cscope 15 $HOME/frr-topo/tests/topotests               0000636359
	@all-protocol-startup/test_all_protocol_startup.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_®l_´ÙocŞ_¡¬tup.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_®l_´ÙocŞ_¡¬tup
.
	gpy
: 
Te¡
 
of
 
®l
 
´ÙocŞs
 
©
 
§me
 
time


30 
impÜt
 
os


31 
impÜt
 
»


32 
impÜt
 
sys


33 
impÜt
 
py‹¡


34 
impÜt
 
glob


35 
äom
 
time
 
impÜt
 
¦“p


37 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


38 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


39 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


40 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


41 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


42 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


44 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


46 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

47 
äom
 
lib
 
impÜt
 
tİÙe¡


49 
çl_”rÜ
 = ""

54 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


58 
şass
 
	$N‘wÜkTİo
(
Tİo
):

61 
def
 
	$bud
(
£lf
, **
_İts
):

63 #S‘u°
Rou‹rs


64 
rou‹r
 = {
	}
}

65 #
#S‘u°
Maš
 
Rou‹r


67 
rou‹r
[1] = 
tİÙe¡
.
addRou‹r
(
£lf
, 'r1')

70 #S‘u°
Sw™ches


72 #

i
 
š
 
¿nge
(0, 10):

74 [
i
] = 
£lf
.
addSw™ch
('sw%s' % i, 
şs
=
tİÙe¡
.
LegacySw™ch
)

75 
£lf
.
addLšk
([
i
], 
rou‹r
[1], 
štfName2
='r1-eth%s' % i )

80 ## 
Te¡s
 
¡¬tšg


84 
def
 
	$£tup_moduË
(
moduË
):

85 
glob®
 
tİo
, 
Ãt


86 
glob®
 
çl_”rÜ


88 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

89 
	`´št
("******************************************\n")

91 
	`´št
("Cleanup old Mininet„uns")

92 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

93 
os
.
	`sy¡em
('sudo„m /tmp/r* > /dev/null 2>&1')

95 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

96 
tİo
 = 
	$N‘wÜkTİo
()

98 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

99 
Ãt
.
	$¡¬t
()

101 
Ãt
['r1'].
	`g‘_rou‹¹y³
() != 'frr':

102 
çl_”rÜ
 = "Test is only implemented for FRR"

103 
sys
.
¡d”r
.
	`wr™e
('\n\nTest is only implemented for FRR - Skipping\n\n')

104 
py‹¡
.
	$sk
(
çl_”rÜ
)

106 #S¹šg 
Rou‹rs


107 #
#Maš 
rou‹r


109 
i
 
š
 
	$¿nge
(1, 2):

110 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

111 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('rd', '%s/r%s/rd.cÚf' % (
thisDœ
, i))

112 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('rngd', '%s/r%s/rngd.cÚf' % (
thisDœ
, i))

113 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('o¥fd', '%s/r%s/o¥fd.cÚf' % (
thisDœ
, i))

114 
Ãt
['r1'].
	`checkRou‹rV”siÚ
('<', '4.0'):

115 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('o¥f6d', '%s/r%s/o¥f6d.cÚf-´e-v4' % (
thisDœ
, i))

117 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('o¥f6d', '%s/r%s/o¥f6d.cÚf' % (
thisDœ
, i))

118 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('isisd', '%s/r%s/isisd.cÚf' % (
thisDœ
, i))

119 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('bgpd', '%s/r%s/bgpd.cÚf' % (
thisDœ
, i))

120 
Ãt
['r%s' % 
i
].
	`d«mÚ_avaabË
('ldpd'):

121 #OÆy 
‹¡
 
LDPd
 
™
's installed‡nd Kernel >= 4.5

122 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('ldpd', '%s/r%s/ldpd.cÚf' % (
thisDœ
, i))

123 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

125 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Quagga
/
FRR
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


126 #CLI(
Ãt
)

129 
def
 
	$‹¬down_moduË
(
moduË
):

130 
glob®
 
Ãt


132 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

133 
	`´št
("******************************************\n")

135 #End - 
Shutdown
 
ÃtwÜk


136 
Ãt
.
	$¡İ
()

139 
def
 
	$‹¡_rou‹r_ruÂšg
():

140 
glob®
 
çl_”rÜ


141 
glob®
 
Ãt


143 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


144 ià(
çl_”rÜ
 != ""):

145 
py‹¡
.
	$sk
(
çl_”rÜ
)

147 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

148 
	`´št
("******************************************\n")

149 
	$¦“p
(5)

151 #S¹šg 
Rou‹rs


152 
i
 
š
 
	$¿nge
(1, 2):

153 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

154 
as£¹
 
çl_”rÜ
 == "", fatal_error

156 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


157 #CLI(
Ãt
)

160 
def
 
	$‹¡_”rÜ_mes§ges_vtysh
():

161 
glob®
 
çl_”rÜ


162 
glob®
 
Ãt


164 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


165 ià(
çl_”rÜ
 != ""):

166 
py‹¡
.
	$sk
(
çl_”rÜ
)

168 
	`´št
("\n\n** Check forƒrror messages on VTYSH")

169 
	`´št
("******************************************\n")

171 
çu»s
 = 0

172 
i
 
š
 
	$¿nge
(1, 2):

173 #
#Fœ¡ 
checkšg
 
Snd¬d
 
Ouut


177 #VTYSH 
ouut
 
äom
 
rou‹r


178 
vty¡dout
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show v”siÚ" 2> /dev/nuÎ').
	$r¡r
()

180 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

181 
vty¡dout
 = ('\n'.
	`još
(vty¡dout.
	`¥l™lšes
()è+ '\n').
	$r¡r
()

182 #Drİ 
ev”ythšg
 
¡¬tšg
 
w™h
 "FRRoutšg X.xx" 
mes§ge


183 
vty¡dout
 = 
»
.
	`sub
(
r
"FRRoutšg [0-9]+.*", "", vty¡dout, 
æags
ôe.
DOTALL
)

185 ià(
vty¡dout
 == ''):

186 
	`´št
("r% StdOuˆok" % 
i
)

188 
as£¹
 
vty¡dout
 =ğ'', "Vtysh StdOuˆOuuˆcheck faed fÜ„ou‹¸r%s" % 
i


190 #
#SecÚd 
checkšg
 
Snd¬d
 
E¼Ü


194 #VTYSH 
StdE¼
 
ouut
 
äom
 
rou‹r


195 
vty¡d”r
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show v”siÚ" > /dev/nuÎ').
	$r¡r
()

197 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

198 
vty¡d”r
 = ('\n'.
	`još
(vty¡d”r.
	`¥l™lšes
()è+ '\n').
	$r¡r
()

199 ## 
Drİ
 
ev”ythšg
 
¡¬tšg
 
w™h
 "FRRoutšg X.xx" 
mes§ge


200 #vty¡d”¸ğ
»
.
	`sub
(
r
"FRRoutšg [0-9]+.*", "", 
vty¡d”r
, 
æags
ôe.
DOTALL
)

202 ià(
vty¡d”r
 == ''):

203 
	`´št
("r% StdE¼ ok" % 
i
)

205 
as£¹
 
vty¡d”r
 =ğ'', "Vtysh StdE¼ Ouuˆcheck faed fÜ„ou‹¸r%s" % 
i


207 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


208 
i
 
š
 
	$¿nge
(1, 2):

209 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

210 
as£¹
 
çl_”rÜ
 == "", fatal_error

212 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


213 #CLI(
Ãt
)

216 
def
 
	$‹¡_”rÜ_mes§ges_d«mÚs
():

217 
glob®
 
çl_”rÜ


218 
glob®
 
Ãt


220 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


221 ià(
çl_”rÜ
 != ""):

222 
py‹¡
.
	$sk
(
çl_”rÜ
)

224 
	`´št
("\n\n** Check forƒrror messages in daemons")

225 
	`´št
("******************************************\n")

227 
”rÜ_logs
 = ""

229 
i
 
š
 
	$¿nge
(1, 2):

230 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ripd')

231 
log
:

232 
”rÜ_logs
 +ğ"r% RIPd StdE¼ Ouut:\n" % 
i


233 
”rÜ_logs
 +ğ
log


234 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ripngd')

235 
log
:

236 
”rÜ_logs
 +ğ"r% RIPngd StdE¼ Ouut:\n" % 
i


237 
”rÜ_logs
 +ğ
log


238 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ospfd')

239 
log
:

240 
”rÜ_logs
 +ğ"r% OSPFd StdE¼ Ouut:\n" % 
i


241 
”rÜ_logs
 +ğ
log


242 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ospf6d')

243 
log
:

244 
”rÜ_logs
 +ğ"r% OSPF6d StdE¼ Ouut:\n" % 
i


245 
”rÜ_logs
 +ğ
log


246 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('isisd')

247 #ISIS 
shows
 
debuggšg
 
’abËd
 
¡©us
 
Ú
 
StdE¼


248 #Remov
the£
 
mes§ges


249 
log
 = 
»
.
	`sub
(
r
"^IS-IS .* debuggšg i Ú.*", "",†og).
	$r¡r
()

250 
log
:

251 
”rÜ_logs
 +ğ"r% ISISd StdE¼ Ouut:\n" % 
i


252 
”rÜ_logs
 +ğ
log


253 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('bgpd')

254 
log
:

255 
”rÜ_logs
 +ğ"r% BGPd StdE¼ Ouut:\n" % 
i


256 
”rÜ_logs
 +ğ
log


257 ià(
Ãt
['r%s' % 
i
].
	`d«mÚ_avaabË
('ldpd')):

258 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ldpd')

259 
log
:

260 
”rÜ_logs
 +ğ"r% LDPd StdE¼ Ouut:\n" % 
i


261 
”rÜ_logs
 +ğ
log


262 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('zebra')

263 
log
:

264 
”rÜ_logs
 += "r%s Zebra StdErr Output:\n"

265 
”rÜ_logs
 +ğ
log


267 
”rÜ_logs
:

268 
sys
.
¡d”r
.
	`wr™e
('Faed check fÜ StdE¼ OuuˆÚ d«mÚs:\n%s\n' % 
”rÜ_logs
)

270 #IgnÜšg 
the
 
issue
 
tŞd
 
to
 
	`ignÜe
 (
›
 
nÙ
 
y‘
 
fixed
)

271 ià(
”rÜ_logs
 != ""):

272 ià(
os
.
’vœÚ
.
	`g‘
('bamboo_TOPOTESTS_ISSUE_349') == "IGNORE"):

273 
sys
.
¡d”r
.
	`wr™e
('Known issue - IGNORING. See https://github.com/FRRouting/frr/issues/349\n')

274 
py‹¡
.
	`sk
('Known issue - IGNORING. See https://github.com/FRRouting/frr/issues/349')

276 
as£¹
 
”rÜ_logs
 == "", "Daemons„eportƒrrorso StdErr"

278 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


279 #CLI(
Ãt
)

282 
def
 
	$‹¡_cÚv”ge_´ÙocŞs
():

283 
glob®
 
çl_”rÜ


284 
glob®
 
Ãt


286 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


287 ià(
çl_”rÜ
 != ""):

288 
py‹¡
.
	$sk
(
çl_”rÜ
)

290 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

292 
	`´št
("\n\n** Waiting for…rotocols convergence")

293 
	`´št
("******************************************\n")

295 #NÙ 
»®ly
 
im¶em’‹d
 
y‘
 - 
ju¡
 
¦“p
 60 
£cs
 
now


296 
	$¦“p
(60)

298 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


299 
çu»s
 = 0

300 
i
 
š
 
	$¿nge
(1, 2):

301 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

302 
as£¹
 
çl_”rÜ
 == "", fatal_error

304 
	`´št
("Showhat v4„outes‡re„ight\n");

305 
v4_rou‹sFe
 = '%s/r%s/v4_rou‹s.»f' % (
thisDœ
, 
i
)

306 
ex³ùed
 = 
	`İ’
(
v4_rou‹sFe
).
	`»ad
().
	$r¡r
()

307 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

309 
aùu®
 = 
Ãt
['r%s' %
i
].
	`cmd
('vtysh -ø"show i°rou‹" | /u¤/bš/ -À+7 | sÜˆ2> /dev/nuÎ').
	$r¡r
()

310 #Drİ 
time
 
š
 
Ï¡
 
upd©e


311 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

312 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

313 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

314 
t™Ë1
="Actual IP Routing Table",

315 
t™Ë2
="Expected IP RoutingTable")

316 
diff
:

317 
sys
.
¡d”r
.
	`wr™e
('r% çed IP RoutšgabË check:\n%s\n' % (
i
, 
diff
))

318 
çu»s
 += 1

320 
	`´št
("r% ok" %
i
)

322 
as£¹
 
çu»s
 =ğ0, "IP RoutšgabË faed fÜ„%s\n%s" % (
i
, 
diff
)

324 
çu»s
 = 0

326 
	`´št
("Showhat v6„outes‡re„ight\n")

327 
v6_rou‹sFe
 = '%s/r%s/v6_rou‹s.»f' % (
thisDœ
, 
i
)

328 
ex³ùed
 = 
	`İ’
(
v6_rou‹sFe
).
	`»ad
().
	$r¡r
()

329 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

331 
aùu®
 = 
Ãt
['r%s' %
i
].
	`cmd
('vtysh -ø"show ipv6„ou‹" | /u¤/bš/ -À+7 | sÜˆ2> /dev/nuÎ').
	$r¡r
()

332 #Drİ 
time
 
š
 
Ï¡
 
upd©e


333 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

334 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

335 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

336 
t™Ë1
="Actual IPv6 Routing Table",

337 
t™Ë2
="Expected IPv6 RoutingTable")

338 
diff
:

339 
sys
.
¡d”r
.
	`wr™e
('r% çed IPv6 RoutšgabË check:\n%s\n' % (
i
, 
diff
))

340 
çu»s
 += 1

342 
	`´št
("r% ok" %
i
)

344 
as£¹
 
çu»s
 =ğ0, "IPv6 RoutšgabË faed fÜ„%s\n%s" % (
i
, 
diff
)

346 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


347 ## 
	`CLI
(
Ãt
)

350 
def
 
	$‹¡_r_¡©us
():

351 
glob®
 
çl_”rÜ


352 
glob®
 
Ãt


354 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


355 ià(
çl_”rÜ
 != ""):

356 
py‹¡
.
	$sk
(
çl_”rÜ
)

358 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

360 
	`´št
("\n\n** Verifying RIP status")

361 
	`´št
("******************************************\n")

362 
çu»s
 = 0

363 
i
 
š
 
	$¿nge
(1, 2):

364 
»fTabËFe
 = '%s/r%s/r_¡©us.»f' % (
thisDœ
, 
i
)

365 
os
.
·th
.
	$isfe
(
»fTabËFe
):

366 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


367 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

368 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

369 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

371 #Aùu® 
ouut
 
äom
 
rou‹r


372 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°r stus" 2> /dev/nuÎ').
	$r¡r
()

373 #Drİ 
time
 
š
 
Ãxt
 
due


374 
aùu®
 = 
»
.
	`sub
(
r
"in [0-9]+ seconds", "in XX seconds",‡ctual)

375 #Drİ 
time
 
š
 
Ï¡
 
upd©e


376 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

377 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

378 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

380 #G’”©
Diff


381 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

382 
t™Ë1
="actual IP RIP status",

383 
t™Ë2
="expected IP RIP status")

385 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

386 
diff
:

387 
sys
.
¡d”r
.
	`wr™e
('r% çed IP RIP stu check:\n%s\n' % (
i
, 
diff
))

388 
çu»s
 += 1

390 
	`´št
("r% ok" % 
i
)

392 
as£¹
 
çu»s
 =ğ0, "IP RIP stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

394 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


395 
i
 
š
 
	$¿nge
(1, 2):

396 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

397 
as£¹
 
çl_”rÜ
 == "", fatal_error

399 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


400 #CLI(
Ãt
)

403 
def
 
	$‹¡_rng_¡©us
():

404 
glob®
 
çl_”rÜ


405 
glob®
 
Ãt


407 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


408 ià(
çl_”rÜ
 != ""):

409 
py‹¡
.
	$sk
(
çl_”rÜ
)

411 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

413 
	`´št
("\n\n** Verifying RIPng status")

414 
	`´št
("******************************************\n")

415 
çu»s
 = 0

416 
i
 
š
 
	$¿nge
(1, 2):

417 
»fTabËFe
 = '%s/r%s/rng_¡©us.»f' % (
thisDœ
, 
i
)

418 
os
.
·th
.
	$isfe
(
»fTabËFe
):

419 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


420 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

421 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

422 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

424 #Aùu® 
ouut
 
äom
 
rou‹r


425 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show ipv6„ng stus" 2> /dev/nuÎ').
	$r¡r
()

426 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

427 
aùu®
 = 
»
.
	`sub
(
r
" fe80::[0-9a-f:]+", " fe80::XXXX:XXXX:XXXX:XXXX",‡ctual)

428 #Drİ 
time
 
š
 
Ãxt
 
due


429 
aùu®
 = 
»
.
	`sub
(
r
"in [0-9]+ seconds", "in XX seconds",‡ctual)

430 #Drİ 
time
 
š
 
Ï¡
 
upd©e


431 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

432 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

433 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

435 #G’”©
Diff


436 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

437 
t™Ë1
="actual IPv6 RIPng status",

438 
t™Ë2
="expected IPv6 RIPng status")

440 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

441 
diff
:

442 
sys
.
¡d”r
.
	`wr™e
('r% çed IPv6 RIPng stu check:\n%s\n' % (
i
, 
diff
))

443 
çu»s
 += 1

445 
	`´št
("r% ok" % 
i
)

447 
as£¹
 
çu»s
 =ğ0, "IPv6 RIPng stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

449 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


450 
i
 
š
 
	$¿nge
(1, 2):

451 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

452 
as£¹
 
çl_”rÜ
 == "", fatal_error

454 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


455 #CLI(
Ãt
)

458 
def
 
	$‹¡_o¥fv2_š‹rçûs
():

459 
glob®
 
çl_”rÜ


460 
glob®
 
Ãt


462 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


463 ià(
çl_”rÜ
 != ""):

464 
py‹¡
.
	$sk
(
çl_”rÜ
)

466 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

468 
	`´št
("\n\n** Verifying OSPFv2 interfaces")

469 
	`´št
("******************************************\n")

470 
çu»s
 = 0

471 
i
 
š
 
	$¿nge
(1, 2):

472 
»fTabËFe
 = '%s/r%s/show__o¥f_š‹rçû.»f' % (
thisDœ
, 
i
)

473 
os
.
·th
.
	$isfe
(
»fTabËFe
):

474 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


475 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

476 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

477 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

479 #Aùu® 
ouut
 
äom
 
rou‹r


480 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°o¥àš‹rçû" 2> /dev/nuÎ').
	$r¡r
()

481 #Mask 
out
 
Bªdwidth
 
pÜtiÚ
. 
They
 
may
 
chªge
..

482 
aùu®
 = 
»
.
	`sub
(
r
"BW [0-9]+ Mbit", "BW XX Mbit",‡ctual)

483 #Drİ 
time
 
š
 
Ãxt
 
due


484 
aùu®
 = 
»
.
	`sub
(
r
"Hello due in [0-9\.]+s", "Hello due in XX.XXXs",‡ctual)

485 #Fix 'MTU mism©ch d‘eùiÚ:ƒÇbËd' 
vs
 'MTU mism©ch d‘eùiÚ:’abËd' - 
acû±
 
bÙh


486 
aùu®
 = 
»
.
	`sub
(
r
"MTU mismatch detection:([a-z]+.*)",„"MTU mismatch detection: \1",‡ctual)

487 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

488 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

490 #G’”©
Diff


491 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

492 
t™Ë1
="actual SHOW IP OSPF INTERFACE",

493 
t™Ë2
="expected SHOW IP OSPF INTERFACE")

495 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

496 
diff
:

497 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW IP OSPF INTERFACE check:\n%s\n' % (
i
, 
diff
))

498 
çu»s
 += 1

500 
	`´št
("r% ok" % 
i
)

502 #IgnÜšg 
the
 
issue
 
tŞd
 
to
 
	`ignÜe
 (
›
 
nÙ
 
y‘
 
fixed
)

503 ià(
çu»s
 != 0):

504 ià(
os
.
’vœÚ
.
	`g‘
('bamboo_TOPOTESTS_ISSUE_348') == "IGNORE"):

505 
sys
.
¡d”r
.
	`wr™e
('Known issue - IGNORING. See https://github.com/FRRouting/frr/issues/348\n')

506 
py‹¡
.
	`sk
('Known issue - IGNORING. See https://github.com/FRRouting/frr/issues/348')

508 
as£¹
 
çu»s
 =ğ0, "SHOW IP OSPF INTERFACE faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

510 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


511 
i
 
š
 
	$¿nge
(1, 2):

512 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

513 
as£¹
 
çl_”rÜ
 == "", fatal_error

515 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


516 #CLI(
Ãt
)

519 
def
 
	$‹¡_isis_š‹rçûs
():

520 
glob®
 
çl_”rÜ


521 
glob®
 
Ãt


523 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


524 ià(
çl_”rÜ
 != ""):

525 
py‹¡
.
	$sk
(
çl_”rÜ
)

527 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

529 
	`´št
("\n\n** Verifying ISIS interfaces")

530 
	`´št
("******************************************\n")

531 
çu»s
 = 0

532 
i
 
š
 
	$¿nge
(1, 2):

533 
»fTabËFe
 = '%s/r%s/show_isis_š‹rçû_d‘a.»f' % (
thisDœ
, 
i
)

534 
os
.
·th
.
	$isfe
(
»fTabËFe
):

535 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


536 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

537 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

538 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

540 #Aùu® 
ouut
 
äom
 
rou‹r


541 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show isi š‹rçû d‘a" 2> /dev/nuÎ').
	$r¡r
()

542 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

543 
aùu®
 = 
»
.
	`sub
(
r
"fe80::[0-9a-f:]+", "fe80::XXXX:XXXX:XXXX:XXXX",‡ctual)

544 #Mask 
out
 
SNPA
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

545 
aùu®
 = 
»
.
	`sub
(
r
"SNPA: [0-9a-f\.]+", "SNPA: XXXX.XXXX.XXXX",‡ctual)

546 #Mask 
out
 
Cœcu™
 
ID
 
numb”


547 
aùu®
 = 
»
.
	`sub
(
r
"Circuit Id: 0x[0-9]+", "Circuit Id: 0xXX",‡ctual)

548 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

549 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

551 #G’”©
Diff


552 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

553 
t™Ë1
="actual SHOW ISIS INTERFACE DETAIL",

554 
t™Ë2
="expected SHOW ISIS OSPF6 INTERFACE DETAIL")

556 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

557 
diff
:

558 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW ISIS INTERFACE DETAIL check:\n%s\n' % (
i
, 
diff
))

559 
çu»s
 += 1

561 
	`´št
("r% ok" % 
i
)

563 
as£¹
 
çu»s
 =ğ0, "SHOW ISIS INTERFACE DETAIL faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

565 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


566 
i
 
š
 
	$¿nge
(1, 2):

567 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

568 
as£¹
 
çl_”rÜ
 == "", fatal_error

570 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


571 #CLI(
Ãt
)

574 
def
 
	$‹¡_bgp_summ¬y
():

575 
glob®
 
çl_”rÜ


576 
glob®
 
Ãt


578 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


579 ià(
çl_”rÜ
 != ""):

580 
py‹¡
.
	$sk
(
çl_”rÜ
)

582 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

584 
	`´št
("\n\n** Verifying BGP Summary")

585 
	`´št
("******************************************\n")

586 
çu»s
 = 0

587 
i
 
š
 
	$¿nge
(1, 2):

588 
»fTabËFe
 = '%s/r%s/show__bgp_summ¬y.»f' % (
thisDœ
, 
i
)

589 
os
.
·th
.
	$isfe
(
»fTabËFe
):

590 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


591 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

592 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

593 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

595 #Aùu® 
ouut
 
äom
 
rou‹r


596 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°bg°summ¬y" 2> /dev/nuÎ').
	$r¡r
()

597 #Mask 
out
 "usšg XXiXX by‹s" 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

598 
aùu®
 = 
»
.
	`sub
(
r
"using [0-9]+ bytes", "using XXXX bytes",‡ctual)

599 #Mask 
out
 "usšg XiXXX KiB" 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

600 
aùu®
 = 
»
.
	`sub
(
r
"using [0-9]+ KiB", "using XXXX KiB",‡ctual)

601 #
#Remov
exŒa
 
summ¬›s
 
which
 
exi¡
 
w™h
 
Ãw”
 
v”siÚs


603 #
#Remov
summ¬y
 
	`lšes
 (
chªged
 
»ûÁly
)

605 
aùu®
 = 
»
.
	`sub
(
r
'Total‚umber.*', '',‡ctual)

606 
aùu®
 = 
»
.
	`sub
(
r
'Displayed.*', '',‡ctual)

607 #Remov
IPv4
 
Uniÿ¡
 
	`Summ¬y
 (
T™Ë
 
Úly
)

608 
aùu®
 = 
»
.
	`sub
(
r
'IPv4 Unicast Summary:', '',‡ctual)

609 #Remov
IPv4
 
MuÉiÿ¡
 
	`Summ¬y
 (
®l
 
of
 
™
)

610 
aùu®
 = 
»
.
	`sub
(
r
'IPv4 Multicast Summary:', '',‡ctual)

611 
aùu®
 = 
»
.
	`sub
(
r
'No IPv4 Multicast‚eighbor is configured', '',‡ctual)

612 #Remov
IPv4
 
VPN
 
	`Summ¬y
 (
®l
 
of
 
™
)

613 
aùu®
 = 
»
.
	`sub
(
r
'IPv4 VPN Summary:', '',‡ctual)

614 
aùu®
 = 
»
.
	`sub
(
r
'No IPv4 VPN‚eighbor is configured', '',‡ctual)

615 #Remov
IPv4
 
Enÿp
 
	`Summ¬y
 (
®l
 
of
 
™
)

616 
aùu®
 = 
»
.
	`sub
(
r
'IPv4 Encap Summary:', '',‡ctual)

617 
aùu®
 = 
»
.
	`sub
(
r
'No IPv4 Encap‚eighbor is configured', '',‡ctual)

618 #Remov
Unknown
 
	`Summ¬y
 (
®l
 
of
 
™
)

619 
aùu®
 = 
»
.
	`sub
(
r
'Unknown Summary:', '',‡ctual)

620 
aùu®
 = 
»
.
	`sub
(
r
'No Unknown‚eighbor is configured', '',‡ctual)

622 
aùu®
 = 
»
.
	`sub
(
r
'IPv4†abeled-unicast Summary:', '',‡ctual)

623 
aùu®
 = 
»
.
	`sub
(
r
'No IPv4†abeled-unicast‚eighbor is configured', '',‡ctual)

625 #SŒ 
em±y
 
lšes


626 
aùu®
 =‡ùu®.
	$l¡r
()

627 
aùu®
 =‡ùu®.
	$r¡r
()

628 #
#Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

630 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

632 #G’”©
Diff


633 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

634 
t™Ë1
="actual SHOW IP BGP SUMMARY",

635 
t™Ë2
="expected SHOW IP BGP SUMMARY")

637 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

638 
diff
:

639 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW IP BGP SUMMARY check:\n%s\n' % (
i
, 
diff
))

640 
çu»s
 += 1

642 
	`´št
("r% ok" % 
i
)

644 
as£¹
 
çu»s
 =ğ0, "SHOW IP BGP SUMMARY faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

646 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


647 
i
 
š
 
	$¿nge
(1, 2):

648 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

649 
as£¹
 
çl_”rÜ
 == "", fatal_error

651 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


652 #CLI(
Ãt
)

655 
def
 
	$‹¡_bgp_v6_summ¬y
():

656 
glob®
 
çl_”rÜ


657 
glob®
 
Ãt


659 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


660 ià(
çl_”rÜ
 != ""):

661 
py‹¡
.
	$sk
(
çl_”rÜ
)

663 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

665 
	`´št
("\n\n** Verifying BGP IPv6 Summary")

666 
	`´št
("******************************************\n")

667 
çu»s
 = 0

668 
i
 
š
 
	$¿nge
(1, 2):

669 
»fTabËFe
 = '%s/r%s/show_bgp_v6_summ¬y.»f' % (
thisDœ
, 
i
)

670 
os
.
·th
.
	$isfe
(
»fTabËFe
):

671 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


672 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

673 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

674 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

676 #Aùu® 
ouut
 
äom
 
rou‹r


677 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show bg°v6 summ¬y" 2> /dev/nuÎ').
	$r¡r
()

678 #Mask 
out
 "usšg XXiXX by‹s" 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

679 
aùu®
 = 
»
.
	`sub
(
r
"using [0-9]+ bytes", "using XXXX bytes",‡ctual)

680 #Mask 
out
 "usšg XiXXX KiB" 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

681 
aùu®
 = 
»
.
	`sub
(
r
"using [0-9]+ KiB", "using XXXX KiB",‡ctual)

682 #
#Remov
exŒa
 
summ¬›s
 
which
 
exi¡
 
w™h
 
Ãw”
 
v”siÚs


684 #
#Remov
summ¬y
 
	`lšes
 (
chªged
 
»ûÁly
)

686 
aùu®
 = 
»
.
	`sub
(
r
'Total‚umber.*', '',‡ctual)

687 
aùu®
 = 
»
.
	`sub
(
r
'Displayed.*', '',‡ctual)

688 #Remov
IPv4
 
Uniÿ¡
 
	`Summ¬y
 (
T™Ë
 
Úly
)

689 
aùu®
 = 
»
.
	`sub
(
r
'IPv6 Unicast Summary:', '',‡ctual)

690 #Remov
IPv4
 
MuÉiÿ¡
 
	`Summ¬y
 (
®l
 
of
 
™
)

691 
aùu®
 = 
»
.
	`sub
(
r
'IPv6 Multicast Summary:', '',‡ctual)

692 
aùu®
 = 
»
.
	`sub
(
r
'No IPv6 Multicast‚eighbor is configured', '',‡ctual)

693 #Remov
IPv4
 
VPN
 
	`Summ¬y
 (
®l
 
of
 
™
)

694 
aùu®
 = 
»
.
	`sub
(
r
'IPv6 VPN Summary:', '',‡ctual)

695 
aùu®
 = 
»
.
	`sub
(
r
'No IPv6 VPN‚eighbor is configured', '',‡ctual)

696 #Remov
IPv4
 
Enÿp
 
	`Summ¬y
 (
®l
 
of
 
™
)

697 
aùu®
 = 
»
.
	`sub
(
r
'IPv6 Encap Summary:', '',‡ctual)

698 
aùu®
 = 
»
.
	`sub
(
r
'No IPv6 Encap‚eighbor is configured', '',‡ctual)

699 #Remov
Unknown
 
	`Summ¬y
 (
®l
 
of
 
™
)

700 
aùu®
 = 
»
.
	`sub
(
r
'Unknown Summary:', '',‡ctual)

701 
aùu®
 = 
»
.
	`sub
(
r
'No Unknown‚eighbor is configured', '',‡ctual)

703 #Remov
Lab–ed
 
Uniÿ¡
 
	`Summ¬y
 (
®l
 
of
 
™
)

704 
aùu®
 = 
»
.
	`sub
(
r
'IPv6†abeled-unicast Summary:', '',‡ctual)

705 
aùu®
 = 
»
.
	`sub
(
r
'No IPv6†abeled-unicast‚eighbor is configured', '',‡ctual)

707 #SŒ 
em±y
 
lšes


708 
aùu®
 =‡ùu®.
	$l¡r
()

709 
aùu®
 =‡ùu®.
	$r¡r
()

710 #
#Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

712 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

714 #G’”©
Diff


715 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

716 
t™Ë1
="actual SHOW BGP IPv6 SUMMARY",

717 
t™Ë2
="expected SHOW BGP IPv6 SUMMARY")

719 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

720 
diff
:

721 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW BGP IPv6 SUMMARY check:\n%s\n' % (
i
, 
diff
))

722 
çu»s
 += 1

724 
	`´št
("r% ok" % 
i
)

726 
as£¹
 
çu»s
 =ğ0, "SHOW BGP IPv6 SUMMARY faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

728 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


729 
i
 
š
 
	$¿nge
(1, 2):

730 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

731 
as£¹
 
çl_”rÜ
 == "", fatal_error

733 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


734 #CLI(
Ãt
)

737 
def
 
	$‹¡_bgp_v4
():

738 
glob®
 
çl_”rÜ


739 
glob®
 
Ãt


741 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


742 ià(
çl_”rÜ
 != ""):

743 
py‹¡
.
	$sk
(
çl_”rÜ
)

745 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

747 
	`´št
("\n\n** Verifying BGP IPv4")

748 
	`´št
("******************************************\n")

749 
difäesuÉ
 = {
	}
}

750 
i
 
š
 
	$¿nge
(1, 2):

751 
sucûss
 = 0

752 
»fTabËFe
 
	`š
 (
glob
.
	`glob
(

753 '%s/r%s/show_bgp_v4*.»f' % (
thisDœ
, 
i
))):

754 
os
.
·th
.
	$isfe
(
»fTabËFe
):

755 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


756 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

757 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

758 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

760 #Aùu® 
ouut
 
äom
 
rou‹r


761 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show bg°v4" 2> /dev/nuÎ').
	$r¡r
()

762 #Remov
summ¬y
 
	`lše
 (
chªged
 
»ûÁly
)

763 
aùu®
 = 
»
.
	`sub
(
r
'Total‚umber.*', '',‡ctual)

764 
aùu®
 = 
»
.
	`sub
(
r
'Displayed.*', '',‡ctual)

765 
aùu®
 =‡ùu®.
	$r¡r
()

766 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

767 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

769 #G’”©
Diff


770 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

771 
t™Ë1
="actual SHOW BGP IPv4",

772 
t™Ë2
="expected SHOW BGP IPv4")

774 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

775 
diff
:

776 
difäesuÉ
[
»fTabËFe
] = 
diff


778 
sucûss
 = 1

779 
	`´št
("‹m¶©% m©ched:„% ok" % (
»fTabËFe
, 
i
))

782 
nÙ
 
sucûss
:

783 
»suÉ¡r
 = 'Noemplate matched.\n'

784 
f
 
š
 
difäesuÉ
.
	$™”keys
():

785 
»suÉ¡r
 += (

787 % (
f
, 
i
, 
difäesuÉ
[f]))

788 
¿i£
 
	`As£¹iÚE¼Ü
(

789 "SHOW BGP IPv4 faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
»suÉ¡r
))

791 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


792 
i
 
š
 
	$¿nge
(1, 2):

793 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

794 
as£¹
 
çl_”rÜ
 == "", fatal_error

796 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


797 #CLI(
Ãt
)

800 
def
 
	$‹¡_bgp_v6
():

801 
glob®
 
çl_”rÜ


802 
glob®
 
Ãt


804 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


805 ià(
çl_”rÜ
 != ""):

806 
py‹¡
.
	$sk
(
çl_”rÜ
)

808 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

810 
	`´št
("\n\n** Verifying BGP IPv6")

811 
	`´št
("******************************************\n")

812 
difäesuÉ
 = {
	}
}

813 
i
 
š
 
	$¿nge
(1, 2):

814 
sucûss
 = 0

815 
»fTabËFe
 
	`š
 (
glob
.
	`glob
(

816 '%s/r%s/show_bgp_v6*.»f' % (
thisDœ
, 
i
))):

817 
os
.
·th
.
	$isfe
(
»fTabËFe
):

818 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


819 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

820 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

821 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

823 #Aùu® 
ouut
 
äom
 
rou‹r


824 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show bg°v6" 2> /dev/nuÎ').
	$r¡r
()

825 #Remov
summ¬y
 
	`lše
 (
chªged
 
»ûÁly
)

826 
aùu®
 = 
»
.
	`sub
(
r
'Total‚umber.*', '',‡ctual)

827 
aùu®
 = 
»
.
	`sub
(
r
'Displayed.*', '',‡ctual)

828 
aùu®
 =‡ùu®.
	$r¡r
()

829 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

830 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

832 #G’”©
Diff


833 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

834 
t™Ë1
="actual SHOW BGP IPv6",

835 
t™Ë2
="expected SHOW BGP IPv6")

837 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

838 
diff
:

839 
difäesuÉ
[
»fTabËFe
] = 
diff


841 
sucûss
 = 1

842 
	`´št
("‹m¶©% m©ched:„% ok" % (
»fTabËFe
, 
i
))

844 
nÙ
 
sucûss
:

845 
»suÉ¡r
 = 'Noemplate matched.\n'

846 
f
 
š
 
difäesuÉ
.
	$™”keys
():

847 
»suÉ¡r
 += (

849 % (
f
, 
i
, 
difäesuÉ
[f]))

850 
¿i£
 
	`As£¹iÚE¼Ü
(

851 "SHOW BGP IPv6 faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
»suÉ¡r
))

853 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


854 
i
 
š
 
	$¿nge
(1, 2):

855 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

856 
as£¹
 
çl_”rÜ
 == "", fatal_error

858 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


859 #CLI(
Ãt
)

863 
def
 
	$‹¡_m¶s_š‹rçûs
():

864 
glob®
 
çl_”rÜ


865 
glob®
 
Ãt


867 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


868 ià(
çl_”rÜ
 != ""):

869 
py‹¡
.
	$sk
(
çl_”rÜ
)

871 #Sk 
no
 
LDP
 
š¡®Ëd
 
Ü
 
Şd
 
k”Ãl


872 ià(
Ãt
['r1'].
	`d«mÚ_avaabË
('ldpd'è=ğ
F®£
):

873 
py‹¡
.
	`sk
("No MPLS or kernel < 4.5")

875 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

877 
	`´št
("\n\n** Verifying MPLS Interfaces")

878 
	`´št
("******************************************\n")

879 
çu»s
 = 0

880 
i
 
š
 
	$¿nge
(1, 2):

881 
»fTabËFe
 = '%s/r%s/show_m¶s_ldp_š‹rçû.»f' % (
thisDœ
, 
i
)

882 
os
.
·th
.
	$isfe
(
»fTabËFe
):

883 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


884 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

885 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

886 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

888 #Aùu® 
ouut
 
äom
 
rou‹r


889 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°š‹rçû" 2> /dev/nuÎ').
	$r¡r
()

890 #Mask 
out
 
Tim”
 
š
 
U±ime


891 
aùu®
 = 
»
.
	`sub
(
r
" [0-9][0-9]:[0-9][0-9]:[0-9][0-9] ", " xx:xx:xx ",‡ctual)

892 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

893 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

895 #G’”©
Diff


896 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

897 
t™Ë1
="actual MPLS LDP interface status",

898 
t™Ë2
="expected MPLS LDP interface status")

900 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

901 
diff
:

902 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLS LDP IÁ”çû stu Check:\n%s\n' % (
i
, 
diff
))

903 
çu»s
 += 1

905 
	`´št
("r% ok" % 
i
)

907 
çu»s
>0:

908 
çl_”rÜ
 = "MPLS LDP Interface status failed"

910 
as£¹
 
çu»s
 =ğ0, "MPLS LDP IÁ”çû stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

912 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


913 
i
 
š
 
	$¿nge
(1, 2):

914 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

915 
as£¹
 
çl_”rÜ
 == "", fatal_error

917 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


918 #CLI(
Ãt
)

921 
def
 
	$‹¡_shutdown_check_¡d”r
():

922 
glob®
 
çl_”rÜ


923 
glob®
 
Ãt


925 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


926 ià(
çl_”rÜ
 != ""):

927 
py‹¡
.
	$sk
(
çl_”rÜ
)

929 
	`´št
("\n\n** Verifying unexpected STDERR output from daemons")

930 
	`´št
("******************************************\n")

932 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

933 
	`´št
("SKIPPED final check on StdErr output: Disabled (TOPOTESTS_CHECK_STDERR undefined)\n")

934 
py‹¡
.
	`sk
('Skippingest for Stderr output')

936 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

938 
	`´št
("thisDœ=" + 
thisDœ
)

940 
Ãt
['r1'].
	$¡İRou‹r
()

942 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ripd')

943 
log
:

944 
	`´št
("\nRIPd StdE¼ Log:\n" + 
log
)

945 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ripngd')

946 
log
:

947 
	`´št
("\nRIPngd StdE¼ Log:\n" + 
log
)

948 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ospfd')

949 
log
:

950 
	`´št
("\nOSPFd StdE¼ Log:\n" + 
log
)

951 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ospf6d')

952 
log
:

953 
	`´št
("\nOSPF6d StdE¼ Log:\n" + 
log
)

954 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('isisd')

955 
log
:

956 
	`´št
("\nISISd StdE¼ Log:\n" + 
log
)

957 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('bgpd')

958 
log
:

959 
	`´št
("\nBGPd StdE¼ Log:\n" + 
log
)

960 ià(
Ãt
['r1'].
	`d«mÚ_avaabË
('ldpd')):

961 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ldpd')

962 
log
:

963 
	`´št
("\nLDPd StdE¼ Log:\n" + 
log
)

964 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('zebra')

965 
log
:

966 
	`´št
("\nZeb¿ StdE¼ Log:\n" + 
log
)

969 
def
 
	$‹¡_shutdown_check_memËak
():

970 
glob®
 
çl_”rÜ


971 
glob®
 
Ãt


973 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


974 ià(
çl_”rÜ
 != ""):

975 
py‹¡
.
	$sk
(
çl_”rÜ
)

977 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
is
 
NÚe
:

978 
	`´št
("SKIPPED final check on Memory†eaks: Disabled (TOPOTESTS_CHECK_MEMLEAK undefined)\n")

979 
py‹¡
.
	`sk
('Skippingest for memory†eaks')

981 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

983 
i
 
š
 
	$¿nge
(1, 2):

984 
Ãt
['r%s' % 
i
].
	$¡İRou‹r
()

985 
Ãt
['r%s' % 
i
].
	`»pÜt_memÜy_Ëaks
(
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'), os.
·th
.
	$ba£Çme
(
__fe__
))

988 
__Çme__
 == '__main__':

990 
	`£tLogLev–
('info')

991 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


992 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

993 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

994 
sys
.
	`ex™
(
»tv®
)

	@bfd-topo1/__init__.py

	@bfd-topo1/test_bfd_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bfd_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2018 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_bfd_tİo1
.
	gpy
: 
Te¡
 
the
 
FRR
/
Quagga
 
BFD
 
d«mÚ
.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
jsÚ


32 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


33 
impÜt
 
py‹¡


35 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

36 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

37 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

39 #pylšt: 
di§bË
=
C0413


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


45 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


48 
şass
 
	$BFDTİo
(
Tİo
):

50 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

52 
tg’
 = 
	$g‘_tİog’
(
£lf
)

54 #C»©4 
rou‹rs


55 
rou‹º
 
š
 
	$¿nge
(1, 5):

56 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

58 ğ
tg’
.
	`add_sw™ch
('s1')

59 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

60 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

62 ğ
tg’
.
	`add_sw™ch
('s2')

63 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

64 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

66 ğ
tg’
.
	`add_sw™ch
('s3')

67 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

68 .
	`add_lšk
(
tg’
.
g—rs
['r4'])

71 
def
 
	$£tup_moduË
(
mod
):

73 
tg’
 = 
	$Tİog’
(
BFDTİo
, 
mod
.
__Çme__
)

74 
tg’
.
	$¡¬t_tİŞogy
()

76 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

77 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

78 
rou‹r
.
	`lßd_cÚfig
(

79 
TİoRou‹r
.
RD_ZEBRA
,

80 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

82 
rou‹r
.
	`lßd_cÚfig
(

83 
TİoRou‹r
.
RD_BFD
,

84 
os
.
·th
.
	`još
(
CWD
, '{}/bfdd.cÚf'.
	$fÜm©
(
ºame
))

86 
rou‹r
.
	`lßd_cÚfig
(

87 
TİoRou‹r
.
RD_BGP
,

88 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

91 #In™Ÿliz
®l
 
rou‹rs
.

92 
tg’
.
	$¡¬t_rou‹r
()

94 #V”ify 
th©
 
we
 
¬e
 
usšg
 
the
 
´İ”
 
v”siÚ
 
ªd
h©h
BFD


95 #d«mÚ 
exi¡s
.

96 
rou‹r
 
š
 
rou‹r_li¡
.
	$v®ues
():

97 #Check 
V”siÚ


98 
rou‹r
.
	`has_v”siÚ
('<', '5.1'):

99 
tg’
.
	`£t_”rÜ
('Unsupported FRR version')

103 
def
 
	$‹¬down_moduË
(
_mod
):

105 
tg’
 = 
	$g‘_tİog’
()

106 
tg’
.
	$¡İ_tİŞogy
()

109 
def
 
	$‹¡_bfd_cÚÃùiÚ
():

111 
tg’
 = 
	$g‘_tİog’
()

112 
tg’
.
	$rou‹rs_have_çu»
():

113 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

115 
logg”
.
	`šfo
('waiting for bfd…eerso go up')

117 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

118 
jsÚ_fe
 = '{}/{}/³”s.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

119 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
jsÚ_fe
).
	$»ad
())

121 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

122 
rou‹r
, 'show bfd…“r jsÚ', 
ex³ùed
)

123 
_
, 
»suÉ
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=8, 
wa™
=0.5)

124 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
rou‹r
.
Çme
)

125 
as£¹
 
»suÉ
 
is
 
NÚe
, 
as£¹msg


128 
def
 
	$‹¡_bgp_cÚv”g’û
():

130 
tg’
 = 
	$g‘_tİog’
()

131 
tg’
.
	$rou‹rs_have_çu»
():

132 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

134 
logg”
.
	`šfo
('waiting for bgp…eerso go up')

136 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

137 
»f_fe
 = '{}/{}/bgp_summ¬y.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

138 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»f_fe
).
	$»ad
())

139 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

140 
rou‹r
, 'show i°bg°summ¬y jsÚ', 
ex³ùed
)

141 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=125, 
wa™
=1.0)

142 
as£¹msg
 = '{}: bg°did‚Ù cÚv”ge'.
	$fÜm©
(
rou‹r
.
Çme
)

143 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


146 
def
 
	$‹¡_bgp_ç¡_cÚv”g’û
():

148 
tg’
 = 
	$g‘_tİog’
()

149 
tg’
.
	$rou‹rs_have_çu»
():

150 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

152 
logg”
.
	`šfo
('waiting for bgp…eers converge')

154 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

155 
»f_fe
 = '{}/{}/bgp_´efixes.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

156 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»f_fe
).
	$»ad
())

157 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

158 
rou‹r
, 'show i°bg°jsÚ', 
ex³ùed
)

159 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=40, 
wa™
=0.5)

160 
as£¹msg
 = '{}: bg°did‚Ù cÚv”ge'.
	$fÜm©
(
rou‹r
.
Çme
)

161 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


164 
def
 
	$‹¡_bfd_ç¡_cÚv”g’û
():

166 
As£¹
 
th©
 
BFD
 
nÙiûs
 
the
 
lšk
 
down
 
aá”
 
simuÏtšg
 
ÃtwÜk


167 
çu»
.

169 
tg’
 = 
	$g‘_tİog’
()

170 
tg’
.
	$rou‹rs_have_çu»
():

171 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

173 #Di§bË 
r1
-
‘h0
 
lšk
.

174 
tg’
.
g—rs
['r1'].
	`lšk_’abË
('r1-‘h0', 
’abËd
=
F®£
)

176 #Wa™ 
the
 
mšimum
 
time
 
we
 
ÿn
 
befÜe
 
checkšg
 
th©
 
BGP
/
BFD


178 
logg”
.
	`šfo
('waiting for BFD converge')

180 #Check 
th©
 
BGP
 
cÚv”ged
 
quickly
.

181 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

182 
jsÚ_fe
 = '{}/{}/³”s.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

183 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
jsÚ_fe
).
	$»ad
())

185 #Lßd 
the
 
§me
 
fe
 
as
 
´evious
 
‹¡
, 
but
 
ex³ù
 
R1
 
to
 
be
 
down
.

186 
rou‹r
.
Çme
 == 'r1':

187 
³”
 
š
 
ex³ùed
:

188 
³”
['peer'] == '192.168.0.2':

189 
³”
['status'] = 'down'

191 
³”
 
š
 
ex³ùed
:

192 
³”
['peer'] == '192.168.0.1':

193 
³”
['status'] = 'down'

195 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

196 
rou‹r
, 'show bfd…“r jsÚ', 
ex³ùed
)

197 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=20, 
wa™
=0.5)

198 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
rou‹r
.
Çme
)

199 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


202 
def
 
	$‹¡_bgp_ç¡_»cÚv”g’û
():

204 
tg’
 = 
	$g‘_tİog’
()

205 
tg’
.
	$rou‹rs_have_çu»
():

206 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

208 
logg”
.
	`šfo
('waiting for BGP„e convergence')

210 #Check 
th©
 
BGP
 
cÚv”ged
 
quickly
.

211 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

212 
»f_fe
 = '{}/{}/bgp_´efixes.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

213 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»f_fe
).
	$»ad
())

215 #Lßd 
the
 
§me
 
fe
 
as
 
´evious
 
‹¡
, 
but
 
£t
 
ÃtwÜks
 
to
 
NÚe


216 #tØ
‹¡
 
ab£nû
.

217 
rou‹r
.
Çme
 == 'r1':

218 
ex³ùed
['rou‹s']['10.254.254.2/32'] = 
NÚe


219 
ex³ùed
['rou‹s']['10.254.254.3/32'] = 
NÚe


220 
ex³ùed
['rou‹s']['10.254.254.4/32'] = 
NÚe


222 
ex³ùed
['rou‹s']['10.254.254.1/32'] = 
NÚe


224 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

225 
rou‹r
, 'show i°bg°jsÚ', 
ex³ùed
)

226 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(

227 
‹¡_func
,

228 
NÚe
,

229 
couÁ
=3,

230 
wa™
=1

232 
as£¹msg
 = '{}: bg°did‚Ù cÚv”ge'.
	$fÜm©
(
rou‹r
.
Çme
)

233 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


236 
def
 
	$‹¡_memÜy_Ëak
():

238 
tg’
 = 
	$g‘_tİog’
()

239 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

240 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

242 
tg’
.
	$»pÜt_memÜy_Ëaks
()

245 
__Çme__
 == '__main__':

246 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

247 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@bfd-topo2/__init__.py

	@bfd-topo2/test_bfd_topo2.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bfd_tİo2.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2019 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_bfd_tİo2
.
	gpy
: 
Te¡
 
the
 
FRR
/
Quagga
 
BFD
 
d«mÚ
 
w™h
 
muÉihİ
 
ªd
 
BGP


27 
uÂumb”ed
.

30 
impÜt
 
os


31 
impÜt
 
sys


32 
impÜt
 
jsÚ


33 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


34 
impÜt
 
py‹¡


36 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

37 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

38 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

40 #pylšt: 
di§bË
=
C0413


41 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


42 
äom
 
lib
 
impÜt
 
tİÙe¡


43 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


44 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


46 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

47 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


50 
şass
 
	$BFDTİo
(
Tİo
):

52 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

54 
tg’
 = 
	$g‘_tİog’
(
£lf
)

56 #C»©4 
rou‹rs
.

57 
rou‹º
 
š
 
	$¿nge
(1, 5):

58 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

60 ğ
tg’
.
	`add_sw™ch
('s1')

61 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

62 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

64 ğ
tg’
.
	`add_sw™ch
('s2')

65 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

66 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

68 ğ
tg’
.
	`add_sw™ch
('s3')

69 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

70 .
	`add_lšk
(
tg’
.
g—rs
['r4'])

73 
def
 
	$£tup_moduË
(
mod
):

75 
tg’
 = 
	$Tİog’
(
BFDTİo
, 
mod
.
__Çme__
)

76 
tg’
.
	$¡¬t_tİŞogy
()

78 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

79 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

80 
rou‹r
.
	`lßd_cÚfig
(

81 
TİoRou‹r
.
RD_ZEBRA
,

82 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

84 
rou‹r
.
	`lßd_cÚfig
(

85 
TİoRou‹r
.
RD_BFD
,

86 
os
.
·th
.
	`još
(
CWD
, '{}/bfdd.cÚf'.
	$fÜm©
(
ºame
))

88 
rou‹r
.
	`lßd_cÚfig
(

89 
TİoRou‹r
.
RD_BGP
,

90 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

92 
rou‹r
.
	`lßd_cÚfig
(

93 
TİoRou‹r
.
RD_OSPF
,

94 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

96 
rou‹r
.
	`lßd_cÚfig
(

97 
TİoRou‹r
.
RD_OSPF6
,

98 
os
.
·th
.
	`još
(
CWD
, '{}/o¥f6d.cÚf'.
	$fÜm©
(
ºame
))

101 #In™Ÿliz
®l
 
rou‹rs
.

102 
tg’
.
	$¡¬t_rou‹r
()

104 #V”ify 
th©
 
we
 
¬e
 
usšg
 
the
 
´İ”
 
v”siÚ
 
ªd
h©h
BFD


105 #d«mÚ 
exi¡s
.

106 
rou‹r
 
š
 
rou‹r_li¡
.
	$v®ues
():

107 #Check 
V”siÚ


108 
rou‹r
.
	`has_v”siÚ
('<', '5.1'):

109 
tg’
.
	`£t_”rÜ
('Unsupported FRR version')

113 
def
 
	$‹¬down_moduË
(
_mod
):

115 
tg’
 = 
	$g‘_tİog’
()

116 
tg’
.
	$¡İ_tİŞogy
()

119 
def
 
	$‹¡_´ÙocŞs_cÚv”g’û
():

121 
As£¹
 
th©
 
®l
 
´ÙocŞs
 
have
 
cÚv”ged
 
befÜe
 
checkšg
 
the
 
BFD


122 
¡©u£s
 
as
 
they
 
d•’d
 
Ú
 
™
.

124 
tg’
 = 
	$g‘_tİog’
()

125 
tg’
.
	$rou‹rs_have_çu»
():

126 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

128 #Check 
IPv4
 
routšg
 
bËs
.

129 
logg”
.
	`šfo
("Checking IPv4„outes for convergence")

130 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

131 
jsÚ_fe
 = '{}/{}/v4_rou‹s.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

132 
nÙ
 
os
.
·th
.
	$isfe
(
jsÚ_fe
):

133 
logg”
.
	`šfo
('skpšg f{}'.
	$fÜm©
(
jsÚ_fe
))

136 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
jsÚ_fe
).
	$»ad
())

137 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

138 
rou‹r
, 'show i°rou‹ jsÚ', 
ex³ùed
)

139 
_
, 
»suÉ
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=160,

140 
wa™
=0.5)

141 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
rou‹r
.
Çme
)

142 
as£¹
 
»suÉ
 
is
 
NÚe
, 
as£¹msg


144 #Check 
IPv6
 
routšg
 
bËs
.

145 
logg”
.
	`šfo
("Checking IPv6„outes for convergence")

146 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

147 
jsÚ_fe
 = '{}/{}/v6_rou‹s.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

148 
nÙ
 
os
.
·th
.
	$isfe
(
jsÚ_fe
):

149 
logg”
.
	`šfo
('skpšg f{}'.
	$fÜm©
(
jsÚ_fe
))

152 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
jsÚ_fe
).
	$»ad
())

153 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

154 
rou‹r
, 'show ipv6„ou‹ jsÚ', 
ex³ùed
)

155 
_
, 
»suÉ
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=160,

156 
wa™
=0.5)

157 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
rou‹r
.
Çme
)

158 
as£¹
 
»suÉ
 
is
 
NÚe
, 
as£¹msg


161 
def
 
	$‹¡_bfd_cÚÃùiÚ
():

163 
tg’
 = 
	$g‘_tİog’
()

164 
tg’
.
	$rou‹rs_have_çu»
():

165 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

167 
logg”
.
	`šfo
('waiting for bfd…eerso go up')

169 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

170 
jsÚ_fe
 = '{}/{}/³”s.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

171 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
jsÚ_fe
).
	$»ad
())

173 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

174 
rou‹r
, 'show bfd…“r jsÚ', 
ex³ùed
)

175 
_
, 
»suÉ
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=8, 
wa™
=0.5)

176 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
rou‹r
.
Çme
)

177 
as£¹
 
»suÉ
 
is
 
NÚe
, 
as£¹msg


180 
def
 
	$‹¡_memÜy_Ëak
():

182 
tg’
 = 
	$g‘_tİog’
()

183 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

184 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

186 
tg’
.
	$»pÜt_memÜy_Ëaks
()

189 
__Çme__
 == '__main__':

190 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

191 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@bgp-basic-functionality-topo1/__init__.py

	@bgp-basic-functionality-topo1/test_bgp_basic_functionality.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

5 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

6 #š 
this
 
fe
.

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 
FŞlowšg
 
‹¡s
 
¬e
 
cov”ed
 
to
 
‹¡
 
BGP
 
basic
 
	gfunùiÚ®™y
:

26 
Te¡
 
¡•s


27 - 
C»©e
 
	$tİŞogy
 (
£tup
 
moduË
)

28 
C»©šg
 4 
rou‹rs
 
tİŞogy
, 
r1
, 
r2
, 
r3
 
¬e
 
š
 
IBGP
 
ªd
„3, 
r4
‡» iÀ
EBGP


29 - 
Bršg
 
up
 
tİŞogy


30 - 
V”ify
 
bgp
 
to
 
cÚv”ge


31 - 
Modify
/
D–‘e
 
ªd
 
v”ify
 
rou‹r
-
id


32 - 
Modify
 
ªd
 
v”ify
 
bgp
 
tim”s


33 - 
C»©e
 
ªd
 
v”ify
 
rou‹s


34 - 
Modify
 
ªd
 
v”ify
 
admš
 
di¡ªû
 
exi¡šg
 
rou‹s


35 - 
Te¡
 
adv”ti£
 
ÃtwÜk
 
usšg
‚‘wÜk 
commªd


36 - 
V”ify
 
ş—r
 
bgp


37 - 
Te¡
 
bgp
 
cÚv”g’û
 
w™h
 
loİback
 
š‹rçû


38 - 
Te¡
 
adv”ti£
 
ÃtwÜk
 
usšg
‚‘wÜk 
commªd


42 
impÜt
 
os


43 
impÜt
 
sys


44 
impÜt
 
pdb


45 
impÜt
 
jsÚ


46 
impÜt
 
py‹¡


47 
impÜt
 
š¥eù


48 
impÜt
 
add»ss


49 
äom
 
time
 
impÜt
 
¦“p


51 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

52 
CWD
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

53 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

54 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../lib/'))

56 #pylšt: 
di§bË
=
C0413


57 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


58 
äom
 
lib
 
impÜt
 
tİÙe¡


59 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


60 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


62 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

63 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


64 
äom
 
lib
.
tİojsÚ
 
impÜt
 *

66 #R—dšg 
the
 
d©a
 
äom
 
JSON
 
Fe
 
tİŞogy
 
ü—tiÚ


67 
jsÚFe
 = "test_bgp_basic_functionality.json"

68 
Œy
:

69 
w™h
 
	`İ’
(
jsÚFe
, 'r'è
as
 
tİoJsÚ
:

70 
tİo
 = 
jsÚ
.
	$lßd
(
tİoJsÚ
)

71 
exû±
 
IOE¼Ü
:

72 
logg”
.
	`šfo
("Could‚Ù„—d fe:", 
jsÚFe
)

74 #Glob® 
v¬ŸbËs


75 
bgp_cÚv”g’û
 = 
NÚe


77 #šput_diù, 
diùiÚ¬y
 
would
 
be
 
u£d
 
to
 
´ovide
 
šput
Ø
APIs


78 
šput_diù
 = {
	}
}

80 
şass
 
	$BGPBasicTİo
(
Tİo
):

82 
Te¡
 
BGPBasicTİo
 - 
tİŞogy
 1

84 * `
Tİo
`: 
TİŞogy
 
objeù


87 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

89 
tg’
 = 
	$g‘_tİog’
(
£lf
)

91 #Budšg 
tİŞogy
 
ªd
 
cÚfigu¿tiÚ
 
äom
 
jsÚ
 
fe


92 
	$bud_tİo_äom_jsÚ
(
tg’
, 
tİo
)

94 
def
 
	$£tup_moduË
(
mod
):

96 
S‘s
 
up
 
the
 
py‹¡
 
’vœÚm’t


98 * `
mod
`: 
moduË
 
Çme


101 
‹¡su™e_run_time
 = 
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))

102 
logg”
.
	`šfo
("Te¡su™¡¬ˆtime: {}".
	$fÜm©
(
‹¡su™e_run_time
))

103 
logg”
.
	`šfo
("="*40)

105 
logg”
.
	`šfo
("Running setup_moduleo createopology")

107 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

108 
tg’
 = 
	$Tİog’
(
BGPBasicTİo
, 
mod
.
__Çme__
)

109 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

111 
tg’
.
	$¡¬t_tİŞogy
()

113 #Uncomm’ˆ
fŞlowšg
 
lše
 
to
 
’abË
 
debug
 
logs
 
ªd
 
comm’t
 - 
tg’
.
	`¡¬t_tİŞogy
()

114 #tg’.
	`¡¬t_tİŞogy
(
log_Ëv–
='debug')

116 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

117 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

118 
Œy
:

119 
os
.
	$chdœ
(
CWD
)

120 #D–‘šg 
rou‹r
 
Çmed
 
dœs
 
exi¡s


121 
os
.
·th
.
	`exi¡s
('{}'.
	$fÜm©
(
ºame
)):

122 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

124 #C»©šg 
rou”
 
Çmed
 
dœ
 
ªd
 
emÙy
 
zeb¿
.
cÚf
 
bgpd
.cÚà
fes
 
šside
 
the
 
cu¼’t
 
dœeùÜy


125 
os
.
	`mkdœ
('{}'.
	$fÜm©
(
ºame
))

126 
os
.
	`chdœ
("{}/{}".
	$fÜm©
(
CWD
, 
ºame
))

127 
os
.
	`sy¡em
('touch zebra.conf bgpd.conf')

128 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

129 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

131 
rou‹r
.
	`lßd_cÚfig
(

132 
TİoRou‹r
.
RD_ZEBRA
,

133 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

135 
rou‹r
.
	`lßd_cÚfig
(

136 
TİoRou‹r
.
RD_BGP
,

137 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

140 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
¡¬ts
 
cÚfigu»d
 
d«mÚs
.

141 
logg”
.
	`šfo
("Starting‡ll„outers onceopology is created")

142 
tg’
.
	$¡¬t_rou‹r
()

144 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


145 
	$bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

147 
logg”
.
	`šfo
("Running setup_module() done")

149 
def
 
	$‹¬down_moduË
(
mod
):

151 
T—rdown
 
the
 
py‹¡
 
’vœÚm’t


153 * `
mod
`: 
moduË
 
Çme


156 
logg”
.
	`šfo
("Runningeardown_moduleo deleteopology")

158 
tg’
 = 
	$g‘_tİog’
()

160 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

161 
tg’
.
	$¡İ_tİŞogy
()

163 #Removšg 
tmp
 
dœs
 
ªd
 
fes


164 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

165 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

166 
Œy
:

167 
os
.
	$chdœ
(
CWD
)

168 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

169 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

170 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

172 
‹¡su™e_run_time
 = 
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))

173 
logg”
.
	`šfo
("Te¡su™’dime: {}".
	$fÜm©
(
‹¡su™e_run_time
))

174 
logg”
.
	`šfo
("="*40)

179 ## 
Te¡ÿ£s


183 
def
 
	$‹¡_bgp_cÚv”g’û
():

186 
tg’
 = 
	$g‘_tİog’
()

187 
glob®
 
bgp_cÚv”g’û


190 
tg’
.
	$rou‹rs_have_çu»
():

191 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

193 #‹¡ 
Çme


194 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

195 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	$fÜm©
(
tc_Çme
))

197 #Ap˜
ÿÎ
 
v”ify
 
wh‘h”
 
BGP
 
is
 
cÚv”ged


198 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

199 
bgp_cÚv”g’û
 !ğ
True
: 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
bgp_cÚv”g’û
)

201 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

203 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


204 #tg’.
	`mšš‘_şi
()

206 
def
 
	$‹¡_modify_ªd_d–‘e_rou‹r_id
():

209 
tg’
 = 
	$g‘_tİog’
()

210 
glob®
 
bgp_cÚv”g’û


212 
bgp_cÚv”g’û
 !ğ
True
:

213 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

215 #‹¡ 
Çme


216 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

217 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	$fÜm©
(
tc_Çme
))

219 ## 
API
 
ÿÎ
 
to
 
modify
 
rou‹r
 
id


220 #šput_diù 
diùiÚ¬y
 
to
 
be
 
´ovided
Ø
	`modify_d–‘e_rou‹r_id
()

221 
šput_diù
 = {

231 
	}
}

232 
»suÉ
 = 
modify_d–‘e_rou‹r_id
('modify', 
šput_diù
, 
CWD
, 
tg’
, 
tİo
)

233 
	g»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
	gtc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

235 #V”ifyšg 
rou‹r
 
id
 
Úû
 
modif›d


236 
»suÉ
 = 
	$v”ify_rou‹r_id
(
šput_diù
, 
tg’
, 
tİo
)

237 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼nÜ: {}".
	$fÜm©
(
»suÉ
)

239 ## 
API
 
ÿÎ
 
to
 
d–‘e
 
rou‹r
 
id


240 #šput_diù 
diùiÚ¬y
 
to
 
be
 
´ovided
Ø
	`modify_d–‘e_rou‹r_id
()

241 
šput_diù
 = {

243 
	}
}

244 
»suÉ
 = 
modify_d–‘e_rou‹r_id
('d–‘e', 
šput_diù
, 
CWD
, 
tg’
, 
tİo
)

245 
	g»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
	gtc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

247 #V”ifyšg 
rou‹r
 
id
 
Úû
 
d–‘ed


248 #Onû 
rou‹r
-
id
 
is
 
d–‘ed
, 
highe¡
 
š‹rçû
 

 
should
 
become
„outer-id

249 
»suÉ
 = 
	$v”ify_rou‹r_id
(
šput_diù
, 
tg’
, 
tİo
)

250 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

252 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

254 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


255 #tg’.
	`mšš‘_şi
()

257 
def
 
	$‹¡_BGP_cÚfig_w™h_4by‹_AS_numb”
():

259 
Te¡
 
adv”ti£
 
ÃtwÜks
 
usšg
 
ÃtwÜk
 
commªd
.

262 
tg’
 = 
	$g‘_tİog’
()

263 
glob®
 
bgp_cÚv”g’û


265 
bgp_cÚv”g’û
 !ğ
True
:

266 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

268 #‹¡ 
Çme


269 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

270 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	$fÜm©
(
tc_Çme
))

272 #Ap˜
ÿÎ
 
to
 
modify
 
AS
 
numb”


273 
šput_diù
 = {

318 
	}
}

319 
»suÉ
 = 
modify_AS_numb”
('v4', 
šput_diù
, 
tg’
, 
CWD
, 
tİo
)

320 
	g»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
	gtc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

322 
»suÉ
 = 
	`v”ify_AS_numb”s
('v4', 
tg’
, 
šput_diù
, 
tİo
)

323 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

325 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

327 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


328 #tg’.
	`mšš‘_şi
()

330 
def
 
	$‹¡_bgp_tim”s
():

332 
Te¡
 
to
 
modify
 
bgp
 
tim”s
 
ªd
 
v”ify
 
š
 
ruÂšg
 
cÚfig
.

334 
U§ge
:

335 * 
If
 
u£r
 
wªts
 
to
 
modify
 
BGP
 
tim”s
 
®l
 
the
 
ÃighbÜs
 
ªy
 
rou‹r
 
th’
 
we
 
ÿn
 
·ss
 
šput_diù


336 
as
 
b–ow
:

337 
šput_diù
 = {

340 "k“·liv‘im”": 90(
as
 
³r
 
‹¡
),

341 "hŞddowÁim”": 270(
as
 
³r
 
‹¡
)

344 * 
If
 
u£r
 
wªts
 
to
 
modify
 
BGP
 
tim”s
Ø
ªy
 
¥ecific
 
ÃighbÜ
 
of
 
rou‹r
 
th’
 
we
 
ÿn
 
·ss
 
šput_diù


345 
as
 
b–ow
:

346 
šput_diù
 = {

358 
tg’
 = 
	`g‘_tİog’
()

359 
glob®
 
bgp_cÚv”g’û


361 
bgp_cÚv”g’û
 !ğ
True
:

362 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

364 #‹¡ 
Çme


365 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

366 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

368 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


369 
	`bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

371 #Ap˜
ÿÎ
 
to
 
modfiy
/
d–‘e
 
admš
 
di¡ªû


372 
šput_diù
 = {

382 
»suÉ
 = 
	`modify_bgp_tim”s
('v4', 
šput_diù
, 
CWD
, 
tg’
, 
tİo
)

383 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

385 #V”ifyšg 
bgp
 
tim”s
 
Úû
 
modif›d


386 
»suÉ
 = 
	`v”ify_bgp_tim”s
('v4', 
tg’
, 
šput_diù
, 
tİo
)

387 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

389 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

391 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


392 #tg’.
	`mšš‘_şi
()

394 
def
 
	`‹¡_¡©ic_rou‹s
():

397 
tg’
 = 
	`g‘_tİog’
()

398 
glob®
 
bgp_cÚv”g’û


400 
bgp_cÚv”g’û
 !ğ
True
:

401 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

403 #Te¡ 
Çme


404 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

405 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

407 #Ap˜
ÿÎ
 
to
 
ü—‹
 
rou‹s


408 
šput_diù
 = {

413 
»suÉ
 = 
	`ü—‹_¡©ic_rou‹s
('v4', 
šput_diù
, 
tg’
, 
CWD
, 
tİo
)

414 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

416 #Ap˜
ÿÎ
 
to
 
»di¡ribu‹
 
rou‹s


417 
šput_diù_1
 = {

420 '¡©ic': 
True
,

421 'cÚÃùed': 
True
,

425 
»suÉ
 = 
	`»di¡ribu‹_¡©ic_rou‹s
('v4', 
šput_diù_1
, 
tg’
, 
CWD
, 
tİo
)

426 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

428 #V”ifyšg 
RIB
 
rou‹s


429 
dut
 = 'r3'

430 
´ÙocŞ
 = 'bgp'

431 
Ãxt_hİ
 = '10.0.0.2'

432 
»suÉ
 = 
	`v”ify_rib
('v4', 
dut
, 
tg’
, 
šput_diù
, 
Ãxt_hİ
 =‚ext_hİ, 
´ÙocŞ
 =…rotocol)

433 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

435 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

437 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


438 #tg’.
	`mšš‘_şi
()

440 
def
 
	`‹¡_admš_di¡ªû_fÜ_exi¡šg_¡©ic_rou‹s
():

443 
tg’
 = 
	`g‘_tİog’
()

444 
glob®
 
bgp_cÚv”g’û


446 
bgp_cÚv”g’û
 !ğ
True
:

447 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

449 #‹¡ 
Çme


450 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

451 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

453 #Ap˜
ÿÎ
 
to
 
modfiy
/
d–‘e
 
admš
 
di¡ªû


454 
šput_diù
 = {

462 
»suÉ
 = 
	`modify_admš_di¡ªû_fÜ_¡©ic_rou‹s
(
šput_diù
, 
CWD
, 
tg’
, 
tİo
)

463 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

465 #V”ifyšg 
admš
 
di¡ªû
 
Úû
 
modif›d


466 
»suÉ
 = 
	`v”ify_admš_di¡ªû_fÜ_¡©ic_rou‹s
(
šput_diù
, 
tg’
)

467 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

469 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

471 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


472 #tg’.
	`mšš‘_şi
()

474 
def
 
	`‹¡_adv”ti£_ÃtwÜk_usšg_ÃtwÜk_commªd
():

477 
tg’
 = 
	`g‘_tİog’
()

478 
glob®
 
är_cfg
, 
bgp_cfg
, 
bgp_cÚv”g’û


480 
bgp_cÚv”g’û
 !ğ
True
:

481 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

483 #‹¡ 
Çme


484 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

485 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

487 #Ap˜
ÿÎ
 
to
 
adv”ti£
 
ÃtwÜks


488 
šput_diù
 = {

494 
»suÉ
 = 
	`adv”ti£_ÃtwÜks_usšg_ÃtwÜk_commªd
('v4', 
šput_diù
, 
tg’
, 
CWD
, 
tİo
)

495 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

497 #V”ifyšg 
RIB
 
rou‹s


498 
dut
 = 'r2'

499 
´ÙocŞ
 = "bgp"

500 
»suÉ
 = 
	`v”ify_rib
('v4', 
dut
, 
tg’
, 
šput_diù
, 
´ÙocŞ
 =…rotocol)

501 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

503 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

505 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


506 #tg’.
	`mšš‘_şi
()

508 
def
 
	`‹¡_ş—r_bgp
():

511 
tg’
 = 
	`g‘_tİog’
()

512 
glob®
 
bgp_cÚv”g’û


514 
bgp_cÚv”g’û
 !ğ
True
:

515 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

517 #‹¡ 
Çme


518 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

519 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

521 #Ap˜
ÿÎ
 
to
 
modfiy
/
d–‘e
 
admš
 
di¡ªû


522 
dut
 = 'r1'

523 
»suÉ
 = 
	`ş—r_bgp_ªd_v”ify
('v4', 
tg’
, 
dut
, 
tİo
)

524 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(result)

526 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

528 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


529 #tg’.
	`mšš‘_şi
()

531 
def
 
	`‹¡_bgp_w™h_loİback_š‹rçû
():

533 
Te¡
 
BGP
 
w™h
 
loİback
 
š‹rçû


535 
We
 
¬e
 
addšg
 "sourû": "lo" 
š
 
šput
 
jsÚ
 
fe
 
to
 
®l
 
the
 
rou‹r
's‚eighbors‡nd creating config using†oopback interface.

536 
Onû
 
‹¡ed
 
we
 
¬e
 
d–‘šg
 
key
 "sourû": "lo" 
äom
 
šput
 
jsÚ
 
fe
 
®l
 
the
 
rou‹r
's‚eighbors‡nd creating config using…hysical interface.

539 
tg’
 = 
	`g‘_tİog’
()

540 
glob®
 
bgp_cÚv”g’û


542 
bgp_cÚv”g’û
 !ğ
True
:

543 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

545 #‹¡ 
Çme


546 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

547 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	`fÜm©
(
tc_Çme
))

549 
rou‹rN
 
š
 
	`sÜ‹d
(
tİo
['rou‹rs'].
	`™”™ems
()):

550 
bgp_ÃighbÜ
 
š
 
tİo
['rou‹rs'][
rou‹rN
[0]]['bgp']['bgp_ÃighbÜs'].
	`™”™ems
():

551 
tİo
['rou‹rs'][
rou‹rN
[0]]['bgp']['bgp_ÃighbÜs'][
bgp_ÃighbÜ
[0]]['peer']['source'] = 'lo'

553 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


554 
	`bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

556 #Ap˜
ÿÎ
 
v”ify
 
wh‘h”
 
BGP
 
is
 
cÚv”ged


557 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

558 
bgp_cÚv”g’û
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(bgp_convergence)

560 #CËªu°
to
 
bršg
 
cÚfig
 
back
Ø
physiÿl
 
š‹rçû
 
äom
 
loİback
 interface

561 
rou‹rN
 
š
 
	`sÜ‹d
(
tİo
['rou‹rs'].
	`™”™ems
()):

562 
bgp_ÃighbÜ
 
š
 
tİo
['rou‹rs'][
rou‹rN
[0]]['bgp']['bgp_ÃighbÜs'].
	`™”™ems
():

563 
Œy
:

564 
d–
 
tİo
['rou‹rs'][
rou‹rN
[0]]['bgp']['bgp_ÃighbÜs'][
bgp_ÃighbÜ
[0]]['peer']['source']

565 
exû±
 
KeyE¼Ü
:

566 
logg”
.
	`”rÜ
("Key: source is‚ot found \n")

568 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


569 
	`bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

571 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

572 
bgp_cÚv”g’û
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	`fÜm©
(bgp_convergence)

574 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

576 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


577 #tg’.
	`mšš‘_şi
()

579 
__Çme__
 == '__main__':

580 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

581 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@bgp-ecmp-topo1/__init__.py

	@bgp-ecmp-topo1/peer1/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer1/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer10/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer10/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer11/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer11/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer12/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer12/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer13/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer13/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer14/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer14/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer15/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer15/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer16/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer16/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer17/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer17/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer18/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer18/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer19/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer19/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer2/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer2/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer20/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer20/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer3/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer3/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer4/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer4/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer5/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer5/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer6/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer6/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer7/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer7/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer8/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer8/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/peer9/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp-ecmp-topo1/peer9/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 ià(
³”
 <= 10):

17 
a¢um
 = 99

19 
a¢um
 = 
³”
+100

21 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


22 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, (((
³”
-1) / 5) + 1),…eer+100))

24 
¡dout
.
	$æush
()

26 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

27 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

28 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.202.%s.0/24 med 100‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, (((
³”
-1è/ 5è+ 1),…“r+100, 
a¢um
))

29 
¡dout
.
	$æush
()

31 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS


32 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

33 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.203.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš igp\n' % (
i
, 
³”
, (((peer-1) / 5) + 1),…eer+100))

34 
¡dout
.
	$æush
()

36 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
w™h
 
difã»Á
 
med
 
³r
 
PE
 
ªd
 difã»Á 
ÃighbÜ
 
AS
, 
but
 
§me
 
sourû
 AS

37 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

38 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.204.%s.0/24 med %˜Ãxt-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
i
, 
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

39 
¡dout
.
	$æush
()

41 #AÂounû 2 
difã»Á
 
rou‹
 
³r
 
³”


42 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.205.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš igp\n' % (
³”
, (((peer-1) / 5) + 1),…eer+100))

43 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.206.%i.0/24‚ext-hİ 10.0.%i.%˜Üigš ig°as-·th [ %˜200 ]\n' % (
³”
, ((Õ“r-1è/ 5è+ 1),…“r+100, 
a¢um
))

44 
¡dout
.
	$æush
()

46 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


47 
True
:

48 
	`¦“p
(1)

	@bgp-ecmp-topo1/test_bgp_ecmp_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bgp_ecmp_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_bgp_ecmp_tİo1
.
	gpy
: 
Te¡
 
BGP
 
tİŞogy
 
w™h
 
ECMP
 (
Equ®
 
Co¡
 
MuÉiP©h
).

29 
impÜt
 
jsÚ


30 
impÜt
 
funùoŞs


31 
impÜt
 
os


32 
impÜt
 
sys


33 
impÜt
 
py‹¡


35 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

36 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

37 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

39 #pylšt: 
di§bË
=
C0413


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


45 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


48 
tÙ®_ebgp_³”s
 = 20

50 #####################################################
#
#N‘wÜk 
TİŞogy
 
Defš™iÚ


57 
şass
 
	$BGPECMPTİo1
(
Tİo
):

60 
def
 
	$bud
(
£lf
, **
_İts
):

61 
tg’
 = 
	$g‘_tİog’
(
£lf
)

63 #C»©
the
 
BGP
 
rou‹r


64 
rou‹r
 = 
tg’
.
	`add_rou‹r
('r1')

66 #S‘u°
Sw™ches
 - 1 
³r
 5 
³”šg
 
rou‹rs


67 
swNum
 
š
 
	`¿nge
(1, (
tÙ®_ebgp_³”s
 + 4) / 5 + 1):

68 ğ
tg’
.
	`add_sw™ch
('s{}'.
	$fÜm©
(
swNum
))

69 .
	$add_lšk
(
rou‹r
)

71 #Add 'tÙ®_ebgp_³”s' 
numb”
 
of
 
eBGP
 
ExaBGP
 
ÃighbÜs


72 
³”Num
 
š
 
	`¿nge
(1, 
tÙ®_ebgp_³”s
+1):

73 
swNum
 = ((
³”Num
 - 1) / 5 + 1)

75 
³”_
 = '10.0.{}.{}'.
	`fÜm©
(
swNum
, 
³”Num
 + 100)

76 
³”_rou‹
 = 'vŸ 10.0.{}.1'.
	$fÜm©
(
swNum
)

77 
³”
 = 
tg’
.
	`add_exabgp_³”
('³”{}'.
	`fÜm©
(
³”Num
),

78 

=
³”_
, 
deçuÉRou‹
=
³”_rou‹
)

80 ğ
tg’
.
g—rs
['s{}'.
	`fÜm©
(
swNum
)]

81 .
	$add_lšk
(
³”
)

84 #####################################################
#
#Te¡ 
¡¬tšg


90 
def
 
	$£tup_moduË
(
moduË
):

91 
tg’
 = 
	$Tİog’
(
BGPECMPTİo1
, 
moduË
.
__Çme__
)

92 
tg’
.
	$¡¬t_tİŞogy
()

94 #S¹šg 
Rou‹rs


95 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

96 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

97 
rou‹r
.
	`lßd_cÚfig
(

98 
TİoRou‹r
.
RD_ZEBRA
,

99 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

101 
rou‹r
.
	`lßd_cÚfig
(

102 
TİoRou‹r
.
RD_BGP
,

103 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

105 
rou‹r
.
	$¡¬t
()

107 #S¹šg 
Ho¡s
 
ªd
 
š™
 
ExaBGP
 
Ú
 
—ch
 
of
 
them


108 
tİÙe¡
.
	`¦“p
(10, '¡¬tšg BGP oÀ®È{}…“rs'.
	$fÜm©
(
tÙ®_ebgp_³”s
))

109 
³”_li¡
 = 
tg’
.
	$exabgp_³”s
()

110 
²ame
, 
³”
 
š
 
³”_li¡
.
	$™”™ems
():

111 
³”_dœ
 = 
os
.
·th
.
	$još
(
CWD
, 
²ame
)

112 
’v_fe
 = 
os
.
·th
.
	`još
(
CWD
, 'exabgp.env')

113 
³”
.
	$¡¬t
(
³”_dœ
, 
’v_fe
)

114 
logg”
.
	$šfo
(
²ame
)

117 
def
 
	$‹¬down_moduË
(
moduË
):

118 
tg’
 = 
	$g‘_tİog’
()

119 
tg’
.
	$¡İ_tİŞogy
()

122 
def
 
	$‹¡_bgp_cÚv”g’û
():

124 
tg’
 = 
	$g‘_tİog’
()

126 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


127 
tg’
.
	$rou‹rs_have_çu»
():

128 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

130 #Ex³ùed 
»suÉ


131 
rou‹r
 = 
tg’
.
g—rs
['r1']

132 
rou‹r
.
	`has_v”siÚ
('<', '3.0'):

133 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 'r1/summary20.txt')

135 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 'r1/summary.txt')

137 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»ffe
).
	$»ad
())

139 
def
 
	$_ouut_summ¬y_cmp
(
rou‹r
, 
cmd
, 
d©a
):

141 
Runs
 `
cmd
` 
th©
 
»tuºs
 
JSON
 
	`d©a
 (
nÜm®ly
 
the
 
commªd
 
’ds


142 
w™h
 'jsÚ'è
ªd
 
com·»
 w™h `
d©a
` 
cÚ‹Ás
.

144 
ouut
 = 
rou‹r
.
	$vtysh_cmd
(
cmd
, 
isjsÚ
=
True
)

145 'v4Uniÿ¡' 
š
 
ouut
:

146 
ouut
['ipv4Unicast']['vrfName'] = \

147 
ouut
['v4Uniÿ¡']['vrfName'].
	`»¶aû
(

149 
–if
 'vrfName' 
š
 
ouut
:

150 
ouut
['vrfName'] = ouut['vrfName'].
	`»¶aû
('default', 'Default')

151  
tİÙe¡
.
	$jsÚ_cmp
(
ouut
, 
d©a
)

153 
‹¡_func
 = 
funùoŞs
.
	`·¹Ÿl
(

154 
_ouut_summ¬y_cmp
, 
rou‹r
, 'show i°bg°summ¬y jsÚ', 
ex³ùed
)

155 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=60, 
wa™
=0.5)

156 
as£¹msg
 = 'BGP„outer‚etwork did‚ot converge'

157 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


160 
def
 
	$‹¡_bgp_ecmp
():

161 
tg’
 = 
	$g‘_tİog’
()

163 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


164 
tg’
.
	$rou‹rs_have_çu»
():

165 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

167 
ex³ù
 = {

171 
	}
}

173 
Ãt
 
š
 
	$¿nge
(1, 5):

174 
subÃt
 
š
 
	$¿nge
(0, 10):

175 
Ãtkey
 = '10.20{}.{}.0/24'.
	$fÜm©
(
Ãt
, 
subÃt
)

176 
ex³ù
['rou‹s'][
Ãtkey
] = []

177 
_
 
š
 
	$¿nge
(0, 10):

178 
³”
 = {'muÉ©h': 
True
, 'v®id': 
	}
True}

179 
ex³ù
['rou‹s'][
Ãtkey
].
	$­³nd
(
³”
)

181 
‹¡_func
 = 
funùoŞs
.
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

182 
tg’
.
g—rs
['r1'], 'show i°bg°jsÚ', 
ex³ù
)

183 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=10, 
wa™
=0.5)

184 
as£¹msg
 = 'expected multipath„outes in "show ip bgp" output'

185 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


188 
__Çme__
 == '__main__':

189 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

190 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@bgp-vrf-route-leak-basic/test_bgp.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bgp.
py


5 #
#Cİyrighˆ(
c
è2018 
Cumulus
 
N‘wÜks
, 
Inc
.

7 #DÚ®d 
Sh¬p


8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
Cumulus
 
N‘wÜks
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

25 
	g‹¡_bgp
.
	gpy
: 
Te¡
 
basic
 
vrf
 
rou‹
 
Ëakšg


28 
impÜt
 
jsÚ


29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
py‹¡


33 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

34 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

36 #pylšt: 
di§bË
=
C0413


37 
äom
 
lib
 
impÜt
 
tİÙe¡


38 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


39 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


41 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


44 
şass
 
	$BGPVRFTİo
(
Tİo
):

45 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

47 
tg’
 = 
	$g‘_tİog’
(
£lf
)

49 
rou‹º
 
š
 
	$¿nge
(1, 2):

50 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

52 
def
 
	$£tup_moduË
(
mod
):

54 
tg’
 = 
	$Tİog’
(
BGPVRFTİo
, 
mod
.
__Çme__
)

55 
tg’
.
	$¡¬t_tİŞogy
()

57 #FÜ 
®l
 
»gi¡”ed
 
rou‹rs
, 
lßd
 
the
 
zeb¿
 
cÚfigu¿tiÚ
 
fe


58 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

59 
rou‹r
.
	`run
("/bš/bash {}/£tup_vrfs".
	$fÜm©
(
CWD
))

60 
rou‹r
.
	`lßd_cÚfig
(

61 
TİoRou‹r
.
RD_ZEBRA
,

62 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

64 
rou‹r
.
	`lßd_cÚfig
(

65 
TİoRou‹r
.
RD_BGP
,

66 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

69 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
lßds
 
cÚfigu»d
 
d«mÚs
.

70 
tg’
.
	$¡¬t_rou‹r
()

71 #tg’.
	`mšš‘_şi
()

73 
def
 
	$‹¬down_moduË
(
mod
):

75 
tg’
 = 
	$g‘_tİog’
()

77 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

78 
tg’
.
	$¡İ_tİŞogy
()

80 
def
 
	$‹¡_vrf_rou‹_Ëak
():

81 
logg”
.
	`šfo
("Ensurehat„outes‡re†eaked back‡nd forth")

82 
tg’
 = 
	$g‘_tİog’
()

84 
tg’
.
	$rou‹rs_have_çu»
():

85 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

87 
r1
 = 
tg’
.
g—rs
['r1']

89 
dÚÇ
 = 
r1
.
	`vtysh_cmd
("show i°rou‹ vràDONNA jsÚ", 
isjsÚ
=
True
)

90 
rou‹0
 = 
dÚÇ
["10.0.0.0/24"][0]

91 
as£¹
 
rou‹0
['protocol'] == "connected"

92 
rou‹1
 = 
dÚÇ
["10.0.1.0/24"][0]

93 
as£¹
 
rou‹1
['protocol'] == "bgp"

94 
as£¹
 
rou‹1
['£Ëùed'] =ğ
True


95 
nhİ
 = 
rou‹1
['nexthops'][0]

96 
as£¹
 
nhİ
['fib'] =ğ
True


97 
rou‹2
 = 
dÚÇ
["10.0.2.0/24"][0]

98 
as£¹
 
rou‹2
['protocol'] == "connected"

99 
rou‹3
 = 
dÚÇ
["10.0.3.0/24"][0]

100 
as£¹
 
rou‹3
['protocol'] == "bgp"

101 
as£¹
 
rou‹3
['£Ëùed'] =ğ
True


102 
nhİ
 = 
rou‹3
['nexthops'][0]

103 
as£¹
 
nhİ
['fib'] =ğ
True


104 
eva
 = 
r1
.
	`vtysh_cmd
("show i°rou‹ vràEVA jsÚ", 
isjsÚ
=
True
)

105 
rou‹0
 = 
eva
["10.0.0.0/24"][0]

106 
as£¹
 
rou‹0
['protocol'] == "bgp"

107 
as£¹
 
rou‹0
['£Ëùed'] =ğ
True


108 
nhİ
 = 
rou‹0
['nexthops'][0]

109 
as£¹
 
nhİ
['fib'] =ğ
True


110 
rou‹1
 = 
eva
["10.0.1.0/24"][0]

111 
as£¹
 
rou‹1
['protocol'] == "connected"

112 
rou‹2
 = 
eva
["10.0.2.0/24"][0]

113 
as£¹
 
rou‹2
['protocol'] == "bgp"

114 
as£¹
 
rou‹2
['£Ëùed'] =ğ
True


115 
nhİ
 = 
rou‹2
['nexthops'][0]

116 
as£¹
 
nhİ
['fib'] =ğ
True


117 
rou‹3
 = 
eva
["10.0.3.0/24"][0]

118 
as£¹
 
rou‹3
['protocol'] == "connected"

119 #tg’.
	`mšš‘_şi
()

121 
def
 
	$‹¡_memÜy_Ëak
():

123 
tg’
 = 
	$g‘_tİog’
()

124 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

125 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

127 
tg’
.
	$»pÜt_memÜy_Ëaks
()

130 
__Çme__
 == '__main__':

131 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

132 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@bgp_l3vpn_to_bgp_direct/__init__.py

	@bgp_l3vpn_to_bgp_direct/customize.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2017 
by


7 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

25 
	gcu¡omize
.
	gpy
: 
Sim¶e
 
FRR
/
Quagga
 
MPLS
 
L3VPN
 
‹¡
 
tİŞogy


29 | 
û1
 |

30 | 99.0.0.1| 
CE
 
Rou‹r


32 192.168.1. | .2 
û1
-
‘h0


33 | .1 
r1
-
‘h4


35 | 
r1
 |

36 | 1.1.1.1 | 
PE
 
Rou‹r


38 | .1 
r1
-
‘h0


41 ~~ 
sw0
 ~~

46 | .2 
r2
-
‘h0


48 | 
r2
 |

49 | 2.2.2.2 | 
P
 
rou‹r


51 
r2
-
‘h2
 .2 | | .2„2-
‘h1


52 
______
/ \______

55 ~~ 
sw2
 ~~ ~~ 
sw1
 ~~

59 \ 
_________
/ |

61 
r3
-
‘h1
 .3 | | .3„3-
‘h0
 | .4 
r4
-eth0

63 | 
r3
 | | 
r4
 |

64 | 3.3.3.3 | | 4.4.4.4 | 
PE
 
Rou‹rs


66 192.168.1. | .1 192.168.1. | .1 
rX
-
‘h4


67 | .2 | .2 
ûX
-
‘h0


69 | 
û2
 | | 
û3
 |

70 | 99.0.0.2 | | 99.0.0.3 | 
CE
 
Rou‹rs


76 
impÜt
 
os


77 
impÜt
 
»


78 
impÜt
 
py‹¡


80 #pylšt: 
di§bË
=
C0413


81 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


82 
äom
 
lib
 
impÜt
 
tİÙe¡


83 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
	gTİoRou‹r
, 
g‘_tİog’


84 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


85 
äom
 
	glib
.
Éem¶©e
 
impÜt
 
	gÉem¶©eRŒCmd


87 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

88 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


90 
impÜt
 
shut


91 
	gCWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

92 #‹¡ 
Çme
 
ba£d
 
Ú
 
dœeùÜy


93 
TEST
 = 
os
.
·th
.
	$ba£Çme
(
CWD
)

95 
şass
 
	$ThisTe¡Tİo
(
Tİo
):

97 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

99 
tg’
 = 
	$g‘_tİog’
(
£lf
)

101 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
defše
 
®loÿtiÚ
 
ªd
 
»ÏtiÚsh


102 #b‘w“À
rou‹rs
, 
sw™ches
 
ªd
 
ho¡s
.

103 #
#C»©
P
/
PE
 
rou‹rs


105 
tg’
.
	`add_rou‹r
('r1')

106 #check 
m¶s


107 
tg’
.
hasm¶s
 !ğ
True
:

108 
logg”
.
	`šfo
('MPLS‚ot‡vailable,ests will be skipped')

110 
rou‹º
 
š
 
	$¿nge
(2, 5):

111 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

112 #C»©
CE
 
rou‹rs


113 
rou‹º
 
š
 
	$¿nge
(1, 4):

114 
tg’
.
	`add_rou‹r
('û{}'.
	$fÜm©
(
rou‹º
))

116 #CE/
PE
 
lšks


117 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce1'],gen.gears['r1'], 'ce1-eth0', 'r1-eth4')

118 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce2'],gen.gears['r3'], 'ce2-eth0', 'r3-eth4')

119 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce3'],gen.gears['r4'], 'ce3-eth0', 'r4-eth4')

121 #C»©
a
 
w™h
 
ju¡
 
Úe
 
rou‹r
 
cÚÃùed
 
to
 
™
Ø
simuÏ‹
‡

122 #em±y 
ÃtwÜk
.

123 ğ{
	}
}

124 [0] = 
tg’
.
add_sw™ch
('sw0')

125 [0].
add_lšk
(
tg’
.
g—rs
['r1'], 
nodeif
='r1-eth0')

126 [0].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth0')

128 [1] = 
tg’
.
add_sw™ch
('sw1')

129 [1].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth1')

130 [1].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth0')

131 [1].
add_lšk
(
tg’
.
g—rs
['r4'], 
nodeif
='r4-eth0')

133 [1] = 
tg’
.
add_sw™ch
('sw2')

134 [1].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth2')

135 [1].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth1')

137 
def
 
	$Éem¶©eP»Rou‹rS¹Hook
():

138 
cc
 = 
	$Éem¶©eRŒCmd
()

139 
tg’
 = 
	$g‘_tİog’
()

140 
logg”
.
	`šfo
('pre„outer-start hook')

141 #check 
m¶s


142 
tg’
.
hasm¶s
 !ğ
True
:

143 
logg”
.
	`šfo
('MPLS‚ot‡vailable, skipping setup')

144  
F®£


145 #check 
nÜm®
 
š™


146 
	`Ën
(
tg’
.
Ãt
) == 1:

147 
logg”
.
	`šfo
('Topology‚ot configured, skipping setup')

148  
F®£


149 #cÚfigu» 
r2
 
m¶s
 
š‹rçûs


150 
štfs
 = ['lo', 'r2-eth0', 'r2-eth1', 'r2-eth2']

151 
štf
 
š
 
štfs
:

152 
cc
.
	`doCmd
(
tg’
, 'r2', 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/{}/šput'.
	$fÜm©
(
štf
))

153 #cÚfigu» 
MPLS


154 
¹rs
 = ['r1', 'r3', 'r4']

155 
cmds
 = ['echo 1 > /proc/sys/net/mpls/conf/lo/input']

156 
¹r
 
š
 
¹rs
:

157 
rou‹r
 = 
tg’
.
g—rs
[
¹r
]

158 
cmd
 
š
 
cmds
:

159 
cc
.
	$doCmd
(
tg’
, 
¹r
, 
cmd
)

160 
štfs
 = ['lo', 
¹r
+'-eth0',„tr+'-eth4']

161 
štf
 
š
 
štfs
:

162 
cc
.
	`doCmd
(
tg’
, 
¹r
, 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/{}/šput'.
	$fÜm©
(
štf
))

163 
logg”
.
	`šfo
('setup mpls input')

164  
True


166 
def
 
	$Éem¶©ePo¡Rou‹rS¹Hook
():

167 
logg”
.
	`šfo
('post„outer-start hook')

168  
True


	@bgp_l3vpn_to_bgp_direct/scripts/add_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "show bgp‚ext"','99.0.0.. valid', 'wait', 'See CE static NH')

3 
luCommªd
('r3','vtysh -c "show bgp‚ext"','99.0.0.. valid', 'wait', 'See CE static NH')

4 
luCommªd
('r4','vtysh -c "show bgp‚ext"','99.0.0.. valid', 'wait', 'See CE static NH')

5 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni"','i5.*i5','wait','See CE„outes')

6 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni"','i5.*i5','wait','See CE„outes')

7 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni"','i5.*i5','wait','See CE„outes')

8 
luCommªd
('ce1','vtysh -c "show bgp ipv4 uni 5.1.0.0/24"','','none','See CE„outes')

9 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni 5.1.0.0/24"','','none','See CE„outes')

10 
luCommªd
('ce2','vtysh -c "show bgp ipv4 uni 5.1.0.0/24"','','none','See CE„outes')

11 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni 5.1.0.0/24"','','none','See CE„outes')

12 
luCommªd
('ce3','vtysh -c "show bgp ipv4 uni 5.1.2.0/24"','','none','See CE„outes')

13 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni 5.1.2.0/24"','','none','See CE„outes')

15 
luCommªd
('r1','vtysh -c "add vrf cust1…refix 99.0.0.1/32"','.','none','IP Address')

16 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','99.0.0.1','wait','Local Registration')

17 
luCommªd
('r1','vtysh -c "show vnc„egistrations imported"','2 out of 2 imported','wait','Imported Registrations')

18 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn"','i99.0.0.1/32','wait','See R1s static‡ddress')

19 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn"','i99.0.0.1/32','wait','See R1s static‡ddress')

20 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn„d 10:1"','i5.*i5','wait','See R1s imports')

21 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn„d 10:1"','i5.*i5','wait','See R1s imports')

23 
luCommªd
('r3','vtysh -c "add vrf cust1…refix 99.0.0.2/32"','.','none','IP Address')

24 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','99.0.0.2','wait','Local Registration')

25 
	ghave2ndImpÜts
 = 
luCommªd
('r3','vtysh -c "show vnc„egistrations imported"','2 out of 2 imported','none','Imported Registrations',2)

26 
	ghave2ndImpÜts
:

27 
luCommªd
('r3','vtysh -c "show vnc„egistrations imported"','2 out of 2 imported','pass','Imported Registrations')

28 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn"','i99.0.0.2/32','wait','See R3s static‡ddress')

29 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn"','i99.0.0.2/32','wait','See R3s static‡ddress')

30 
	ghave2ndImpÜts
:

31 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn„d 10:3"','i5.*i5','none','See R3s imports')

32 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn„d 10:3"','i5.*i5','none','See R3s imports')

34 
luCommªd
('r4','vtysh -c "add vrf cust1…refix 99.0.0.3/32"','.','none','IP Address')

35 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','99.0.0.3','wait','Local Registration')

36 
luCommªd
('r4','vtysh -c "show vnc„egistrations imported"','2 out of 2 imported','wait','Imported Registrations')

37 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn"','i99.0.0.3/32','wait','See R4s static‡ddress')

38 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn"','i99.0.0.3/32','wait','See R4s static‡ddress')

39 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn„d 10:4"','i5.*i5','wait','See R4s imports')

40 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn„d 10:4"','i5.*i5','wait','See R4s imports')

43 
luCommªd
('r1','vtysh -c "show vnc„egistrations„emote"','5.1.2.0/24 .*5.1.3.0/24','wait','R4s„egistrations')

44 
luCommªd
('r3','vtysh -c "show vnc„egistrations„emote"','5.1.2.0/24 .*5.1.3.0/24','wait','R4s„egistrations')

45 
	ghave2ndImpÜts
:

46 
luCommªd
('r1','vtysh -c "show vnc„egistrations„emote"','5.1.0.0/24 .*5.1.1.0/24','wait','Remote„egistrations')

47 
luCommªd
('r3','vtysh -c "show vnc„egistrations„emote"','5.1.0.0/24 .*5.1.1.0/24','wait','Remote„egistrations')

48 
luCommªd
('r4','vtysh -c "show vnc„egistrations„emote"','5.1.0.0/24 .*5.1.1.0/24','wait','Remote„egistrations')

49 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

50 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

51 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

	@bgp_l3vpn_to_bgp_direct/scripts/adjacencies.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('ce1','ping 192.168.1.1 -c 1',' 0.…acket†oss','pass','CE->PE…ing')

3 
luCommªd
('ce2','ping 192.168.1.1 -c 1',' 0.…acket†oss','pass','CE->PE…ing')

4 
luCommªd
('ce3','ping 192.168.1.1 -c 1',' 0.…acket†oss','pass','CE->PE…ing')

5 
luCommªd
('ce1','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up',90)

6 
luCommªd
('ce2','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up')

7 
luCommªd
('ce3','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up')

8 
luCommªd
('r1','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

9 
luCommªd
('r3','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

10 
luCommªd
('r4','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

11 
luCommªd
('r2','vtysh -c "show bgp summary"',' 00:0.* 00:0.* 00:0','wait','Core‡djacencies up')

12 
luCommªd
('r1','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

13 
luCommªd
('r3','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

14 
luCommªd
('r4','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

15 
luCommªd
('r1','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0','pass','All‡djacencies up')

16 
luCommªd
('r3','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0','pass','All‡djacencies up')

17 
luCommªd
('r4','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0','pass','All‡djacencies up')

18 
luCommªd
('r1','ping 3.3.3.3 -c 1',' 0.…acket†oss','wait','PE->PE3 (loopback)…ing')

19 
luCommªd
('r1','ping 4.4.4.4 -c 1',' 0.…acket†oss','wait','PE->PE4 (loopback)…ing')

20 
luCommªd
('r4','ping 3.3.3.3 -c 1',' 0.…acket†oss','wait','PE->PE3 (loopback)…ing')

	@bgp_l3vpn_to_bgp_direct/scripts/check_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('ce1','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 7','wait','Local‡nd„emote„outes')

3 
luCommªd
('ce2','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 9','wait','Local‡nd„emote„outes')

4 
luCommªd
('ce3','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 7','wait','Local‡nd„emote„outes')

5 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 9','pass','Unicast SAFI')

6 
luCommªd
('r2','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Unicast SAFI')

7 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 9','pass','Unicast SAFI')

8 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni"','7„outes‡nd 9','pass','Unicast SAFI')

9 
	ghave2ndImpÜts
 = 
luCommªd
('r3','vtysh -c "show vnc„egistrations imported"','2 out of 2 imported','none','Imported Registrations',2)

10 
	ghave2ndImpÜts
:

11 
num
 = '9„outes‡nd 9'

13 
num
 = '7„outes‡nd 7'

14 
luCommªd
('r1','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI')

15 
luCommªd
('r2','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI')

16 
luCommªd
('r3','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI')

17 
luCommªd
('r4','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI')

	@bgp_l3vpn_to_bgp_direct/scripts/cleanup_all.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "clear vrf cust1…refix 99.0.0.1/32"','.','none','Cleared VRF„oute')

3 
luCommªd
('r3','vtysh -c "clear vrf cust1…refix 99.0.0.2/32"','.','none','Cleared VRF„oute')

4 
luCommªd
('r4','vtysh -c "clear vrf cust1…refix 99.0.0.3/32"','.','none','Cleared VRF„oute')

5 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','99.0.0.1','fail','Local Registration cleared')

6 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','99.0.0.2','fail','Local Registration cleared')

7 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','99.0.0.3','fail','Local Registration cleared')

8 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated')

9 
luCommªd
('r2','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Unicast SAFI')

10 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated')

11 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated')

12 
luCommªd
('ce1','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes')

13 
luCommªd
('ce2','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes')

14 
luCommªd
('ce3','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes')

15 
luCommªd
('r1','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

16 
luCommªd
('r3','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

17 
luCommªd
('r4','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

	@bgp_l3vpn_to_bgp_direct/test_bgp_l3vpn_to_bgp_direct.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2018, 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

7 #AuthÜed 
by
 
Lou
 
B”g”
 <
lb”g”
@
Ïbn
.
Ãt
>

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

24 
impÜt
 
os


25 
impÜt
 
sys


26 
impÜt
 
py‹¡


28 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
još
(os.·th.
dœÇme
(os.·th.
»®·th
(
__fe__
)), '..'))

30 
äom
 
	glib
.
Éem¶©e
 
impÜt
 *

32 
def
 
	$‹¡_adjaûnc›s
():

33 
CliOnFa
 = 
NÚe


34 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


36 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

37 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


39 
	`Éem¶©eTe¡
('süts/adjaûnc›s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

41 
def
 
	$‹¡_add_rou‹s
():

42 
CliOnFa
 = 
NÚe


43 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


45 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

46 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


48 
	`Éem¶©eTe¡
('süts/add_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

50 
def
 
	$‹¡_check_rou‹s
():

51 
CliOnFa
 = 
NÚe


52 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


54 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

55 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


57 
	`Éem¶©eTe¡
('süts/check_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

59 
def
 
	$‹¡_ş—nup_®l
():

60 
CliOnFa
 = 
NÚe


61 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


63 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

64 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


66 
	`Éem¶©eTe¡
('süts/ş—nup_®l.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

68 
__Çme__
 == '__main__':

69 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

70 
sys
.
	`ex™
(
»tv®
)

	@bgp_l3vpn_to_bgp_vrf/__init__.py

	@bgp_l3vpn_to_bgp_vrf/customize.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2017 
by


7 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

25 
	gcu¡omize
.
	gpy
: 
Sim¶e
 
FRR
/
Quagga
 
MPLS
 
L3VPN
 
‹¡
 
tİŞogy


29 | 
û1
 |

30 | 99.0.0.1| 
CE
 
Rou‹r


32 192.168.1. | .2 
û1
-
‘h0


33 | .1 
r1
-
‘h4


35 | 
r1
 |

36 | 1.1.1.1 | 
PE
 
Rou‹r


38 | .1 
r1
-
‘h0


41 ~~ 
sw0
 ~~

46 | .2 
r2
-
‘h0


48 | 
r2
 |

49 | 2.2.2.2 | 
P
 
rou‹r


51 
r2
-
‘h2
 .2 | | .2„2-
‘h1


52 
______
/ \______

55 ~~ 
sw2
 ~~ ~~ 
sw1
 ~~

59 \ 
_________
/ |

61 
r3
-
‘h1
 .3 | | .3„3-
‘h0
 | .4 
r4
-eth0

63 | 
r3
 | | 
r4
 |„4-
‘h5


64 | 3.3.3.3 | | 4.4.4.4 |-------+ 
PE
 
Rou‹rs


66 192.168.1.1 |
r3
.
‘h4
 192.168.1.1 | 
r4
-eth4 |192.168.2.1

67 .2 | 
ûX
-
‘h0
 .2 | | .2

69 | 
û2
 | | 
û3
 | | 
û4
 |

70 | 99.0.0.2 | | 99.0.0.3 | | 99.0.0.4 | 
CE
 
Rou‹rs


76 
impÜt
 
os


77 
impÜt
 
»


78 
impÜt
 
py‹¡


79 
impÜt
 
¶©fÜm


81 #pylšt: 
di§bË
=
C0413


82 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


83 
äom
 
lib
 
impÜt
 
tİÙe¡


84 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
	gTİoRou‹r
, 
g‘_tİog’


85 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


86 
äom
 
	glib
.
Éem¶©e
 
impÜt
 
	gÉem¶©eRŒCmd


88 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

89 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


91 
impÜt
 
shut


92 
	gCWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

93 #‹¡ 
Çme
 
ba£d
 
Ú
 
dœeùÜy


94 
TEST
 = 
os
.
·th
.
	$ba£Çme
(
CWD
)

96 
şass
 
	$ThisTe¡Tİo
(
Tİo
):

98 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

100 
tg’
 = 
	$g‘_tİog’
(
£lf
)

102 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
defše
 
®loÿtiÚ
 
ªd
 
»ÏtiÚsh


103 #b‘w“À
rou‹rs
, 
sw™ches
 
ªd
 
ho¡s
.

104 #
#C»©
P
/
PE
 
rou‹rs


106 #check 
m¶s


107 
tg’
.
	`add_rou‹r
('r1')

108 
tg’
.
hasm¶s
 !ğ
True
:

109 
logg”
.
	`šfo
('MPLS‚ot‡vailable,ests will be skipped')

111 
mach
 = 
¶©fÜm
.
	$machše
()

112 
k»l
 = 
¶©fÜm
.
	$»Ëa£
()

113 
mach
[:1] =ğ'a' 
ªd
 
tİÙe¡
.
	`v”siÚ_cmp
(
k»l
, '4.11') < 0:

114 
logg”
.
	`šfo
('Need Kernel version 4.11o„un on‡rm…rocessor')

116 
rou‹º
 
š
 
	$¿nge
(2, 5):

117 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

118 #C»©
CE
 
rou‹rs


119 
rou‹º
 
š
 
	$¿nge
(1, 5):

120 
tg’
.
	`add_rou‹r
('û{}'.
	$fÜm©
(
rou‹º
))

122 #CE/
PE
 
lšks


123 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce1'],gen.gears['r1'], 'ce1-eth0', 'r1-eth4')

124 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce2'],gen.gears['r3'], 'ce2-eth0', 'r3-eth4')

125 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce3'],gen.gears['r4'], 'ce3-eth0', 'r4-eth4')

126 
tg’
.
	`add_lšk
Ñg’.
g—rs
['ce4'],gen.gears['r4'], 'ce4-eth0', 'r4-eth5')

128 #C»©
a
 
w™h
 
ju¡
 
Úe
 
rou‹r
 
cÚÃùed
 
to
 
™
Ø
simuÏ‹
‡

129 #em±y 
ÃtwÜk
.

130 ğ{
	}
}

131 [0] = 
tg’
.
add_sw™ch
('sw0')

132 [0].
add_lšk
(
tg’
.
g—rs
['r1'], 
nodeif
='r1-eth0')

133 [0].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth0')

135 [1] = 
tg’
.
add_sw™ch
('sw1')

136 [1].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth1')

137 [1].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth0')

138 [1].
add_lšk
(
tg’
.
g—rs
['r4'], 
nodeif
='r4-eth0')

140 [1] = 
tg’
.
add_sw™ch
('sw2')

141 [1].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth2')

142 [1].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth1')

144 
l3mdev_acû±
 = 0

146 
def
 
	$Éem¶©eP»Rou‹rS¹Hook
():

147 
glob®
 
l3mdev_acû±


148 
cc
 = 
	$Éem¶©eRŒCmd
()

149 
k»l
 = 
¶©fÜm
.
	$»Ëa£
()

150 
tg’
 = 
	$g‘_tİog’
()

151 
logg”
.
	`šfo
('´rou‹r-¡¬ˆhook, k”Ãl=' + 
k»l
)

152 
tİÙe¡
.
	`v”siÚ_cmp
(
k»l
, '4.15') == 0:

153 
l3mdev_acû±
 = 1

155 
l3mdev_acû±
 = 0

156 
logg”
.
	`šfo
('£‰šg‚‘.v4.tı_l3mdev_acû±={}'.
	$fÜm©
(
l3mdev_acû±
))

157 #check 
m¶s


158 
tg’
.
hasm¶s
 !ğ
True
:

159 
logg”
.
	`šfo
('MPLS‚ot‡vailable, skipping setup')

160  
F®£


161 #check 
nÜm®
 
š™


162 
	`Ën
(
tg’
.
Ãt
) == 1:

163 
logg”
.
	`šfo
('Topology‚ot configured, skipping setup')

164  
F®£


165 #Œaû 
”rÜs
/
uÃx³ùed
 
ouut


166 
cc
.
	$»£tCouÁs
()

167 #cÚfigu» 
r2
 
m¶s
 
š‹rçûs


168 
štfs
 = ['lo', 'r2-eth0', 'r2-eth1', 'r2-eth2']

169 
štf
 
š
 
štfs
:

170 
cc
.
	`doCmd
(
tg’
, 'r2', 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/{}/šput'.
	$fÜm©
(
štf
))

172 #cÚfigu» 
cu¡1
 
VRFs
 & 
MPLS


173 
¹rs
 = ['r1', 'r3', 'r4']

174 
cmds
 = ['ip†ink‡dd {0}-cust1ype vrfable 10',

178 'sysùÈ-w‚‘.v4.tı_l3mdev_acû±={}'.
	`fÜm©
(
l3mdev_acû±
)]

179 
¹r
 
š
 
¹rs
:

180 
rou‹r
 = 
tg’
.
g—rs
[
¹r
]

181 
cmd
 
š
 
cmds
:

182 
cc
.
	`doCmd
(
tg’
, 
¹r
, 
cmd
.
	$fÜm©
(
¹r
))

183 
cc
.
	`doCmd
(
tg’
, 
¹r
, '†šk s‘ dev {0}-‘h4 ma¡” {0}-cu¡1'.
	$fÜm©
(
¹r
))

184 
štfs
 = [
¹r
+'-cust1', 'lo',„tr+'-eth0',„tr+'-eth4']

185 
štf
 
š
 
štfs
:

186 
cc
.
	`doCmd
(
tg’
, 
¹r
, 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/{}/šput'.
	$fÜm©
(
štf
))

187 
logg”
.
	`šfo
('£tu°{0} vrà{0}-cu¡1, {0}-‘h4.ƒÇbËd m¶ šput.'.
	$fÜm©
(
¹r
))

188 #cÚfigu» 
cu¡2
 
VRFs
 & 
MPLS


189 
¹rs
 = ['r4']

190 
cmds
 = ['ip†ink‡dd {0}-cust2ype vrfable 20',

194 
¹r
 
š
 
¹rs
:

195 
cmd
 
š
 
cmds
:

196 
cc
.
	`doCmd
(
tg’
, 
¹r
, 
cmd
.
	$fÜm©
(
¹r
))

197 
cc
.
	`doCmd
(
tg’
, 
¹r
, '†šk s‘ dev {0}-‘h5 ma¡” {0}-cu¡2'.
	$fÜm©
(
¹r
))

198 
štfs
 = [
¹r
+'-cust2',„tr+'-eth5']

199 
štf
 
š
 
štfs
:

200 
cc
.
	`doCmd
(
tg’
, 
¹r
, 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/{}/šput'.
	$fÜm©
(
štf
))

201 
logg”
.
	`šfo
('£tu°{0} vrà{0}-cu¡2, {0}-‘h5.ƒÇbËd m¶ šput.'.
	$fÜm©
(
¹r
))

202 #puˆ
û4
-
‘h0
 
što
 
a
 
	`VRF
 (
no
  
š¡ªû
!)

203 
¹rs
 = ['ce4']

204 
cmds
 = ['ip†ink‡dd {0}-cust2ype vrfable 20',

208 'sysùÈ-w‚‘.v4.tı_l3mdev_acû±={}'.
	`fÜm©
(
l3mdev_acû±
)]

209 
¹r
 
š
 
¹rs
:

210 
cmd
 
š
 
cmds
:

211 
cc
.
	`doCmd
(
tg’
, 
¹r
, 
cmd
.
	$fÜm©
(
¹r
))

212 
cc
.
	`doCmd
(
tg’
, 
¹r
, '†šk s‘ dev {0}-‘h0 ma¡” {0}-cu¡2'.
	$fÜm©
(
¹r
))

213 
cc
.
	`g‘Ouut
() != 4:

214 
In™Sucûss
 = 
F®£


215 
logg”
.
	`šfo
('UÃx³ùed ouuˆ£’ ({}imes,e¡ wÈbsk³d'.
	`fÜm©
(
cc
.
	$g‘Ouut
()))

217 
In™Sucûss
 = 
True


218 
logg”
.
	`šfo
('VRF config successful!')

219  
In™Sucûss


221 
def
 
	$Éem¶©ePo¡Rou‹rS¹Hook
():

222 
logg”
.
	`šfo
('post„outer-start hook')

223  
True


	@bgp_l3vpn_to_bgp_vrf/scripts/add_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "add vrf„1-cust1…refix 99.0.0.1/32"','.','none','IP Address')

3 
luCommªd
('r3','vtysh -c "add vrf„3-cust1…refix 99.0.0.2/32"','.','none','IP Address')

4 
luCommªd
('r4','vtysh -c "add vrf„4-cust1…refix 99.0.0.3/32"','.','none','IP Address')

5 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','99.0.0.1','pass','Local Registration')

6 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','99.0.0.2','pass','Local Registration')

7 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','99.0.0.3','pass','Local Registration')

8 
luCommªd
('r1','vtysh -c "show vnc„egistrations„emote"','4 out of 4','wait','Remote Registration', 10)

9 
luCommªd
('r3','vtysh -c "show vnc„egistrations„emote"','6 out of 6','wait','Remote Registration', 10)

10 
luCommªd
('r4','vtysh -c "show vnc„egistrations„emote"','4 out of 4','wait','Remote Registration', 10)

11 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

12 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

13 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

	@bgp_l3vpn_to_bgp_vrf/scripts/adjacencies.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('ce1','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up',180)

3 
luCommªd
('ce2','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up')

4 
luCommªd
('ce3','vtysh -c "show bgp summary"',' 00:0','wait','Adjacencies up')

5 
luCommªd
('ce4','vtysh -c "show bgp vrf‡ll summary"',' 00:0','wait','Adjacencies up',180)

6 
luCommªd
('r1','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

7 
luCommªd
('r3','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

8 
luCommªd
('r4','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

9 
luCommªd
('r2','vtysh -c "show bgp summary"',' 00:0.* 00:0.* 00:0','wait','Core‡djacencies up',300)

10 
luCommªd
('r1','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

11 
luCommªd
('r3','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

12 
luCommªd
('r4','vtysh -c "show bgp summary"',' 00:0','pass','Core‡djacencies up')

13 
luCommªd
('r1','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0','pass','All‡djacencies up')

14 
luCommªd
('r3','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0','pass','All‡djacencies up')

15 
luCommªd
('r4','vtysh -c "show bgp vrf‡ll summary"',' 00:0.* 00:0.* 00:0','pass','All‡djacencies up')

16 
luCommªd
('r1','ping 3.3.3.3 -c 1',' 0.…acket†oss','wait','PE->PE3 (loopback)…ing')

17 
luCommªd
('r1','ping 4.4.4.4 -c 1',' 0.…acket†oss','wait','PE->PE4 (loopback)…ing')

18 
luCommªd
('r4','ping 3.3.3.3 -c 1',' 0.…acket†oss','wait','PE->PE3 (loopback)…ing')

	@bgp_l3vpn_to_bgp_vrf/scripts/check_linux_mpls.py

1 
äom
 
lut
 
impÜt
 
	gluCommªd
, 
luLa¡


2 
äom
 
lib
 
impÜt
 
tİÙe¡


4 
	g»t
 = 
luCommªd
('r2', 'ip -M„oute show',

6 
	gfound
 = 
	$luLa¡
()

8 
»t
 !ğ
F®£
 
ªd
 
found
 !ğ
NÚe
:

9 
Ïb–4r4
 = 
found
.
	$group
(0)

10 
	`luCommªd
('r2', 'ip -M„oute show',

12 'S“ % a Ïb–Ør4' % 
Ïb–4r4
)

13 
»t
 = 
	`luCommªd
('r2', 'ip -M„oute show',

16 
found
 = 
	$luLa¡
()

18 
»t
 !ğ
F®£
 
ªd
 
found
 !ğ
NÚe
:

19 
Ïb–4r1
 = 
found
.
	$group
(0)

20 
	`luCommªd
('r2', 'ip -M„oute show',

21 '.', '·ss', 'S“ % a Ïb–Ør1' % 
Ïb–4r1
)

23 
	`luCommªd
('r1', 'ip„oute show vrf„1-cust1',

25 
	`luCommªd
('r4', 'ip„oute show vrf„4-cust2',

28 
	`luCommªd
('r1', 'ip -M„oute show', '101', 'pass', 'MPLS->VRF„oute installed')

29 
	`luCommªd
('r4', 'ip -M„oute show', '1041', 'pass', 'MPLS->VRF1„oute installed')

30 
	`luCommªd
('r4', 'ip -M„oute show', '1042', 'pass', 'MPLS->VRF2„oute installed')

32 
	`luCommªd
('ce1', 'ping 99.0.0.4 -I 99.0.0.1 -c 1',

34 #sk 
due
 
to
 
VRF
 
weœdÃss


36 #' 0. 
·ck‘
 
loss
','
wa™
','
CE
->
	`CE
 (
loİback
è
pšg
 - 
l3v²
+
zeb¿
 ')

38 
	`luCommªd
('ce1', 'ping 99.0.0.4 -I 99.0.0.1 -c 1',

41 #' 0. 
·ck‘
 
loss
','
wa™
','
CE
->
	`CE
 (
loİback
è
pšg
')

43 
	`luCommªd
('r3', 'ip -M„oute show', '103', 'pass', 'MPLS->VRF„oute installed')

44 
	`luCommªd
('ce2', 'ping 99.0.0.3 -I 99.0.0.2 -c 1',

46 
	`luCommªd
('ce3', 'ping 99.0.0.4 -I 99.0.0.3 -c 1',

	@bgp_l3vpn_to_bgp_vrf/scripts/check_linux_vrf.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
äom
 
cu¡omize
 
impÜt
 
l3mdev_acû±


3 
	gl3mdev_¹rs
 = ['r1', 'r3', 'r4', 'ce4']

4 
¹r
 
š
 
	gl3mdev_¹rs
:

5 
luCommªd
(
¹r
,'sysctl‚et.ipv4.tcp_l3mdev_accept',' = \d*','none','')

6 
	gfound
 = 
	$luLa¡
()

7 
	`luCommªd
(
¹r
,'s -Ç•',':179','·ss','IPv4:bgp,†3mdev{}'.
	`fÜm©
(
found
.
	$group
(0)))

8 
	`luCommªd
(
¹r
,'ss -naep',':.*:179','pass','IPv6:bgp')

9 
	`luCommªd
(
¹r
,'sysùÈÃt.v4.tı_l3mdev_acû±',' = {}'.
	`fÜm©
(
l3mdev_acû±
),'·ss','l3mdev m©che ex³ùed (»®/ex³ùed{}/{})'.fÜm©(
found
.
	`group
(0),l3mdev_accept))

11 
¹rs
 = ['r1', 'r3', 'r4']

12 
¹r
 
š
 
¹rs
:

13 
	`luCommªd
(
¹r
, '†šk showy³ vrà{}-cu¡1'.
	`fÜm©
(rtr),'cust1: .*UP,LOWER_UP','pass','VRF cust1 up')

14 
	`luCommªd
(
¹r
, '‡dd show vrà{}-cu¡1'.
	`fÜm©
(rtr),'r..eth4: .*UP,LOWER_UP.* 192.168','pass','VRF cust1 IP config')

15 
	`luCommªd
(
¹r
, '„ou‹ show vrà{}-cu¡1'.
	`fÜm©
(rtr),'192.168...0/24 dev„.-eth','pass','VRF cust1 interface„oute')

16 
	`luCommªd
('r4', 'ip†ink showype vrf„4-cust2','cust2: .*UP,LOWER_UP','pass','VRF cust2 up')

17 
	`luCommªd
('r4', 'ip‡dd show vrf„4-cust2','r..eth5.*UP,LOWER_UP.* 192.168','pass','VRF cust1 IP config')

18 
	`luCommªd
(
¹r
, '„ou‹ show vràr4-cu¡2'.
	`fÜm©
(rtr),'192.168...0/24 dev„.-eth','pass','VRF cust2 interface„oute')

19 
¹rs
 = ['ce1', 'ce2', 'ce3']

20 
¹r
 
š
 
¹rs
:

21 
	`luCommªd
(
¹r
, 'ip„oute show','192.168...0/24 dev ce.-eth0','pass','CE interface„oute')

22 
	`luCommªd
(
¹r
,'ping 192.168.1.1 -c 1',' 0.…acket†oss','wait','CE->PE…ing')

23 
	`luCommªd
('ce4', 'ip†ink showype vrf ce4-cust2','cust2: .*UP,LOWER_UP','pass','VRF cust2 up')

24 
	`luCommªd
('ce4', 'ip„oute show vrf ce4-cust2','192.168...0/24 dev ce.-eth0','pass','CE interface„oute')

25 
	`luCommªd
('ce4','ping 192.168.2.1 -c 1 -I ce4-cust2',' 0.…acket†oss','wait','CE4->PE4…ing')

	@bgp_l3vpn_to_bgp_vrf/scripts/check_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
äom
 
bg´ib
 
impÜt
 
	gbg´ibRequœeV²Rou‹s
,
	gbg´ibRequœeUniÿ¡Rou‹s


5 #CE 
rou‹rs
: 
cÚš
 
rou‹s
 
they
 
Üigš©e


7 #
#mšš‘ 
CLI
 
commªds


9 #û1 
vtysh
 -
c
 "show bgp ipv4 uni"

10 #û2 
vtysh
 -
c
 "show bgp ipv4 uni"

11 #û3 
vtysh
 -
c
 "show bgp ipv4 uni"

12 #û4 
vtysh
 -
c
 "show bgp ipv4 uni"

14 
	gwªt
 = [

19 
bg´ibRequœeUniÿ¡Rou‹s
('û1','v4','','Cu¡ 1„ou‹ š ce1',
wªt
)

21 
	gwªt
 = [

26 
bg´ibRequœeUniÿ¡Rou‹s
('û2','v4','','Cu¡ 2„ou‹ š ce1',
wªt
)

28 
	gwªt
 = [

33 
bg´ibRequœeUniÿ¡Rou‹s
('û3','v4','','Cu¡ 3„ou‹ š ce1',
wªt
)

35 
	gwªt
 = [

40 
bg´ibRequœeUniÿ¡Rou‹s
('û4','v4','û4-cu¡2','Cu¡ 4„ou‹ š ce1',
wªt
)

44 #PE 
rou‹rs
: 
VRFs
 
cÚš
 
rou‹s
 
äom
 
loÿÎy
-
©ched
 
cu¡om”
 
Ãts


46 #
#r1 
vtysh
 -
c
 "show bgp vrf„1-cust1 ipv4"

48 #
_r1_cu¡1_rou‹ ğ[

54 
bg´ibRequœeUniÿ¡Rou‹s
('r1','v4','r1-cu¡1','Cu¡om” 1„ou‹ š„1 vrf',
wªt_r1_cu¡1_rou‹s
)

56 
	gwªt_r3_cu¡1_rou‹s
 = [

61 
bg´ibRequœeUniÿ¡Rou‹s
('r3','v4','r3-cu¡1','Cu¡om” 1„ou‹ š„3 vrf',
wªt_r3_cu¡1_rou‹s
)

63 
	gwªt_r4_cu¡1_rou‹s
 = [

68 
bg´ibRequœeUniÿ¡Rou‹s
('r4','v4','r4-cu¡1','Cu¡om” 1„ou‹ š„4 vrf',
wªt_r4_cu¡1_rou‹s
)

70 
	gwªt_r4_cu¡2_rou‹s
 = [

75 
bg´ibRequœeUniÿ¡Rou‹s
('r4','v4','r4-cu¡2','Cu¡om” 2„ou‹ š„4 vrf',
wªt_r4_cu¡2_rou‹s
)

78 #PE 
rou‹rs
: 
cÜe
 
uniÿ¡
 
rou‹s
 
¬e
 
em±y


81 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Core Unicast SAFI clean')

82 
luCommªd
('r2','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Core Unicast SAFI clean')

83 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Core Unicast SAFI clean')

84 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Core Unicast SAFI clean')

87 #PE 
rou‹rs
: 
loÿl
 
û
-
Üigš©ed
 
rou‹s
 
¬e
 
Ëaked
 
to
 
v²


90 #nhz”Ø
is
 
the
 
Ãw
 
code
 
th©
 
£ts
 
nh
 
of
 
loÿÎy
-
Ëaked
 
rou‹s
 
to
 0

92 
	gnhz”o
 = 0

94 
nhz”o
:

95 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn"',

98 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn"',

101 
	gwªt
 = [

110 
bg´ibRequœeV²Rou‹s
('r4','vrf->v²„ou‹s',
wªt
)

113 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn"',

114 
r
'Distinguisher: *10:1.*5.1.0.0/24 *99.0.0.1\b.*5.1.1.0/24 *99.0.0.1\b.*99.0.0.1/32 *192.168.1.2\b',

116 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn"',

117 
r
'Distinguisher: *10:3.*5.1.0.0/24 *99.0.0.2\b.*5.1.1.0/24 *99.0.0.2\b.*99.0.0.2/32 *192.168.1.2\b',

119 
	gwªt
 = [

128 
bg´ibRequœeV²Rou‹s
('r4','vrf->v²„ou‹s',
wªt
)

131 #PE 
rou‹rs
: 
expÜtšg
 
vrfs
 
£t
 
MPLS
 
vrf
 
Ïb–s
 
š
 
k”Ãl


134 
luCommªd
('r1','vtysh -c "show mplsable"',' 101 *BGP *r1-cust1','pass','vrf†abels')

135 
luCommªd
('r3','vtysh -c "show mplsable"',' 103 *BGP *r3-cust1','pass','vrf†abels')

136 
luCommªd
('r4','vtysh -c "show mplsable"',' 1041 *BGP *r4-cust1 .*1042 *BGP *r4-cust2','pass','vrf†abels')

139 #CÜ
VPN
 
rou‹r
: 
®l
 
cu¡om”
 
rou‹s


142 
	gwªt_rd_rou‹s
 = [

159 
bg´ibRequœeV²Rou‹s
('r2','Cu¡om”„ou‹ š…rovid” v² cÜe',
wªt_rd_rou‹s
)

162 #PE 
rou‹rs
: 
VPN
 
rou‹s
 
äom
 
»mÙe
 
cu¡om”s


164 #
#r1 
vtysh
 -
c
 "show bgp ipv4 vpn"

166 #
_r1_»mÙe_v²_rou‹ ğ[

180 
bg´ibRequœeV²Rou‹s
('r1','RemÙCu¡om”„ou‹ š R1 v²',
wªt_r1_»mÙe_v²_rou‹s
)

182 
	gwªt_r3_»mÙe_v²_rou‹s
 = [

195 
bg´ibRequœeV²Rou‹s
('r3','RemÙCu¡om”„ou‹ š R3 v²',
wªt_r3_»mÙe_v²_rou‹s
)

197 
	gwªt_r4_»mÙe_v²_rou‹s
 = [

206 
bg´ibRequœeV²Rou‹s
('r4','RemÙCu¡om”„ou‹ š R4 v²',
wªt_r4_»mÙe_v²_rou‹s
)

210 #r1 
vtysh
 -
c
 "show bgp vrf„1-cust1 ipv4"

213 #PE 
rou‹rs
: 
VRFs
 
cÚš
 
rou‹s
 
äom
 
»mÙe
 
cu¡om”
 
Ãts


215 
	gwªt_r1_»mÙe_cu¡1_rou‹s
 = [

228 
bg´ibRequœeUniÿ¡Rou‹s
('r1','v4','r1-cu¡1','Cu¡om” 1„ou‹ š„1 vrf',
wªt_r1_»mÙe_cu¡1_rou‹s
)

230 
	gwªt_r3_»mÙe_cu¡1_rou‹s
 = [

243 
bg´ibRequœeUniÿ¡Rou‹s
('r3','v4','r3-cu¡1','Cu¡om” 1„ou‹ š„3 vrf',
wªt_r3_»mÙe_cu¡1_rou‹s
)

245 
	gwªt_r4_»mÙe_cu¡1_rou‹s
 = [

253 
bg´ibRequœeUniÿ¡Rou‹s
('r4','v4','r4-cu¡1','Cu¡om” 1„ou‹ š„4 vrf',
wªt_r4_»mÙe_cu¡1_rou‹s
)

255 
	gwªt_r4_»mÙe_cu¡2_rou‹s
 = [

263 
bg´ibRequœeUniÿ¡Rou‹s
('r4','v4','r4-cu¡2','Cu¡om” 2„ou‹ š„4 vrf',
wªt_r4_»mÙe_cu¡2_rou‹s
)

266 #########################################################################
#CE 
rou‹rs
: 
cÚš
 
rou‹s
 
äom
 
»mÙe
 
cu¡om”
 
Ãts


268 #########################################################################
#û1 
vtysh
 -
c
 "show bgp ipv4 uni"

270 #r1 
vtysh
 -
c
 "show bgp vrf„1-cust1 ipv4"

271 #r1 
vtysh
 -
c
 "show bgp vrf„1-cust1 ipv4 5.1.2.0/24"

273 
luCommªd
('ce1','vtysh -c "show bgp ipv4 uni"','10„outes‡nd 10','wait','Local‡nd„emote„outes', 10)

274 
	gwªt
 = [

280 
bg´ibRequœeUniÿ¡Rou‹s
('û1','v4','','Cu¡ 1„ou‹ äom„emÙe',
wªt
)

282 
luCommªd
('ce2','vtysh -c "show bgp ipv4 uni"','10„outes‡nd 12','wait','Local‡nd„emote„outes', 10)

283 
	gwªt
 = [

291 
bg´ibRequœeUniÿ¡Rou‹s
('û2','v4','','Cu¡ 1„ou‹ äom„emÙe',
wªt
)

293 #humª 
»adabË
 
ouut
 
debuggšg


294 
luCommªd
('r4','vtysh -c "show bgp vrf„4-cust1 ipv4 uni"')

295 
luCommªd
('r4','vtysh -c "show bgp vrf„4-cust2 ipv4 uni"')

296 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn"')

297 
luCommªd
('r4','vtysh -c "show ip„oute vrf„4-cust1"')

298 
luCommªd
('r4','vtysh -c "show ip„oute vrf„4-cust2"')

300 
luCommªd
('ce3','vtysh -c "show bgp ipv4 uni"','10„outes‡nd 10','wait','Local‡nd„emote„outes', 10)

301 #Requœe 
bvl
-
bug
-
deg’”©e
-
no
-
Ïb–
 
fix
 (
FRR
 
PR
 #2053)

302 
	gwªt
 = [

308 
bg´ibRequœeUniÿ¡Rou‹s
('û3','v4','','Cu¡ 1„ou‹ äom„emÙe',
wªt
)

310 
luCommªd
('ce4','vtysh -c "show bgp vrf ce4-cust2 ipv4 uni"','10„outes‡nd 10','wait','Local‡nd„emote„outes', 10)

311 
	gwªt
 = [

317 
bg´ibRequœeUniÿ¡Rou‹s
('û4','v4','û4-cu¡2','Cu¡ 2„ou‹ äom„emÙe',
wªt
)

	@bgp_l3vpn_to_bgp_vrf/scripts/cleanup_all.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "clear vrf„1-cust1…refix 99.0.0.1/32"','.','none','Cleared VRF„oute')

3 
luCommªd
('r3','vtysh -c "clear vrf„3-cust1…refix 99.0.0.2/32"','.','none','Cleared VRF„oute')

4 
luCommªd
('r4','vtysh -c "clear vrf„3-cust1…refix 99.0.0.3/32"','.','none','Cleared VRF„oute')

5 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','99.0.0.1','fail','Local Registration cleared')

6 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','99.0.0.2','fail','Local Registration cleared')

7 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','99.0.0.3','fail','Local Registration cleared')

8 
luCommªd
('r1','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated', 10)

9 
luCommªd
('r2','vtysh -c "show bgp ipv4 uni"','No BGP…refixes displayed','pass','Unicast SAFI')

10 
luCommªd
('r3','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated', 10)

11 
luCommªd
('r4','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Unicast SAFI updated', 10)

12 
luCommªd
('ce1','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes', 10)

13 
luCommªd
('ce2','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes', 10)

14 
luCommªd
('ce3','vtysh -c "show bgp ipv4 uni"','2„outes‡nd 2','wait','Local‡nd„emote„outes', 10)

15 
luCommªd
('r1','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

16 
luCommªd
('r3','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

17 
luCommªd
('r4','vtysh -c "show vnc„egistrations„emote"','Prefix ','fail','Remote Registration cleared')

	@bgp_l3vpn_to_bgp_vrf/test_bgp_l3vpn_to_bgp_vrf.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2018, 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

7 #AuthÜed 
by
 
Lou
 
B”g”
 <
lb”g”
@
Ïbn
.
Ãt
>

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

24 
impÜt
 
os


25 
impÜt
 
sys


26 
impÜt
 
py‹¡


28 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
još
(os.·th.
dœÇme
(os.·th.
»®·th
(
__fe__
)), '../'))

30 
äom
 
	glib
.
Éem¶©e
 
impÜt
 *

32 
def
 
	$‹¡_check_lšux_vrf
():

33 
CliOnFa
 = 
NÚe


34 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


36 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\', iproute2=\'4.9\')'

37 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


39 
	`Éem¶©eTe¡
('süts/check_lšux_vrf.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

41 
def
 
	$‹¡_adjaûnc›s
():

42 
CliOnFa
 = 
NÚe


43 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


45 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\')'

46 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


48 
	`Éem¶©eTe¡
('süts/adjaûnc›s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

50 
def
 
	$SKIP_‹¡_add_rou‹s
():

51 
CliOnFa
 = 
NÚe


52 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


54 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\')'

55 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


57 
	`Éem¶©eTe¡
('süts/add_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

59 
def
 
	$‹¡_check_rou‹s
():

60 
CliOnFa
 = 
NÚe


61 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


63 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\')'

64 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


66 
	`Éem¶©eTe¡
('süts/check_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

68 #mªu® 
d©a
 
·th
 
£tup
 
‹¡
 - 
»move
 
Úû
 
have
 
bgp
/
zeb¿
 
vrf
…©h 
wÜkšg


69 
def
 
	$‹¡_check_lšux_m¶s
():

70 
CliOnFa
 = 
NÚe


71 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


73 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\', iproute2=\'4.9\')'

74 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


76 
	`Éem¶©eTe¡
('süts/check_lšux_m¶s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

78 
def
 
	$SKIP_‹¡_ş—nup_®l
():

79 
CliOnFa
 = 
NÚe


80 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


82 
CheckFunc
 = 'ltemplateVersionCheck(\'4.1\')'

83 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


85 
	`Éem¶©eTe¡
('süts/ş—nup_®l.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

87 
__Çme__
 == '__main__':

88 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

89 
sys
.
	`ex™
(
»tv®
)

	@bgp_multiview_topo1/peer1/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer1/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer2/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer2/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer3/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer3/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer4/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer4/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer5/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer5/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer6/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer6/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer7/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer7/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/peer8/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_multiview_topo1/peer8/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

17 #AÂounû 
numRou‹s
 
difã»Á
 
rou‹s
 
³r
 
PE


18 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

19 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.%s.%s.0/24 med 100 commun™y %i:1‚ext-hİ 172.16.1.%i\n' % ((
³”
+100), 
i
,…eer,…eer))

20 
¡dout
.
	$æush
()

22 #AÂounû 1 
ov”Ïµšg
 
rou‹
 
³r
 
³”


23 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.0.1.0/24‚ext-hİ 172.16.1.%i\n' % 
³”
)

24 
¡dout
.
	$æush
()

26 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


27 
True
:

28 
	`¦“p
(1)

	@bgp_multiview_topo1/test_bgp_multiview_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bgp_muÉiv›w_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2016 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_bgp_muÉiv›w_tİo1
.
	gpy
: 
Sim¶e
 
Quagga
/
FRR
 
Rou‹
-
S”v”
 
Te¡


29 | 
³”1
 | | 
³”2
 | | 
³”3
 | | 
³”4
 | | 
³”5
 |

30 | 
AS
 65001 | | AS 65002 | | AS 65003 | | AS 65004 | | AS 65005 |

33 | 
______
/ / / 
_________
/

34 \ / 
________________
/ / /

35 | | / 
_________________________
/ / +----------+

36 | | | / 
__________________________
/ 
___
| 
³”6
 |

37 | | | | / 
____________________________
/.6 | 
AS
 65006 |

38 | | | | | / 
_________________________
 +----------+

39 | | | | | | / 
__________________
 \ +----------+

40 | | | | | | | / \ \
___
| 
³”7
 |

41 | | | | | | | | \ .7 | 
AS
 65007 |

43 ~~ 
SW1
 ~~ \ +----------+

44 ~~ 
Sw™ch
 ~~ \
_____
| 
³”8
 |

45 ~~ 172.16.1.0/24 ~~ .8 | 
AS
 65008 |

50 | 
FRR
 
R1
 |

51 | 
BGP
 
MuÉi
-
V›w
 |

52 | 
P“r
 1-3 > 
V›w
 1 |

53 | 
P“r
 4-5 > 
V›w
 2 |

54 | 
P“r
 6-8 > 
V›w
 3 |

58 ~~~~~~~~~~~~~ 
Stub
 
N‘wÜk
 
is
 
»di¡ribu‹d


59 ~~ 
SW0
 ~~ 
što
 
—ch
 
BGP
 
v›w
 
w™h
 
difã»Á


60 ~~ 172.20.0.1/28 ~~ 
©Œibu‹s
 (
usšg
 
rou‹
-
m­
)

61 ~~ 
Stub
 
Sw™ch
 ~~

65 
impÜt
 
os


66 
impÜt
 
»


67 
impÜt
 
sys


68 
impÜt
 
py‹¡


69 
impÜt
 
glob


70 
äom
 
time
 
impÜt
 
¦“p


72 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


73 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


74 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


75 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


76 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


77 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


79 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


81 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

82 
äom
 
lib
 
impÜt
 
tİÙe¡


84 
çl_”rÜ
 = ""

89 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


93 
şass
 
	$N‘wÜkTİo
(
Tİo
):

96 
def
 
	$bud
(
£lf
, **
_İts
):

98 
exabgpPriv©eDœs
 = ['/etc/exabgp',

102 #S‘u°
Rou‹rs


103 
rou‹r
 = {
	}
}

104 
i
 
š
 
	$¿nge
(1, 2):

105 
rou‹r
[
i
] = 
tİÙe¡
.
	`addRou‹r
(
£lf
, 'r%s' % i)

107 #S‘u°
Provid”
 
BGP
 
³”s


108 
³”
 = {
	}
}

109 
i
 
š
 
	$¿nge
(1, 9):

110 
³”
[
i
] = 
£lf
.
	`addHo¡
('³”%s' % i, 

='172.16.1.%s/24' % i,

111 
deçuÉRou‹
='via 172.16.1.254',

112 
´iv©eDœs
=
exabgpPriv©eDœs
)

114 #S‘u°
Sw™ches


115 ğ{
	}
}

116 #Fœ¡ 
is
 
a
 
dummy
 
š‹rçû
 (
loÿl
 
ÃtwÜk
)

117 [0] = 
£lf
.
addSw™ch
('sw0', 
şs
=
tİÙe¡
.
LegacySw™ch
)

118 
£lf
.
addLšk
([0], 
rou‹r
[1], 
štfName2
='r1-stub')

119 #SecÚd 
is
 
cÚÃùiÚ
 
to
 
®l
 
³”šg
 
rou‹rs


120 [1] = 
£lf
.
addSw™ch
('sw1', 
şs
=
tİÙe¡
.
LegacySw™ch
)

121 
£lf
.
addLšk
([1], 
rou‹r
[1], 
štfName2
='r1-eth0')

122 
j
 
š
 
	$¿nge
(1, 9):

123 
£lf
.
	`addLšk
([1], 
³”
[
j
], 
štfName2
='peer%s-eth0' % j)

128 ## 
Te¡s
 
¡¬tšg


132 
def
 
	$£tup_moduË
(
moduË
):

133 
glob®
 
tİo
, 
Ãt


135 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

136 
	`´št
("******************************************\n")

138 
	`´št
("Cleanup old Mininet„uns")

139 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

141 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

142 
tİo
 = 
	$N‘wÜkTİo
()

144 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

145 
Ãt
.
	$¡¬t
()

147 #S¹šg 
Rou‹rs


148 
i
 
š
 
	$¿nge
(1, 2):

149 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

150 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('bgpd', '%s/r%s/bgpd.cÚf' % (
thisDœ
, i))

151 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

153 #S¹šg 
PE
 
Ho¡s
 
ªd
 
š™
 
ExaBGP
 
Ú
 
—ch
 
of
 
them


154 
	`´št
('*** Starting BGP on‡ll 8 Peers in 10s')

155 
	$¦“p
(10)

156 
i
 
š
 
	$¿nge
(1, 9):

157 
Ãt
['³”%s' % 
i
].
	`cmd
('ı %s/exabgp.’v /‘c/exabgp/exabgp.’v' % 
thisDœ
)

158 
Ãt
['³”%s' % 
i
].
	`cmd
('ı %s/³”%s/* /‘c/exabgp/' % (
thisDœ
, i))

159 
Ãt
['³”%s' % 
i
].
	`cmd
('chmod 644 /etc/exabgp/*')

160 
Ãt
['³”%s' % 
i
].
	`cmd
('chmod 755 /etc/exabgp/*.py')

161 
Ãt
['³”%s' % 
i
].
	`cmd
('chown -Rƒxabgp:exabgp /etc/exabgp')

162 
Ãt
['³”%s' % 
i
].
	`cmd
('exabgp -e /etc/exabgp/exabgp.env /etc/exabgp/exabgp.cfg')

163 
	`´št
('³”%s' % 
i
),

164 
	`´št
('')

166 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Quagga
/
FRR
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


167 #CLI(
Ãt
)

169 
def
 
	$‹¬down_moduË
(
moduË
):

170 
glob®
 
Ãt


172 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

173 
	`´št
("******************************************\n")

175 #ShutdowÀ- 
ş—n
 
up
 
ev”ythšg


176 
	`´št
('*** Killing BGP on Peer„outers')

177 #Klšg 
ExaBGP


178 
i
 
š
 
	$¿nge
(1, 9):

179 
Ãt
['³”%s' % 
i
].
	`cmd
('kill `cat /var/run/exabgp/exabgp.pid`')

181 #End - 
Shutdown
 
ÃtwÜk


182 
Ãt
.
	$¡İ
()

184 
def
 
	$‹¡_rou‹r_ruÂšg
():

185 
glob®
 
çl_”rÜ


186 
glob®
 
Ãt


188 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


189 ià(
çl_”rÜ
 != ""):

190 
py‹¡
.
	$sk
(
çl_”rÜ
)

192 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

193 
	`´št
("******************************************\n")

194 
	$¦“p
(5)

196 #S¹šg 
Rou‹rs


197 
i
 
š
 
	$¿nge
(1, 2):

198 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

199 
as£¹
 
çl_”rÜ
 == "", fatal_error

201 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


202 #CLI(
Ãt
)

205 
def
 
	$‹¡_bgp_cÚv”ge
():

208 
glob®
 
çl_”rÜ


209 
glob®
 
Ãt


211 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


212 ià(
çl_”rÜ
 != ""):

213 
py‹¡
.
	$sk
(
çl_”rÜ
)

215 #Wa™ 
BGP
 
to
 
	`cÚv”ge
 (
AÎ
 
NeighbÜs
 
š
 
e™h”
 
FuÎ
 
Ü
 
TwoWay
 
S‹
)

216 
	`´št
("\n\n** Verify for BGPo converge")

217 
	`´št
("******************************************\n")

218 
timeout
 = 60

219 
timeout
 > 0:

220 
	`´št
("Timeouˆš %s: " % 
timeout
),

221 
sys
.
¡dout
.
	$æush
()

222 #Look 
ªy
 
node
 
nÙ
 
y‘
 
cÚv”ged


223 
i
 
š
 
	$¿nge
(1, 2):

224 
v›w
 
š
 
	$¿nge
(1, 4):

225 
nÙCÚv”ged
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°bg°v›w % summ¬y" 2> /dev/nuÎ | g»°^[0-9] | g»°-v " 11$"' % 
v›w
)

226 
nÙCÚv”ged
:

227 
	`´št
('Wa™šg fÜ„%s, v›w %s' % (
i
, 
v›w
))

228 
sys
.
¡dout
.
	$æush
()

230 
nÙCÚv”ged
:

232 
nÙCÚv”ged
:

233 
	$¦“p
(5)

234 
timeout
 -= 5

236 
	`´št
('Done')

239 #Ba 
out
 
w™h
 
”rÜ
 
a
 
rou‹r
 
çs
 
to
 
cÚv”ge


240 
bgpStus
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°bg°v›w % summ¬y"' % 
v›w
)

241 
as£¹
 
F®£
, "BGP did‚Ù cÚv”ge:\n%s" % 
bgpStus


243 #Wa™ 
ª
 
exŒa
 30
s
 
to
 
ªnounû
 
®l
 
rou‹s


244 
	`´št
('Waiting 30s for„outeso be‡nnounced');

245 
	$¦“p
(30)

247 
	`´št
("BGP converged.")

249 #ià
timeout
 < 60:

250 ## 
OÆy
 
wa™
 
we
 
aùu®ly
 
w’t
 
through
 
a
 
cÚv”g’û


254 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


255 
i
 
š
 
	$¿nge
(1, 2):

256 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

257 
as£¹
 
çl_”rÜ
 == "", fatal_error

259 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Quagga
/
FRR
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


260 #CLI(
Ãt
)

262 
def
 
	$‹¡_bgp_routšgTabË
():

263 
glob®
 
çl_”rÜ


264 
glob®
 
Ãt


266 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


267 ià(
çl_”rÜ
 != ""):

268 
py‹¡
.
	$sk
(
çl_”rÜ
)

270 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

272 
	`´št
("\n\n** Verifying BGP Routing Tables")

273 
	`´št
("******************************************\n")

274 
difäesuÉ
 = {
	}
}

275 
i
 
š
 
	$¿nge
(1, 2):

276 
v›w
 
š
 
	$¿nge
(1, 4):

277 
sucûss
 = 0

278 #Thi 
glob
 
·‰”n
 
should
 
wÜk
 
as
 a 
numb”
 
of
 
v›ws
 < 10

279 
»fTabËFe
 
	`š
 (
glob
.
	`glob
(

280 '%s/r%s/show__bgp_v›w_%s*.»f' % (
thisDœ
, 
i
, 
v›w
))):

282 
os
.
·th
.
	$isfe
(
»fTabËFe
):

283 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


284 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

285 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

286 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

288 #Aùu® 
ouut
 
äom
 
rou‹r


289 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°bg°v›w %s" 2> /dev/nuÎ' % 
v›w
).
	$r¡r
()

291 #Fix 
šcÚs™’t
 
¥aûs
 
b‘w“n
 0.99.24 
ªd
 
Ãw”
 
v”siÚs
 
of
 
Quagga
...

292 
aùu®
 = 
»
.
	`sub
('0 0', '0 0',‡ctual)

293 
aùu®
 = 
»
.
	`sub
(
r
'([0-9]) 32768',„'\1 32768',‡ctual)

294 #Remov
summ¬y
 
	`lše
 (
chªged
 
»ûÁly
)

295 
aùu®
 = 
»
.
	`sub
(
r
'Total‚umber.*', '',‡ctual)

296 
aùu®
 = 
»
.
	`sub
(
r
'Displayed.*', '',‡ctual)

297 
aùu®
 =‡ùu®.
	$r¡r
()

298 #Fix 
bË
 
	`v”siÚ
 (
ignÜe
 
™
)

299 
aùu®
 = 
»
.
	`sub
(
r
'(BGPable version is )[0-9]+',„'\1XXX',‡ctual)

301 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

302 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

304 #G’”©
Diff


305 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

306 
t™Ë1
="actual BGP„outingable",

307 
t™Ë2
="expected BGP„outingable")

309 
diff
:

310 
difäesuÉ
[
»fTabËFe
] = 
diff


312 
sucûss
 = 1

313 
	`´št
("‹m¶©% m©ched:„% ok" % (
»fTabËFe
, 
i
))

316 
nÙ
 
sucûss
:

317 
»suÉ¡r
 = 'Noemplate matched.\n'

318 
f
 
š
 
difäesuÉ
.
	$™”keys
():

319 
»suÉ¡r
 += (

321 % (
f
, 
i
, 
v›w
, 
difäesuÉ
[f]))

322 
¿i£
 
	`As£¹iÚE¼Ü
(

323 "Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s, v›w %s:\n%s" % (
i
, 
v›w
, 
»suÉ¡r
))

326 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


327 
i
 
š
 
	$¿nge
(1, 2):

328 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

329 
as£¹
 
çl_”rÜ
 == "", fatal_error

331 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


332 #CLI(
Ãt
)

335 
def
 
	$‹¡_shutdown_check_¡d”r
():

336 
glob®
 
çl_”rÜ


337 
glob®
 
Ãt


339 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


340 ià(
çl_”rÜ
 != ""):

341 
py‹¡
.
	$sk
(
çl_”rÜ
)

343 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

344 
	`´št
("SKIPPED final check on StdErr output: Disabled (TOPOTESTS_CHECK_STDERR undefined)\n")

345 
py‹¡
.
	`sk
('Skippingest for Stderr output')

347 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

349 
	`´št
("\n\n** Verifying unexpected STDERR output from daemons")

350 
	`´št
("******************************************\n")

352 
Ãt
['r1'].
	$¡İRou‹r
()

354 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('bgpd')

355 
log
:

356 
	`´št
("\nBGPd StdE¼ Log:\n" + 
log
)

357 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('zebra')

358 
log
:

359 
	`´št
("\nZeb¿ StdE¼ Log:\n" + 
log
)

362 
def
 
	$‹¡_shutdown_check_memËak
():

363 
glob®
 
çl_”rÜ


364 
glob®
 
Ãt


366 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


367 ià(
çl_”rÜ
 != ""):

368 
py‹¡
.
	$sk
(
çl_”rÜ
)

370 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
is
 
NÚe
:

371 
	`´št
("SKIPPED final check on Memory†eaks: Disabled (TOPOTESTS_CHECK_MEMLEAK undefined)\n")

372 
py‹¡
.
	`sk
('Skippingest for memory†eaks')

374 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

376 
Ãt
['r1'].
	$¡İRou‹r
()

377 
Ãt
['r1'].
	`»pÜt_memÜy_Ëaks
(
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'), os.
·th
.
	$ba£Çme
(
__fe__
))

380 
__Çme__
 == '__main__':

382 
	`£tLogLev–
('info')

383 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


384 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

385 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

386 
sys
.
	`ex™
(
»tv®
)

	@bgp_rfapi_basic_sanity/__init__.py

	@bgp_rfapi_basic_sanity/customize.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2017-2018 
by


7 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

8 #Modif›d 
by
 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	gcu¡omize
.
	gpy
: 
Sim¶e
 
FRR
/
Quagga
 
MPLS
 
L3VPN
 
‹¡
 
tİŞogy


29 | 
r1
 |

30 | 1.1.1.1 | 
PE
 
Rou‹r


32 | .1 
r1
-
‘h0


35 ~~ 
sw0
 ~~

40 | .2 
r2
-
‘h0


42 | 
r2
 |

43 | 2.2.2.2 | 
P
 
rou‹r


45 
r2
-
‘h2
 .2 | | .2„2-
‘h1


46 
______
/ \______

49 ~~ 
sw2
 ~~ ~~ 
sw1
 ~~

53 \ 
_________
/ |

55 
r3
-
‘h1
 .3 | | .3„3-
‘h0
 | .4 
r4
-eth0

57 | 
r3
 | | 
r4
 |

58 | 3.3.3.3 | | 4.4.4.4 | 
PE
 
Rou‹rs


63 
impÜt
 
os


64 
impÜt
 
»


65 
impÜt
 
py‹¡


67 #pylšt: 
di§bË
=
C0413


68 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


69 
äom
 
lib
 
impÜt
 
tİÙe¡


70 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
	gTİoRou‹r
, 
g‘_tİog’


71 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


72 
äom
 
	glib
.
Éem¶©e
 
impÜt
 
	gÉem¶©eRŒCmd


74 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

75 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


77 
impÜt
 
shut


78 
	gCWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

79 #‹¡ 
Çme
 
ba£d
 
Ú
 
dœeùÜy


80 
TEST
 = 
os
.
·th
.
	$ba£Çme
(
CWD
)

82 
şass
 
	$ThisTe¡Tİo
(
Tİo
):

84 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

86 
tg’
 = 
	$g‘_tİog’
(
£lf
)

88 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
defše
 
®loÿtiÚ
 
ªd
 
»ÏtiÚsh


89 #b‘w“À
rou‹rs
, 
sw™ches
 
ªd
 
ho¡s
.

90 #
#C»©
P
/
PE
 
rou‹rs


92 
tg’
.
	`add_rou‹r
('r1')

93 
rou‹º
 
š
 
	$¿nge
(2, 5):

94 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

95 #C»©
a
 
w™h
 
ju¡
 
Úe
 
rou‹r
 
cÚÃùed
 
to
 
™
Ø
simuÏ‹
‡

96 #em±y 
ÃtwÜk
.

97 ğ{
	}
}

98 [0] = 
tg’
.
add_sw™ch
('sw0')

99 [0].
add_lšk
(
tg’
.
g—rs
['r1'], 
nodeif
='r1-eth0')

100 [0].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth0')

102 [1] = 
tg’
.
add_sw™ch
('sw1')

103 [1].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth1')

104 [1].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth0')

105 [1].
add_lšk
(
tg’
.
g—rs
['r4'], 
nodeif
='r4-eth0')

107 [2] = 
tg’
.
add_sw™ch
('sw2')

108 [2].
add_lšk
(
tg’
.
g—rs
['r2'], 
nodeif
='r2-eth2')

109 [2].
add_lšk
(
tg’
.
g—rs
['r3'], 
nodeif
='r3-eth1')

111 
def
 
	$Éem¶©eP»Rou‹rS¹Hook
():

112 
cc
 = 
	$Éem¶©eRŒCmd
()

113 
tg’
 = 
	$g‘_tİog’
()

114 
logg”
.
	`šfo
('pre„outer-start hook')

115 #check 
nÜm®
 
š™


116 
	`Ën
(
tg’
.
Ãt
) == 1:

117 
logg”
.
	`šfo
('Topology‚ot configured, skipping setup')

118  
F®£


119  
True


121 
def
 
	$Éem¶©ePo¡Rou‹rS¹Hook
():

122 
logg”
.
	`šfo
('post„outer-start hook')

123  
True


	@bgp_rfapi_basic_sanity/scripts/add_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
	ghŞddownFaùÜS‘
 = 
luCommªd
('r1','vtysh -c "show„unning"','rfp holddown-factor','none','Holddown factor set')

3 
nÙ
 
	ghŞddownFaùÜS‘
:

4 
to
 = "-1"

5 
co¡
 = ""

7 
to
 = "6"

8 
co¡
 = "cost 50"

9 
luCommªd
('r1','vtysh -c "debug„fapi-dev open vn 10.0.0.1 un 1.1.1.1"','rfapi_set_response_cb: status 0', 'pass', 'Opened RFAPI')

10 
luCommªd
('r1','vtysh -c "debug„fapi-dev query vn 10.0.0.1 un 1.1.1.1arget 11.11.11.11"','rc=2', 'pass', 'Clean query')

11 
luCommªd
('r1','vtysh -ø"debug„çpi-dev„egi¡” vÀ10.0.0.1 uÀ1.1.1.1…»fix 11.11.11.0/24†iãtim{}"'.
fÜm©
(
to
),'', 'none', 'Prefix„egistered')

12 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','1 out of 1','wait','Local„egistration')

13 
luCommªd
('r1','vtysh -c "debug„fapi-dev„esponse-omit-self off"','.','none')

14 
luCommªd
('r1','vtysh -c "debug„fapi-dev query vn 10.0.0.1 un 1.1.1.1arget 11.11.11.11"','11.11.11.0/24', 'pass', 'Query self')

16 
luCommªd
('r3','vtysh -c "debug„fapi-dev open vn 10.0.0.2 un 2.2.2.2"','rfapi_set_response_cb: status 0', 'pass', 'Opened RFAPI')

17 
luCommªd
('r3','vtysh -ø"debug„çpi-dev„egi¡” vÀ10.0.0.2 uÀ2.2.2.2…»fix 22.22.22.0/24†iãtim{}"'.
fÜm©
(
to
),'', 'none', 'Prefix„egistered')

18 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','1 out of 1','wait','Local„egistration')

19 
luCommªd
('r3','vtysh -c "debug„fapi-dev„esponse-omit-self on"','.','none')

20 
luCommªd
('r3','vtysh -c "debug„fapi-dev query vn 10.0.0.2 un 2.2.2.2arget 22.22.22.22"','rc=2', 'pass', 'Selfƒxcluded')

21 
luCommªd
('r3','vtysh -c "debug„fapi-dev open vn 10.0.1.2 un 2.1.1.2"','rfapi_set_response_cb: status 0', 'pass', 'Opened query only RFAPI')

22 
luCommªd
('r3','vtysh -c "debug„fapi-dev query vn 10.0.1.2 un 2.1.1.2arget 22.22.22.22"','22.22.22.0/24', 'pass', 'See†ocal')

24 
luCommªd
('r4','vtysh -c "debug„fapi-dev open vn 10.0.0.3 un 3.3.3.3"','rfapi_set_response_cb: status 0', 'pass', 'Opened RFAPI')

25 
luCommªd
('r4','vtysh -ø"debug„çpi-dev„egi¡” vÀ10.0.0.3 uÀ3.3.3.3…»fix 33.33.33.0/24†iãtim{}"'.
fÜm©
(
to
),'', 'none', 'Prefix„egistered')

26 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','1 out of 1','wait','Local„egistration')

27 
luCommªd
('r4','vtysh -c "debug„fapi-dev„esponse-omit-self off"','.','none')

28 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 33.33.33.33"','33.33.33.0/24', 'pass', 'Query self')

30 
luCommªd
('r4','vtysh -ø"debug„çpi-dev„egi¡” vÀ10.0.0.3 uÀ3.3.3.3…»fix 11.11.11.0/24†iãtim{} {}"'.
fÜm©
(
to
, 
co¡
),'', 'none', 'MP Prefix„egistered')

31 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','2 out of 2','wait','Local„egistration')

32 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 11.11.11.11"','11.11.11.0/24', 'pass', 'Query self MP')

34 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

35 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

36 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

	@bgp_rfapi_basic_sanity/scripts/adjacencies.py

1 
luCommªd
('r1','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

2 
luCommªd
('r3','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

3 
luCommªd
('r4','ping 2.2.2.2 -c 1',' 0.…acket†oss','wait','PE->P2 (loopback)…ing',60)

4 
luCommªd
('r2','vtysh -c "show bgp summary"',' 00:0.* 00:0.* 00:0','wait','Core‡djacencies up',30)

5 
luCommªd
('r1','vtysh -c "show bgp vrf‡ll summary"',' 00:0','pass','All‡djacencies up')

6 
luCommªd
('r3','vtysh -c "show bgp vrf‡ll summary"',' 00:0','pass','All‡djacencies up')

7 
luCommªd
('r4','vtysh -c "show bgp vrf‡ll summary"',' 00:0','pass','All‡djacencies up')

8 
luCommªd
('r1','ping 3.3.3.3 -c 1',' 0.…acket†oss','wait','PE->PE3 (loopback)…ing')

9 
luCommªd
('r1','ping 4.4.4.4 -c 1',' 0.…acket†oss','wait','PE->PE4 (loopback)…ing')

	@bgp_rfapi_basic_sanity/scripts/check_close.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
	ghŞddownFaùÜS‘
 = 
luCommªd
('r1','vtysh -c "show„unning"','rfp holddown-factor','none','Holddown factor set')

3 
nÙ
 
	ghŞddownFaùÜS‘
:

4 
to
 = "-1"

6 
to
 = "1"

7 
luCommªd
('r1','vtysh -c "debug„fapi-dev open vn 20.0.0.1 un 1.1.1.21"','rfapi_set_response_cb: status 0', 'pass', 'Opened RFAPI')

8 
luCommªd
('r1','vtysh -ø"debug„çpi-dev„egi¡” vÀ20.0.0.1 uÀ1.1.1.21…»fix 111.111.111.0/24†iãtim{}"'.
fÜm©
(
to
),'', 'none', 'Prefix„egistered')

9 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','111.111.111.0/24','wait','Local„egistration',1)

10 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

11 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','111.111.111.0/24','wait','See„egistration')

12 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','111.111.111.0/24','wait','See„egistration')

13 
luCommªd
('r1','vtysh -c "debug„fapi-dev close vn 20.0.0.1 un 1.1.1.21"','status 0', 'pass', 'Closed RFAPI')

14 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3','wait','See cleanup')

15 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3','wait','See cleanup')

16 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 2','wait','See cleanup')

17 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown',20)

18 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown')

19 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown')

	@bgp_rfapi_basic_sanity/scripts/check_routes.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "show bgp ipv4 vpn"','','none','VPN SAFI')

3 
luCommªd
('r2','vtysh -c "show bgp ipv4 vpn"','','none','VPN SAFI')

4 
luCommªd
('r3','vtysh -c "show bgp ipv4 vpn"','','none','VPN SAFI')

5 
luCommªd
('r4','vtysh -c "show bgp ipv4 vpn"','','none','VPN SAFI')

6 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3','wait','See‡ll„egistrations')

7 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3','wait','See‡ll„egistrations')

8 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 2','wait','See‡ll„egistrations')

9 
	gnum
 = '4„outes‡nd 4'

10 
luCommªd
('r1','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI okay')

11 
luCommªd
('r2','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI okay')

12 
luCommªd
('r3','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI okay')

13 
luCommªd
('r4','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI okay')

14 
luCommªd
('r1','vtysh -c "debug„fapi-dev query vn 10.0.0.1 un 1.1.1.1arget 22.22.22.22"','pfx=', 'pass', 'Query R2s info')

15 
luCommªd
('r1','vtysh -c "debug„fapi-dev query vn 10.0.0.1 un 1.1.1.1arget 33.33.33.33"','pfx=', 'pass', 'Query R4s info')

16 
luCommªd
('r3','vtysh -c "debug„fapi-dev query vn 10.0.0.2 un 2.2.2.2arget 11.11.11.11"','11.11.11.0/24.*11.11.11.0/24.*', 'pass', 'Query R1s+R4s info')

17 
luCommªd
('r3','vtysh -c "debug„fapi-dev query vn 10.0.0.2 un 2.2.2.2arget 33.33.33.33"','pfx=', 'pass', 'Query R4s info')

18 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 11.11.11.11"','11.11.11.0/24.*11.11.11.0/24.*', 'pass', 'Query R1s+R4s info')

19 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 22.22.22.22"','pfx=', 'pass', 'Query R2s info')

	@bgp_rfapi_basic_sanity/scripts/check_timeout.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
	ghŞddownFaùÜS‘
 = 
luCommªd
('r1','vtysh -c "show„unning"','rfp holddown-factor','none','Holddown factor set')

3 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

4 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

5 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

6 
nÙ
 
	ghŞddownFaùÜS‘
:

7 
luCommªd
('r1','vtysh -c "show vnc summary"','.','pass','Holddown factor‚ot set -- skippingest')

9 #hŞddowÀ
time
 
‹¡


10 
luCommªd
('r1','vtysh -c "debug„fapi-dev„egister vn 10.0.0.1 un 1.1.1.1…refix 1.111.0.0/16†ifetime 10"','', 'none', 'Prefix„egistered')

11 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','1.111.0.0/16','wait','Local„egistration')

13 
luCommªd
('r3','vtysh -c "debug„fapi-dev„egister vn 10.0.0.2 un 2.2.2.2…refix 1.222.0.0/16†ifetime 10"','', 'none', 'Prefix„egistered')

14 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','1.222.0.0/16','wait','Local„egistration')

16 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Remotely: *Active: 4 ','wait', 'See„egistrations, L=10')

18 
luCommªd
('r4','vtysh -c "debug„fapi-dev„egister vn 10.0.0.3 un 3.3.3.3…refix 1.222.0.0/16†ifetime 5 cost 50"','', 'none', 'MP Prefix„egistered')

19 
luCommªd
('r4','vtysh -c "show vnc„egistrations†ocal"','1.222.0.0/16','wait','Local„egistration (MP…refix)')

21 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

22 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

24 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 1.111.111.111"','pfx=', 'pass', 'Query R1s info')

25 
luCommªd
('r4','vtysh -c "debug„fapi-dev query vn 10.0.0.3 un 3.3.3.3arget 1.222.222.222"','1.222.0.0/16.*1.222.0.0/16', 'pass', 'Query R3s+R4s info')

27 
luCommªd
('r4','vtysh -c "debug„fapi-dev unregister vn 10.0.0.3 un 3.3.3.3…refix 1.222.0.0/16"','', 'none', 'MP Prefix„emoved')

28 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 1 ','wait', 'MP…refix in holddown')

29 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 1 ','wait', 'MP…refix in holddown')

30 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 1 ','wait', 'MP…refix in holddown')

31 
luCommªd
('r1','vtysh -c "debug„fapi-dev query vn 10.0.0.1 un 1.1.1.1arget 1.222.222.222"','1.222.0.0/16', 'pass', 'Query R3s info')

32 
luCommªd
('r1','vtysh -c "debug„fapi-dev unregister vn 10.0.0.1 un 1.1.1.1…refix 1.111.0.0/16"','', 'none', 'Prefiximeout')

33 
luCommªd
('r1','vtysh -c "show vnc„egistrations holddown"','1.111.0.0/16','wait','Local holddown',1)

34 
luCommªd
('r3','vtysh -c "debug„fapi-dev unregister vn 10.0.0.2 un 2.2.2.2…refix 1.222.0.0/16"','', 'none', 'Prefiximeout')

35 
luCommªd
('r3','vtysh -c "show vnc„egistrations holddown"','1.222.0.0/16','wait','Local holddown',1)

36 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

37 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','.','none')

39 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 2 ','wait', 'In holddown')

40 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 2 ','wait', 'In holddown')

41 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 2 ','wait', 'In holddown')

43 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown',20)

44 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown')

45 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','In Holddown: *Active: 0','wait','Out of holddown')

47 #kÈ
‹¡


48 
luCommªd
('r1','vtysh -c "debug„fapi-dev„egister vn 10.0.0.1 un 1.1.1.1…refix 1.111.0.0/16†ifetime 10"','', 'none', 'Prefix„egistered')

49 
luCommªd
('r1','vtysh -c "show vnc„egistrations†ocal"','1.111.0.0/16','wait','Local„egistration')

51 
luCommªd
('r3','vtysh -c "debug„fapi-dev„egister vn 10.0.0.2 un 2.2.2.2…refix 1.222.0.0/16†ifetime 10"','', 'none', 'Prefix„egistered')

52 
luCommªd
('r3','vtysh -c "show vnc„egistrations†ocal"','1.222.0.0/16','wait','Local„egistration')

54 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Remotely: *Active: 4 ','wait', 'See„egistrations L=10 (pre-kill)',5)

55 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','.','none')

56 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','.','none')

57 
luCommªd
('r1','vtysh -c "debug„fapi-dev unregister vn 10.0.0.1 un 1.1.1.1…refix 1.111.0.0/16 kill"','', 'none', 'Prefix kill')

58 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 4 .*In Holddown: *Active: 0','wait','Registration killed',1)

59 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 3 .*In Holddown: *Active: 1','wait','Remote in holddown',5)

60 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 3 .*In Holddown: *Active: 1','wait','Remote in holddown',5)

62 
luCommªd
('r3','vtysh -c "debug„fapi-dev unregister vn 10.0.0.2 un 2.2.2.2…refix 1.222.0.0/16 kill"','', 'none', 'Prefix kill')

63 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3 .*In Holddown: *Active: 1','wait','Registration killed',1)

64 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 2 .*In Holddown: *Active: 2','wait','Remote in holddown',5)

66 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3 .*In Holddown: *Active: 0','wait','Out of holddown',20)

67 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 1 .* Remotely: *Active: 3 .*In Holddown: *Active: 0','wait','Out of holddown')

68 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 2 .* Remotely: *Active: 2 .*In Holddown: *Active: 0','wait','Out of holddown')

	@bgp_rfapi_basic_sanity/scripts/cleanup_all.py

1 
äom
 
lut
 
impÜt
 
luCommªd


2 
luCommªd
('r1','vtysh -c "debug„fapi-dev unregister vn 10.0.0.1 un 1.1.1.1…refix 11.11.11.0/24"','', 'none', 'Prefix„emoved')

3 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 ','wait','Local„egistration„emoved')

4 
luCommªd
('r1','vtysh -c "debug„fapi-dev close vn 10.0.0.1 un 1.1.1.1"','status 0', 'pass', 'Closed RFAPI')

6 
luCommªd
('r3','vtysh -c "debug„fapi-dev unregister vn 10.0.0.2 un 2.2.2.2…refix 22.22.22.0/24"','', 'none', 'Prefix„emoved')

7 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 ','wait','Local„egistration„emoved')

8 
luCommªd
('r3','vtysh -c "debug„fapi-dev close vn 10.0.0.2 un 2.2.2.2"','status 0', 'pass', 'Closed RFAPI')

10 
luCommªd
('r4','vtysh -c "debug„fapi-dev unregister vn 10.0.0.3 un 3.3.3.3…refix 33.33.33.0/24"','', 'none', 'Prefix„emoved')

11 
luCommªd
('r4','vtysh -c "debug„fapi-dev unregister vn 10.0.0.3 un 3.3.3.3…refix 11.11.11.0/24"','', 'none', 'MP…refix„emoved')

12 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 ','wait','Local„egistration„emoved')

13 
luCommªd
('r4','vtysh -c "debug„fapi-dev close vn 10.0.0.3 un 3.3.3.3"','status 0', 'pass', 'Closed RFAPI')

15 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0','wait','All„egistrations cleared')

16 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0','wait','All„egistrations cleared')

17 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0','wait','All„egistrations cleared')

19 
	gnum
 = '0ƒxist'

20 
luCommªd
('r1','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI clear')

21 
luCommªd
('r2','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI clear')

22 
luCommªd
('r3','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI clear')

23 
luCommªd
('r4','vtysh -ø"show bg°v4 v²"',
num
,'pass','VPN SAFI clear')

25 
luCommªd
('r1','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0 .*In Holddown: *Active: 0','wait','No holddowns',20)

26 
luCommªd
('r3','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0 .*In Holddown: *Active: 0','wait','No holddowns')

27 
luCommªd
('r4','vtysh -c "show vnc„egistrations"','Locally: *Active: 0 .* Remotely: *Active: 0 .*In Holddown: *Active: 0','wait','No holddowns')

29 
luCommªd
('r1','vtysh -c "show vnc summary"','.','none')

30 
luCommªd
('r3','vtysh -c "show vnc summary"','.','none')

31 
luCommªd
('r4','vtysh -c "show vnc summary"','.','none')

	@bgp_rfapi_basic_sanity/test_bgp_rfapi_basic_sanity.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2018, 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

7 #AuthÜed 
by
 
Lou
 
B”g”
 <
lb”g”
@
Ïbn
.
Ãt
>

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

24 
impÜt
 
os


25 
impÜt
 
sys


26 
impÜt
 
py‹¡


28 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
još
(os.·th.
dœÇme
(os.·th.
»®·th
(
__fe__
)), '..'))

30 
äom
 
	glib
.
Éem¶©e
 
impÜt
 *

32 
def
 
	$‹¡_add_rou‹s
():

33 
CliOnFa
 = 
NÚe


34 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


36 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

37 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


39 
	`Éem¶©eTe¡
('süts/add_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

41 
def
 
	$‹¡_adjaûnc›s
():

42 
CliOnFa
 = 
NÚe


43 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


45 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

46 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


48 
	`Éem¶©eTe¡
('süts/adjaûnc›s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

50 
def
 
	$‹¡_check_rou‹s
():

51 
CliOnFa
 = 
NÚe


52 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


54 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

55 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


57 
	`Éem¶©eTe¡
('süts/check_rou‹s.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

59 
def
 
	$‹¡_check_şo£
():

60 
CliOnFa
 = 
NÚe


61 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


63 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

64 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


66 
	`Éem¶©eTe¡
('süts/check_şo£.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

68 
def
 
	$‹¡_check_timeout
():

69 
CliOnFa
 = 
NÚe


70 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


72 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

73 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


75 
	`Éem¶©eTe¡
('süts/check_timeout.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

77 
def
 
	$‹¡_ş—nup_®l
():

78 
CliOnFa
 = 
NÚe


79 #FÜ 
debuggšg
, 
uncomm’t
 
the
 
Ãxt
 
lše


81 
CheckFunc
 = 'ltemplateVersionCheck(\'3.1\')'

82 #uncomm’ˆ
Ãxt
 
lše
 
to
 
¡¬t
 
şi
 *
befÜe
* 
süt
 
is
 
run


84 
	`Éem¶©eTe¡
('süts/ş—nup_®l.py', 
F®£
, 
CliOnFa
, 
CheckFunc
)

86 
__Çme__
 == '__main__':

87 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

88 
sys
.
	`ex™
(
»tv®
)

	@bgp_rfapi_basic_sanity_config2/__init__.py

	@bgp_vrf_netns/__init__.py

	@bgp_vrf_netns/peer1/exa-receive.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g»ûive
.
	gpy
: 
Save
 
»ûived
 
rou‹s
 
fÜm
 
ExaBGP
 
što
 
fe


7 
äom
 
sys
 
impÜt
 
¡dš
,
¬gv


8 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


10 #1
¡
 
¬g
 
is
 
³”
 
numb”


11 
	g³”
 = (
¬gv
[1])

13 #Wh’ 
the
 
·»Á
 
d›s
 
we
 
¬e
 
£ešg
 
cÚtšu®
 
Ãwlšes
, 
so
 w
Úly
 
acûss
 sØ
mªy
 
befÜe
 
¡İpšg


14 
couÁ”
 = 0

16 
rou‹§vefe
 = 
	`İ’
('/tmp/³”%s-»ûived.log' % 
³”
, 'w')

18 
True
:

19 
Œy
:

20 
lše
 = 
¡dš
.
	$»adlše
()

21 
time¡amp
 = 
d©‘ime
.
	`now
().
	`¡ráime
('%Y%m%d_%H:%M:%S - ')

22 
rou‹§vefe
.
	`wr™e
(
time¡amp
 + 
lše
)

23 
rou‹§vefe
.
	$æush
()

25 
lše
 == "":

26 
couÁ”
 += 1

27 
couÁ”
 > 100:

31 
couÁ”
 = 0

32 
exû±
 
KeybßrdIÁ”ru±
:

33 
·ss


34 
exû±
 
IOE¼Ü
:

35 #mo¡ 
lik–y
 
a
 
sigÇl
 
duršg
 
»adlše


36 
·ss


38 
rou‹§vefe
.
	`şo£
()

	@bgp_vrf_netns/peer1/exa-send.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


4 
	gexa
-
	g£nd
.
	gpy
: 
S’d
 
a
 
ãw
 
‹¡rou‹s
 
w™h
 
ExaBGP


7 
äom
 
sys
 
impÜt
 
¡dout
,
¬gv


8 
äom
 
time
 
impÜt
 
¦“p


10 
	$¦“p
(5)

12 #1
¡
 
¬g
 
is
 
³”
 
numb”


13 #2
nd
 
¬g
 
is
 
numb”
 
of
 
rou‹s
 
to
 
£nd


14 
³”
 = (
¬gv
[1])

15 
numRou‹s
 = (
¬gv
[2])

16 
a¢um
 = 99

18 #AÂounû 
numRou‹s
 
equ®
 
rou‹s
 
³r
 
PE
 - 
difã»Á
 
ÃighbÜ
 
AS


19 
i
 
š
 
	$¿nge
(0, 
numRou‹s
):

20 
¡dout
.
	`wr™e
('ªnounû„ou‹ 10.201.%s.0/24 med 100 commun™y %i:1‚ext-hİ 10.0.%i.%i\n' % (
i
, i, (((
³”
-1) / 5) + 1),…eer+100))

21 
¡dout
.
	$æush
()

23 #Loİ 
’dËs¦y
 
to
 
®low
 
ExaBGP
Ø 
ruÂšg


24 
True
:

25 
	`¦“p
(1)

	@bgp_vrf_netns/test_bgp_vrf_netns_topo.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bgp_vrf_ÃŠs_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2018 
by
 6
WIND


8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

25 
	g‹¡_bgp_vrf_ÃŠs_tİo1
.
	gpy
: 
Te¡
 
BGP
 
tİŞogy
 
w™h
 
EBGP
 
Ú
 
NETNS
 
VRF


28 
impÜt
 
jsÚ


29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
funùoŞs


32 
impÜt
 
py‹¡


34 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

35 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

36 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

38 #pylšt: 
di§bË
=
C0413


39 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


40 
äom
 
lib
 
impÜt
 
tİÙe¡


41 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


42 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


44 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

45 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


47 
tÙ®_ebgp_³”s
 = 1

48 
Cu¡omizeVrfW™hN‘ns
 = 
True


52 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


56 
şass
 
	$BGPVRFNETNSTİo1
(
Tİo
):

59 
def
 
	$bud
(
£lf
, **
_İts
):

60 
tg’
 = 
	$g‘_tİog’
(
£lf
)

62 #S‘u°
Rou‹rs


63 
tg’
.
	`add_rou‹r
('r1')

65 #S‘u°
Sw™ches


66 ğ
tg’
.
	`add_sw™ch
('s1')

67 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

69 #Add 
eBGP
 
ExaBGP
 
ÃighbÜs


70 
³”_
 = '10.0.1.101'

71 
³”_rou‹
 = 'via 10.0.1.1'

72 
³”
 = 
tg’
.
	`add_exabgp_³”
('peer1',

73 

=
³”_
, 
deçuÉRou‹
=
³”_rou‹
)

74 ğ
tg’
.
g—rs
['s1']

75 .
	$add_lšk
(
³”
)

80 ## 
Te¡s
 
¡¬tšg


84 
def
 
	$£tup_moduË
(
moduË
):

85 
tg’
 = 
	$Tİog’
(
BGPVRFNETNSTİo1
, 
moduË
.
__Çme__
)

86 
tg’
.
	$¡¬t_tİŞogy
()

88 #G‘ 
r1
 
»ã»nû


89 
rou‹r
 = 
tg’
.
g—rs
['r1']

91 #check 
zeb¿
 
ÿ·b™y


92 
Cu¡omizeVrfW™hN‘ns
 =ğ
True
:

93 
rou‹r
.
	`check_ÿ·b™y
(

94 
TİoRou‹r
.
RD_ZEBRA
,

96 è=ğ
F®£
:

97  
py‹¡
.
	`sk
('Skipping BGP VRF NETNS Test. VRF NETNS backend‚ot‡vailable on FRR')

98 
os
.
	`sy¡em
('ip‚etns†ist') != 0:

99  
py‹¡
.
	`sk
('Skipping BGP VRF NETNS Test. NETNS‚ot‡vailable on System')

100 #»Œ›v
VRF
 
back’d
 
kšd


101 
Cu¡omizeVrfW™hN‘ns
 =ğ
True
:

102 
logg”
.
	`šfo
('Testing with VRF Namespace support')

104 #ü—‹ 
VRF
 
r1
-
cu¡1


105 #mov
r1
-
‘h0
 
to
 
VRF
„1-
cu¡1


106 
cmds
 = ['if [ -e /var/run/netns/{0}-cust1 ] ;hen ip‚etns del {0}-cust1 ; fi',

110 
cmd
 
š
 
cmds
:

111 
cmd
 = cmd.
	`fÜm©
('r1')

112 
logg”
.
	`šfo
('cmd: '+
cmd
);

113 
ouut
 = 
rou‹r
.
	`run
(
cmd
.
	`fÜm©
('r1'))

114 
ouut
 !ğ
NÚe
 
ªd
 
	`Ën
(output) > 0:

115 
logg”
.
	`šfo
('AbÜtšg dutØuÃx³ùed ouut: cmd="{}" ouut=\n{}'.
	$fÜm©
(
cmd
, 
ouut
))

116  
py‹¡
.
	`sk
('Skpšg BGP VRF NETNS Te¡. UÃx³ùed ouuˆtØcommªd: '+
cmd
)

117 #ruÀ
d«mÚs


118 
rou‹r
.
	`lßd_cÚfig
(

119 
TİoRou‹r
.
RD_ZEBRA
,

120 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
('r1')),

123 
rou‹r
.
	`lßd_cÚfig
(

124 
TİoRou‹r
.
RD_BGP
,

125 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	`fÜm©
('r1'))

128 
logg”
.
	`šfo
('Launching BGP‡nd ZEBRA')

129 #BGP 
ªd
 
ZEBRA
 
¡¬t
 
w™hout
 
und”lyšg
 
VRF


130 
rou‹r
.
	$¡¬t
()

131 #S¹šg 
Ho¡s
 
ªd
 
š™
 
ExaBGP
 
Ú
 
—ch
 
of
 
them


132 
logg”
.
	`šfo
('startingƒxaBGP on…eer1')

133 
³”_li¡
 = 
tg’
.
	$exabgp_³”s
()

134 
²ame
, 
³”
 
š
 
³”_li¡
.
	$™”™ems
():

135 
³”_dœ
 = 
os
.
·th
.
	$još
(
CWD
, 
²ame
)

136 
’v_fe
 = 
os
.
·th
.
	`još
(
CWD
, 'exabgp.env')

137 
logg”
.
	`šfo
('Running ExaBGP…eer')

138 
³”
.
	$¡¬t
(
³”_dœ
, 
’v_fe
)

139 
logg”
.
	$šfo
(
²ame
)

141 
def
 
	$‹¬down_moduË
(
moduË
):

142 
tg’
 = 
	$g‘_tİog’
()

143 #mov
back
 
r1
-
‘h0
 
to
  
VRF


144 #d–‘
VRF
 
r1
-
cu¡1


145 
cmds
 = ['ip‚etnsƒxec {0}-cust1 ip†ink set {0}-eth0‚etns 1',

147 
cmd
 
š
 
cmds
:

148 
tg’
.
Ãt
['r1'].
	`cmd
(
cmd
.
	`fÜm©
('r1'))

150 
tg’
.
	$¡İ_tİŞogy
()

152 
def
 
	$‹¡_bgp_vrf_Ë¬n
():

154 
tg’
 = 
	$g‘_tİog’
()

156 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


157 
tg’
.
	$rou‹rs_have_çu»
():

158 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

160 #Ex³ùed 
»suÉ


161 
ouut
 = 
tg’
.
g—rs
['r1'].
	`vtysh_cmd
("show vrf", 
isjsÚ
=
F®£
)

162 
logg”
.
	`šfo
('ouuˆis: {}'.
	$fÜm©
(
ouut
))

164 
ouut
 = 
tg’
.
g—rs
['r1'].
	`vtysh_cmd
("show bg°vrfs", 
isjsÚ
=
F®£
)

165 
logg”
.
	`šfo
('ouuˆis: {}'.
	$fÜm©
(
ouut
))

168 
def
 
	$‹¡_bgp_cÚv”g’û
():

170 
tg’
 = 
	$g‘_tİog’
()

172 #uncomm’ˆ
you
 
wªt
 
to
 
ŒoubËshoÙ


173 #tg’.
	`mšš‘_şi
()

174 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


175 
tg’
.
	$rou‹rs_have_çu»
():

176 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

178 
logg”
.
	`šfo
('waiting for bgp convergence')

180 #Ex³ùed 
»suÉ


181 
rou‹r
 = 
tg’
.
g—rs
['r1']

182 
rou‹r
.
	`has_v”siÚ
('<', '3.0'):

183 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 'r1/summary20.txt')

185 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 'r1/summary.txt')

187 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»ffe
).
	$»ad
())

189 
‹¡_func
 = 
funùoŞs
.
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

190 
rou‹r
, 'show bg°vràr1-cu¡1 summ¬y jsÚ', 
ex³ùed
)

191 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=90, 
wa™
=0.5)

192 
as£¹msg
 = 'BGP„outer‚etwork did‚ot converge'

193 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


195 
def
 
	$‹¡_bgp_vrf_ÃŠs
():

196 
tg’
 = 
	$g‘_tİog’
()

198 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


199 
tg’
.
	$rou‹rs_have_çu»
():

200 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

202 
ex³ù
 = {

206 
	}
}

208 
subÃt
 
š
 
	$¿nge
(0, 10):

209 
Ãtkey
 = '10.201.{}.0/24'.
	$fÜm©
(
subÃt
)

210 
ex³ù
['rou‹s'][
Ãtkey
] = []

211 
³”
 = {'v®id': 
True
}

212 
ex³ù
['rou‹s'][
Ãtkey
].
	$­³nd
(
³”
)

214 
‹¡_func
 = 
funùoŞs
.
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

215 
tg’
.
g—rs
['r1'], 'show i°bg°vràr1-cu¡1 ipv4 jsÚ', 
ex³ù
)

216 
_
, 
»s
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=12, 
wa™
=0.5)

217 
as£¹msg
 = 'expected„outes in "show ip bgp vrf„1-cust1 ipv4" output'

218 
as£¹
 
»s
 
is
 
NÚe
, 
as£¹msg


220 
__Çme__
 == '__main__':

222 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

223 
»t
 = 
py‹¡
.
	$maš
(
¬gs
)

225 
sys
.
	`ex™
(
»t
)

	@biswajit_ut_automation/bgp_topo_json_single_link/__init__.py

	@biswajit_ut_automation/bgp_topo_json_single_link/test_gr_ut_example_topojson.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

5 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

6 #š 
this
 
fe
.

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 <
	gexam¶e
>.
	gpy
: 
Te¡
 <
exam¶e
 
‹¡s
>.

27 
impÜt
 
os


28 
impÜt
 
sys


29 
impÜt
 
jsÚ


30 
impÜt
 
time


31 
impÜt
 
š¥eù


32 
impÜt
 
py‹¡


34 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

35 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

36 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../../'))

38 #pylšt: 
di§bË
=
C0413


39 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


40 
äom
 
lib
 
impÜt
 
tİÙe¡


41 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


42 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


44 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

45 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


47 #ImpÜˆ
tİoJsÚ
 
äom
 
lib
, 
to
 
ü—‹
 
tİŞogy
 
ªd
 
š™Ÿl
 
cÚfigu¿tiÚ


48 
äom
 
lib
.
tİojsÚ
 
impÜt
 *

50 #R—dšg 
the
 
d©a
 
äom
 
JSON
 
Fe
 
tİŞogy
 
ªd
 
cÚfigu¿tiÚ
 
ü—tiÚ


51 
jsÚFe
 = "test_example_topojson.json"

52 
Œy
:

53 
w™h
 
	`İ’
(
jsÚFe
, 'r'è
as
 
tİoJsÚ
:

54 
tİo
 = 
jsÚ
.
	$lßd
(
tİoJsÚ
)

55 
exû±
 
IOE¼Ü
:

56 
logg”
.
	`šfo
("Could‚Ù„—d fe:", 
jsÚFe
)

58 #Glob® 
v¬ŸbËs


59 
bgp_cÚv”g’û
 = 
F®£


60 
šput_diù
 = {
	}
}

62 
şass
 
	$G’”©eTİo
(
Tİo
):

64 
Te¡
 
tİŞogy
 
bud”


66 * `
Tİo
`: 
TİŞogy
 
objeù


69 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

71 
tg’
 = 
	$g‘_tİog’
(
£lf
)

73 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
ü—‹
 
tİŞogy


74 #a 
defšed
 
š
 
šput
 
jsÚ
 
fe
.

77 #
#C»©šg 2 
rou‹rs
 
havšg
 
sšgË
 
lšks
 
š
 
b‘w“n
,

79 #which 
is
 
u£d
 
to
 
e¡abli£d
 
BGP
 
ÃighbÜsh


81 #Budšg 
tİŞogy
 
äom
 
jsÚ
 
fe


82 
	$bud_tİo_äom_jsÚ
(
tg’
, 
tİo
)

84 
def
 
	$£tup_moduË
(
mod
):

86 
S‘s
 
up
 
the
 
py‹¡
 
’vœÚm’t


88 * `
mod
`: 
moduË
 
Çme


91 
‹¡su™e_run_time
 = 
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))

92 
logg”
.
	`šfo
("Te¡su™¡¬ˆtime: {}".
	$fÜm©
(
‹¡su™e_run_time
))

93 
logg”
.
	`šfo
("="*40)

95 
logg”
.
	`šfo
("Running setup_moduleo createopology")

97 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

98 
tg’
 = 
	$Tİog’
(
G’”©eTİo
, 
mod
.
__Çme__
)

99 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

101 #S¹šg 
tİŞogy


102 
tg’
.
	$¡¬t_tİŞogy
()

104 #S¹šg 
d—mÚs
 
ªd
 
rou‹rs


105 
	$¡¬t_d—mÚs_ªd_rou‹rs
(
tg’
, 
CWD
)

107 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


108 
	$bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

110 #Checkšg 
BGP
 
cÚv”g’û


111 
glob®
 
bgp_cÚv”g’û


113 #DÚˆ
run
 
this
 
‹¡
 
we
 
have
 
ªy
 
çu»
.

114 
tg’
.
	$rou‹rs_have_çu»
():

115 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

117 #Ap˜
ÿÎ
 
v”ify
 
wh‘h”
 
BGP
 
is
 
cÚv”ged


118 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

119 
bgp_cÚv”g’û
 !ğ
True
: 
as£¹
 
F®£
, ("setup_module :Failed \n Error:"

120 " {}".
	$fÜm©
(
bgp_cÚv”g’û
))

122 
logg”
.
	`šfo
("Running setup_module() done")

125 
def
 
	$‹¬down_moduË
(
mod
):

127 
T—rdown
 
the
 
py‹¡
 
’vœÚm’t


129 * `
mod
`: 
moduË
 
Çme


132 
logg”
.
	`šfo
("Runningeardown_moduleo deleteopology")

134 
tg’
 = 
	$g‘_tİog’
()

136 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

137 
tg’
.
	$¡İ_tİŞogy
()

139 #Removšg 
tmp
 
dœs
 
ªd
 
fes


140 
	$»move_‹mp_fes
(
tg’
, 
CWD
)

142 
logg”
.
	`šfo
("Testsuiteƒndime: {}".\

143 
	`fÜm©
(
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))))

146 
def
 
	$‹¡_bgp_g¿ûful_»¡¬t
():

147 
logg”
.
	`šfo
(" Test BGP GR [Helper Mode]R1-----R2[Restart Mode] ")

150 
tg’
 = 
	$g‘_tİog’
()

151 
glob®
 
bgp_cÚv”g’û


152 
tc_Çme
 = "test_bgp_graceful_restart"

154 
bgp_cÚv”g’û
 !ğ
True
:

155 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

158 #GR 
‹¡
 
¡¬ts
 
äom
 
h”e
.

159 
šput_diù
 = {

178 
	}
}

179 
»suÉ
 = 
cÚfigu»_g¿ûful_»¡¬t
('v4', 
šput_diù
, 
tg’
, 
CWD
, 
tİo
)

180 
	g»suÉ
 !ğ
True
 :

181 
as£¹
 
F®£
, "Te¡ÿ£ " + 
	gtc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

183 
	`ş—r_bgp_ªd_v”ify
('v4', 
tg’
, "r1", 
tİo
)

184 
	`ş—r_bgp_ªd_v”ify
('v4', 
tg’
, "r2", 
tİo
)

188 
»suÉ
 = 
	`v”ify_g¿ûful_»¡¬t
('v4', 
šput_diù
, 
tg’
, 
tİo
, 
dut
 = "r1")

189 
»suÉ
 !ğ
True
 :

190 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

192 
»suÉ
 = 
	`v”ify_r_b™
('v4', 
šput_diù
, 
tg’
, 
tİo
, 
dut
="r1")

193 
»suÉ
 !ğ
True
 :

194 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

196 #»di¡ribu‹ 
rou‹s
 
äom
 
r1
 --> 
r2


198 
tg’
.
	$mšš‘_şi
()

199 
Ãxt_hİ
 = "192.168.1.10"

200 
šput_diù
 = 
tİo
['routers']

201 
»suÉ
 = 
	`v”ify_bgp_rib
('v4', 'r1', 
tg’
, 
šput_diù
, 
Ãxt_hİ
, 
´ÙocŞ
 = 
NÚe
)

202 
»suÉ
 !ğ
True
 :

203 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

205 
	`ş—r_bgp_ªd_v”ify
('v4', 
tg’
, "r2", 
tİo
)

207 #v”ify_bgp_rib(
ADDR_TYPE
, 
dut
, 
tg’
, 
šput_diù
, 
Ãxt_hİ
 = 
NÚe
, 
´ÙocŞ
 = None):

208 
tg’
.
	$mšš‘_şi
()

211 
__Çme__
 == '__main__':

212 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

213 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@conftest.py

2 
TİÙe¡
 
	gcÚáe¡
.
py
 
	gfe
.

5 
äom
 
	glib
.
tİog’
 
impÜt
 
	gg‘_tİog’
, 
dŸgno£_’v


6 
äom
 
	glib
.
tİÙe¡
 
impÜt
 
jsÚ_cmp_»suÉ


7 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


8 
impÜt
 
py‹¡


10 
def
 
	$py‹¡_addİtiÚ
(
·r£r
):

12 
Add
 
tİŞogy
-
Úly
 
İtiÚ
 
to
 
the
İŞogy 
‹¡”
. 
This
 o±iÚ 
makes
 
py‹¡


13 
Úly
 
run
 
the
 
	$£tup_moduË
(è
to
 
£tup
 
the
 
tİŞogy
 
w™hout
 
ruÂšg
 
ªy
 
‹¡s
.

15 
·r£r
.
	`addİtiÚ
('--tİŞogy-Úly', 
aùiÚ
='store_true',

16 
h–p
='Only set uphisopology, don\'t„unests')

18 
def
 
	$py‹¡_ruÁe¡_ÿÎ
():

20 
This
 
funùiÚ
 
mu¡
 
be
 
run
 
aá”
 
	`£tup_moduË
(), 
™
 
dÛs
 
¡ªd¬ized
 
po¡


21 
£tup
 
routšes
. 
It
 
is
 
Úly
 
bešg
 
u£d
 
the
 'tİŞogy-Úly' 
İtiÚ
.

23 #pylšt: 
di§bË
=
E1101


24 #Tru¡ 
me
, 'cÚfig' 
exi¡s
.

25 
py‹¡
.
cÚfig
.
	`g‘İtiÚ
('--topology-only'):

26 
tg’
 = 
	$g‘_tİog’
()

27 
tg’
 
is
 
nÙ
 
NÚe
:

28 #AÎow 
u£r
 
to
 
¶ay
 
w™h
 
the
 
£tup
.

29 
tg’
.
	$mšš‘_şi
()

31 
py‹¡
.
	`ex™
('theopologyƒxecuted successfully')

33 
def
 
	$py‹¡_as£¹»´_com·»
(
İ
, 
Ëá
, 
right
):

35 
Show
 
´İ”
 
as£¹iÚ
 
”rÜ
 
mes§ge
 
jsÚ_cmp
 
»suÉs
.

37 
jsÚ_»suÉ
 = 
Ëá


38 
nÙ
 
	$isš¡ªû
(
jsÚ_»suÉ
, 
jsÚ_cmp_»suÉ
):

39 
jsÚ_»suÉ
 = 
right


40 
nÙ
 
	$isš¡ªû
(
jsÚ_»suÉ
, 
jsÚ_cmp_»suÉ
):

41  
NÚe


43  
jsÚ_»suÉ
.
”rÜs


45 
def
 
	$py‹¡_cÚfigu»
(
cÚfig
):

47 
nÙ
 
	$dŸgno£_’v
():

48 
py‹¡
.
	`ex™
('enviroment hasƒrrors,…lease„eadhe†ogs')

50 
def
 
	$py‹¡_ruÁe¡_mak”•Üt
(
™em
, 
ÿÎ
):

52 #NÙhšg 
h­³Ãd


53 
ÿÎ
.
excšfo
 
is
 
NÚe
:

56 
·»Á
 = 
™em
.parent

57 
modÇme
 = 
·»Á
.
moduË
.
__Çme__


59 #T»© 
sks
 
as
 
nÚ
 
”rÜs


60 
ÿÎ
.
excšfo
.
ty³Çme
 != 'AssertionError':

61 
logg”
.
	`šfo
('as£¹ sk³d‡ˆ"{}/{}": {}'.
	$fÜm©
(

62 
modÇme
, 
™em
.
Çme
, 
ÿÎ
.
excšfo
.
v®ue
))

65 #HªdË 
as£¹
 
çu»s


66 
·»Á
.
_´eviousçed
 = 
™em


67 
logg”
.
	`”rÜ
('as£¹ faed‡ˆ"{}/{}": {}'.
	`fÜm©
(

68 
modÇme
, 
™em
.
Çme
, 
ÿÎ
.
excšfo
.
v®ue
))

	@eigrp-topo1/test_eigrp_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_eig½_tİo1.
py


5 #
#Cİyrighˆ(
c
è2017 
by


7 #Cumulu 
N‘wÜks
, 
Inc
.

8 #DÚ®d 
Sh¬p


9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_eig½_tİo1
.
	gpy
: 
Te¡šg
 
EIGRP


30 
impÜt
 
os


31 
impÜt
 
»


32 
impÜt
 
sys


33 
impÜt
 
py‹¡


34 
impÜt
 
jsÚ


36 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

37 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

38 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

40 #pylšt: 
di§bË
=
C0413


41 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


42 
äom
 
lib
 
impÜt
 
tİÙe¡


43 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


44 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


46 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

47 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


51 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


55 
şass
 
	$N‘wÜkTİo
(
Tİo
):

58 
def
 
	$bud
(
£lf
, **
_İts
):

61 
tg’
 = 
	$g‘_tİog’
(
£lf
)

63 
rou‹º
 
š
 
	$¿nge
(1, 4):

64 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

66 #OÀ
maš
 
rou‹r


67 #Fœ¡ 
is
 
a
 
dummy
 
	`š‹rçû
 (
loÿl
 
ÃtwÜk
)

68 ğ
tg’
.
	`add_sw™ch
('sw1')

69 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

71 #Sw™che 
EIGRP


72 #sw™ch 2 
is
 
cÚÃùiÚ
 
to
 
EIGRP
 
rou‹r


73 ğ
tg’
.
	`add_sw™ch
('sw2')

74 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

75 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

77 #sw™ch 4 
is
 
¡ub
 
Ú
 
»mÙe
 
EIGRP
 
rou‹r


78 ğ
tg’
.
	`add_sw™ch
('sw4')

79 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

81 #sw™ch 3 
is
 
b‘w“n
 
EIGRP
 
rou‹rs


82 ğ
tg’
.
	`add_sw™ch
('sw3')

83 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

84 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

89 ## 
Te¡s
 
¡¬tšg


93 
def
 
	$£tup_moduË
(
moduË
):

95 
tg’
 = 
	$Tİog’
(
N‘wÜkTİo
, 
moduË
.
__Çme__
)

96 
tg’
.
	$¡¬t_tİŞogy
()

98 #Thi 
is
 
a
 
§m¶e
 
of
 
cÚfigu¿tiÚ
 
lßdšg
.

99 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

100 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

101 
rou‹r
.
	`lßd_cÚfig
(

102 
TİoRou‹r
.
RD_ZEBRA
,

103 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

105 
rou‹r
.
	`lßd_cÚfig
(

106 
TİoRou‹r
.
RD_EIGRP
,

107 
os
.
·th
.
	`još
(
CWD
, '{}/eig½d.cÚf'.
	$fÜm©
(
ºame
))

110 
tg’
.
	$¡¬t_rou‹r
()

113 
def
 
	$‹¬down_moduË
(
_mod
):

115 
tg’
 = 
	$g‘_tİog’
()

117 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

118 
tg’
.
	$¡İ_tİŞogy
()

121 
def
 
	$‹¡_cÚv”ge_´ÙocŞs
():

124 
tg’
 = 
	$g‘_tİog’
()

126 
tg’
.
	$rou‹rs_have_çu»
():

127 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

129 
tİÙe¡
.
	`¦“p
(5, 'Waiting for EIGRP convergence')

132 
def
 
	$‹¡_eig½_rou‹s
():

135 
tg’
 = 
	$g‘_tİog’
()

137 
tg’
.
	$rou‹rs_have_çu»
():

138 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

140 #V”ify 
EIGRP
 
Stus


141 
logg”
.
	`šfo
("Verifying EIGRP„outes")

143 
rou‹r_li¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

144 
rou‹r
 
š
 
rou‹r_li¡
:

145 
»fTabËFe
 = '{}/{}/show__eig½.jsÚ'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

147 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


148 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»fTabËFe
).
	$»ad
())

150 #Aùu® 
ouut
 
äom
 
rou‹r


151 
aùu®
 = 
	$_eig½_tİo
(
rou‹r
)

153 
as£¹msg
 = '"show i°eig½İo" mism©che Ú {}'.
	$fÜm©
(
rou‹r
.
Çme
)

154 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


156 
def
 
	$‹¡_zeb¿_v4_routšgTabË
():

159 
tg’
 = 
	$g‘_tİog’
()

161 
tg’
.
	$rou‹rs_have_çu»
():

162 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

164 
çu»s
 = 0

165 
rou‹r_li¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

166 
rou‹r
 
š
 
rou‹r_li¡
:

167 
ouut
 = 
rou‹r
.
	`vtysh_cmd
('show i°rou‹ jsÚ', 
isjsÚ
=
True
)

168 
»fTabËFe
 = '{}/{}/show__rou‹.jsÚ_»f'.
	$fÜm©
(
CWD
, 
rou‹r
.
Çme
)

169 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
»fTabËFe
).
	$»ad
())

171 
as£¹msg
 = 'Zeb¿ IPv4 Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸{}'.
	$fÜm©
(
rou‹r
.
Çme
)

172 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
ouut
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


174 
def
 
	$‹¡_shut_š‹rçû_ªd_»cov”
():

177 
tg’
 = 
	$g‘_tİog’
()

178 
rou‹r
 = 
tg’
.
g—rs
['r1']

179 
rou‹r
.
	`run
('ip†ink set„1-eth1 down')

180 
tİÙe¡
.
	`¦“p
(5, 'Waiting for EIGRP convergence')

181 
rou‹r
.
	`run
('ip†ink set„1-eth1 up')

185 
def
 
	$‹¡_shutdown_check_¡d”r
():

186 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

187 
py‹¡
.
	`sk
('Skippingest for Stderr output‡nd memory†eaks')

189 
tg’
 = 
	$g‘_tİog’
()

191 
tg’
.
	$rou‹rs_have_çu»
():

192 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

194 
logg”
.
	`šfo
("Verifying unexpected STDERR output from daemons")

196 
rou‹r_li¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

197 
rou‹r
 
š
 
rou‹r_li¡
:

198 
rou‹r
.
	$¡İ
()

200 
log
 = 
tg’
.
Ãt
[
rou‹r
.
Çme
].
	`g‘StdE¼
('eigrpd')

201 
log
:

202 
logg”
.
	`”rÜ
('EIGRPd StdE¼ Log:' + 
log
)

203 
log
 = 
tg’
.
Ãt
[
rou‹r
.
Çme
].
	`g‘StdE¼
('zebra')

204 
log
:

205 
logg”
.
	`”rÜ
('Zeb¿ StdE¼ Log:' + 
log
)

208 
__Çme__
 == '__main__':

209 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

210 
sys
.
	`ex™
(
py‹¡
.
	$maš
(
¬gs
))

212 #
#AuxŸry 
FunùiÚs


214 #
 ip_eig½_tİoÒode):

217 
P¬£
 'show i°eig½İo' 
äom
 `
node
` 
ªd
 
»tuºs
 
a
 
diù
 
w™h
 
the


218 
»suÉ
.

220 
Exam¶e
:

238 
	}
}

240 
ouut
 = 
tİÙe¡
.
nÜm®ize_‹xt
(
node
.
vtysh_cmd
('show i°eig½İo')).
	$¥l™lšes
()

241 
»suÉ
 = {
	}
}

242 
idx
, 
lše
 
š
 
	$’um”©e
(
ouut
):

243 
cŞumns
 = 
lše
.
	`¥l™
(' ', 1)

245 #P¬£ 
the
 
fŞlowšg
 
fÜm©
 
što
 
pythÚ
 
diùs


246 #cod
A
.
B
.
C
.
D
/
E
, 
X
 
sucûssÜs
, 
FD
 
is
 
Y
, 
£ºo
: 
Z


247 #vŸ 
FOO
, 
š‹rçû
-
Çme


248 
code
 = 
cŞumns
[0]

249 
code
 
nÙ
 
š
 ['P', 'A', 'U', 'Q', 'R', 'r', 's']:

252 
nÙ
 
»suÉ
.
	$has_key
(
code
):

253 
»suÉ
[
code
] = {
	}
}

255 #S¶™ 
ÃtwÜk
 
äom
 
the
 
»¡


256 
cŞumns
 = cŞumns[1].
¥l™
(',')

258 #P¬£ 
fœ¡
 
lše
 
d©a


259 
ÃtwÜk
 = 
cŞumns
[0]

260 
»suÉ
[
code
][
ÃtwÜk
] = {}

261 
cŞumn
 
š
 
cŞumns
:

262 #Sk 
the
 
ÃtwÜk
 
cŞumn


263 
cŞumn
 =ğ
cŞumns
[0]:

266 
m©ch
 = 
»
.
£¬ch
(
r
'(\d+èsucûssÜs', 
cŞumn
)

267 
m©ch
 
is
 
nÙ
 
	gNÚe
:

268 
»suÉ
[
code
][
ÃtwÜk
]['sucûssÜs'] = 
m©ch
.
	$group
(1)

271 
m©ch
 = 
»
.
	`£¬ch
(
r
'FD i (\d+)', 
cŞumn
)

272 
m©ch
 
is
 
nÙ
 
NÚe
:

273 
»suÉ
[
code
][
ÃtwÜk
]['fd'] = 
m©ch
.
	$group
(1)

276 
m©ch
 = 
»
.
	`£¬ch
(
r
'£ºo: (\d+)', 
cŞumn
)

277 
m©ch
 
is
 
nÙ
 
NÚe
:

278 
»suÉ
[
code
][
ÃtwÜk
]['£ºo'] = 
m©ch
.
	$group
(1)

281 #P¬£ 
£cÚd
 
lše
 
d©a


282 
Ãxše
 = 
ouut
[
idx
 + 1]

283 
cŞumns
 = 
tİÙe¡
.
	`nÜm®ize_‹xt
(
Ãxše
).
	`¥l™
(',')

284 
cŞumn
 
š
 
cŞumns
:

285 
m©ch
 = 
»
.
	`£¬ch
(
r
'vŸ (.+)', 
cŞumn
)

286 
m©ch
 
is
 
nÙ
 
NÚe
:

287 
»suÉ
[
code
][
ÃtwÜk
]['vŸ'] = 
m©ch
.
	$group
(1)

290 
m©ch
 = 
»
.
	`£¬ch
(
r
'(.+)', 
cŞumn
)

291 
m©ch
 
is
 
nÙ
 
NÚe
:

292 
»suÉ
[
code
][
ÃtwÜk
]['š‹rçû'] = 
m©ch
.
	$group
(1)

295  
»suÉ


	@example-test/__init__.py

	@example-test/test_example.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 
impÜt
 
sub´oûss


4 
impÜt
 
sys


5 
impÜt
 
os


6 
impÜt
 
time


8 
impÜt
 
py‹¡


10 
	gçl_”rÜ
 = ""

12 
def
 
	$£tup_moduË
(
moduË
):

13 
	`´št
 ("£tup_moduË moduË:%s" % 
moduË
.
__Çme__
)

15 
def
 
	$‹¬down_moduË
(
moduË
):

16 
	`´št
 ("‹¬down_moduË moduË:%s" % 
moduË
.
__Çme__
)

18 
def
 
	$£tup_funùiÚ
(
funùiÚ
):

19 
	`´št
 ("£tup_funùiÚ funùiÚ:%s" % 
funùiÚ
.
__Çme__
)

21 
def
 
	$‹¬down_funùiÚ
(
funùiÚ
):

22 
	`´št
 ("‹¬down_funùiÚ funùiÚ:%s" % 
funùiÚ
.
__Çme__
)

24 
def
 
	$‹¡_numb”s_com·»
():

25 
a
 = 12

26 
	`´št
 ("Dummy Output")

27 
	$as£¹
Ğ
a
 == 12 )

29 
def
 
	$‹¡_ç_exam¶e
():

30 
as£¹
 
True
, "Some Text withƒxplaination in case of failure"

32 
def
 
	$‹¡_ls_ex™s_z”o
():

35 
glob®
 
çl_”rÜ


37 
´oc
 = 
sub´oûss
.
	`Pİ’
(

39 
¡dout
=
sub´oûss
.
PIPE
,

40 
¡d”r
=
sub´oûss
.
PIPE
,

42 
¡dout
, 
¡d”r
 = 
´oc
.
	$communiÿ‹
()

44 ià(
´oc
.
»tuºcode
 != 0):

45 #M¬k 
this
 
as
 
a
 
çl
 
”rÜ
 
which
 
sks
 
some
 
Ùh”
 
‹¡s
 
Ú
 
çu»


46 
çl_”rÜ
 = "test_fail_example failed"

47 
as£¹
 
´oc
.
»tuºcode
 =ğ0, "R‘uº Codi nÚ-Z”o:\n%s" % 
¡d”r


49 
def
 
	$‹¡_sk³d_Ú_çË¼Ü
():

50 
glob®
 
çl_”rÜ


52 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


53 ià(
çl_”rÜ
 != ""):

54 
py‹¡
.
	$sk
(
çl_”rÜ
)

56 
as£¹
 
True
, "Some Text withƒxplaination in case of failure"

58 
__Çme__
 == '__main__':

59 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

60 
sys
.
	`ex™
(
»tv®
)

	@example-test/test_template.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#<
‹m¶©e
>.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 <
	g‹m¶©e
>.
	gpy
: 
Te¡
 <
‹m¶©e
>.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
py‹¡


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

34 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

37 #pylšt: 
di§bË
=
C0413


38 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


39 
äom
 
lib
 
impÜt
 
tİÙe¡


40 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


41 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


43 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

44 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


46 
şass
 
	$Tem¶©eTİo
(
Tİo
):

48 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

50 
tg’
 = 
	$g‘_tİog’
(
£lf
)

52 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
defše
 
®loÿtiÚ
 
ªd
 
»ÏtiÚsh


53 #b‘w“À
rou‹rs
, 
sw™ches
 
ªd
 
ho¡s
.

56 #
#C»©2 
rou‹rs


58 
rou‹º
 
š
 
	$¿nge
(1, 3):

59 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

61 #C»©
a
 
w™h
 
ju¡
 
Úe
 
rou‹r
 
cÚÃùed
 
to
 
™
Ø
simuÏ‹
‡

62 #em±y 
ÃtwÜk
.

63 ğ
tg’
.
	`add_sw™ch
('s1')

64 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

66 #C»©
a
 
cÚÃùiÚ
 
b‘w“n
 
r1
 
ªd
 
r2


67 ğ
tg’
.
	`add_sw™ch
('s2')

68 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

69 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

71 
def
 
	$£tup_moduË
(
mod
):

73 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

74 
tg’
 = 
	$Tİog’
(
Tem¶©eTİo
, 
mod
.
__Çme__
)

75 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

76 
tg’
.
	$¡¬t_tİŞogy
()

78 #Thi 
is
 
a
 
§m¶e
 
of
 
cÚfigu¿tiÚ
 
lßdšg
.

79 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

81 #FÜ 
®l
 
»gi¡»d
 
rou‹rs
, 
lßd
 
the
 
zeb¿
 
cÚfigu¿tiÚ
 
fe


82 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

83 
rou‹r
.
	`lßd_cÚfig
(

84 
TİoRou‹r
.
RD_ZEBRA
,

85 #Uncomm’ˆ
Ãxt
 
lše
 
to
 
lßd
 
cÚfigu¿tiÚ
 
äom
 ./
rou‹r
/
zeb¿
.
cÚf


86 #os.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
(
ºame
))

89 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
lßds
 
cÚfigu»d
 
d«mÚs
.

90 
tg’
.
	$¡¬t_rou‹r
()

92 
def
 
	$‹¬down_moduË
(
mod
):

94 
tg’
 = 
	$g‘_tİog’
()

96 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

97 
tg’
.
	$¡İ_tİŞogy
()

99 
def
 
	$‹¡_ÿÎ_mšš‘_şi
():

101 
tg’
 = 
	$g‘_tİog’
()

103 
tg’
.
	$rou‹rs_have_çu»
():

104 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

106 
logg”
.
	`šfo
('calling mininet CLI')

107 
tg’
.
	$mšš‘_şi
()

109 #MemÜy 
Ëak
 
‹¡
 
‹m¶©e


110 
def
 
	$‹¡_memÜy_Ëak
():

112 
tg’
 = 
	$g‘_tİog’
()

113 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

114 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

116 
tg’
.
	$»pÜt_memÜy_Ëaks
()

118 
__Çme__
 == '__main__':

119 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

120 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@example-topojson-test/__init__.py

	@example-topojson-test/test_topo_json_multiple_links/__init__.py

	@example-topojson-test/test_topo_json_multiple_links/test_example_topojson_multiple_links.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

5 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

6 #š 
this
 
fe
.

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 <
	gexam¶e
>.
	gpy
: 
Te¡
 <
exam¶e
 
‹¡s
>.

27 
impÜt
 
os


28 
impÜt
 
sys


29 
impÜt
 
jsÚ


30 
impÜt
 
š¥eù


31 
impÜt
 
py‹¡


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

34 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../../'))

37 #pylšt: 
di§bË
=
C0413


38 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


39 
äom
 
lib
 
impÜt
 
tİÙe¡


40 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


41 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


43 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

44 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


46 #ImpÜˆ
tİoJsÚ
 
äom
 
lib
, 
to
 
ü—‹
 
tİŞogy
 
ªd
 
š™Ÿl
 
cÚfigu¿tiÚ


47 
äom
 
lib
.
tİojsÚ
 
impÜt
 *

49 #R—dšg 
the
 
d©a
 
äom
 
JSON
 
Fe
 
tİŞogy
 
ªd
 
cÚfigu¿tiÚ
 
ü—tiÚ


50 
jsÚFe
 = "test_example_topojson_multiple_links.json"

51 
Œy
:

52 
w™h
 
	`İ’
(
jsÚFe
, 'r'è
as
 
tİoJsÚ
:

53 
tİo
 = 
jsÚ
.
	$lßd
(
tİoJsÚ
)

54 
exû±
 
IOE¼Ü
:

55 
logg”
.
	`šfo
("Could‚Ù„—d fe:", 
jsÚFe
)

57 #Glob® 
v¬ŸbËs


58 
bgp_cÚv”g’û
 = 
F®£


59 
šput_diù
 = {
	}
}

61 
şass
 
	$Tem¶©eTİo
(
Tİo
):

63 
Te¡
 
tİŞogy
 
bud”


65 * `
Tİo
`: 
TİŞogy
 
objeù


68 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

70 
tg’
 = 
	$g‘_tİog’
(
£lf
)

72 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
ü—‹
 
tİŞogy


73 #a 
defšed
 
š
 
šput
 
jsÚ
 
fe
.

76 #
#C»©šg 2 
rou‹rs
 
havšg
 2 
lšks
 
š
 
b‘w“n
,

78 #Ú
is
 
u£d
 
to
 
e¡abli£d
 
BGP
 
ÃighbÜsh


80 #Budšg 
tİŞogy
 
äom
 
jsÚ
 
fe


81 
	$bud_tİo_äom_jsÚ
(
tg’
, 
tİo
)

83 
def
 
	$£tup_moduË
(
mod
):

85 
S‘s
 
up
 
the
 
py‹¡
 
’vœÚm’t


87 * `
mod
`: 
moduË
 
Çme


90 
‹¡su™e_run_time
 = 
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))

91 
logg”
.
	`šfo
("Te¡su™¡¬ˆtime: {}".
	$fÜm©
(
‹¡su™e_run_time
))

92 
logg”
.
	`šfo
("="*40)

94 
logg”
.
	`šfo
("Running setup_moduleo createopology")

96 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

97 
tg’
 = 
	$Tİog’
(
Tem¶©eTİo
, 
mod
.
__Çme__
)

98 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

100 #S¹šg 
tİŞogy


101 
tg’
.
	$¡¬t_tİŞogy
()

103 #Uncomm’ˆ
fŞlowšg
 
lše
 
to
 
’abË
 
debug
 
logs
 
ªd
 
comm’t
 - 
tg’
.
	`¡¬t_tİŞogy
()

104 #tg’.
	`¡¬t_tİŞogy
(
log_Ëv–
='debug')

106 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

107 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

108 
Œy
:

109 
os
.
	$chdœ
(
CWD
)

110 #D–‘šg 
rou‹r
 
Çmed
 
dœs
 
exi¡s


111 
os
.
·th
.
	`exi¡s
('{}'.
	$fÜm©
(
ºame
)):

112 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

114 #C»©šg 
rou”
 
Çmed
 
dœ
 
ªd
 
emÙy
 
zeb¿
.
cÚf
 
bgpd
.cÚà
fes
 
šside
 
the
 
cu¼’t
 
dœeùÜy


115 
os
.
	`mkdœ
('{}'.
	$fÜm©
(
ºame
))

116 
os
.
	`chdœ
("{}/{}".
	$fÜm©
(
CWD
, 
ºame
))

117 
os
.
	`sy¡em
('touch zebra.conf bgpd.conf')

118 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

119 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

121 #Lßdšg 
em±y
 
zeb¿
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 zeb¿ 
d—mÚ


122 
rou‹r
.
	`lßd_cÚfig
(

123 
TİoRou‹r
.
RD_ZEBRA
,

124 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

126 #Lßdšg 
em±y
 
bgpd
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 
bgp
 
d—mÚ


127 
rou‹r
.
	`lßd_cÚfig
(

128 
TİoRou‹r
.
RD_BGP
,

129 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

132 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
¡¬ts
 
cÚfigu»d
 
d«mÚs
.

133 
logg”
.
	`šfo
("Starting‡ll„outers onceopology is created")

134 
tg’
.
	$¡¬t_rou‹r
()

136 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
ü—‹
 
cÚfigu¿tiÚ


137 #a 
defšed
 
š
 
šput
 
jsÚ
 
fe
.

140 #
#C»©šg 
cÚfigu¿tiÚ
 
defšed
 
š
 
šput
 
JSON


142 #fe, 
exam¶e
, 
BGP
 
cÚfig
, 
š‹rçû
 cÚfig, 
rou‹s


143 #cÚfig, 
´efix
 
li¡
 
cÚfig


145 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


146 
	$bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

148 
logg”
.
	`šfo
("Running setup_module() done")

150 
def
 
	$‹¬down_moduË
(
mod
):

152 
T—rdown
 
the
 
py‹¡
 
’vœÚm’t


154 * `
mod
`: 
moduË
 
Çme


157 
logg”
.
	`šfo
("Runningeardown_moduleo deleteopology")

159 
tg’
 = 
	$g‘_tİog’
()

161 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

162 
tg’
.
	$¡İ_tİŞogy
()

164 #Removšg 
tmp
 
dœs
 
ªd
 
fes


165 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

166 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

167 
Œy
:

168 
os
.
	$chdœ
(
CWD
)

169 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

170 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

171 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

173 
def
 
	$‹¡_bgp_cÚv”g’û
():

176 
tg’
 = 
	$g‘_tİog’
()

177 
glob®
 
bgp_cÚv”g’û


180 
tg’
.
	$rou‹rs_have_çu»
():

181 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

183 #Ap˜
ÿÎ
 
v”ify
 
wh‘h”
 
BGP
 
is
 
cÚv”ged


184 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

185 
bgp_cÚv”g’û
 !ğ
True
: 
as£¹
 
F®£
, "‹¡_bgp_cÚv”g’û faed.. \ÀE¼Ü: {}".
	$fÜm©
(
bgp_cÚv”g’û
)

187 
logg”
.
	`šfo
("BGP is converged successfully \n")

189 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


190 #tg’.
	`mšš‘_şi
()

192 
def
 
	$‹¡_¡©ic_rou‹s
():

195 
tg’
 = 
	$g‘_tİog’
()

196 
glob®
 
bgp_cÚv”g’û


198 
bgp_cÚv”g’û
 !ğ
True
:

199 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

201 #Te¡ 
Çme


202 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

203 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	$fÜm©
(
tc_Çme
))

205 #Stiø
rou‹s
 
¬e
 
ü—‹d
 
as
 
·¹
 
of
 
š™Ÿl
 
cÚfigu¿tiÚ
, 
v”ifyšg
 
RIB


206 
dut
 = 'r2'

207 
´ÙocŞ
 = 'bgp'

208 
Ãxt_hİ
 = '10.0.0.1'

209 
šput_diù
 = 
tİo
["routers"]

210 
»suÉ
 = 
	`v”ify_rib
('v4', 
dut
, 
tg’
, 
šput_diù
, 
Ãxt_hİ
 =‚ext_hİ, 
´ÙocŞ
 =…rotocol)

211 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

213 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

215 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


216 
tg’
.
	$mšš‘_şi
()

219 
__Çme__
 == '__main__':

220 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

221 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@example-topojson-test/test_topo_json_single_link/__init__.py

	@example-topojson-test/test_topo_json_single_link/test_example_topojson.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

5 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

6 #š 
this
 
fe
.

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 <
	gexam¶e
>.
	gpy
: 
Te¡
 <
exam¶e
 
‹¡s
>.

27 
impÜt
 
os


28 
impÜt
 
sys


29 
impÜt
 
jsÚ


30 
impÜt
 
š¥eù


31 
impÜt
 
py‹¡


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

34 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../../'))

37 #pylšt: 
di§bË
=
C0413


38 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


39 
äom
 
lib
 
impÜt
 
tİÙe¡


40 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


41 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


43 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

44 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


46 #ImpÜˆ
tİoJsÚ
 
äom
 
lib
, 
to
 
ü—‹
 
tİŞogy
 
ªd
 
š™Ÿl
 
cÚfigu¿tiÚ


47 
äom
 
lib
.
tİojsÚ
 
impÜt
 *

49 #R—dšg 
the
 
d©a
 
äom
 
JSON
 
Fe
 
tİŞogy
 
ªd
 
cÚfigu¿tiÚ
 
ü—tiÚ


50 
jsÚFe
 = "test_example_topojson.json"

51 
Œy
:

52 
w™h
 
	`İ’
(
jsÚFe
, 'r'è
as
 
tİoJsÚ
:

53 
tİo
 = 
jsÚ
.
	$lßd
(
tİoJsÚ
)

54 
exû±
 
IOE¼Ü
:

55 
logg”
.
	`šfo
("Could‚Ù„—d fe:", 
jsÚFe
)

57 #Glob® 
v¬ŸbËs


58 
bgp_cÚv”g’û
 = 
F®£


59 
šput_diù
 = {
	}
}

61 
şass
 
	$Tem¶©eTİo
(
Tİo
):

63 
Te¡
 
tİŞogy
 
bud”


65 * `
Tİo
`: 
TİŞogy
 
objeù


68 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

70 
tg’
 = 
	$g‘_tİog’
(
£lf
)

72 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
ü—‹
 
tİŞogy


73 #a 
defšed
 
š
 
šput
 
jsÚ
 
fe
.

76 #
#C»©šg 2 
rou‹rs
 
havšg
 
sšgË
 
lšks
 
š
 
b‘w“n
,

78 #which 
is
 
u£d
 
to
 
e¡abli£d
 
BGP
 
ÃighbÜsh


80 #Budšg 
tİŞogy
 
äom
 
jsÚ
 
fe


81 
	$bud_tİo_äom_jsÚ
(
tg’
, 
tİo
)

83 
def
 
	$£tup_moduË
(
mod
):

85 
S‘s
 
up
 
the
 
py‹¡
 
’vœÚm’t


87 * `
mod
`: 
moduË
 
Çme


90 
‹¡su™e_run_time
 = 
time
.
	`asùime
Ñime.
	`loÿÉime
Ñime.
	$time
()))

91 
logg”
.
	`šfo
("Te¡su™¡¬ˆtime: {}".
	$fÜm©
(
‹¡su™e_run_time
))

92 
logg”
.
	`šfo
("="*40)

94 
logg”
.
	`šfo
("Running setup_moduleo createopology")

96 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

97 
tg’
 = 
	$Tİog’
(
Tem¶©eTİo
, 
mod
.
__Çme__
)

98 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

100 #S¹šg 
tİŞogy


101 
tg’
.
	$¡¬t_tİŞogy
()

103 #Uncomm’ˆ
fŞlowšg
 
lše
 
to
 
’abË
 
debug
 
logs
 
ªd
 
comm’t
 - 
tg’
.
	`¡¬t_tİŞogy
()

104 #tg’.
	`¡¬t_tİŞogy
(
log_Ëv–
='debug')

106 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

107 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

108 
Œy
:

109 
os
.
	$chdœ
(
CWD
)

110 #D–‘šg 
rou‹r
 
Çmed
 
dœs
 
exi¡s


111 
os
.
·th
.
	`exi¡s
('{}'.
	$fÜm©
(
ºame
)):

112 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

114 #C»©šg 
rou”
 
Çmed
 
dœ
 
ªd
 
emÙy
 
zeb¿
.
cÚf
 
bgpd
.cÚà
fes
 
šside
 
the
 
cu¼’t
 
dœeùÜy


115 
os
.
	`mkdœ
('{}'.
	$fÜm©
(
ºame
))

116 
os
.
	`chdœ
("{}/{}".
	$fÜm©
(
CWD
, 
ºame
))

117 
os
.
	`sy¡em
('touch zebra.conf bgpd.conf')

118 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

119 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

121 #Lßdšg 
em±y
 
zeb¿
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 zeb¿ 
d—mÚ


122 
rou‹r
.
	`lßd_cÚfig
(

123 
TİoRou‹r
.
RD_ZEBRA
,

124 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

126 #Lßdšg 
em±y
 
bgpd
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 
bgp
 
d—mÚ


127 
rou‹r
.
	`lßd_cÚfig
(

128 
TİoRou‹r
.
RD_BGP
,

129 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

132 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
¡¬ts
 
cÚfigu»d
 
d«mÚs
.

133 
logg”
.
	`šfo
("Starting‡ll„outers onceopology is created")

134 
tg’
.
	$¡¬t_rou‹r
()

136 #Thi 
funùiÚ
 
Úly
 
pu½o£
 
is
 
to
 
ü—‹
 
cÚfigu¿tiÚ


137 #a 
defšed
 
š
 
šput
 
jsÚ
 
fe
.

140 #
#C»©šg 
cÚfigu¿tiÚ
 
defšed
 
š
 
šput
 
JSON


142 #fe, 
exam¶e
, 
BGP
 
cÚfig
, 
š‹rçû
 cÚfig, 
rou‹s


143 #cÚfig, 
´efix
 
li¡
 
cÚfig


145 #C»©šg 
cÚfigu¿tiÚ
 
äom
 
JSON


146 
	$bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
)

148 
logg”
.
	`šfo
("Running setup_module() done")

150 
def
 
	$‹¬down_moduË
(
mod
):

152 
T—rdown
 
the
 
py‹¡
 
’vœÚm’t


154 * `
mod
`: 
moduË
 
Çme


157 
logg”
.
	`šfo
("Runningeardown_moduleo deleteopology")

159 
tg’
 = 
	$g‘_tİog’
()

161 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

162 
tg’
.
	$¡İ_tİŞogy
()

164 #Removšg 
tmp
 
dœs
 
ªd
 
fes


165 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

166 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

167 
Œy
:

168 
os
.
	$chdœ
(
CWD
)

169 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

170 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

171 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

173 
def
 
	$‹¡_bgp_cÚv”g’û
():

176 
tg’
 = 
	$g‘_tİog’
()

177 
glob®
 
bgp_cÚv”g’û


180 
tg’
.
	$rou‹rs_have_çu»
():

181 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

183 
tg’
.
	$mšš‘_şi
()

184 #Ap˜
ÿÎ
 
v”ify
 
wh‘h”
 
BGP
 
is
 
cÚv”ged


185 
bgp_cÚv”g’û
 = 
	`v”ify_bgp_cÚv”g’û
('v4', 
tg’
, 
tİo
)

186 
bgp_cÚv”g’û
 !ğ
True
: 
as£¹
 
F®£
, "‹¡_bgp_cÚv”g’û faed.. \ÀE¼Ü: {}".
	$fÜm©
(
bgp_cÚv”g’û
)

188 
logg”
.
	`šfo
("BGP is converged successfully \n")

190 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


191 #tg’.
	`mšš‘_şi
()

194 
def
 
	$‹¡_¡©ic_rou‹s
():

197 
tg’
 = 
	$g‘_tİog’
()

198 
glob®
 
bgp_cÚv”g’û


200 
bgp_cÚv”g’û
 !ğ
True
:

201 
py‹¡
.
	`sk
('skipped because of BGP Convergence failure')

203 #Te¡ 
Çme


204 
tc_Çme
 = 
š¥eù
.
	`¡ack
()[0][3]

205 
logg”
.
	`šfo
("Te¡ÿ£ s¹ed: {} \n".
	$fÜm©
(
tc_Çme
))

207 #Stiø
rou‹s
 
¬e
 
ü—‹d
 
as
 
·¹
 
of
 
š™Ÿl
 
cÚfigu¿tiÚ
, 
v”ifyšg
 
RIB


208 
dut
 = 'r2'

209 
Ãxt_hİ
 = '10.0.0.1'

210 
šput_diù
 = 
tİo
["routers"]

211 
»suÉ
 = 
	`v”ify_rib
('v4', 
dut
, 
tg’
, 
šput_diù
, 
Ãxt_hİ
 =‚ext_hop)

212 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, "Te¡ÿ£ " + 
tc_Çme
 + " :Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

214 
logg”
.
	`šfo
("Te¡ÿ£ " + 
tc_Çme
 + " :Passed \n")

216 #Uncomm’ˆ
Ãxt
 
lše
 
debuggšg


217 
tg’
.
	`mšš‘_şi
()

220 
__Çme__
 == '__main__':

221 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

222 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@isis-topo1/__init__.py

	@isis-topo1/test_isis_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_isis_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_isis_tİo1
.
	gpy
: 
Te¡
 
ISIS
 
tİŞogy
.

29 
impÜt
 
cŞËùiÚs


30 
impÜt
 
funùoŞs


31 
impÜt
 
jsÚ


32 
impÜt
 
os


33 
impÜt
 
»


34 
impÜt
 
sys


35 
impÜt
 
py‹¡


36 
impÜt
 
time


38 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

39 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

41 #pylšt: 
di§bË
=
C0413


42 
äom
 
lib
 
impÜt
 
tİÙe¡


43 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


44 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


49 
şass
 
	$ISISTİo1
(
Tİo
):

51 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

53 
tg’
 = 
	$g‘_tİog’
(
£lf
)

55 #Add 
ISIS
 
rou‹rs
:

56 #r1 
r2


57 #| 
sw1
 | 
sw2


58 #r3 
r4


60 #sw3 
sw4


63 
rou‹º
 
š
 
	$¿nge
(1, 6):

64 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

66 #r1 <- 
sw1
 -> 
r3


67 
sw
 = 
tg’
.
	`add_sw™ch
('sw1')

68 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r1'])

69 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r3'])

71 #r2 <- 
sw2
 -> 
r4


72 
sw
 = 
tg’
.
	`add_sw™ch
('sw2')

73 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r2'])

74 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r4'])

76 #r3 <- 
sw3
 -> 
r5


77 
sw
 = 
tg’
.
	`add_sw™ch
('sw3')

78 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r3'])

79 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r5'])

81 #r4 <- 
sw4
 -> 
r5


82 
sw
 = 
tg’
.
	`add_sw™ch
('sw4')

83 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r4'])

84 
sw
.
	`add_lšk
(
tg’
.
g—rs
['r5'])

87 
def
 
	$£tup_moduË
(
mod
):

89 
tg’
 = 
	$Tİog’
(
ISISTİo1
, 
mod
.
__Çme__
)

90 
tg’
.
	$¡¬t_tİŞogy
()

92 #FÜ 
®l
 
»gi¡”ed
 
rou‹rs
, 
lßd
 
the
 
zeb¿
 
cÚfigu¿tiÚ
 
fe


93 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

94 
rou‹r
.
	`lßd_cÚfig
(

95 
TİoRou‹r
.
RD_ZEBRA
,

96 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

98 
rou‹r
.
	`lßd_cÚfig
(

99 
TİoRou‹r
.
RD_ISIS
,

100 
os
.
·th
.
	`još
(
CWD
, '{}/isisd.cÚf'.
	$fÜm©
(
ºame
))

103 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
lßds
 
cÚfigu»d
 
d«mÚs
.

104 
tg’
.
	$¡¬t_rou‹r
()

106 
has_v”siÚ_20
 = 
F®£


107 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$v®ues
():

108 
rou‹r
.
	`has_v”siÚ
('<', '3'):

109 
has_v”siÚ_20
 = 
True


111 
has_v”siÚ_20
:

112 
logg”
.
	`šfo
('Skipping ISISests for FRR 2.0')

113 
tg’
.
	`£t_”rÜ
('ISIS has convergence…roblems with IPv6')

116 
def
 
	$‹¬down_moduË
(
mod
):

118 
tg’
 = 
	$g‘_tİog’
()

120 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

121 
tg’
.
	$¡İ_tİŞogy
()

124 
def
 
	$‹¡_isis_cÚv”g’û
():

126 
tg’
 = 
	$g‘_tİog’
()

128 
tg’
.
	$rou‹rs_have_çu»
():

129 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

131 
logg”
.
	`šfo
("waiting for ISIS…rotocolo converge")

132 #Cod
to
 
g’”©e
 
the
 
jsÚ
 
fes
.

133 #fÜ 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	`™”™ems
():

134 #İ’('/tmp/{}_tİŞogy.jsÚ'.
	`fÜm©
(
ºame
), 'w').
	`wr™e
(

135 #jsÚ.
	`dumps
(
	`show_isis_tİŞogy
(
rou‹r
), 
šd’t
=2, 
sÜt_keys
=
True
)

138 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

139 
f’ame
 = '{0}/{1}/{1}_tİŞogy.jsÚ'.
	$fÜm©
(
CWD
, 
ºame
)

140 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
).
	$»ad
())

142 
def
 
	$com·»_isis_tİŞogy
(
rou‹r
, 
ex³ùed
):

144 
aùu®
 = 
	$show_isis_tİŞogy
(
rou‹r
)

145  
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
)

147 
‹¡_func
 = 
funùoŞs
.
	$·¹Ÿl
(
com·»_isis_tİŞogy
, 
rou‹r
, 
ex³ùed
)

148 (
»suÉ
, 
diff
èğ
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
,

149 
wa™
=0.5, 
couÁ
=120)

150 
as£¹
 
»suÉ
, 'ISIS did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
ºame
, 
diff
)

153 
def
 
	$‹¡_isis_rou‹_š¡®ÏtiÚ
():

155 
tg’
 = 
	$g‘_tİog’
()

157 
tg’
.
	$rou‹rs_have_çu»
():

158 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

160 
logg”
.
	`šfo
('Checking„outers for installed ISIS„outes')

162 #Check 
rou‹s
 
š
 'show ip„oute json'

163 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

164 
f’ame
 = '{0}/{1}/{1}_rou‹.jsÚ'.
	$fÜm©
(
CWD
, 
ºame
)

165 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
, 'r').
	$»ad
())

166 
aùu®
 = 
rou‹r
.
	`vtysh_cmd
('show i°rou‹ jsÚ', 
isjsÚ
=
True
)

168 #Old” 
FRR
 
v”siÚs
 
dÚ
't†ist interfaces in some ISIS„outes

169 
rou‹r
.
	`has_v”siÚ
('<', '3.1'):

170 
ÃtwÜk
, 
rou‹s
 
š
 
ex³ùed
.
	$™”™ems
():

171 
rou‹
 
š
 
rou‹s
:

172 
rou‹
['protocol'] != 'isis':

175 
Ãxthİ
 
š
 
rou‹
['nexthops']:

176 
Ãxthİ
.
	`pİ
('š‹rçûIndex', 
NÚe
)

177 
Ãxthİ
.
	`pİ
('š‹rçûName', 
NÚe
)

179 
as£¹msg
 = "Rou‹¸'{}'„ou‹ mism©ch".
	$fÜm©
(
ºame
)

180 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


183 
def
 
	$‹¡_isis_lšux_rou‹_š¡®ÏtiÚ
():

185 
tg’
 = 
	$g‘_tİog’
()

187 
tg’
.
	$rou‹rs_have_çu»
():

188 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

190 
logg”
.
	`šfo
('Checking„outers for installed ISIS„outes in OS')

192 #Check 
rou‹s
 
š
 `

 
rou‹
`

193 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

194 
f’ame
 = '{0}/{1}/{1}_rou‹_lšux.jsÚ'.
	$fÜm©
(
CWD
, 
ºame
)

195 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
, 'r').
	$»ad
())

196 
aùu®
 = 
tİÙe¡
.
	$4_rou‹
(
rou‹r
)

198 #Old” 
FRR
 
v”siÚs
 
š¡®l
 
rou‹s
 
usšg
 
difã»Á
 
´Ùo


199 
rou‹r
.
	`has_v”siÚ
('<', '3.1'):

200 
ÃtwÜk
, 
ÃtİtiÚs
 
š
 
ex³ùed
.
	$™”™ems
():

201 '´Ùo' 
š
 
ÃtİtiÚs
 
ªd
‚etoptions['proto'] == '187':

202 
ÃtİtiÚs
['proto'] = 'zebra'

204 
as£¹msg
 = "Rou‹¸'{}' OS„ou‹ mism©ch".
	$fÜm©
(
ºame
)

205 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


208 
def
 
	$‹¡_isis_rou‹6_š¡®ÏtiÚ
():

210 
tg’
 = 
	$g‘_tİog’
()

212 
tg’
.
	$rou‹rs_have_çu»
():

213 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

215 
logg”
.
	`šfo
('Checking„outers for installed ISIS IPv6„outes')

217 #Check 
rou‹s
 
š
 'show ip„oute json'

218 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

219 
f’ame
 = '{0}/{1}/{1}_rou‹6.jsÚ'.
	$fÜm©
(
CWD
, 
ºame
)

220 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
, 'r').
	$»ad
())

221 
aùu®
 = 
rou‹r
.
	`vtysh_cmd
('show ipv6„ou‹ jsÚ', 
isjsÚ
=
True
)

223 #Old” 
FRR
 
v”siÚs
 
dÚ
't†ist interfaces in some ISIS„outes

224 
rou‹r
.
	`has_v”siÚ
('<', '3.1'):

225 
ÃtwÜk
, 
rou‹s
 
š
 
ex³ùed
.
	$™”™ems
():

226 
rou‹
 
š
 
rou‹s
:

227 #Old” 
v”siÚs
 
di¥Ïy
 
difã»Á
 
m‘rics
 
IPv6
 
rou‹s


228 
rou‹
.
	`pİ
('m‘ric', 
NÚe
)

230 
rou‹
['protocol'] != 'isis':

233 
Ãxthİ
 
š
 
rou‹
['nexthops']:

234 
Ãxthİ
.
	`pİ
('š‹rçûIndex', 
NÚe
)

235 
Ãxthİ
.
	`pİ
('š‹rçûName', 
NÚe
)

237 
as£¹msg
 = "Rou‹¸'{}'„ou‹ mism©ch".
	$fÜm©
(
ºame
)

238 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


241 
def
 
	$‹¡_isis_lšux_rou‹6_š¡®ÏtiÚ
():

243 
tg’
 = 
	$g‘_tİog’
()

245 
tg’
.
	$rou‹rs_have_çu»
():

246 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

248 
logg”
.
	`šfo
('Checking„outers for installed ISIS IPv6„outes in OS')

250 #Check 
rou‹s
 
š
 `

 
rou‹
`

251 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

252 
f’ame
 = '{0}/{1}/{1}_rou‹6_lšux.jsÚ'.
	$fÜm©
(
CWD
, 
ºame
)

253 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
, 'r').
	$»ad
())

254 
aùu®
 = 
tİÙe¡
.
	$6_rou‹
(
rou‹r
)

256 #Old” 
FRR
 
v”siÚs
 
š¡®l
 
rou‹s
 
usšg
 
difã»Á
 
´Ùo


257 
rou‹r
.
	`has_v”siÚ
('<', '3.1'):

258 
ÃtwÜk
, 
ÃtİtiÚs
 
š
 
ex³ùed
.
	$™”™ems
():

259 '´Ùo' 
š
 
ÃtİtiÚs
 
ªd
‚etoptions['proto'] == '187':

260 
ÃtİtiÚs
['proto'] = 'zebra'

262 
as£¹msg
 = "Rou‹¸'{}' OS„ou‹ mism©ch".
	$fÜm©
(
ºame
)

263 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
aùu®
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


266 
def
 
	$‹¡_memÜy_Ëak
():

268 
tg’
 = 
	$g‘_tİog’
()

269 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

270 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

272 
tg’
.
	$»pÜt_memÜy_Ëaks
()

275 
__Çme__
 == '__main__':

276 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

277 
sys
.
	`ex™
(
py‹¡
.
	$maš
(
¬gs
))

280 #
#AuxŸry 
funùiÚs


285 
def
 
	$diù_m”ge
(
dù
, 
m”ge_dù
):

287 
Recursive
 
diù
 
m”ge
. 
In¥œed
 
by
 :
m‘h
:``diù.
	`upd©e
()``, 
š¡—d
 
of


288 
upd©šg
 
Úly
 
tİ
-
Ëv–
 
keys
, 
diù_m”ge
 
»cur£s
 
down
 
što
 
diùs
 
Ã¡ed


289 
to
 
ª
 
¬b™¿ry
 
d•th
, 
upd©šg
 
keys
. 
The
 ``
m”ge_dù
`` 
is
 
m”ged
 
što


290 ``
dù
``.

291 :
·¿m
 
dù
: 
diù
 
Úto
 
which
 
the
 
m”ge
 
is
 
execu‹d


292 :
·¿m
 
m”ge_dù
: 
dù
 
m”ged
 
što
 dct

293 :: 
NÚe


295 
Sourû
:

296 
h‰ps
:

298 
k
, 
v
 
š
 
m”ge_dù
.
	$™”™ems
():

299 ià(
k
 
š
 
dù
 
ªd
 
	$isš¡ªû
(
dù
[
k
], 
diù
)

300 
ªd
 
	$isš¡ªû
(
m”ge_dù
[
k
], 
cŞËùiÚs
.
M­pšg
)):

301 
	$diù_m”ge
(
dù
[
k
], 
m”ge_dù
[k])

303 
dù
[
k
] = 
m”ge_dù
[k]

306 
def
 
	$·r£_tİŞogy
(
lšes
, 
Ëv–
):

308 
P¬£
 
the
 
ouut
 
of
 'show isi tİŞogy†ev–-X' 
što
 
a
 
PythÚ
 
diù
.

310 
¬—s
 = {
	}
}

311 
¬—
 = 
NÚe


312 
v
 = 
NÚe


314 
lše
 
š
 
lšes
:

315 
¬—_m©ch
 = 
»
.
m©ch
(
r
"A»¨(.+):", 
lše
)

316 
	g¬—_m©ch
:

317 
¬—
 = 
¬—_m©ch
.
	$group
(1)

318 
¬—
 
nÙ
 
š
 
¬—s
:

319 
¬—s
[
¬—
] = {

320 
Ëv–
: {

324 
	}
}

325 
v
 = 
NÚe


327 
–if
 
¬—
 
is
 
NÚe
:

330 
»
.
m©ch
(
r
"IS\-IS…©h tØËv–-.„ou‹r th© s³ak IPv6", 
lše
):

331 
v
 = 'ipv6'

333 
»
.
m©ch
(
r
"IS\-IS…©h tØËv–-.„ou‹r th© s³ak IP", 
lše
):

334 
v
 = 'ipv4'

337 
™em_m©ch
 = 
»
.
m©ch
(

338 
r
"([^ ]+è([^ ]+è([^ ]+è([^ ]+è([^ ]+è([^ ]+)", 
lše
)

339 
™em_m©ch
 
is
 
nÙ
 
	gNÚe
:

340 #Sk 
h—d”


341 ià(
™em_m©ch
.
group
(1è=ğ'V”‹x' 
ªd


342 
™em_m©ch
.
group
(2è=ğ'Ty³' 
ªd


343 
™em_m©ch
.
group
(3è=ğ'M‘ric' 
ªd


344 
™em_m©ch
.
group
(4è=ğ'Next-Hİ' 
ªd


345 
™em_m©ch
.
group
(5è=ğ'IÁ”çû' 
ªd


346 
™em_m©ch
.
group
(6) == 'Parent'):

349 
¬—s
[
¬—
][
Ëv–
][
v
].
­³nd
({

350 'v”‹x': 
™em_m©ch
.
group
(1),

351 'ty³': 
™em_m©ch
.
group
(2),

352 'm‘ric': 
™em_m©ch
.
group
(3),

353 'Ãxt-hİ': 
™em_m©ch
.
group
(4),

354 'š‹rçû': 
™em_m©ch
.
group
(5),

355 '·»Á': 
™em_m©ch
.
group
(6),

359 
™em_m©ch
 = 
»
.
m©ch
(
r
"([^ ]+è([^ ]+è([^ ]+è([^ ]+)", 
lše
)

360 
™em_m©ch
 
is
 
nÙ
 
	gNÚe
:

361 
¬—s
[
¬—
][
Ëv–
][
v
].
­³nd
({

362 'v”‹x': 
™em_m©ch
.
group
(1),

363 'ty³': 
™em_m©ch
.
group
(2),

364 'm‘ric': 
™em_m©ch
.
group
(3),

365 '·»Á': 
™em_m©ch
.
group
(4),

369 
	g™em_m©ch
 = 
»
.
m©ch
(
r
"([^ ]+)", 
lše
)

370 
™em_m©ch
 
is
 
nÙ
 
	gNÚe
:

371 
¬—s
[
¬—
][
Ëv–
][
v
].
­³nd
({'v”‹x': 
™em_m©ch
.
group
(1)})

374  
¬—s


377 
def
 
	$show_isis_tİŞogy
(
rou‹r
):

379 
G‘
 
the
 
ISIS
 
tİŞogy
 
š
 
a
 
diùiÚ¬y
 
fÜm©
.

381 
Sam¶e
:

410 
	}
}

412 
l1out
 = 
tİÙe¡
.
nÜm®ize_‹xt
(

413 
rou‹r
.
vtysh_cmd
('show isisopology†evel-1')

414 ).
	$¥l™lšes
()

415 
l2out
 = 
tİÙe¡
.
	`nÜm®ize_‹xt
(

416 
rou‹r
.
	`vtysh_cmd
('show isisopology†evel-2')

417 ).
	$¥l™lšes
()

419 
l1
 = 
	`·r£_tİŞogy
(
l1out
, 'level-1')

420 
l2
 = 
	`·r£_tİŞogy
(
l2out
, 'level-2')

422 
	$diù_m”ge
(
l1
, 
l2
)

423  
l1


	@ldp-topo1/test_ldp_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_bgp_muÉiv›w_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2016 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_ldp_tİo1
.
	gpy
: 
Sim¶e
 
FRR
/
Quagga
 
LDP
 
Te¡


29 | 
r1
 |

32 | .1 
r1
-
‘h0


35 ~~ 
sw0
 ~~

40 | .2 
r2
-
‘h0


42 | 
r2
 |

45 
r2
-
‘h2
 .2 | | .2„2-
‘h1


46 
______
/ \______

49 ~~ 
sw2
 ~~ ~~ 
sw1
 ~~

53 \ 
_________
/ |

55 
r3
-
‘h1
 .3 | | .3„3-
‘h0
 | .4 
r4
-eth0

57 | 
r3
 | | 
r4
 |

62 
impÜt
 
os


63 
impÜt
 
»


64 
impÜt
 
sys


65 
impÜt
 
py‹¡


66 
äom
 
time
 
impÜt
 
¦“p


68 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


69 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


70 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


71 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


72 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


73 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


75 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

76 
äom
 
lib
 
impÜt
 
tİÙe¡


78 
çl_”rÜ
 = ""

80 #Ex³ùed 
v”siÚ
 
of
 
CLI
 
Ouut
 - 
Aµ’dix
 
to
 
f’ame


81 #em±y 
¡ršg
 = 
cu¼’t
, 
Ï‹¡
 
	`ouut
 ()

82 #"-1" ... "-
NNN
"…revious versions (incrementing withƒach version)

83 
şi_v”siÚ
 = ""

88 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


92 
şass
 
	$N‘wÜkTİo
(
Tİo
):

95 
def
 
	$bud
(
£lf
, **
_İts
):

97 #S‘u°
Rou‹rs


98 
rou‹r
 = {
	}
}

99 
i
 
š
 
	$¿nge
(1, 5):

100 
rou‹r
[
i
] = 
tİÙe¡
.
	`addRou‹r
(
£lf
, 'r%s' % i)

102 #S‘u°
Sw™ches
, 
add
 
IÁ”çûs
 
ªd
 
CÚÃùiÚs


103 ğ{
	}
}

105 [0] = 
£lf
.
addSw™ch
('sw0', 
şs
=
tİÙe¡
.
LegacySw™ch
)

106 
£lf
.
addLšk
([0], 
rou‹r
[1], 
štfName2
='r1-‘h0', 
addr1
='80:AA:00:00:00:00', 
addr2
='00:11:00:01:00:00')

107 
£lf
.
addLšk
([0], 
rou‹r
[2], 
štfName2
='r2-‘h0', 
addr1
='80:AA:00:00:00:01', 
addr2
='00:11:00:02:00:00')

109 [1] = 
£lf
.
addSw™ch
('sw1', 
şs
=
tİÙe¡
.
LegacySw™ch
)

110 
£lf
.
addLšk
([1], 
rou‹r
[2], 
štfName2
='r2-‘h1', 
addr1
='80:AA:00:01:00:00', 
addr2
='00:11:00:02:00:01')

111 
£lf
.
addLšk
([1], 
rou‹r
[3], 
štfName2
='r3-‘h0', 
addr1
='80:AA:00:01:00:01', 
addr2
='00:11:00:03:00:00')

112 
£lf
.
addLšk
([1], 
rou‹r
[4], 
štfName2
='r4-‘h0', 
addr1
='80:AA:00:01:00:02', 
addr2
='00:11:00:04:00:00')

114 [2] = 
£lf
.
addSw™ch
('sw2', 
şs
=
tİÙe¡
.
LegacySw™ch
)

115 
£lf
.
addLšk
([2], 
rou‹r
[2], 
štfName2
='r2-‘h2', 
addr1
='80:AA:00:02:00:00', 
addr2
='00:11:00:02:00:02')

116 
£lf
.
addLšk
([2], 
rou‹r
[3], 
štfName2
='r3-‘h1', 
addr1
='80:AA:00:02:00:01', 
addr2
='00:11:00:03:00:01')

121 ## 
Te¡s
 
¡¬tšg


125 
def
 
	$£tup_moduË
(
moduË
):

126 
glob®
 
tİo
, 
Ãt


127 
glob®
 
çl_”rÜ


129 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

130 
	`´št
("******************************************\n")

132 
	`´št
("Cleanup old Mininet„uns")

133 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

135 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

136 
tİo
 = 
	$N‘wÜkTİo
()

138 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

139 
Ãt
.
	$¡¬t
()

141 #S¹šg 
Rou‹rs


142 
i
 
š
 
	$¿nge
(1, 5):

143 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

144 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('o¥fd', '%s/r%s/o¥fd.cÚf' % (
thisDœ
, i))

145 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('ldpd', '%s/r%s/ldpd.cÚf' % (
thisDœ
, i))

146 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

148 
çl_”rÜ
 != "":

151 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


152 #CLI(
Ãt
)

154 
def
 
	$‹¬down_moduË
(
moduË
):

155 
glob®
 
Ãt


157 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

158 
	`´št
("******************************************\n")

160 #End - 
Shutdown
 
ÃtwÜk


161 
Ãt
.
	$¡İ
()

164 
def
 
	$‹¡_rou‹r_ruÂšg
():

165 
glob®
 
çl_”rÜ


166 
glob®
 
Ãt


167 
glob®
 
şi_v”siÚ


169 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


170 ià(
çl_”rÜ
 != ""):

171 
py‹¡
.
	$sk
(
çl_”rÜ
)

173 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

174 
	`´št
("******************************************\n")

175 
	$¦“p
(5)

177 #S¹šg 
Rou‹rs


178 
i
 
š
 
	$¿nge
(1, 5):

179 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

180 
as£¹
 
çl_”rÜ
 == "", fatal_error

182 #D‘eù 
CLI
 
V”siÚ


183 #Aˆ
this
 
time
, 
th”e
 
¬e
 
Úly
 2 
possibË
 
ouuts
, 
so
 
sim¶e
 
check


184 
ouut
 = 
Ãt
['r1'].
	`cmd
('vtysh -ø"show m¶ ld°discov”y" 2> /dev/nuÎ').
	$r¡r
()

186 #Check 
Şd
 
Ü
 
Ãw
 
fÜm©
 
of
 
CLI
 
Ouut
. 
DeçuÉ
 
is
 
to
 
cu¼’t
 format

187 #
#Old (
v1
è
ouut
 
looks
 
like
 
this
:

189 #LoÿÈ
LDP
 
Id’tif›r
: 1.1.1.1:0

190 #Discov”y 
Sourûs
:

192 #r1-
‘h0
: 
xm™
/
»cv


193 #LDP 
Id
: 2.2.2.2:0, 
T¿n¥Üt
 
add»ss
: 2.2.2.2

194 #HŞd 
time
: 15 
£c


195 #T¬g‘ed 
H–los
:

196 #
#Cu¼’ˆ(
v0
è
ouut
 
looks
 
like
 
this
:

198 #AF 
ID
 
Ty³
 
Sourû
 
HŞdtime


199 #v4 2.2.2.2 
Lšk
 
r1
-
‘h0
 15

200 
·‰”n
 = 
»
.
	`compe
("^Local LDP Identifier.*")

201 
·‰”n
.
	$m©ch
(
ouut
):

202 
şi_v”siÚ
 = "-1"

204 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


205 #CLI(
Ãt
)

207 
def
 
	$‹¡_m¶s_š‹rçûs
():

208 
glob®
 
çl_”rÜ


209 
glob®
 
Ãt


210 
glob®
 
şi_v”siÚ


212 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


213 ià(
çl_”rÜ
 != ""):

214 
py‹¡
.
	$sk
(
çl_”rÜ
)

216 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

218 #V”ify 
OSPFv3
 
Routšg
 
TabË


219 
	`´št
("\n\n** Verifying MPLS Interfaces")

220 
	`´št
("******************************************\n")

221 
çu»s
 = 0

222 
i
 
š
 
	$¿nge
(1, 5):

223 
»fTabËFe
 = '%s/r%s/show_m¶s_ldp_š‹rçû.»f%s' % (
thisDœ
, 
i
, 
şi_v”siÚ
)

224 
os
.
·th
.
	$isfe
(
»fTabËFe
):

225 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


226 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

227 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

228 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

230 #Aùu® 
ouut
 
äom
 
rou‹r


231 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°š‹rçû" 2> /dev/nuÎ').
	$r¡r
()

232 #Mask 
out
 
Tim”
 
š
 
U±ime


233 
aùu®
 = 
»
.
	`sub
(
r
" [0-9][0-9]:[0-9][0-9]:[0-9][0-9] ", " xx:xx:xx ",‡ctual)

234 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

235 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

237 #G’”©
Diff


238 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

239 
t™Ë1
="actual MPLS LDP interface status",

240 
t™Ë2
="expected MPLS LDP interface status")

242 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

243 
diff
:

244 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLS LDP IÁ”çû stu Check:\n%s\n' % (
i
, 
diff
))

245 
çu»s
 += 1

247 
	`´št
("r% ok" % 
i
)

249 
çu»s
>0:

250 
çl_”rÜ
 = "MPLS LDP Interface status failed"

252 
as£¹
 
çu»s
 =ğ0, "MPLS LDP IÁ”çû stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

254 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


255 
i
 
š
 
	$¿nge
(1, 5):

256 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

257 
as£¹
 
çl_”rÜ
 == "", fatal_error

259 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


260 #CLI(
Ãt
)

263 
def
 
	$‹¡_m¶s_ldp_ÃighbÜ_e¡ablish
():

264 
glob®
 
çl_”rÜ


265 
glob®
 
Ãt


266 
glob®
 
şi_v”siÚ


268 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


269 ià(
çl_”rÜ
 != ""):

270 
py‹¡
.
	$sk
(
çl_”rÜ
)

272 #Wa™ 
OSPF6
 
to
 
	`cÚv”ge
 (
AÎ
 
NeighbÜs
 
š
 
e™h”
 
FuÎ
 
Ü
 
TwoWay
 
S‹
)

273 
	`´št
("\n\n** Verify MPLS LDP‚eighborsoƒstablish")

274 
	`´št
("******************************************\n")

275 
timeout
 = 90

276 
timeout
 > 0:

277 
	`´št
("Timeouˆš %s: " % 
timeout
),

278 
sys
.
¡dout
.
	$æush
()

279 #Look 
ªy
 
node
 
nÙ
 
y‘
 
cÚv”ged


280 
i
 
š
 
	$¿nge
(1, 5):

281 
e¡ablished
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°ÃighbÜ" 2> /dev/nuÎ').
	$r¡r
()

282 
şi_v”siÚ
 != "-1":

283 #OÀ
cu¼’t
 
v”siÚ
, 
we
 
Ãed
 
to
 
make
 
su»
 
they
 
®l
 
tuº
Ø
OPERATIONAL
 
Ú
‡Î 
lšes


284 #
 = ('\n'.jošÓ¡ablished.¥l™lšes()è+ '\n').¥l™lšes(1)

286 #Check 
®l
 
lšes
 
to
 
be
 
e™h”
 
bË
 
	`h—d”
 (
¡¬tšg
 
w™h
 ^
AF
 
Ü
 
show
 
OPERATIONAL
)

287 
h—d”
 = 
r
'^AF.*'

288 
İ”©iÚ®
 = 
r
'^ip.*OPERATIONAL.*'

289 
found_İ”©iÚ®
 = 0

290 
j
 
š
 
	`¿nge
(1, 
	$Ën
(
lšes
)):

291 ià(
nÙ
 
»
.
	$£¬ch
(
h—d”
, 
lšes
[
j
])è
	`ªd
 (
nÙ
 
»
.
	$£¬ch
(
İ”©iÚ®
, 
lšes
[
j
])):

292 
e¡ablished
 = "" #Em±y 
¡ršg
 
shows
 
NOT
ƒstablished

293 
»
.
	$£¬ch
(
İ”©iÚ®
, 
lšes
[
j
]):

294 
found_İ”©iÚ®
 += 1

295 
found_İ”©iÚ®
 < 1:

296 #N“d 
©
 
Ëa¡
 
Úe
 
İ”©iÚ®
 
ÃighbÜ


297 
e¡ablished
 = "" #Em±y 
¡ršg
 
shows
 
NOT
ƒstablished

298 
nÙ
 
e¡ablished
:

299 
	`´št
('Wa™šg fÜ„%s' %
i
)

300 
sys
.
¡dout
.
	$æush
()

302 
nÙ
 
e¡ablished
:

303 
	$¦“p
(5)

304 
timeout
 -= 5

306 
	`´št
('Done')

309 #Ba 
out
 
w™h
 
”rÜ
 
a
 
rou‹r
 
çs
 
to
 
cÚv”ge


310 
çl_”rÜ
 = "MPLS LDP‚eighbors did‚otƒstablish"

311 
as£¹
 
F®£
, "MPLS LDP‚eighbÜ did‚Ùƒ¡ablish" % 
o¥fStus


313 
	`´št
("MPLS LDP‚eighborsƒstablished.")

315 
timeout
 < 60:

316 #OÆy 
wa™
 
we
 
aùu®ly
 
w’t
 
through
 
a
 
cÚv”g’û


317 
	`´št
("\nwaiting 15s for LDP sessionsoƒstablish")

318 
	$¦“p
(15)

320 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


321 
i
 
š
 
	$¿nge
(1, 5):

322 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

323 
as£¹
 
çl_”rÜ
 == "", fatal_error

326 
def
 
	$‹¡_m¶s_ldp_discov”y
():

327 
glob®
 
çl_”rÜ


328 
glob®
 
Ãt


329 
glob®
 
şi_v”siÚ


331 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


332 ià(
çl_”rÜ
 != ""):

333 
py‹¡
.
	$sk
(
çl_”rÜ
)

335 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

337 #V”ify 
OSPFv3
 
Routšg
 
TabË


338 
	`´št
("\n\n** Verifying MPLS LDP discovery")

339 
	`´št
("******************************************\n")

340 
çu»s
 = 0

341 
i
 
š
 
	$¿nge
(1, 5):

342 
»fTabËFe
 = '%s/r%s/show_m¶s_ldp_discov”y.»f%s' % (
thisDœ
, 
i
, 
şi_v”siÚ
)

343 
os
.
·th
.
	$isfe
(
»fTabËFe
):

344 #Aùu® 
ouut
 
äom
 
rou‹r


345 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°discov”y" 2> /dev/nuÎ').
	$r¡r
()

347 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


348 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

349 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

350 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

352 #Aùu® 
ouut
 
äom
 
rou‹r


353 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°discov”y" 2> /dev/nuÎ').
	$r¡r
()

355 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

356 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

358 #G’”©
Diff


359 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

360 
t™Ë1
="actual MPLS LDP discovery output",

361 
t™Ë2
="expected MPLS LDP discovery output")

363 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

364 
diff
:

365 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLS LDP discov”y ouuˆCheck:\n%s\n' % (
i
, 
diff
))

366 
çu»s
 += 1

368 
	`´št
("r% ok" % 
i
)

370 
as£¹
 
çu»s
 =ğ0, "MPLS LDP IÁ”çû discov”y ouuˆfÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

372 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


373 
i
 
š
 
	$¿nge
(1, 5):

374 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

375 
as£¹
 
çl_”rÜ
 == "", fatal_error

377 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


378 #CLI(
Ãt
)

381 
def
 
	$‹¡_m¶s_ldp_ÃighbÜ
():

382 
glob®
 
çl_”rÜ


383 
glob®
 
Ãt


384 
glob®
 
şi_v”siÚ


386 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


387 ià(
çl_”rÜ
 != ""):

388 
py‹¡
.
	$sk
(
çl_”rÜ
)

390 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

392 #V”ify 
OSPFv3
 
Routšg
 
TabË


393 
	`´št
("\n\n** Verifying MPLS LDP‚eighbor")

394 
	`´št
("******************************************\n")

395 
çu»s
 = 0

396 
i
 
š
 
	$¿nge
(1, 5):

397 
»fTabËFe
 = '%s/r%s/show_m¶s_ldp_ÃighbÜ.»f%s' % (
thisDœ
, 
i
, 
şi_v”siÚ
)

398 
os
.
·th
.
	$isfe
(
»fTabËFe
):

399 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


400 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

401 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

402 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

404 #Aùu® 
ouut
 
äom
 
rou‹r


405 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°ÃighbÜ" 2> /dev/nuÎ').
	$r¡r
()

407 #Mask 
out
 
chªgšg
 
·¹s
 
š
 
ouut


408 
şi_v”siÚ
 == "-1":

409 #Mask 
out
 
Tim”
 
š
 
U±ime


410 
aùu®
 = 
»
.
	`sub
(
r
"Upime: [0-9][0-9]:[0-9][0-9]:[0-9][0-9]", "Upime: xx:xx:xx",‡ctual)

411 #Mask 
out
 
PÜt
 
numb”s
 
š
 
TCP
 
cÚÃùiÚ


412 
aùu®
 = 
»
.
	`sub
(
r
"TCP connection: ([0-9]+\.[0-9]+\.[0-9]+\.[0-9]):[0-9]+ - ([0-9]+\.[0-9]+\.[0-9]+\.[0-9]):[0-9]+",

413 
r
"TCP cÚÃùiÚ: \1:xxx - \2:xxx", 
aùu®
)

415 #Cu¼’ˆ
V”siÚ


416 #
#Mask 
out
 
Tim”
 
š
 
U±ime


418 
aùu®
 = 
»
.
	`sub
(
r
"(ipv4 [0-9\.]+ +OPERATIONAL [0-9\.]+ +)[0-9][0-9]:[0-9][0-9]:[0-9][0-9]",„"\1xx:xx:xx",‡ctual)

420 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

421 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

423 #G’”©
Diff


424 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

425 
t™Ë1
="actual MPLS LDP‚eighbor output",

426 
t™Ë2
="expected MPLS LDP‚eighbor output")

428 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

429 
diff
:

430 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLS LDP‚eighbÜ ouuˆCheck:\n%s\n' % (
i
, 
diff
))

431 
çu»s
 += 1

433 
	`´št
("r% ok" % 
i
)

435 
as£¹
 
çu»s
 =ğ0, "MPLS LDP IÁ”çû‚eighbÜ ouuˆfÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

437 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


438 
i
 
š
 
	$¿nge
(1, 5):

439 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

440 
as£¹
 
çl_”rÜ
 == "", fatal_error

442 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


443 #CLI(
Ãt
)

446 
def
 
	$‹¡_m¶s_ldp_bšdšg
():

447 
glob®
 
çl_”rÜ


448 
glob®
 
Ãt


449 
glob®
 
şi_v”siÚ


451 #Sk 
this
 
‹¡
 
now
 
uÁ
 
´İ”
 
sÜtšg
 
of
 
the
 
ouut


452 #i 
im¶em’‹d


453 #py‹¡.
	`sk
("Skippingest_mpls_ldp_binding")

455 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


456 ià(
çl_”rÜ
 != ""):

457 
py‹¡
.
	$sk
(
çl_”rÜ
)

459 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

461 #V”ify 
OSPFv3
 
Routšg
 
TabË


462 
	`´št
("\n\n** Verifying MPLS LDP binding")

463 
	`´št
("******************************************\n")

464 
çu»s
 = 0

465 
i
 
š
 
	$¿nge
(1, 5):

466 
»fTabËFe
 = '%s/r%s/show_m¶s_ldp_bšdšg.»f%s' % (
thisDœ
, 
i
, 
şi_v”siÚ
)

467 
os
.
·th
.
	$isfe
(
»fTabËFe
):

468 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


469 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

470 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

471 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

473 #Aùu® 
ouut
 
äom
 
rou‹r


474 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ ld°bšdšg" 2> /dev/nuÎ').
	$r¡r
()

476 #Mask 
out
 
chªgšg
 
·¹s
 
š
 
ouut


477 
şi_v”siÚ
 == "-1":

478 #Mask 
out
 
Ïb–


479 
aùu®
 = 
»
.
	`sub
(
r
"label: [0-9]+", "label: xxx",‡ctual)

480 
aùu®
 = 
»
.
	`sub
(
r
"(\s+[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+[ ]+)[0-9]+",„"\1xxx",‡ctual)

482 #Cu¼’ˆ
V”siÚ


483 #
#Mask 
out
 
Ïb–


485 
aùu®
 = 
»
.
	`sub
(
r
"(ipv4 [0-9\./]+ +[0-9\.]+ +)[0-9][0-9] (.*)",„"\1xxx\2",‡ctual)

486 
aùu®
 = 
»
.
	`sub
(
r
"(ipv4 [0-9\./]+ +[0-9\.]+ +[a-z\-]+ +)[0-9][0-9] (.*)",„"\1xxx\2",‡ctual)

488 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

489 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

491 #SÜˆ
lšes
 
which
 
¡¬t
 
w™h
 "xx via inet "

492 
·‰”n
 = 
r
'^\s+[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+\s+'

493 
sw­³d
 = 
True


494 
sw­³d
:

495 
sw­³d
 = 
F®£


496 
j
 
š
 
	`¿nge
(1, 
	$Ën
(
aùu®
)):

497 
»
.
	$£¬ch
(
·‰”n
, 
aùu®
[
j
]è
ªd
 
»
.
	`£¬ch
(pattern,‡ctual[j-1]):

498 
aùu®
[
j
-1] >‡ctual[j]:

499 
‹mp
 = 
aùu®
[
j
-1]

500 
aùu®
[
j
-1] =‡ctual[j]

501 
aùu®
[
j
] = 
‹mp


502 
sw­³d
 = 
True


504 #G’”©
Diff


505 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

506 
t™Ë1
="actual MPLS LDP binding output",

507 
t™Ë2
="expected MPLS LDP binding output")

509 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

510 
diff
:

511 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLS LDP bšdšg ouuˆCheck:\n%s\n' % (
i
, 
diff
))

512 
çu»s
 += 1

514 
	`´št
("r% ok" % 
i
)

516 
as£¹
 
çu»s
 =ğ0, "MPLS LDP IÁ”çû bšdšg ouuˆfÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

518 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


519 
i
 
š
 
	$¿nge
(1, 5):

520 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

521 
as£¹
 
çl_”rÜ
 == "", fatal_error

523 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


524 #CLI(
Ãt
)

527 
def
 
	$‹¡_zeb¿_v4_routšgTabË
():

528 
glob®
 
çl_”rÜ


529 
glob®
 
Ãt


530 
glob®
 
şi_v”siÚ


532 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


533 ià(
çl_”rÜ
 != ""):

534 
py‹¡
.
	$sk
(
çl_”rÜ
)

536 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

538 #V”ify 
OSPFv3
 
Routšg
 
TabË


539 
	`´št
("\n\n** Verifying Zebra IPv4 Routing Table")

540 
	`´št
("******************************************\n")

541 
çu»s
 = 0

542 
i
 
š
 
	$¿nge
(1, 5):

543 
»fTabËFe
 = '%s/r%s/show_v4_rou‹.»f%s' % (
thisDœ
, 
i
, 
şi_v”siÚ
)

544 
os
.
·th
.
	$isfe
(
»fTabËFe
):

545 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


546 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

548 #Aùu® 
ouut
 
äom
 
rou‹r


549 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°rou‹" 2> /dev/nuÎ | g»°"^O"').
	$r¡r
()

550 #Drİ 
tim”s
 
Ú
 
’d
 
of
 
	`lše
 (
Şd”
 
Quagga
 
V”siÚs
)

551 
aùu®
 = 
»
.
	`sub
(
r
", [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", "",‡ctual)

553 #Mask 
out
 
Ïb–
 - 
®l
 
LDP
 
Ïb–s
 
should
 
be
 >ğ10 (2-
dig™
)

554 #Ëavšg 
the
 
im¶ic™
 
Ïb–s
 
unmasked


555 
aùu®
 = 
»
.
	`sub
(
r
"†abel [0-9][0-9]+", "†abel xxx",‡ctual)

556 #ªd 
Œª¦©šg
 
»maššg
 
	`im¶ic™
 (
sšgË
-
dig™
è
Ïb–s
 
to
 
Ïb–
 
im¶ic™
-
nuÎ


557 
aùu®
 = 
»
.
	`sub
(
r
"†abel [0-9]+", "†abel implicit-null",‡ctual)

558 #Check 
we
 
have
 
im¶ic™
 
Ïb–s
 - 
nÙ
, 
th’
 
»move
 
them
 
äom
 
»ã»nû


559 ià(
nÙ
 
»
.
	`£¬ch
(
r
"†ab– im¶ic™-nuÎ", 
aùu®
)):

560 
ex³ùed
 = 
»
.
	`sub
(
r
",†abel implicit-null", "",ƒxpected)

562 #now 
fix
 
Ãwlšes
 
of
 
	`ex³ùed
 (
make
 
them
 
®l
 
the
 
§me
)

563 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

565 #Add 
missšg
 
comma
 
befÜe
 
	`Ïb–
 (
Şd
 
v”siÚ
)

566 
aùu®
 = 
»
.
	`sub
(
r
"([0-9])†abel ",„"\1,†abel ",‡ctual)

568 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

569 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

571 #G’”©
Diff


572 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

573 
t™Ë1
="actual IPv4 zebra„outingable",

574 
t™Ë2
="expected IPv4 zebra„outingable")

576 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

577 
diff
:

578 
sys
.
¡d”r
.
	`wr™e
('r% çed IPv4 Zeb¿ Routšg TabË Check:\n%s\n' % (
i
, 
diff
))

579 
çu»s
 += 1

581 
	`´št
("r% ok" % 
i
)

583 
as£¹
 
çu»s
 =ğ0, "IPv4 Zeb¿ Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

585 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


586 
i
 
š
 
	$¿nge
(1, 5):

587 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

588 
as£¹
 
çl_”rÜ
 == "", fatal_error

590 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


591 #CLI(
Ãt
)

594 
def
 
	$‹¡_m¶s_bË
():

595 
glob®
 
çl_”rÜ


596 
glob®
 
Ãt


597 
glob®
 
şi_v”siÚ


599 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


600 ià(
çl_”rÜ
 != ""):

601 
py‹¡
.
	$sk
(
çl_”rÜ
)

603 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

605 #V”ify 
OSPFv3
 
Routšg
 
TabË


606 
	`´št
("\n\n** Verifying MPLSable")

607 
	`´št
("******************************************\n")

608 
çu»s
 = 0

610 
v”siÚ
 = 
şi_v”siÚ


611 ià(
v”siÚ
 == ""):

612 #check 
Ãw
 
ouut
 
w™hout
 
im¶ic™
-
nuÎ


613 
ouut
 = 
Ãt
['r1'].
	`cmd
('vtysh -ø"show m¶ bË" 2> /dev/nuÎ').
	$r¡r
()

614 'LDP 10.0.1.2 3' 
š
 
ouut
:

615 
v”siÚ
 = "-no-impl-null"

617 
i
 
š
 
	$¿nge
(1, 5):

618 
»fTabËFe
 = '%s/r%s/show_m¶s_bË.»f%s' % (
thisDœ
, 
i
, 
v”siÚ
)

619 
os
.
·th
.
	$isfe
(
»fTabËFe
):

620 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


621 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

622 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

623 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

625 #Aùu® 
ouut
 
äom
 
rou‹r


626 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show m¶ bË" 2> /dev/nuÎ').
	$r¡r
()

628 #Fix 
šcÚsi¡’t
 
Lab–
 
numb”s
 
©
 
begšnšg
 
of
 
lše


629 
aùu®
 = 
»
.
	`sub
(
r
"(\s+)[0-9]+(\s+LDP)",„"\1XX\2",‡ctual)

630 #Fix 
šcÚsi¡’t
 
Lab–
 
numb”s
 
©
 
’d
 
of
 
lše


631 
aùu®
 = 
»
.
	`sub
(
r
"(\s+[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+\s+)[0-9][0-9]",„"\1XX",‡ctual)

633 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

634 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

636 #SÜˆ
lšes
 
which
 
¡¬t
 
w™h
 " XX LDP"

637 
·‰”n
 = 
r
'^\s+[0-9X]+\s+LDP'

638 
sw­³d
 = 
True


639 
sw­³d
:

640 
sw­³d
 = 
F®£


641 
j
 
š
 
	`¿nge
(1, 
	$Ën
(
aùu®
)):

642 
»
.
	$£¬ch
(
·‰”n
, 
aùu®
[
j
]è
ªd
 
»
.
	`£¬ch
(pattern,‡ctual[j-1]):

643 
aùu®
[
j
-1] >‡ctual[j]:

644 
‹mp
 = 
aùu®
[
j
-1]

645 
aùu®
[
j
-1] =‡ctual[j]

646 
aùu®
[
j
] = 
‹mp


647 
sw­³d
 = 
True


649 #G’”©
Diff


650 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

651 
t™Ë1
="actual MPLSable output",

652 
t™Ë2
="expected MPLSable output")

654 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

655 
diff
:

656 
sys
.
¡d”r
.
	`wr™e
('r% çed MPLSabË ouuˆCheck:\n%s\n' % (
i
, 
diff
))

657 
çu»s
 += 1

659 
	`´št
("r% ok" % 
i
)

661 
as£¹
 
çu»s
 =ğ0, "MPLSabË ouuˆfÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

663 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


664 
i
 
š
 
	$¿nge
(1, 5):

665 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

666 
as£¹
 
çl_”rÜ
 == "", fatal_error

668 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


669 #CLI(
Ãt
)

672 
def
 
	$‹¡_lšux_m¶s_rou‹s
():

673 
glob®
 
çl_”rÜ


674 
glob®
 
Ãt


675 
glob®
 
şi_v”siÚ


677 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


678 ià(
çl_”rÜ
 != ""):

679 
py‹¡
.
	$sk
(
çl_”rÜ
)

681 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

683 #V”ify 
OSPFv3
 
Routšg
 
TabË


684 
	`´št
("\n\n** Verifying Linux Kernel MPLS„outes")

685 
	`´št
("******************************************\n")

686 
çu»s
 = 0

687 
i
 
š
 
	$¿nge
(1, 5):

688 
»fTabËFe
 = '%s/r%s/_m¶s_rou‹.»f' % (
thisDœ
, 
i
)

689 
os
.
·th
.
	$isfe
(
»fTabËFe
):

690 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


691 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

692 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

693 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

695 #Aùu® 
ouut
 
äom
 
rou‹r


696 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
(' -Ø-çmy m¶ rou‹ 2> /dev/nuÎ').
	$r¡r
()

698 #Mask 
out
 
Ïb–
 
ªd
 
´ÙocŞ


699 
aùu®
 = 
»
.
	`sub
(
r
"[0-9][0-9] via inet ", "xx via inet ",‡ctual)

700 
aùu®
 = 
»
.
	`sub
(
r
"[0-9][0-9] +proto", "xx…roto",‡ctual)

701 
aùu®
 = 
»
.
	`sub
(
r
"[0-9][0-9]‡so ", "xx‡so ",‡ctual)

702 
aùu®
 = 
»
.
	`sub
(
r
"[ ]+proto \w+", "…roto xx",‡ctual)

704 #SÜˆ
Ãxthİs


705 
Ãxthİ_sÜ‹d
 = []

706 
lše
 
š
 
aùu®
.
	$¥l™lšes
():

707 
tok’s
 = 
»
.
	`¥l™
(
r
'\\\t', 
lše
.
	$¡r
())

708 
Ãxthİ_sÜ‹d
.
	`­³nd
('{} {}'.
	`fÜm©
(

709 
tok’s
[0].
	`¡r
(),

710 ' '.
	`još
([ 
tok’
.
	$¡r
(è
tok’
 
š
 
	`sÜ‹d
(
tok’s
[1:]) ])

711 ).
	$¡r
())

713 #SÜˆ
lšes
 
ªd
 
fixup
 
difã»nûs
 
b‘w“n
 
Şd
‡nd 
Ãw
 
rou‹


714 
aùu®
 = '\n'.
	`još
(
	$sÜ‹d
(
Ãxthİ_sÜ‹d
))

715 
aùu®
 = 
»
.
	`sub
(
r
"nexthop via", "nexthopvia",‡ctual)

716 
aùu®
 = 
»
.
	`sub
(
r
"‚exthop‡so xx via inet ", "‚exthopvia inet ",‡ctual)

717 
aùu®
 = 
»
.
	`sub
(
r
" weight 1", "",‡ctual)

718 
aùu®
 = 
»
.
	`sub
(
r
" [ ]+", " ",‡ctual)

720 #puˆ\
n
 
back
 
©
 
lše
 
’ds


721 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

723 #G’”©
Diff


724 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

725 
t™Ë1
="actual Linux Kernel MPLS„oute",

726 
t™Ë2
="expected Linux Kernel MPLS„oute")

728 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

729 
diff
:

730 
sys
.
¡d”r
.
	`wr™e
('r% çed Lšux K”ÃÈMPLS„ou‹ ouuˆCheck:\n%s\n' % (
i
, 
diff
))

731 
çu»s
 += 1

733 
	`´št
("r% ok" % 
i
)

735 
as£¹
 
çu»s
 =ğ0, "Lšux K”ÃÈMPLS„ou‹ ouuˆfÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

737 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


738 
i
 
š
 
	$¿nge
(1, 5):

739 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

740 
as£¹
 
çl_”rÜ
 == "", fatal_error

742 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


743 #CLI(
Ãt
)

746 
def
 
	$‹¡_shutdown_check_¡d”r
():

747 
glob®
 
çl_”rÜ


748 
glob®
 
Ãt


750 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


751 ià(
çl_”rÜ
 != ""):

752 
py‹¡
.
	$sk
(
çl_”rÜ
)

754 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

755 
	`´št
("SKIPPED final check on StdErr output: Disabled (TOPOTESTS_CHECK_STDERR undefined)\n")

756 
py‹¡
.
	`sk
('Skippingest for Stderr output')

758 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

760 
	`´št
("\n\n** Verifying unexpected STDERR output from daemons")

761 
	`´št
("******************************************\n")

763 
i
 
š
 
	$¿nge
(1, 5):

764 
Ãt
['r%s' % 
i
].
	$¡İRou‹r
()

765 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ldpd')

766 
log
:

767 
	`´št
("\nRou‹¸r% LDPd StdE¼ Log:\n%s" % (
i
, 
log
))

768 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ospfd')

769 
log
:

770 
	`´št
("\nRou‹¸r% OSPFd StdE¼ Log:\n%s" % (
i
, 
log
))

771 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('zebra')

772 
log
:

773 
	`´št
("\nRou‹¸r% Zeb¿ StdE¼ Log:\n%s" % (
i
, 
log
))

776 
def
 
	$‹¡_shutdown_check_memËak
():

777 
glob®
 
çl_”rÜ


778 
glob®
 
Ãt


780 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


781 ià(
çl_”rÜ
 != ""):

782 
py‹¡
.
	$sk
(
çl_”rÜ
)

784 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
is
 
NÚe
:

785 
	`´št
("SKIPPED final check on Memory†eaks: Disabled (TOPOTESTS_CHECK_MEMLEAK undefined)\n")

786 
py‹¡
.
	`sk
('Skippingest for memory†eaks')

788 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

790 
i
 
š
 
	$¿nge
(1, 5):

791 
Ãt
['r%s' % 
i
].
	$¡İRou‹r
()

792 
Ãt
['r%s' % 
i
].
	`»pÜt_memÜy_Ëaks
(
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'), os.
·th
.
	$ba£Çme
(
__fe__
))

795 
__Çme__
 == '__main__':

797 
	`£tLogLev–
('info')

798 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


799 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

800 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

801 
sys
.
	`ex™
(
»tv®
)

	@ldp-vpls-topo1/__init__.py

	@ldp-vpls-topo1/test_ldp_vpls_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_ldp_v¶s_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_ldp_v¶s_tİo1
.
	gpy
:

30 | 
CE1
 | | 
CE2
 |

33 
û1
-
‘h0
 (172.16.1.1/24)| |
û2
-eth0 (172.16.1.2/24)

36 
¹1
-
‘h0
| |
¹2
-eth0

38 | |
¹1
-
‘h1
 | |

39 | 
RT1
 +----------------+ 
RT2
 |

40 | 1.1.1.1 | 
¹2
-
‘h1
| 2.2.2.2 |

43 
¹1
-
‘h2
| |
¹2
-eth2

48 | | 
RT3
 | |

50 
¹3
-
‘h2
| |¹3-
‘h1


52 |
¹3
-
‘h0


55 
û3
-
‘h0
 (172.16.1.3/24)|

58 | 
CE3
 |

63 
impÜt
 
os


64 
impÜt
 
sys


65 
impÜt
 
py‹¡


66 
impÜt
 
jsÚ


67 
äom
 
time
 
impÜt
 
¦“p


68 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


70 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

71 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

72 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

74 #pylšt: 
di§bË
=
C0413


75 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


76 
äom
 
lib
 
impÜt
 
tİÙe¡


77 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


78 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


80 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

81 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


83 
şass
 
	$Tem¶©eTİo
(
Tİo
):

85 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

87 
tg’
 = 
	$g‘_tİog’
(
£lf
)

89 #
#Defš
FRR
 
Rou‹rs


91 #

rou‹r
 
š
 ['ce1', 'ce2', 'ce3', 'r1', 'r2', 'r3']:

93 
tg’
.
	$add_rou‹r
(
rou‹r
)

95 #
#Defš
cÚÃùiÚs


97 #
ğ
tg’
.
	`add_sw™ch
('s1')

99 .
	`add_lšk
(
tg’
.
g—rs
['ce1'])

100 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

102 ğ
tg’
.
	`add_sw™ch
('s2')

103 .
	`add_lšk
(
tg’
.
g—rs
['ce2'])

104 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

106 ğ
tg’
.
	`add_sw™ch
('s3')

107 .
	`add_lšk
(
tg’
.
g—rs
['ce3'])

108 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

110 ğ
tg’
.
	`add_sw™ch
('s4')

111 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

112 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

114 ğ
tg’
.
	`add_sw™ch
('s5')

115 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

116 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

118 ğ
tg’
.
	`add_sw™ch
('s6')

119 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

120 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

122 
def
 
	$£tup_moduË
(
mod
):

124 
tg’
 = 
	$Tİog’
(
Tem¶©eTİo
, 
mod
.
__Çme__
)

125 
tg’
.
	$¡¬t_tİŞogy
()

127 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

129 #FÜ 
®l
 
»gi¡”ed
 
rou‹rs
, 
lßd
 
the
 
zeb¿
 
cÚfigu¿tiÚ
 
fe


130 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

131 
rou‹r
.
	`lßd_cÚfig
(

132 
TİoRou‹r
.
RD_ZEBRA
,

133 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

136 
rou‹r
.
Çme
[0] == 'r':

137 
rou‹r
.
	`lßd_cÚfig
(

138 
TİoRou‹r
.
RD_OSPF
,

139 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

141 
rou‹r
.
	`lßd_cÚfig
(

142 
TİoRou‹r
.
RD_LDP
,

143 
os
.
·th
.
	`još
(
CWD
, '{}/ldpd.cÚf'.
	$fÜm©
(
ºame
))

146 
tg’
.
	$¡¬t_rou‹r
()

147 
rou‹r
 
š
 
rou‹r_li¡
.
	$v®ues
():

148 
rou‹r
.
	`has_v”siÚ
('<', '3'):

149 
tg’
.
	`£t_”rÜ
('unsupported version')

151 
def
 
	$‹¬down_moduË
(
mod
):

153 
tg’
 = 
	$g‘_tİog’
()

155 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

156 
tg’
.
	$¡İ_tİŞogy
()

159 
def
 
	$rou‹r_com·»_jsÚ_ouut
(
ºame
, 
commªd
, 
»ã»nû
):

162 
logg”
.
	`šfo
('Com·ršg„ou‹¸"%s" "%s" ouut', 
ºame
, 
commªd
)

164 
tg’
 = 
	$g‘_tİog’
()

165 
f’ame
 = '{}/{}/{}'.
	$fÜm©
(
CWD
, 
ºame
, 
»ã»nû
)

166 
ex³ùed
 = 
jsÚ
.
	`lßds
(
	`İ’
(
f’ame
).
	$»ad
())

168 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 80 
£cÚds
.

169 
‹¡_func
 = 
	$·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

170 
tg’
.
g—rs
[
ºame
], 
commªd
, 
ex³ùed
)

171 
_
, 
diff
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
, 
couÁ
=160, 
wa™
=0.5)

172 
as£¹msg
 = '"{}" JSON ouuˆmism©che thex³ùed„esuÉ'.
	$fÜm©
(
ºame
)

173 
as£¹
 
diff
 
is
 
NÚe
, 
as£¹msg


175 
def
 
	$‹¡_o¥f_cÚv”g’û
():

176 
logg”
.
	`šfo
("Test: check OSPF‡djacencies")

177 
tg’
 = 
	$g‘_tİog’
()

179 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


180 
tg’
.
	$rou‹rs_have_çu»
():

181 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

183 #Old 
	`ouut
 (
befÜe
 
FRR
 
PR1383
è
didn
't show‡†ist of‚eighbors.

184 #Check 
diù
 
objeù
 
ªd
 
com·»
 
to
 
Şd
 
ouut
 
this
 
is
 
the
 

185 
tg’
 = 
	$g‘_tİog’
()

186 
rou‹r
 = 
tg’
.
g—rs
['r1']

187 
ouut
 = 
rou‹r
.
	`vtysh_cmd
("show i°o¥àÃighbÜ jsÚ", 
isjsÚ
=
True
)

189 #W
could
 
have
 
e™h”
 
Şd
 
	`fÜm©
 (
w™hout
 "ÃighbÜs" 
ªd
 
dœeù
 
li¡


190 #oà
IP
's or‚ew format from PR1659 with "neighbors".

191 #Tryšg 
Şd
 
fÜm©s
 
fœ¡
 
ªd
 
çÎ
 
back
 
to
 
Ãw
 
fÜm©


192 #
#New 
fÜm©
: 
ÃighbÜs
 
have
 
diù
 
š¡—d
 
of
 
li¡
 oà
	`diùs
 (
PR1723
).

194 
ouut
.
	`has_key
('neighbors'):

195 
	`isš¡ªû
(
ouut
['ÃighbÜs'], 
diù
):

196 
»ffe
 = "show_ip_ospf_neighbor.json"

198 
»ffe
 = "show_ip_ospf_neighbor.ref"

200 
	`isš¡ªû
(
ouut
["2.2.2.2"], 
diù
):

201 
»ffe
 = "show_ip_ospf_neighbor.ref-old-nolist"

203 
»ffe
 = "show_ip_ospf_neighbor.ref-no-neigh"

205 
ºame
 
š
 ['r1', 'r2', 'r3']:

206 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show i°o¥àÃighbÜ jsÚ", 
»ffe
)

208 
def
 
	$‹¡_rib
():

209 
logg”
.
	`šfo
("Test: verify RIB")

210 
tg’
 = 
	$g‘_tİog’
()

212 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


213 
tg’
.
	$rou‹rs_have_çu»
():

214 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

216 
ºame
 
š
 ['r1', 'r2', 'r3']:

217 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show ip„oute json", "show_ip_route.ref")

219 
def
 
	$‹¡_ldp_adjaûnc›s
():

220 
logg”
.
	`šfo
("Test: verify LDP‡djacencies")

221 
tg’
 = 
	$g‘_tİog’
()

223 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


224 
tg’
.
	$rou‹rs_have_çu»
():

225 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

227 
ºame
 
š
 ['r1', 'r2', 'r3']:

228 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show mpls†dp discovery json", "show_ldp_discovery.ref")

230 
def
 
	$‹¡_ldp_ÃighbÜs
():

231 
logg”
.
	`šfo
("Test: verify LDP‚eighbors")

232 
tg’
 = 
	$g‘_tİog’
()

234 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


235 
tg’
.
	$rou‹rs_have_çu»
():

236 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

238 
ºame
 
š
 ['r1', 'r2', 'r3']:

239 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show mpls†dp‚eighbor json", "show_ldp_neighbor.ref")

241 
def
 
	$‹¡_ldp_bšdšgs
():

242 
logg”
.
	`šfo
("Test: verify LDP bindings")

243 
tg’
 = 
	$g‘_tİog’
()

245 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


246 
tg’
.
	$rou‹rs_have_çu»
():

247 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

249 
ºame
 
š
 ['r1', 'r2', 'r3']:

250 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show mpls†dp binding json", "show_ldp_binding.ref")

252 
def
 
	$‹¡_ldp_pwid_bšdšgs
():

253 
logg”
.
	`šfo
("Test: verify LDP PW-ID bindings")

254 
tg’
 = 
	$g‘_tİog’
()

256 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


257 
tg’
.
	$rou‹rs_have_çu»
():

258 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

260 
ºame
 
š
 ['r1', 'r2', 'r3']:

261 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show†2vpn‡tom binding json", "show_l2vpn_binding.ref")

263 
def
 
	$‹¡_ldp_p£udowœes
():

264 
logg”
.
	`šfo
("Test: verify LDP…seudowires")

265 
tg’
 = 
	$g‘_tİog’
()

267 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


268 
tg’
.
	$rou‹rs_have_çu»
():

269 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

271 
ºame
 
š
 ['r1', 'r2', 'r3']:

272 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show†2vpn‡tom vc json", "show_l2vpn_vc.ref")

274 
def
 
	$‹¡_ldp_p£udowœes_aá”_lšk_down
():

275 
logg”
.
	`šfo
("Test: verify LDP…seudowires‡fter„1-r2†ink goes down")

276 
tg’
 = 
	$g‘_tİog’
()

278 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


279 
tg’
.
	$rou‹rs_have_çu»
():

280 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

282 #Shuˆ
down
 
r1
-
r2
 
lšk
 */

283 
tg’
 = 
	$g‘_tİog’
()

284 
tg’
.
g—rs
['r1'].
	`³”_lšk_’abË
('r1-‘h1', 
F®£
)

286 #check 
the
 
p£udowœe
 
is
 
¡l
 
	`up
 (
usšg
 
ª
 
®‹º©e
 
·th
 
Ãxthİ
 
»sŞutiÚ
)

287 
ºame
 
š
 ['r1', 'r2', 'r3']:

288 
	`rou‹r_com·»_jsÚ_ouut
(
ºame
, "show†2vpn‡tom vc json", "show_l2vpn_vc.ref")

290 #MemÜy 
Ëak
 
‹¡
 
‹m¶©e


291 
def
 
	$‹¡_memÜy_Ëak
():

293 
tg’
 = 
	$g‘_tİog’
()

294 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

295 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

297 
tg’
.
	$»pÜt_memÜy_Ëaks
()

299 
__Çme__
 == '__main__':

300 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

301 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@lib/__init__.py

	@lib/bgp.py

1 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

3 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
.

4 #("N‘DEF"è
š
 
this
 
fe
.

5 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


7 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


8 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


9 #š 
®l
 
cİ›s
.

10 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


12 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


13 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


14 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


15 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

16 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


17 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


18 #OF 
THIS
 
SOFTWARE
.

21 
impÜt
 
add»ss


22 
impÜt
 
Œaûback


23 
äom
 
time
 
impÜt
 
¦“p


24 
äom
 
	glib
.
tİŞog
 
impÜt
 
	glogg”
, 
	glogg”_cÚfig


26 #ImpÜˆ
commÚ_cÚfig
 
to
 
u£
 
commomÆy
 
u£d
 
APIs


27 
äom
 
	glib
.
commÚ_cÚfig
 
impÜt
 *

29 
	gBGPCFG_FILE
 = 'bgp_json.conf'

30 
bgp_cfg
 = {}

31 
BGP_CONVERGENCE_TIMEOUT
 = 10

33 ###
 BGPRoutšgPB:

36 
def
 
	$__š™__
(
£lf
, 
rou‹r_id
):

37 
£lf
.
bgp_cÚfig
 = 
NÚe


38 
£lf
.
commun™y_li¡s
 = []

39 
£lf
.
»di¡ribu‹_¡©ic
 = 
NÚe


40 
£lf
.
»di¡ribu‹_¡©ic_rou‹_m­
 = 
NÚe


41 
£lf
.
»di¡ribu‹_cÚÃùed
 = 
NÚe


42 
£lf
.
»di¡ribu‹_cÚÃùed_rou‹_m­
 = 
NÚe


43 
£lf
.
routšg_glob®
 = {'rou‹r_id': 
rou‹r_id
}

46 
şass
 
BGPCÚfig
:

48 
def
 
	$__š™__
(
£lf
, 
rou‹r
, 
routšg_cfg_msg
, 
bgpcfg_fe
):

49 
£lf
.
rou‹r
 =„outer

50 
£lf
.
routšg_pb
 = 
routšg_cfg_msg


51 
£lf
.
bgp_glob®
 = 
	$g‘_SŒšgIO
()

52 
£lf
.
bgp_ÃighbÜs
 = 
	$g‘_SŒšgIO
()

53 
£lf
.
bgp_add»ss_çmy
 = {
	}
}

54 
£lf
.
as_·th_´•’d
 = 
F®£


55 
£lf
.
bgp_add»ss_çmy
[
IPv4_UNICAST
] = 
	$g‘_SŒšgIO
()

56 
£lf
.
bgp_add»ss_çmy
[
IPv6_UNICAST
] = 
	$g‘_SŒšgIO
()

57 
£lf
.
bgp_add»ss_çmy
[
VPNv4_UNICAST
] = 
	$g‘_SŒšgIO
()

58 
£lf
.
commun™y_li¡
 = 
	$g‘_SŒšgIO
()

59 
£lf
.
_commun™y_li¡_»gex_šdex
 = 0

60 
£lf
.
bgpcfg_fe
 = bgpcfg_file

62 
def
 
	$»£t_™
(
£lf
):

63 
£lf
.
bgp_glob®
 = 
	$g‘_SŒšgIO
()

64 
£lf
.
bgp_ÃighbÜs
 = 
	$g‘_SŒšgIO
()

65 
£lf
.
bgp_add»ss_çmy
 = {
	}
}

66 
£lf
.
as_·th_´•’d
 = 
F®£


67 
£lf
.
bgp_add»ss_çmy
[
IPv4_UNICAST
] = 
	$g‘_SŒšgIO
()

68 
£lf
.
bgp_add»ss_çmy
[
IPv6_UNICAST
] = 
	$g‘_SŒšgIO
()

69 
£lf
.
bgp_add»ss_çmy
[
VPNv4_UNICAST
] = 
	$g‘_SŒšgIO
()

70 
£lf
.
commun™y_li¡
 = 
	$g‘_SŒšgIO
()

72 
def
 
	$´št_bgp_cÚfig_to_fe
(
£lf
, 
tİo
):

73 
Œy
:

74 
bgpcfg
 = 
	`İ’
(
£lf
.
bgpcfg_fe
, 'w')

75 
exû±
 
IOE¼Ü
 
as
 
”r
:

76 
logg”
.
	`”rÜ
('Unableo open BGP Config File.ƒrror(%s): %s' % (

77 
”r
.
”ºo
,ƒ¼.
¡»¼Ü
))

78  
F®£


80 
bgpcfg
.
	`wr™e
("! Community List Config\n")

81 
bgpcfg
.
	`wr™e
(
£lf
.
commun™y_li¡
.
	$g‘v®ue
())

83 
£lf
.
is_bgp_cÚfigu»d
:

84 
bgpcfg
.
	`wr™e
('! BGP Config\n')

85 
bgpcfg
.
	`wr™e
(
£lf
.
bgp_glob®
.
	$g‘v®ue
())

86 
bgpcfg
.
	`wr™e
(
£lf
.
bgp_ÃighbÜs
.
	$g‘v®ue
())

87 
addr_çmy
 
š
 
£lf
.
bgp_add»ss_çmy
:

88 
bgpcfg
.
	`wr™e
('add»ss-çmy ' + 
	`g‘_add»ss_çmy
(

89 
addr_çmy
) + '\n')

90 
bgpcfg
.
	`wr™e
(
£lf
.
bgp_add»ss_çmy
[
addr_çmy
].
	$g‘v®ue
())

91 
bgpcfg
.
	`wr™e
('exit-address-family\n')

92 
bgpcfg
.
	`wr™e
('line vty\n')

93 
bgpcfg
.
	$şo£
()

94  
True


96 
def
 
	$şo£
(
£lf
):

97 
£lf
.
bgp_ÃighbÜs
.
	$şo£
()

98 
£lf
.
bgp_glob®
.
	$şo£
()

99 
addr_çmy
 
š
 
£lf
.
bgp_add»ss_çmy
:

100 
£lf
.
bgp_add»ss_çmy
[
addr_çmy
].
	$şo£
()

102 
def
 
	$ü—‹_bgp_cfg
(
rou‹r
, 
tİo
):

104 
C»©e
 
BGP
 
cÚfigu¿tiÚ
 
ü—‹d
 
tİŞogy
 
ªd


105 
§ve
 
the
 
cÚfigu¿tiÚ
 
to
 
är
.
cÚf
 
fe
. 
BGP
 configuration

106 
is
 
´ovided
 
š
 
šput
 
jsÚ
 
fe
.

108 * `
rou‹r
` :„ou‹¸
which
 
bgp
 
cÚfig
 
should
 
be
 
ü—‹d


109 * `
tİo
` : 
jsÚ
 
fe
 
d©a


112 
Œy
:

113 #S‘tšg 
key
 
to
 
bgp
Ø
»ad
 
d©a
 
äom
 
jsÚ
 
fe
 bg°
cÚfigu¿tiÚ


114 
key
 = 'bgp'

115 
loÿl_as
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]['local_as']

116 "ecmp" 
š
 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]:

117 
ecmp
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]['ecmp']

119 
ecmp
 = 1

120 "g¿ûfuÌe¡¬t" 
š
 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]:

121 
g¿ûfuÎ_»¡¬t
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
][

124 
g¿ûfuÎ_»¡¬t
 = 
F®£


125 "’abËd" 
š
 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]:

126 
bgp_’abËd
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]['enabled']

128 
bgp_’abËd
 = 
True


129 
bgp_cfg
[
rou‹r
].
is_bgp_cÚfigu»d
 = 
bgp_’abËd


130 
bgp
 = 
	$Bgp
(
loÿl_as
, 
g¿ûfuÎ_»¡¬t
, 
ecmp
)

132 
ÃighbÜs
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)][
key
]['bgp_neighbors']

133 
ÃighbÜ_Çme
, 
d©a
 
š
 
ÃighbÜs
.
	$™”™ems
():

134 
»mÙe_as
 = 
ÃighbÜs
[
ÃighbÜ_Çme
]['remote_as']

135 "hŞddowÁim”" 
š
 
ÃighbÜs
[
ÃighbÜ_Çme
]:

136 
hŞddowÁim”
 = 
ÃighbÜs
[
ÃighbÜ_Çme
]['holddowntimer']

138 
hŞddowÁim”
 = 
NÚe


139 "k“·liv‘im”" 
š
 
ÃighbÜs
[
ÃighbÜ_Çme
]:

140 
k“·liv‘im”
 = 
ÃighbÜs
[
ÃighbÜ_Çme
]['keepalivetimer']

142 
k“·liv‘im”
 = 
NÚe


144 #P“¸
d‘as


145 
³”
 = 
ÃighbÜs
[
ÃighbÜ_Çme
]['peer']

146 
de¡_lšk
 = 
³”
['dest_link']

147 
ADDR_TYPE
 = 
³”
['addr_type']

149 #Add 
suµÜt
 
muÉË
 
loİback
 
add»ss


150 #Loİback 
š‹rçû


151 
nb_Çme
 = 
tİo
['rou‹rs'][
ÃighbÜ_Çme
]

152 "sourû_lšk" 
š
 
³”
 
ªd
…eer['source_link'] == 'lo':

153 
_addr
 = 
nb_Çme
['lo'][
ADDR_TYPE
].
	`¥l™
('/')[0]

154 
upd©e_sourû
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
rou‹r
)]['lo'][

155 
ADDR_TYPE
].
	`¥l™
('/')[0]

156 
ADDR_TYPE
 == "ipv4":

157 
af_modif›r
 = 
IPv4_UNICAST


159 
af_modif›r
 = 
IPv6_UNICAST


160 
addr
 = 
	$Add»ss
(
af_modif›r
, 
_addr
, 
NÚe
)

161 
ÃighbÜ
 = 
bgp
.
	$add_ÃighbÜ
(
af_modif›r
, 
addr
, 
»mÙe_as
,

162 
k“·liv‘im”
, 
hŞddowÁim”
,

163 
NÚe
, 
upd©e_sourû
, 2, None)

164 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
, 
NÚe
, None,

165 
NÚe
, None)

167 #PhysiÿÈ
š‹rçû


169 
de¡Rou‹rLšk
, 
d©a
 
š
 
	`sÜ‹d
(
nb_Çme
['links'].

170 
	$™”™ems
()):

171 
de¡_lšk
 =ğ
de¡Rou‹rLšk
:

172 
_addr
 = 
nb_Çme
['lšks'][
de¡Rou‹rLšk
][
ADDR_TYPE
].\

173 
	`¥l™
('/')[0]

174 
ADDR_TYPE
 == "ipv4":

175 
af_modif›r
 = 
IPv4_UNICAST


177 
af_modif›r
 = 
IPv6_UNICAST


179 
addr
 = 
	$Add»ss
(
af_modif›r
, 
_addr
, 
NÚe
)

180 
ÃighbÜ
 = 
bgp
.
	$add_ÃighbÜ
(
af_modif›r
, 
addr
,

181 
»mÙe_as
, 
k“·liv‘im”
,

182 
hŞddowÁim”
, 
NÚe
,

183 
NÚe
, 0, None)

184 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
, 
NÚe
,

185 
NÚe
, None, None)

187 
exû±
 
Exû±iÚ
 
as
 
e
:

188 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

189 
logg”
.
	$”rÜ
(
”rÜmsg
)

190  
”rÜmsg


192  
bgp


194 
def
 
	$ü—‹_bgp_cÚfigu¿tiÚ
(
ADDR_TYPE
, 
tg’
, 
CWD
, 
tİo
, 
rou‹r
):

196 
It
 
wl
 
ü—‹
 
bgp
.
cÚf
 
fe
, 
š
 
which
 
®l
 
the
 
rou‹rs
 
commÚ
 
cÚfigu¿tiÚ


197 
would
 
be
 
§ved


199 * `
ADDR_TYPE
` : 

 
ty³
 
v4
/
v6


200 * `
tg’
` : 
Tİog’
 
objeù


201 * `
CWD
` : 
ÿÎ”
's current working directory

202 * `
tİo
` : 
jsÚ
 
fe
 
d©a


203 * `
rou‹r
` : 
cu¼’t
„outer

206 
Œy
:

207 
glob®
 
bgp_cfg


208 
li¡Rou‹rs
 = []

209 
rou‹rN
 
š
 
tİo
['rou‹rs'].
	$™”™ems
():

210 
li¡Rou‹rs
.
	$­³nd
(
rou‹rN
[0])

212 
li¡Rou‹rs
.
	$sÜt
()

214 
curRou‹r
 
š
 
li¡Rou‹rs
:

215 
curRou‹r
 !ğ
rou‹r
:

218 'bgp' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

219 'rou‹r-id' 
š
 
tİo
['rou‹rs'][
rou‹r
]['bgp']:

220 
rid
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['router-id']

221 
rou‹r_id
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
rid
, 
NÚe
)

223 
rou‹r_id
 = 
NÚe


225 
¹_cfg
 = 
	$BGPRoutšgPB
(
rou‹r_id
)

227 
âame
 = '{}/{}/{}'.
	$fÜm©
(
CWD
, 
rou‹r
, 
BGPCFG_FILE
)

228 
bgp_cfg
[
rou‹r
] = 
	$BGPCÚfig
(
rou‹r
, 
¹_cfg
, 
âame
)

229 
bgp_cfg
[
rou‹r
].
is_¡ªdby
 = 
F®£


231 
šput_diù
 = 
tİo
['routers']

232 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
 = 
	$ü—‹_bgp_cfg
(
rou‹r
, 
tİo
)

233 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

234 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

235 #Lßd 
cÚfig
 
to
 
rou‹r


236 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

238 '»di¡ribu‹' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

239 
»suÉ
 = 
	$»di¡ribu‹_¡©ic_rou‹s
(
ADDR_TYPE
, 
šput_diù
,

240 
tg’
, 
CWD
, 
tİo
)

241 
as£¹
 
»suÉ
 
is
 
True
, ("API:„edistribute_static_routes() "

242 ":Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
))

244 
exû±
 
Exû±iÚ
 
as
 
e
:

245 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

246 
logg”
.
	$”rÜ
(
”rÜmsg
)

247  
”rÜmsg


249  
True


251 #H–³¸
şass
 
Add»ss
 
ty³
 
cÚfigu¿tiÚ


252 
şass
 
Add»ss
:

254 
def
 
	$__š™__
(
£lf
, 
afi
, 
v4
=
NÚe
, 
v6
=None):

255 
£lf
.
afi
 =‡fi

256 
£lf
.
v4
 = ipv4

257 
£lf
.
v6
 = ipv6

259 #H–³¸
şass
 
Add»ss
 
çmy
 
cÚfigu¿tiÚ


260 
şass
 
Add»ssFamy
:

262 
def
 
	$__š™__
(
£lf
, 
ad_çmy
, 
’abËd
=
NÚe
, 
f‹r_š_´efix_li¡
=None,

263 
f‹r_out_´efix_li¡
=
NÚe
, 
f‹r_š_rm­
=None,

264 
f‹r_out_rm­
=
NÚe
, 
Ãxt_hİ_£lf
 = 
F®£
):

265 
£lf
.
ty³
 = 
ad_çmy


266 
£lf
.
’abËd
 =ƒnabled

267 
£lf
.
f‹r_š_´efix_li¡
 = filter_in_prefix_list

268 
£lf
.
f‹r_out_´efix_li¡
 = filter_out_prefix_list

269 
£lf
.
f‹r_š_rm­
 = filter_in_rmap

270 
£lf
.
f‹r_out_rm­
 = filter_out_rmap

271 
£lf
.
Ãxt_hİ_£lf
 =‚ext_hop_self

273 #H–³¸
şass
 
BGP
 
NeighbÜ
 
cÚfigu¿tiÚ


274 
şass
 
NeighbÜ
:

276 
def
 
	$__š™__
(
£lf
, 
afi
, 
_add»ss
, 
»mÙe_as
, 
k“p_®ive_time
=
NÚe
,

277 
hŞd_down_time
=
NÚe
, 
·sswÜd
=NÚe, 
upd©e_sourû
=None,

278 
max_hİ_lim™
 = 0, 
g¿ûful_»¡¬t
=
NÚe
):

279 
£lf
.
afi
 =‡fi

280 
£lf
.
_add»ss
 = ip_address

281 
£lf
.
»mÙe_as
 =„emote_as

282 
£lf
.
k“p_®ive_time
 = keep_alive_time

283 
£lf
.
hŞd_down_time
 = hold_down_time

284 
£lf
.
·sswÜd
 =…assword

285 
£lf
.
max_hİ_lim™
 = max_hop_limit

286 
£lf
.
upd©e_sourû
 = update_source

287 
£lf
.
add»ss_çm›s
 = []

288 
£lf
.
g¿ûful_»¡¬t
 = graceful_restart

290 
def
 
	$add_add»ss_çmy
(
£lf
, 
ad_çmy
, 
’abËd
=
NÚe
,

291 
f‹r_š_´efix_li¡
=
NÚe
,

292 
f‹r_out_´efix_li¡
=
NÚe
,

293 
f‹r_š_rm­
=
NÚe
,

294 
f‹r_out_rm­
=
NÚe
,

295 
Ãxt_hİ_£lf
 = 
F®£
):

296 
f
 
š
 
£lf
.
add»ss_çm›s
:

297 
f
.
ty³
 =ğ
ad_çmy
:

298 
f
.
’abËd
 =ƒnabled

299 
f
.
f‹r_š_´efix_li¡
 = filter_in_prefix_list

300 
f
.
f‹r_out_´efix_li¡
 = filter_out_prefix_list

301 
f
.
f‹r_š_rm­
 = filter_in_rmap

302 
f
.
f‹r_out_rm­
 = filter_out_rmap

303 
f
.
Ãxt_hİ_£lf
 =‚ext_hop_self

306 
çmy
 = 
	$Add»ssFamy
(
ad_çmy
, 
’abËd
, 
f‹r_š_´efix_li¡
,

307 
f‹r_out_´efix_li¡
, 
f‹r_š_rm­
,

308 
f‹r_out_rm­
, 
Ãxt_hİ_£lf
 = 
F®£
)

309 
£lf
.
add»ss_çm›s
.
	$­³nd
(
çmy
)

311 
def
 
	$d–_add»ss_çmy
(
£lf
, 
ad_çmy
):

312 
f
 
š
 
£lf
.
add»ss_çm›s
:

313 
f
.
ty³
 =ğ
ad_çmy
:

314 
£lf
.
add»ss_çm›s
.
	$»move
(
f
)

316 #H–³¸
şass
 
BGP
 
cÚfigu¿tiÚ


317 
şass
 
Bgp
:

319 
def
 
	$__š™__
(
£lf
, 
loÿl_as
, 
g¿ûful_»¡¬t
, 
ecmp
):

320 
£lf
.
loÿl_as
 =†ocal_as

321 
£lf
.
g¿ûful_»¡¬t
 = graceful_restart

322 
£lf
.
ecmp
 =ƒcmp

323 
£lf
.
ÃighbÜs
 = []

325 
def
 
	$add_ÃighbÜ
(
£lf
, 
afi
, 
_add»ss
, 
»mÙe_as
, 
k“p_®ive_time
=
NÚe
,

326 
hŞd_down_time
=
NÚe
, 
·sswÜd
=NÚe, 
upd©e_sourû
=None,

327 
max_hİ_lim™
=
NÚe
, 
g¿ûful_»¡¬t
=None):

328 
n
 
š
 
£lf
.
ÃighbÜs
:

329 
n
.
afi
 =ğaf˜
ªd
‚.
_add»ss
 == ip_address:

330 
n
.
»mÙe_as
 =„emote_as

331 
n
.
k“p_®ive_time
 = keep_alive_time

332 
n
.
hŞd_down_time
 = hold_down_time

333 
n
.
·sswÜd
 =…assword

334 
n
.
upd©e_sourû
 = update_source

335 
n
.
max_hİ_lim™
 = max_hop_limit

336 
n
.
g¿ûful_»¡¬t
 = graceful_restart

340 
ÃighbÜ
 = 
	$NeighbÜ
(
afi
, 
_add»ss
, 
»mÙe_as
, 
k“p_®ive_time
,

341 
hŞd_down_time
, 
·sswÜd
, 
upd©e_sourû
,

342 
max_hİ_lim™
, 
g¿ûful_»¡¬t
)

343 
£lf
.
ÃighbÜs
.
	$­³nd
(
ÃighbÜ
)

344  
ÃighbÜ


346 
def
 
	$g‘_ÃighbÜ
(
£lf
, 
afi
, 
_add»ss
):

347 
n
 
š
 
£lf
.
ÃighbÜs
:

348 
n
.
afi
 =ğaf˜
ªd
‚.
_add»ss
.
v4
 == ip_address.ipv4:

349  
n


351 
def
 
	$d–_ÃighbÜ
(
£lf
, 
afi
, 
_add»ss
):

352 
n
 
š
 
£lf
.
ÃighbÜs
:

353 
n
.
afi
 =ğaf˜
ªd
‚.
_add»ss
 == ip_address:

354 
£lf
.
ÃighbÜs
.
	$»move
(
n
)

357 
def
 
	$_´št_bgp_glob®_cfg
(
bgp_cfg
, 
loÿl_as_no
, 
rou‹r_id
, 
ecmp_·th
,

358 
gr_’abË
):

359 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('rou‹¸bg°' + 
	`¡r
(
loÿl_as_no
) + '\n')

360 
rou‹r_id
 !ğ
NÚe
:

361 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('bg°rou‹r-id ' + 
	`IpAdd»ssMsg_to_¡r
(

362 
rou‹r_id
) + ' \n')

363 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('no bgp‚etwork import-check\n')

364 
ecmp_·th
 > 1:

365 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('maximum-·th ' + 
	`¡r
(
ecmp_·th
) + '\n')

366 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('bgp fast-external-failover\n')

367 
bgp_cfg
.
bgp_glob®
.
	`wr™e
('bgp†og-neighbor-changes\n')

368 
gr_’abË
:

369 
bgp_cfg
.
bgp_glob®
.
	`wr™e
(' bgp graceful-restart\n')

371 
def
 
	$_´št_bgp_add»ss_çmy_cfg
(
bgp_cfg
, 
Ãigh_
, 
addr_çmy
):

372 
out_f‹r_Ü_rm­
 = 
F®£


373 
Ãigh_cxt
 = 'ÃighbÜ ' + 
Ãigh_
 + ' '

375 #Ãxt-
hİ
-
£lf


376 
addr_çmy
.
Ãxt_hİ_£lf
 !ğ
F®£
:

377 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(

378 
Ãigh_cxt
 + 'next-hop-self' '\n')

380 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(
Ãigh_cxt
 + 'activate\n')

383 
addr_çmy
.
f‹r_š_´efix_li¡
 !ğ
NÚe
:

384 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(

385 
Ãigh_cxt
 + '´efix-li¡ ' + 
addr_çmy
.
f‹r_š_´efix_li¡
 + ' in\n')

387 
addr_çmy
.
f‹r_out_´efix_li¡
 !ğ
NÚe
:

388 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(

389 
Ãigh_cxt
 + '´efix-li¡ ' + 
addr_çmy
.
f‹r_out_´efix_li¡
 + ' out\n')

390 
out_f‹r_Ü_rm­
 = 
True


392 
addr_çmy
.
f‹r_š_rm­
 !ğ
NÚe
:

393 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(

394 
Ãigh_cxt
 + 'rou‹-m­ ' + 
addr_çmy
.
f‹r_š_rm­
 + ' in\n')

396 
addr_çmy
.
f‹r_out_rm­
 !ğ
NÚe
:

397 
bgp_cfg
.
bgp_add»ss_çmy
[
addr_çmy
.
ty³
].
	`wr™e
(

398 
Ãigh_cxt
 + 'rou‹-m­ ' + 
addr_çmy
.
f‹r_out_rm­
 + ' out\n')

399 
out_f‹r_Ü_rm­
 = 
True


401 
nÙ
 
out_f‹r_Ü_rm­
 
ªd
 
bgp_cfg
.
as_·th_´•’d
:

402 
addr_çmy
.
ty³
 =ğ
IPv4_UNICAST
:

403 
bgp_cfg
.
bgp_add»ss_çmy
[
IPv4_UNICAST
].
	`wr™e
(

404 
Ãigh_cxt
 + '„ou‹-m­ ' + 
AS_PREPEND_RMAP_V4
 + ' out\n')

405 
addr_çmy
.
ty³
 =ğ
IPv6_UNICAST
:

406 
bgp_cfg
.
bgp_add»ss_çmy
[
IPv6_UNICAST
].
	`wr™e
(

407 
Ãigh_cxt
 + '„ou‹-m­ ' + 
AS_PREPEND_RMAP_V6
 + ' out\n')

409 
def
 
	$_´št_bgp_ÃighbÜs_cfg
(
bgp_cfg
, 
ÃighbÜ
):

410 
Ãigh_
 = 
	$IpAdd»ssMsg_to_¡r
(
ÃighbÜ
.
_add»ss
)

411 
Ãigh_cxt
 = 'ÃighbÜ ' + 
Ãigh_
 + ' '

412 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

413 
Ãigh_cxt
 + '»mÙe-a ' + 
	`¡r
(
ÃighbÜ
.
»mÙe_as
) + '\n')

415 #bg°
ÃighbÜ
 
a
.
b
.
c
.
d
 
g¿ûful
-
»¡¬t


416 
ÃighbÜ
.
g¿ûful_»¡¬t
 !ğ
NÚe
:

417 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

418 
Ãigh_cxt
 + 
	`¡r
(
ÃighbÜ
.
g¿ûful_»¡¬t
) + '\n')

420 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(
Ãigh_cxt
 + 'activate\n')

421 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(
Ãigh_cxt
 + 'disable-connected-check\n')

422 
ÃighbÜ
.
upd©e_sourû
 !ğ
NÚe
:

423 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

424 
Ãigh_cxt
 + 'upd©e-sourû_lšk ' + 
ÃighbÜ
.
upd©e_sourû
 + ' \n')

425 
k“p_®ive
 = '60'

426 
hŞd_down
 = '180'

427 
ÃighbÜ
.
k“p_®ive_time
 
ªd
‚eighbÜ.
hŞd_down_time
:

428 
k“p_®ive
 = 
	$¡r
(
ÃighbÜ
.
k“p_®ive_time
)

429 
hŞd_down
 = 
	$¡r
(
ÃighbÜ
.
hŞd_down_time
)

430 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

431 
Ãigh_cxt
 + 'tim” ' + 
k“p_®ive
 + ' ' + 
hŞd_down
 + '\n')

432 
ÃighbÜ
.
·sswÜd
 !ğ
NÚe
:

433 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

434 
Ãigh_cxt
 + '·sswÜd ' + 
ÃighbÜ
.
·sswÜd
 + '\n')

435 
ÃighbÜ
.
max_hİ_lim™
 > 1:

436 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(

437 
Ãigh_cxt
 + 'ebgp-muÉihİ ' + 
	`¡r
(
ÃighbÜ
.
max_hİ_lim™
) + '\n')

438 
bgp_cfg
.
bgp_ÃighbÜs
.
	`wr™e
(
Ãigh_cxt
 + 'enforce-multihop\n')

439 
addr_çmy
 
š
 
ÃighbÜ
.
add»ss_çm›s
:

440 
addr_çmy
.
ty³
 
nÙ
 
š
 [
IPv4_UNICAST
, 
IPv6_UNICAST
, 
VPNv4_UNICAST
]:

441 
logg”
.
	`”rÜ
('unsupported‡ddress family')

442  
F®£


443 
addr_çmy
.
ty³
 =ğ
VPNv4_UNICAST
 
ªd
 
nÙ
‡ddr_çmy.
’abËd
:

444 
logg”
.
	`”rÜ
('vpnv4 family is‚otƒnabled')

445  
F®£


446 
	$_´št_bgp_add»ss_çmy_cfg
(
bgp_cfg
, 
Ãigh_
, 
addr_çmy
)

449 
def
 
	$_´št_v6_´efix_li¡
(
bgp_cfg
, 
Çme
, 
aùiÚ
):

450 
bgp_cfg
.
´efix_li¡s
.
	`wr™e
('v6…»fix-li¡ ' + 
Çme
 + ' ' + 
aùiÚ
 + '\n')

452 
def
 
	$_´št_as_´•ªd_acûss_li¡
(
bgp_cfg
):

453 
	`_´št_v6_´efix_li¡
(
bgp_cfg
, 
IPV6_PREFIXLIST_RSVD1
, 'permit‡ny')

455 
def
 
	$_´št_as_´•ªd_rm­
(
bgp_cfg
, 
loÿl_as
, 
»³©
 = 3):

456 
as_´•’d
 = (
	`¡r
(
loÿl_as
è+ ' 'è* 
»³©


457 
	$_´št_as_´•ªd_acûss_li¡
(
bgp_cfg
)

458 
bgp_cfg
.
rou‹_m­s
.
	`wr™e
('rou‹-m­ ' + 
AS_PREPEND_RMAP_V4
 + '…ermit 10\n')

459 
bgp_cfg
.
rou‹_m­s
.
	`wr™e
(

460 'm©ch i°add»s ' + 
IPV4_ACCESSLIST_NUMBER_RSVD1
 + '\n')

461 
bgp_cfg
.
rou‹_m­s
.
	`wr™e
('£ˆ‡s-·th…»³nd ' + 
as_´•’d
 + '\n')

462 
bgp_cfg
.
rou‹_m­s
.
	`wr™e
('rou‹-m­ ' + 
AS_PREPEND_RMAP_V6
 + '…ermit 10\n')

463 
bgp_cfg
.
rou‹_m­s
.
	`wr™e
('£ˆas-·th…»³nd ' + 
as_´•’d
 + '\n')

466 
def
 
	$Bgp_cfg
(
bgp_cfg
):

467 
nÙ
 
bgp_cfg
.
is_bgp_cÚfigu»d
:

468 
logg”
.
	`debug
('BGP is disabled')

470 
bgp
 = 
bgp_cfg
.
routšg_pb
.
bgp_cÚfig


471 
bgp_cfg
.
is_¡ªdby
:

472 
bgp_cfg
.
as_·th_´•’d
 = 
True


473 
	$_´št_as_´•ªd_rm­
(
bgp_cfg
, 
bgp
.
loÿl_as
)

474 
	`_´št_bgp_glob®_cfg
(
bgp_cfg
, 
bgp
.
loÿl_as
,

475 
bgp_cfg
.
routšg_pb
.
routšg_glob®
['router_id'],

476 
bgp
.
ecmp
, bgp.
g¿ûful_»¡¬t
)

477 
ÃighbÜ
 
š
 
bgp
.
ÃighbÜs
:

478 
	$_´št_bgp_ÃighbÜs_cfg
(
bgp_cfg
, 
ÃighbÜ
)

480 
def
 
	$»di¡_cfg
(
bgp_cfg
, 
ADDR_TYPE
):

482 
To
 
»di¡ribu‹
 
ªd
 
cÚÃùed
 
rou‹s
 
giv’
 
rou‹r
.

484 * `
bgp_cfg
` : 
bgp
 
cÚfig
 
fe
 
to
 
§ve
 
rou‹r
's bgp config

485 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/6

488 
Œy
:

489 
bgp_cfg
.
is_bgp_cÚfigu»d
:

490 
ADDR_TYPE
 == "ipv4":

491 
af_modif›r
 = 
IPv4_UNICAST


493 
af_modif›r
 = 
IPv6_UNICAST


494 
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_¡©ic
 =ğ
True
:

495 
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_¡©ic_rou‹_m­
 !ğ
NÚe
:

496 
bgp_cfg
.
bgp_add»ss_çmy
[
af_modif›r
].
	`wr™e
(

498 
	$fÜm©
(
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_¡©ic_rou‹_m­
))

500 
bgp_cfg
.
bgp_add»ss_çmy
[
af_modif›r
].
	`wr™e
(

503 
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_cÚÃùed
 =ğ
True
:

504 
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_cÚÃùed_rou‹_m­
 !ğ
NÚe
:

505 
bgp_cfg
.
bgp_add»ss_çmy
[
af_modif›r
].
	`wr™e
(

507 
	$fÜm©
(
bgp_cfg
.
routšg_pb
.
»di¡ribu‹_cÚÃùed_rou‹_m­
))

509 
bgp_cfg
.
bgp_add»ss_çmy
[
af_modif›r
].
	`wr™e
(

512 
exû±
 
Exû±iÚ
 
as
 
e
:

513 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

514 
logg”
.
	$”rÜ
(
”rÜmsg
)

515  
”rÜmsg


517  
True


519 #H–³¸
şass
 
Commun™y
 
li¡
 
cÚfigu¿tiÚ


520 
şass
 
Commun™y
:

521 
def
 
	$__š™__
(
£lf
, 
commun™y
, 
commun™y_ty³
, 
commun™y_aùiÚ
, 
commun™y_numb”
):

522 
£lf
.
commun™y
 = community

523 
£lf
.
commun™y_ty³
 = community_type

524 
£lf
.
commun™y_aùiÚ
 = community_action

525 
£lf
.
commun™y_numb”
 = community_number

527 
şass
 
Commun™yLi¡
:

528 
def
 
	$__š™__
(
£lf
, 
Çme
):

529 
£lf
.
comm_li¡_uuid_Çme
 = 
Çme


530 
£lf
.
commun™y
 = []

531 
def
 
	$add_commun™y
(
£lf
, 
commun™y
):

532 
£lf
.
commun™y
.
	$­³nd
(
commun™y
)

534 
şass
 
Ex´essiÚ
:

535 
def
 
	$__š™__
(
£lf
, 
m©ch_commun™y_sg_cÚd™iÚ
, 
»guÏr_ex´essiÚ
, 
commun™y_li¡
):

536 
£lf
.
»guÏr_ex´essiÚ
 =„egular_expression

537 
£lf
.
m©ch_commun™y_sg_cÚd™iÚ
 = match_community_sg_condition

538 
£lf
.
commun™y_li¡
 = community_list

540 
def
 
	$commun™y_li¡_cfg
(
bgp_cfg
):

541 
bgp_cfg
.
routšg_pb
.
commun™y_li¡s
 =ğ
NÚe
:

543 
commun™›s
 
š
 
bgp_cfg
.
routšg_pb
.
commun™y_li¡s
:

544 
Çme
 = 
commun™›s
.
comm_li¡_uuid_Çme


545 
commun™y
 
š
 
commun™›s
.community:

546 #Commun™y 
aùiÚ


547 
commun™y
.
commun™y_aùiÚ
 == 'PERMIT':

548 
aùiÚ
 = 'permit'

550 
aùiÚ
 = 'deny'

552 
bgp_cfg
.
commun™y_li¡
.
	`wr™e
(' '.
	`još
([

553 'bgp', 
	`¡r
(
commun™y
.commun™yè, sŒ(commun™y.
commun™y_ty³
), 
Çme
, 
aùiÚ
, sŒ(commun™y.
commun™y_numb”
), '\n']))

555 #The£ 
APIs
 
wl
 
u£d
 
by
 
‹¡ÿ£s


556 
def
 
	$fšd_ibgp_ªd_ebgp_³”s_š_tİŞogy
(
³”_ty³
, 
tİo
):

558 
It
 
wl
 
fšd
 
ebgp
/
ibgp
 
³”


560 * `
³”_ty³
` : 
ty³
 
of
 
bgp
 
ÃighbÜsh
, 
ebgp
/
ibgp


561 * `
tİo
` : 
jsÚ
 
fe
 
d©a


565 
³”s
 = {
	}
}

566 
rou‹r
, 
d©a
 
š
 
sÜ‹d
(
tİo
['rou‹rs'].
	$™”™ems
()):

567 
³”s_li¡
 = []

568 
ebgp_³”s_diù
 = {
	}
}

569 
ibgp_³”s_diù
 = {}

571 #³”s_li¡.
­³nd
(
rou‹r
)

572 
loÿl_as
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['local_as']

573 
ÃighbÜ
, 
d©a
 
š
 
	gtİo
['rou‹rs'][
rou‹r
]['bgp'][

574 'bgp_ÃighbÜs'].
	$™”™ems
():

575 
»mÙe_as
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['bgp_neighbors'][

576 
ÃighbÜ
]['remote_as']

577 
³”
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['bgp_ÃighbÜs'][
ÃighbÜ
][

580 
³”_ty³
 == "ibgp":

581 
loÿl_as
 =ğ
»mÙe_as
:

582 
³”s_li¡
.
	$­³nd
(
³”
)

583 
ibgp_³”s_diù
["ibgp_³”s"] = 
³”s_li¡


584 
³”s
[
rou‹r
] = 
ibgp_³”s_diù


586 
loÿl_as
 !ğ
»mÙe_as
:

587 
³”s_li¡
.
	$­³nd
(
³”
)

588 
ebgp_³”s_diù
["ebgp_³”s"] = 
³”s_li¡


589 
³”s
[
rou‹r
] = 
ebgp_³”s_diù


591  
³”s


593 
def
 
	$modify_d–‘e_rou‹r_id
(
aùiÚ
, 
šput_diù
, 
CWD
, 
tg’
, 
tİo
):

595 
Modify
 
Ü
 
d–‘e
 
rou‹r
-
id
 
a
 
giv’
„outer

597 * `
aùiÚ
 :‡ùiÚ 
to
 
be
 
³rfÜmed
, 
modify
/
d–‘e


598 * `
šput_diù
` : 
which
 
rou‹r
/
s
„ou‹r-
id
 
should
 
modif›d
 
Ü
 
d–‘ed


599 * `
CWD
` : 
ÿÎ”
's current working directory

600 * `
tg’
` : 
Tİog’
 
objeù


601 * `
tİo
` : 
jsÚ
 
fe
 
d©a


603 
logg”
.
	`šfo
("Entering†ib API: modify_delete_router_id()")

605 
Œy
:

606 
aùiÚ
 == 'modify':

607 
rou‹r
 
š
 
šput_diù
.
	$keys
():

608 #Re£ˆ
FRR
 
cÚfig


609 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

611 
rou‹r_id
 = 
šput_diù
[
rou‹r
]['router_id']

612 
rid
 = 
	`¡r
(
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
rou‹r_id
)))

613 
rou‹r_id
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
rid
, 
NÚe
)

615 
bgp_cfg
[
rou‹r
].
routšg_pb
.
routšg_glob®
['rou‹r_id'] = 
rou‹r_id


617 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

618 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

619 #Lßd 
cÚfig
 
to
 
rou‹r


620 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

621 
–if
 
aùiÚ
 == 'delete':

622 
rou‹r
 
š
 
šput_diù
["router_ids"]:

623 #Re£ˆ
FRR
 
cÚfig


624 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

626 
rou‹r_id
 = 
NÚe


627 
bgp_cfg
[
rou‹r
].
routšg_pb
.
routšg_glob®
['rou‹r_id'] = 
rou‹r_id


629 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

630 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

631 #Lßd 
cÚfig
 
to
 
rou‹r


632 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

634 
exû±
 
Exû±iÚ
 
as
 
e
:

635 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

636 
logg”
.
	$”rÜ
(
”rÜmsg
)

637  
”rÜmsg


639 
logg”
.
	`šfo
("Exiting†ib API: modify_delete_router_id()")

640  
True


642 
def
 
	$modify_bgp_tim”s
(
ADDR_TYPE
, 
šput_diù
, 
CWD
, 
tg’
, 
tİo
):

644 
Modify
 
admš
 
di¡ªû
 
giv’
 
rou‹
/
s


646 * `
ADDR_TYPE
` : 
_ty³
, 
v4
/
v6


647 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


648 * `
CWD
` : 
ÿÎ”
's current working directory

649 * `
tg’
` : 
Tİog’
 
objeù


650 * `
tİo
` : 
jsÚ
 
fe
 
d©a


652 
logg”
.
	`šfo
("Entering†ib API: modify_bgp_timers()")

654 
Œy
:

655 
rou‹r
 
š
 
šput_diù
.
	$keys
():

656 #Re£ˆ
cÚfig
 
rou‹rs


657 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

659 
ÃighbÜs
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.neighbors

660 
ÃighbÜ
 
š
 
ÃighbÜs
:

661 
bgp_ÃighbÜ
 
š
 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"].\

662 
	$keys
():

663 
k“·liv‘im”
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]\

664 [
bgp_ÃighbÜ
]["keepalivetimer"]

665 
hŞddowÁim”
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]\

666 [
bgp_ÃighbÜ
]["holddowntimer"]

668 #P“¸
d‘as


669 
³”
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]\

670 [
bgp_ÃighbÜ
]['peer']

671 
de¡_lšk
 = 
³”
['dest_link']

673 #Loİback 
š‹rçû


674 "sourû_lšk" 
š
 
³”
 
ªd
…eer['source_link'] == 'lo':

675 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][
ADDR_TYPE
].\

676 
	`¥l™
('/')[0]

678 #PhysiÿÈ
š‹rçû


679 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'].\

680 
	$™”™ems
():

681 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

682 
ÃighbÜ_
 = \

683 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lšks'][
de¡Rou‹rLšk
[0]]\

684 [
ADDR_TYPE
].
	`¥l™
("/")[0]

686 
	`IpAdd»ssMsg_to_¡r
(
ÃighbÜ
.
_add»ss
è=ğ
ÃighbÜ_
:

687 
ÃighbÜ
.
k“p_®ive_time
 = 
	$¡r
(
k“·liv‘im”
)

688 
ÃighbÜ
.
hŞd_down_time
 = 
	$¡r
(
hŞddowÁim”
)

690 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

691 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

692 #Lßd 
cÚfig
 
to
 
rou‹r


693 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

695 
exû±
 
Exû±iÚ
 
as
 
e
:

696 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

697 
logg”
.
	$”rÜ
(
”rÜmsg
)

698  
”rÜmsg


700 
logg”
.
	`šfo
("Exiting†ib API: modify_bgp_timers()")

701  
True


703 
def
 
	$adv”ti£_ÃtwÜks_usšg_ÃtwÜk_commªd
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
,

704 
tİo
):

706 
Adv”ti£
 
ÃtwÜk
 
usšg
‚‘wÜk 
commªd


708 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/6

709 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


710 * `
CWD
` : 
ÿÎ”
's current working directory

711 * `
tg’
` : 
Tİog’
 
objeù


712 * `
tİo
` : 
jsÚ
 
fe
 
d©a


714 
logg”
.
	`šfo
("Entering†ib API:‡dvertise_networks_using_network_command()")

716 
Œy
:

717 
rou‹r
 
š
 
šput_diù
.
	$keys
():

718 
ÃtwÜks
 = []

720 #Re£ˆ
cÚfig
 
rou‹rs


721 #bgp_cfg[
rou‹r
].
	`»£t_™
()

723 
adv”ti£_ÃtwÜk
 = 
šput_diù
[
rou‹r
]['advertise_networks']

724 
adv”ti£_ÃtwÜk_diù
 
š
 
adv”ti£_ÃtwÜk
:

725 
¡¬t_
 = 
adv”ti£_ÃtwÜk_diù
['start_ip']

726 'no_of_ÃtwÜk' 
š
 
adv”ti£_ÃtwÜk_diù
:

727 
no_of_ÃtwÜk
 = 
adv”ti£_ÃtwÜk_diù
['no_of_network']

729 
no_of_ÃtwÜk
 = 0

731 
ÃtwÜk_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
¡¬t_
, 
no_of_ÃtwÜk
)

732 

 
š
 
ÃtwÜk_li¡
:

733 

 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(

)))

734 
ADDR_TYPE
 == "ipv4":

735 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 

, 
NÚe
)

737 
bgp_cfg
[
rou‹r
].
bgp_add»ss_çmy
[
IPv4_UNICAST
].
	`wr™e
(

738 'ÃtwÜk ' + 
	`IpAdd»ssMsg_to_¡r
(
addr
) + '\n')

740 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 

)

742 
bgp_cfg
[
rou‹r
].
bgp_add»ss_çmy
[
IPv6_UNICAST
].
	`wr™e
(

743 'ÃtwÜk ' + 
	`IpAdd»ssMsg_to_¡r
(
addr
) + '\n')

745 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

746 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

747 #Lßd 
cÚfig
 
to
 
rou‹r


748 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

750 
exû±
 
Exû±iÚ
 
as
 
e
:

751 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

752 
logg”
.
	$”rÜ
(
”rÜmsg
)

753  
”rÜmsg


755 
logg”
.
	`šfo
("Exiting†ib API:‡dvertise_networks_using_network_command()")

756  
True


760 
def
 
	$cÚfigu»_g¿ûful_»¡¬t
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

762 
cÚfigu»_g¿ûful_»¡¬t


764 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/6

765 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


766 * `
tg’
` : 
Tİog’
 
objeù


767 * `
CWD
` : 
ÿÎ”
's current working directory

768 * `
tİo
` : 
jsÚ
 
fe
 
d©a


771 
logg”
.
	`šfo
("Entering†ib API: configure_graceful_restart()")

773 
Œy
:

774 
rou‹r
 
š
 
šput_diù
.
	$keys
():

775 
ÃtwÜks
 = []

777 #Re£ˆ
cÚfig
 
rou‹rs


778 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

780 
ÃighbÜs
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]

781 
ÃighbÜ
 
š
 
ÃighbÜs
.
	$keys
():

782 
g¿ûful_»¡¬t
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_ÃighbÜs"][
ÃighbÜ
]['graceful-restart']

784 #loİback 
š‹rçû


785 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]

786 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer'] \

787 
ªd
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']['source_link'] == 'lo':

788 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['lo'][

789 
ADDR_TYPE
].
	`¥l™
("/")[0]

791 #PhysiÿÈ
š‹rçû


792 #P“¸
D‘as


793 
³”
 = 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']

794 
de¡_lšk
 = 
³”
['dest_link']

796 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
ÃighbÜ
]['links'].\

797 
	$™”™ems
():

798 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

799 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['links'][

800 
de¡Rou‹rLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

802 
li¡_of_ÃighbÜs
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
ÃighbÜs


803 
n
 
š
 
li¡_of_ÃighbÜs
:

804 
	`IpAdd»ssMsg_to_¡r
(
n
.
_add»ss
è=ğ
ÃighbÜ_
:

805 
n
.
g¿ûful_»¡¬t
 = 
	$¡r
(
g¿ûful_»¡¬t
)

808 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

809 
	$»di¡_cfg
(
bgp_cfg
[
rou‹r
], 
ADDR_TYPE
)

810 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

811 #Lßd 
cÚfig
 
to
 
rou‹r


812 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

814 
exû±
 
Exû±iÚ
 
as
 
e
:

815 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

816 
logg”
.
	$”rÜ
(
”rÜmsg
)

817  
”rÜmsg


819 
logg”
.
	`šfo
("Exiting†ib API: configure_graceful_restart()")

820  
True


822 
def
 
	$modify_AS_numb”
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

824 
Modify
 
exi¡šg
 
AS
 
numb”


826 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/6

827 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


828 * `
tg’
` : 
Tİog’
 
objeù


829 * `
CWD
` : 
ÿÎ”
's current working directory

830 * `
tİo
` : 
jsÚ
 
fe
 
d©a


833 
logg”
.
	`šfo
("Entering†ib API: modify_AS_number()")

835 
Œy
:

836 
rou‹r
 
š
 
šput_diù
.
	$keys
():

837 
ÃtwÜks
 = []

839 #Re£ˆ
cÚfig
 
rou‹rs


840 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

842 
loÿl_as
 = 
šput_diù
[
rou‹r
]["local_as"]

843 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
loÿl_as
 =†ocal_as

844 
ÃighbÜs
 = 
šput_diù
[
rou‹r
]["bgp_neighbors"]

845 
ÃighbÜ
 
š
 
ÃighbÜs
.
	$keys
():

846 
»mÙe_as
 = 
šput_diù
[
rou‹r
]["bgp_ÃighbÜs"][
ÃighbÜ
]['remote_as']

848 #loİback 
š‹rçû


849 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]

850 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer'] \

851 
ªd
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']['source_link'] == 'lo':

852 
_add»ss
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['lo'][

853 
ADDR_TYPE
].
	`¥l™
("/")[0]

855 #PhysiÿÈ
š‹rçû


856 #P“¸
D‘as


857 
³”
 = 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']

858 
de¡_lšk
 = 
³”
['dest_link']

860 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
ÃighbÜ
]['links'].\

861 
	$™”™ems
():

862 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

863 
_add»ss
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['links'][

864 
de¡Rou‹rLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

866 
ÃighbÜs
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.neighbors

867 
n
 
š
 
ÃighbÜs
:

868 
ADDR_TYPE
 == 'ipv4':

869 
n
.
_add»ss
.
v4
 == ip_address:

870 
n
.
»mÙe_as
 =„emote_as

872 
n
.
_add»ss
.
v6
 == ip_address:

873 
n
.
»mÙe_as
 =„emote_as

875 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

876 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

877 #Lßd 
cÚfig
 
to
 
rou‹r


878 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

880 
exû±
 
Exû±iÚ
 
as
 
e
:

881 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

882 
logg”
.
	$”rÜ
(
”rÜmsg
)

883  
”rÜmsg


885 
logg”
.
	`šfo
("Exiting†ib API: modify_AS_number()")

886  
True


888 
def
 
	$»di¡ribu‹_¡©ic_rou‹s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

890 
»di¡ribu‹
 
Ü
 
cÚÃùed
 
rou‹s
 o¸
ÃtwÜks


892 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/6

893 * `
šput_diù
` : 
which
 
rou‹r
 
rou‹s
 
has
 
to
 
be
 
»di¡ribu‹d
 
as
 

894 
Ü
 
cÚÃùed


895 * `
tg’
` : 
Tİog’
 
objeù


896 * `
CWD
` : 
ÿÎ”
's current working directory

897 * `
tİo
` : 
jsÚ
 
fe
 
d©a


900 
logg”
.
	`šfo
("Entering†ib API:„edistribute_static_routes_to_bgp()")

902 
Œy
:

903 
glob®
 
bgp_cfg


904 
rou‹r
 
š
 
šput_diù
.
	$keys
():

905 "»di¡ribu‹" 
š
 
šput_diù
[
rou‹r
]:

906 
ÃtwÜks
 = []

908 #Re£ˆ
cÚfig
 
rou‹rs


909 #bgp_cfg[
rou‹r
].
	`»£t_™
()

911 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_¡©ic_rou‹_m­
 = 
NÚe


912 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_cÚÃùed_rou‹_m­
 = 
NÚe


914 
»di¡
 = 
šput_diù
[
rou‹r
]['redistribute']

915 
»di¡_diù
 
š
 
»di¡
:

916 
key
, 
v®ue
 
š
 
»di¡_diù
.
	$™ems
():

917 
key
 == 'static':

918 
v®ue
 =ğ
True
 
Ü
 value == "true":

919 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_¡©ic
 =\

920 
True


921 
	$isš¡ªû
(
v®ue
, 
diù
):

922 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_¡©ic_rou‹_m­
 =\

923 
v®ue
['route-map']

924 
key
 == 'connected':

925 
v®ue
 =ğ
True
 
Ü
 value == "true":

926 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_cÚÃùed
 =\

927 
True


928 
	$isš¡ªû
(
v®ue
, 
diù
):

929 
bgp_cfg
[
rou‹r
].
routšg_pb
.
»di¡ribu‹_cÚÃùed_rou‹_m­
 =\

930 
v®ue
['route-map']

932 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

933 
	$»di¡_cfg
(
bgp_cfg
[
rou‹r
], 
ADDR_TYPE
)

934 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

935 #Lßd 
cÚfig
 
to
 
rou‹r


936 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

938 
exû±
 
Exû±iÚ
 
as
 
e
:

939 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

940 
logg”
.
	$”rÜ
(
”rÜmsg
)

941  
”rÜmsg


943 
logg”
.
	`šfo
("Exiting†ib API:„edistribute_static_routes_to_bgp()")

944  
True


946 
def
 
	$cÚfigu»_bgp_ÃighbÜs
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

948 
cÚfigu»
 
bgp
 
ÃighbÜs
 
´efix
 
li¡s


950 * `
ADDR_TYPE
` : 

 
ty³
 
v4
/
v6


951 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


952 * `
tg’
` : 
Tİog’
 
objeù


953 * `
CWD
` : 
ÿÎ”
's current working directory

954 * `
tİo
` : 
jsÚ
 
fe
 
d©a


956 
logg”
.
	`šfo
("Entering†ib API: configure_bgp_neighbors()")

958 
Œy
:

959 
rou‹r
 
š
 
šput_diù
.
	$keys
():

960 
ÃighbÜ
 
š
 
šput_diù
[
rou‹r
]['ÃighbÜ_cÚfig'].
	$keys
():

961 #Re£ˆ
cÚfig
 
rou‹rs


962 #bgp_cfg[
rou‹r
].
	`»£t_™
()

964 #Loİback 
š‹rçû


965 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]

966 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer'] \

967 
ªd
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']['source_link'] == 'lo':

968 
nh_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['lo'][

969 
ADDR_TYPE
].
	`¥l™
("/")[0]

972 #PhysiÿÈ
š‹rçû


973 #P“¸
d‘as


974 
³”
 = 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']

975 
de¡_lšk
 = 
³”
['dest_link']

977 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
ÃighbÜ
]['links'].\

978 
	$™”™ems
():

979 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

980 
nh_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['links'][

981 
de¡Rou‹rLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

983 #Aµly 
´efix
-
li¡
 
to
 
BGP
 
ÃighbÜ


984 
nb_cÚfig
 = 
šput_diù
[
rou‹r
]['neighbor_config']

985 "´efix_li¡" 
š
 
nb_cÚfig
[
ÃighbÜ
]:

986 
´efix_li¡
 
š
 
nb_cÚfig
[
ÃighbÜ
]['´efix_li¡'].
	$keys
():

987 
dœeùiÚ
 = 
nb_cÚfig
[
ÃighbÜ
]['´efix_li¡'][
´efix_li¡
]

989 
ADDR_TYPE
 == "ipv4":

990 
af_modif›r
 = 
IPv4_UNICAST


991 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
nh_
, 
NÚe
)

993 
af_modif›r
 = 
IPv6_UNICAST


994 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 
nh_
)

996 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.\

997 
	$g‘_ÃighbÜ
(
IPv4_UNICAST
, 
addr
)

998 
dœeùiÚ
 == 'IN':

999 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
,

1000 
´efix_li¡
, 
NÚe
,

1001 
NÚe
, None)

1002 
dœeùiÚ
 == 'OUT':

1003 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
,

1004 
NÚe
, 
´efix_li¡
,

1005 
NÚe
, None)

1007 #Aµly 
rou‹
 
m­
 
to
 
BGP
 
ÃighbÜ


1008 
–if
 "rou‹_m­" 
š
 
nb_cÚfig
[
ÃighbÜ
]:

1009 
rou‹_m­
 
š
 
nb_cÚfig
[
ÃighbÜ
]['rou‹_m­'].
	$keys
():

1010 
dœeùiÚ
 = 
nb_cÚfig
[
ÃighbÜ
]['rou‹_m­'][
rou‹_m­
]

1012 
ADDR_TYPE
 == "ipv4":

1013 
af_modif›r
 = 
IPv4_UNICAST


1014 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
nh_
, 
NÚe
)

1016 
af_modif›r
 = 
IPv6_UNICAST


1017 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 
nh_
)

1019 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.\

1020 
	$g‘_ÃighbÜ
(
af_modif›r
, 
addr
)

1021 
dœeùiÚ
 == 'IN':

1022 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
,

1023 
NÚe
, NÚe, 
rou‹_m­
,

1024 
NÚe
)

1025 
dœeùiÚ
 == 'OUT':

1026 
ÃighbÜ
.
	$add_add»ss_çmy
(
af_modif›r
, 
True
,

1027 
NÚe
, None, None,

1028 
rou‹_m­
)

1030 #Aµly 
Ãxt
-
hİ
-
£lf
 
to
 
bgp
 
ÃighbÜs


1031 
–if
 "Ãxt_hİ_£lf" 
š
 
šput_diù
[
rou‹r
]['neighbor_config']\

1032 [
ÃighbÜ
]:

1033 
nh_£lf
 = 
šput_diù
[
rou‹r
]['ÃighbÜ_cÚfig'][
ÃighbÜ
]\

1036 
ADDR_TYPE
 == "ipv4":

1037 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
nh_
, 
NÚe
)

1038 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
	`g‘_ÃighbÜ
(\

1039 
IPv4_UNICAST
, 
addr
)

1040 
ÃighbÜ
.
	`add_add»ss_çmy
(
IPv4_UNICAST
, 
True
, 
NÚe
, None,\

1041 
NÚe
, NÚe, 
Ãxt_hİ_£lf
 = 
nh_£lf
)

1043 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 
nh_
)

1044 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
	`g‘_ÃighbÜ
(\

1045 
IPv6_UNICAST
, 
addr
)

1046 
ÃighbÜ
.
	`add_add»ss_çmy
(
IPv6_UNICAST
, 
True
, 
NÚe
, None,\

1047 
NÚe
, NÚe, 
Ãxt_hİ_£lf
 = 
nh_£lf
)

1049 #Aµly 
no
 
£nd
-
commun™y


1050 
–if
 "Ãxt_hİ_£lf" 
š
 
šput_diù
[
rou‹r
]['neighbor_config']\

1051 [
ÃighbÜ
]:

1052 
nh_£lf
 = 
šput_diù
[
rou‹r
]['ÃighbÜ_cÚfig'][
ÃighbÜ
]\

1055 
ADDR_TYPE
 == "ipv4":

1056 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
nh_
, 
NÚe
)

1057 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
	`g‘_ÃighbÜ
(\

1058 
IPv4_UNICAST
, 
addr
)

1059 
ÃighbÜ
.
	`add_add»ss_çmy
(
IPv4_UNICAST
, 
True
, 
NÚe
, None,\

1060 
NÚe
, NÚe, 
Ãxt_hİ_£lf
 = 
nh_£lf
)

1062 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 
nh_
)

1063 
ÃighbÜ
 = 
bgp_cfg
[
rou‹r
].
routšg_pb
.
bgp_cÚfig
.
	`g‘_ÃighbÜ
(\

1064 
IPv6_UNICAST
, 
addr
)

1065 
ÃighbÜ
.
	`add_add»ss_çmy
(
IPv6_UNICAST
, 
True
, 
NÚe
, None,\

1066 
NÚe
, NÚe, 
Ãxt_hİ_£lf
 = 
nh_£lf
)

1068 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

1069 
	$»di¡_cfg
(
bgp_cfg
[
rou‹r
], 
ADDR_TYPE
)

1070 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

1071 #Lßd 
cÚfig
 
to
 
rou‹r


1072 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1074 
exû±
 
Exû±iÚ
 
as
 
e
:

1075 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1076 
logg”
.
	$”rÜ
(
”rÜmsg
)

1077  
”rÜmsg


1079 
logg”
.
	`šfo
("Exiting†ib API: configure_bgp_neighbors()")

1080  
True


1082 
def
 
	$ü—‹_commun™y_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1084 
C»©e
 
commun™y
 
li¡s


1086 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1087 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


1088 * `
tg’
` : 
Tİog’
 
objeù


1089 * `
CWD
` : 
ÿÎ”
's current working directory

1090 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1092 
logg”
.
	`šfo
("Entering†ib API: create_community_lists()")

1094 
Œy
:

1095 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1096 "commun™y-li¡" 
š
 
šput_diù
[
rou‹r
] 
Ü
 \

1097 "Ïrge-commun™y-li¡" 
š
 
šput_diù
[
rou‹r
]:

1099 #Re£ˆ
cÚfig
 
rou‹rs


1100 
bgp_cfg
[
rou‹r
].
	$»£t_™
()

1102 
comm_li¡
 
š
 
šput_diù
[
rou‹r
].
	$keys
():

1103 
comm_ty³
 
š
 
šput_diù
[
rou‹r
][
comm_li¡
].
	$keys
():

1104 
comm_Çme
 
š
 
šput_diù
[
rou‹r
][
comm_li¡
][
comm_ty³
].\

1105 
	$keys
():

1107 
comm
 
š
 
bgp_cfg
[
rou‹r
].
routšg_pb
.
commun™y_li¡s
:

1108 
comm
.
comm_li¡_uuid_Çme
 =ğ
comm_Çme
:

1109 
”rÜmsg
 = ("Community†ist is‡lreadyƒxists")

1110  
”rÜmsg


1112 
comm_diù
 
š
 
šput_diù
[
rou‹r
][
comm_li¡
][
comm_ty³
]\

1113 [
comm_Çme
]:

1115 
comm_aùiÚ
 = 
comm_diù
["action"]

1116 
comm_©Œibu‹
 = 
comm_diù
["attribute"]

1118 
comm
 = 
	$Commun™yLi¡
(
comm_Çme
)

1119 
commun™y
 = 
	`Commun™y
(
comm_li¡
, 
comm_ty³
, 
comm_aùiÚ
,\

1120 
comm_©Œibu‹
)

1121 
comm
.
	$add_commun™y
(
commun™y
)

1123 
bgp_cfg
[
rou‹r
].
routšg_pb
.
commun™y_li¡s
.
	$­³nd
(
comm
)

1125 
	$Bgp_cfg
(
bgp_cfg
[
rou‹r
])

1126 
	$»di¡_cfg
(
bgp_cfg
[
rou‹r
], 
ADDR_TYPE
)

1127 
	$commun™y_li¡_cfg
(
bgp_cfg
[
rou‹r
])

1128 
bgp_cfg
[
rou‹r
].
	$´št_bgp_cÚfig_to_fe
(
tİo
)

1129 #Lßd 
cÚfig
 
to
 
rou‹r


1130 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1132 
exû±
 
Exû±iÚ
 
as
 
e
:

1133 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1134 
logg”
.
	$”rÜ
(
”rÜmsg
)

1135  
”rÜmsg


1137 
logg”
.
	`šfo
("Exiting†ib API: create_community_lists()")

1138  
True


1140 ## 
V”ifiÿtiÚ
 
APIs


1141 
def
 
	$v”ify_rou‹r_id
(
šput_diù
, 
tg’
, 
tİo
):

1143 
This
 
API
 
is
 
to
 
v”ify
 
rou‹r
-
id
 
ªy
„outer.

1145 * `
šput_diù
`: 
šput
 
diùiÚ¬y
, 
have
 
d‘as
 
of
 
Deviû
 
Und”
 
Te¡
, 

1146 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


1147 * `
tg’
`: 
tİog’
 
objeù


1148 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1150 
logg”
.
	`šfo
("Entering†ib API: verify_router_id()")

1152 "rou‹r_ids" 
š
 
šput_diù
:

1153 
dut
 
š
 
šput_diù
["router_ids"]:

1154 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1155 
rou‹r
 !ğ
dut
:

1158 
logg”
.
	`šfo
('Checkšg„ou‹¸{}„ou‹r-id'.
	$fÜm©
(
rou‹r
))

1159 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show i°bg°jsÚ", 
isjsÚ
=
True
)

1160 
rou‹r_id_out
 = 
show_bgp_jsÚ
["routerId"]

1161 
rou‹r_id_out
 = 
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
rou‹r_id_out
))

1163 #Onû 
rou‹r
-
id
 
is
 
d–‘ed
, 
highe¡
 
š‹rçû
 

 
should
 
become


1164 #rou‹r-
id


1165 
rou‹r_id
 = 
	`fšd_š‹rçû_w™h_g»©”_
('v4', 
tİo
, 
dut
)

1166 
rou‹r_id
 = 
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
rou‹r_id
))

1168 
rou‹r_id
 =ğ
rou‹r_id_out
:

1169 
logg”
.
	`šfo
("Foundƒxpected„outer-id {} for„outer {} \n".

1170 
	$fÜm©
(
rou‹r_id
, 
rou‹r
))

1172 
”rÜmsg
 = "Router-id for„outer:{} mismatch,ƒxpected:{}"\

1173 " buˆfound:{}".
	$fÜm©
(
rou‹r
, 
rou‹r_id
,

1174 
rou‹r_id_out
)

1175  
”rÜmsg


1177 
dut
 
š
 
šput_diù
.
	$keys
():

1178 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1179 
rou‹r
 !ğ
dut
:

1182 
logg”
.
	`šfo
('Checkšg„ou‹¸{}„ou‹r-id'.
	$fÜm©
(
rou‹r
))

1183 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show i°bg°jsÚ", 
isjsÚ
=
True
)

1184 
rou‹r_id_out
 = 
show_bgp_jsÚ
["routerId"]

1185 
rou‹r_id_out
 = 
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
rou‹r_id_out
))

1187 
rou‹r_id
 = 
šput_diù
[
rou‹r
]['router_id']

1188 
rou‹r_id
 = 
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
rou‹r_id
))

1190 
rou‹r_id
 =ğ
rou‹r_id_out
:

1191 
logg”
.
	`šfo
("Foundƒxpected„outer-id {} for„outer {} \n".

1192 
	$fÜm©
(
rou‹r_id
, 
rou‹r
))

1194 
”rÜmsg
 = "Router-id for„outer:{} mismatch,ƒxpected:{}"\

1195 " buˆfound:{}".
	$fÜm©
(
rou‹r
, 
rou‹r_id
,

1196 
rou‹r_id_out
)

1197  
”rÜmsg


1199 
logg”
.
	`šfo
("Exiting†ib API: verify_router_id()")

1200  
True


1203 ## 
V”ifiÿtiÚ
 
API
 
g¿ûful
 
»¡¬t


1204 
def
 
	$v”ify_g¿ûful_»¡¬t
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
tİo
, 
dut
):

1206 
This
 
API
 
is
 
to
 
v”ify
 
v”ify_g¿ûful_»¡¬t
 
ªy
 
rou‹r
.

1208 * `
šput_diù
`: 
šput
 
diùiÚ¬y
, 
have
 
d‘as
 
of
 
Deviû
 
Und”
 
Te¡
, 

1209 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


1210 * `
tg’
`: 
tİog’
 
objeù


1211 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1213 
logg”
.
	`šfo
("Entering†ib API: verify_graceful_restart()")

1216 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1217 
rou‹r
 !ğ
dut
:

1220 
ÃighbÜs
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]

1221 
ÃighbÜ
 
š
 
ÃighbÜs
.
	$keys
():

1222 
g¿ûful_»¡¬t
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_ÃighbÜs"][
ÃighbÜ
]['graceful-restart']

1224 #loİback 
š‹rçû


1225 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]

1226 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer'] \

1227 
ªd
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']['source_link'] == 'lo':

1228 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['lo'][

1229 
ADDR_TYPE
].
	`¥l™
("/")[0]

1231 #PhysiÿÈ
š‹rçû


1232 #P“¸
D‘as


1233 
³”
 = 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']

1234 
de¡_lšk
 = 
³”
['dest_link']

1236 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
ÃighbÜ
]['links'].\

1237 
	$™”™ems
():

1238 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

1239 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['links'][

1240 
de¡Rou‹rLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1242 
logg”
.
	`šfo
('Checkšg bg°g¿ûful-»¡¬ˆshow o/° {}'.
	$fÜm©
(
ÃighbÜ_
))

1244 
show_bgp_g¿ûful_jsÚ
 = 
NÚe


1246 
	`´št
("rou‹r..................", 
rou‹r
)

1247 
show_bgp_g¿ûful_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°{}‚eighbÜ {} g¿ûful-»¡¬ˆjsÚ".
	`fÜm©
(
ADDR_TYPE
,
ÃighbÜ_
), 
isjsÚ
=
True
)

1249 
	`´št
('show_bgp_g¿ûful_jsÚ',
show_bgp_g¿ûful_jsÚ
)

1251 
show_bgp_g¿ûful_jsÚ_out
 = 
show_bgp_g¿ûful_jsÚ
[
ÃighbÜ_
]

1253 
logg”
.
	`šfo
("<<<<<<<<<<<<<<")

1255 
show_bgp_g¿ûful_jsÚ_out
["ÃighbÜAddr"] =ğ
ÃighbÜ_
 :

1256 
logg”
.
	`šfo
('NighbÜ i°maùhed {}'.
	$fÜm©
(
ÃighbÜ_
))

1258 
logg”
.
	`”rÜ
('Nighbor ip NOT‡ macth {}')

1259  
F®£


1261 
šput_diù
["r1"]["bgp"]["bgp_neighbors"]["r2"]["graceful-restart"] == "graceful-restart-helper" :

1262 
lmode
 = "Helper"

1263 
–if
 
šput_diù
["r1"]["bgp"]["bgp_neighbors"]["r2"]["graceful-restart"] == "graceful-restart" :

1264 
lmode
 = "Restart"

1265 
–if
 
šput_diù
["r1"]["bgp"]["bgp_neighbors"]["r2"]["graceful-restart"] == "graceful-restart-disable" :

1266 
lmode
 = "Disable"

1268 
lmode
 = 
NÚe


1271 
šput_diù
["r2"]["bgp"]["bgp_neighbors"]["r1"]["graceful-restart"]== "graceful-restart-helper" :

1272 
rmode
 = "Helper"

1273 
–if
 
šput_diù
["r2"]["bgp"]["bgp_neighbors"]["r1"]["graceful-restart"] == "graceful-restart" :

1274 
rmode
 = "Restart"

1275 
–if
 
šput_diù
["r2"]["bgp"]["bgp_neighbors"]["r1"]["graceful-restart"] == "graceful-restart-disable" :

1276 
rmode
 = "Disable"

1278 
rmode
 = 
NÚe


1280 
show_bgp_g¿ûful_jsÚ_out
["loÿlGrMode"] =ğ
lmode
 :

1281 
logg”
.
	`šfo
('loÿlGrMod: {} '.
	`fÜm©
(
show_bgp_g¿ûful_jsÚ_out
["localGrMode"]))

1283 
logg”
.
	`”rÜ
('loÿlGrModi nÙ cÜ»ù {}'.
	`fÜm©
(
show_bgp_g¿ûful_jsÚ_out
["localGrMode"]))

1284  
F®£


1286 
logg”
.
	`šfo
(">>>>>>>>>>>>>>")

1288 
show_bgp_g¿ûful_jsÚ_out
["»mÙeGrMode"] =ğ
rmode
 :

1289 
logg”
.
	`šfo
('»mÙeGrMod: {} '.
	`fÜm©
(
show_bgp_g¿ûful_jsÚ_out
["remoteGrMode"]))

1291 
logg”
.
	`”rÜ
('»mÙeGrModi nÙ cÜ»ù {}'.
	`fÜm©
(
show_bgp_g¿ûful_jsÚ_out
["remoteGrMode"]))

1292  
F®£


1295 
logg”
.
	`šfo
("Exiting†ib API: verify_graceful_restart()")

1296  
True


1300 ## 
V”ifiÿtiÚ
 
API
 
r
-
b™


1301 
def
 
	$v”ify_r_b™
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
tİo
, 
dut
):

1303 
This
 
API
 
is
 
to
 
v”ify
 
v”ify_g¿ûful_»¡¬t
 
ªy
 
rou‹r
.

1305 * `
šput_diù
`: 
šput
 
diùiÚ¬y
, 
have
 
d‘as
 
of
 
Deviû
 
Und”
 
Te¡
, 

1306 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


1307 * `
tg’
`: 
tİog’
 
objeù


1308 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1310 
logg”
.
	`šfo
("Entering†ib API: verify_r_bit()")

1312 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1313 
rou‹r
 !ğ
dut
 :

1317 
ÃighbÜs
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]

1318 
ÃighbÜ
 
š
 
ÃighbÜs
.
	$keys
():

1319 
g¿ûful_»¡¬t
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_ÃighbÜs"][
ÃighbÜ
]['graceful-restart']

1321 #loİback 
š‹rçû


1322 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_neighbors"]

1323 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer'] \

1324 
ªd
 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']['source_link'] == 'lo':

1325 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['lo'][

1326 
ADDR_TYPE
].
	`¥l™
("/")[0]

1328 #PhysiÿÈ
š‹rçû


1329 #P“¸
D‘as


1330 
³”
 = 
bgp_ÃighbÜs
[
ÃighbÜ
]['peer']

1331 
de¡_lšk
 = 
³”
['dest_link']

1333 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
ÃighbÜ
]['links'].\

1334 
	$™”™ems
():

1335 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

1336 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
ÃighbÜ
]['links'][

1337 
de¡Rou‹rLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1339 
logg”
.
	`šfo
('Checkšg bg°g¿ûful-»¡¬ˆshow o/° {}'.
	$fÜm©
(
ÃighbÜ_
))

1341 
show_bgp_g¿ûful_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°{}‚eighbÜ {} g¿ûful-»¡¬ˆjsÚ".
	`fÜm©
(
ADDR_TYPE
,
ÃighbÜ_
), 
isjsÚ
=
True
)

1343 
	`´št
('show_bgp_g¿ûful_jsÚ',
show_bgp_g¿ûful_jsÚ
)

1345 
show_bgp_g¿ûful_jsÚ_out
 = 
show_bgp_g¿ûful_jsÚ
[
ÃighbÜ_
]

1347 
show_bgp_g¿ûful_jsÚ_out
["ÃighbÜAddr"] =ğ
ÃighbÜ_
 :

1348 
logg”
.
	`šfo
('NighbÜ i°maùhed {}'.
	$fÜm©
(
ÃighbÜ_
))

1350 
logg”
.
	`”rÜ
('Nighbor ip NOT‡ macth {}')

1351  
F®£


1354 
logg”
.
	`šfo
("Exiting†ib API: verify_r_bit()")

1355  
True


1360 
def
 
	$v”ify_bgp_cÚv”g’û
(
ADDR_TYPE
, 
tg’
, 
tİo
):

1362 
This
 
API
 
is
 
to
 
v”ify
 
BGP
-
CÚv”g’û
 
Ú
 
ªy
 
rou‹r
.

1364 * `
ADDR_TYPE
`: 
_ty³
, 
v4
/
v6


1365 * `
tg’
`: 
tİog’
 
objeù


1366 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1369 
logg”
.
	`šfo
("Entering†ib API: verify_bgp_confergence()")

1371 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1372 
logg”
.
	`šfo
('V”ifyšg BGP CÚv”g’û oÀrou‹¸{}:'.
	$fÜm©
(
rou‹r
))

1374 
»Œy
 
š
 
	$¿nge
(1, 11):

1375 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°summ¬y jsÚ", 
isjsÚ
=
True
)

1376 #V”ifyšg 
ouut
 
diùiÚ¬y
 
show_bgp_jsÚ
 
is
 
em±y
 
Ü
 
nÙ


1377 
	`boŞ
(
show_bgp_jsÚ
è=ğ
F®£
:

1378 
”rÜmsg
 = "BGP is‚ot„unning"

1379  
”rÜmsg


1381 #TØ
fšd
 
ÃighbÜ
 

 
ty³


1382 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_neighbors"]

1383 
tÙ®_³”
 = 
	$Ën
(
bgp_ÃighbÜs
)

1384 
no_of_³”
 = 0

1385 
bgp_ÃighbÜ
, 
d©a
 
š
 
bgp_ÃighbÜs
.
	$™”™ems
():

1386 
de¡_lšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["dest_link"]

1387 #Loİback 
š‹rçû


1388 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["³”"] 
ªd
 \

1389 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["source_link"] == 'lo':

1390 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][

1391 
ADDR_TYPE
].
	`¥l™
("/")[0]

1392 
ADDR_TYPE
 == 'ipv4':

1393 
nh_¡©e
 = 
show_bgp_jsÚ
["ipv4Unicast"]["peers"][

1394 
ÃighbÜ_
]["state"]

1396 
nh_¡©e
 = 
show_bgp_jsÚ
["ipv6Unicast"]["peers"][

1397 
ÃighbÜ_
]["state"]

1399 
nh_¡©e
 == "Established":

1400 
no_of_³”
 += 1

1402 #PhysiÿÈ
š‹rçû


1403 
ÃighbÜLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'].\

1404 
	$™”™ems
():

1405 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1406 
ÃighbÜ_
 = 
tİo
['routers'][

1407 
bgp_ÃighbÜ
]['lšks'][
ÃighbÜLšk
[0]][

1408 
ADDR_TYPE
].
	`¥l™
("/")[0]

1409 
ADDR_TYPE
 == 'ipv4':

1410 
nh_¡©e
 = 
show_bgp_jsÚ
["ipv4Unicast"][

1411 "³”s"][
ÃighbÜ_
]["state"]

1413 
nh_¡©e
 = 
show_bgp_jsÚ
["ipv6Unicast"][

1414 "³”s"][
ÃighbÜ_
]["state"]

1416 
nh_¡©e
 == "Established":

1417 
no_of_³”
 += 1

1418 
no_of_³”
 =ğ
tÙ®_³”
:

1419 
logg”
.
	`šfo
('BGP i CÚv”ged fÜ„ou‹¸{}'.
	$fÜm©
(
rou‹r
))

1422 
logg”
.
	`w¬nšg
('BGP is‚ot yet Converged for„outer {}'.

1423 
	$fÜm©
(
rou‹r
))

1424 
¦“±ime
 = 2 * 
»Œy


1425 
¦“±ime
 <ğ
BGP_CONVERGENCE_TIMEOUT
:

1426 #Wa™šg 
BGP
 
to
 
cÚv”ge


1427 
logg”
.
	`šfo
("Waiting for {} sec for BGPo converge on"

1428 "„ou‹¸{}...".
	$fÜm©
(
¦“±ime
, 
rou‹r
))

1429 
	$¦“p
(
¦“±ime
)

1431 
show_bgp_summ¬y
 = 
ºode
.
	`vtysh_cmd
("show bgp summary")

1432 
”rÜmsg
 = "TIMEOUT!! BGP is‚ot converged in {} seconds" \

1433 " fÜ„ou‹¸{} \À{}".
	$fÜm©
(

1434 
BGP_CONVERGENCE_TIMEOUT
, 
rou‹r
, 
show_bgp_summ¬y
)

1435  
”rÜmsg


1437 
logg”
.
	`šfo
("Exiting API: verify_bgp_confergence()")

1438  
True


1440 
def
 
	$ş—r_bgp_ªd_v”ify
(
ADDR_TYPE
, 
tg’
, 
dut
, 
tİo
):

1442 
This
 
API
 
is
 
to
 
ş—r
 
bgp
 
ÃighbÜsh
 
ªd
 
v”ify
.

1444 * `
ADDR_TYPE
`: 

 
ty³
 
v4
/
v6


1445 * `
tg’
`: 
tİog’
 
objeù


1446 * `
dut
`: 
deviû
 
und”
 
‹¡


1447 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1450 
logg”
.
	`šfo
("Entering†ib API: clear_bgp()")

1452 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1453 
rou‹r
 !ğ
dut
:

1456 
³”U±ime_befÜe_ş—r_bgp
 = {
	}
}

1457 #V”ifyšg 
BGP
 
cÚv”g’û
 
befÜe
 
bgp
 
ş—r
 
commªd


1458 
»Œy
 
š
 
	$¿nge
(1, 11):

1459 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°summ¬y jsÚ", 
isjsÚ
=
True
)

1460 #V”ifyšg 
ouut
 
diùiÚ¬y
 
show_bgp_jsÚ
 
is
 
em±y
 
Ü
 
nÙ


1461 
	`boŞ
(
show_bgp_jsÚ
è=ğ
F®£
:

1462 
”rÜmsg
 = "BGP is‚ot„unning"

1463  
”rÜmsg


1465 
¦“±ime
 = 2 * 
»Œy


1466 
¦“±ime
 <ğ
BGP_CONVERGENCE_TIMEOUT
:

1467 #Wa™šg 
BGP
 
to
 
cÚv”ge


1468 
logg”
.
	`šfo
("Waiting for {} sec for BGPo converge on„outer"

1469 " {}...".
	$fÜm©
(
¦“±ime
, 
rou‹r
))

1470 
	$¦“p
(
¦“±ime
)

1472 
”rÜmsg
 = "TIMEOUT!! BGP is‚ot converged in {} seconds for" \

1473 "„ou‹¸{}".
	$fÜm©
(
BGP_CONVERGENCE_TIMEOUT
, 
rou‹r
)

1474  
”rÜmsg


1476 #TØ
fšd
 
ÃighbÜ
 

 
ty³


1477 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['bgp_neighbors']

1478 
tÙ®_³”
 = 
	$Ën
(
bgp_ÃighbÜs
)

1479 
no_of_³”
 = 0

1480 
bgp_ÃighbÜ
, 
d©a
 
š
 
bgp_ÃighbÜs
.
	$™”™ems
():

1481 
de¡_lšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['dest_link']

1482 #Loİback 
š‹rçû


1483 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['³”'] 
ªd
 \

1484 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['source_link'] == 'lo':

1485 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][

1486 
ADDR_TYPE
].
	`¥l™
("/")[0]

1487 
ADDR_TYPE
 == 'ipv4':

1488 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1489 
ÃighbÜ_
]['state']

1491 #P“¸
up
 
time
 
diùiÚ¬y


1492 
³”U±ime_befÜe_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1493 
show_bgp_jsÚ
['v4Uniÿ¡']['³”s'][
ÃighbÜ_
][

1496 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv6Unicast']['peers'][

1497 
ÃighbÜ_
]['state']

1499 #P“¸
up
 
time
 
diùiÚ¬y


1500 
³”U±ime_befÜe_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1501 
show_bgp_jsÚ
['v6Uniÿ¡']['³”s'][
ÃighbÜ_
][

1504 
nh_¡©e
 == 'Established':

1505 
no_of_³”
 += 1

1507 #PhysiÿÈ
š‹rçû


1508 
ÃighbÜLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'].\

1509 
	$™”™ems
():

1510 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1511 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
][

1512 'lšks'][
ÃighbÜLšk
[0]][

1513 
ADDR_TYPE
].
	`¥l™
("/")[0]

1514 
ADDR_TYPE
 == 'ipv4':

1515 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv4Unicast'][

1516 '³”s'][
ÃighbÜ_
]['state']

1518 #P“¸
up
 
time
 
diùiÚ¬y


1519 
³”U±ime_befÜe_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1520 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1521 
ÃighbÜ_
]['peerUptime']

1523 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv6Unicast'][

1524 '³”s'][
ÃighbÜ_
]['state']

1526 #P“¸
up
 
time
 
diùiÚ¬y


1527 
³”U±ime_befÜe_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1528 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1529 
ÃighbÜ_
]['peerUptime']

1531 
nh_¡©e
 == 'Established':

1532 
no_of_³”
 += 1

1534 
no_of_³”
 =ğ
tÙ®_³”
:

1535 
logg”
.
	`šfo
('BGP is Converged for„outer {} before bgp clear'.

1536 
	$fÜm©
(
rou‹r
))

1539 
logg”
.
	`w¬nšg
('BGP is‚ot yet Converged for„outer {} before'

1540 ' bg°ş—r'.
	$fÜm©
(
rou‹r
))

1542 #CË¬šg 
BGP
 
usšg
 "ş—¸ bg°*" 
commªd


1543 
logg”
.
	`šfo
('CË¬šg BGP‚eighbÜsh fÜ„ou‹¸{}..'.
	$fÜm©
(
rou‹r
))

1544 
»suÉ
 = 
ºode
.
	`vtysh_cmd
("clear ip bgp *")

1546 
³”U±ime_aá”_ş—r_bgp
 = {
	}
}

1547 #V”ifyšg 
BGP
 
cÚv”g’û
 
aá”
 
bgp
 
ş—r
 
commªd


1548 
»Œy
 
š
 
	$¿nge
(1, 11):

1549 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°summ¬y jsÚ", 
isjsÚ
=
True
)

1550 #V”ifyšg 
ouut
 
diùiÚ¬y
 
show_bgp_jsÚ
 
is
 
em±y
 
Ü
 
nÙ


1551 
	`boŞ
(
show_bgp_jsÚ
è=ğ
F®£
:

1552 
”rÜmsg
 = "BGP is‚ot„unning"

1553  
”rÜmsg


1555 
¦“±ime
 = 2 * 
»Œy


1556 
¦“±ime
 <ğ
BGP_CONVERGENCE_TIMEOUT
:

1557 #Wa™šg 
BGP
 
to
 
cÚv”ge


1558 
logg”
.
	`šfo
("Waiting for {} sec for BGPo converge on„outer"

1559 " {}...".
	$fÜm©
(
¦“±ime
, 
rou‹r
))

1560 
	$¦“p
(
¦“±ime
)

1562 
”rÜmsg
 = "TIMEOUT!! BGP is‚ot converged in {} seconds for" \

1563 "„ou‹¸{}".
	$fÜm©
(
BGP_CONVERGENCE_TIMEOUT
, 
rou‹r
)

1564  
”rÜmsg


1566 #TØ
fšd
 
ÃighbÜ
 

 
ty³


1567 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']['bgp_neighbors']

1568 
tÙ®_³”
 = 
	$Ën
(
bgp_ÃighbÜs
)

1569 
no_of_³”
 = 0

1570 
bgp_ÃighbÜ
, 
d©a
 
š
 
bgp_ÃighbÜs
.
	$™”™ems
():

1571 
de¡_lšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['dest_link']

1572 #Loİback 
š‹rçû


1573 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['³”'] 
ªd
 \

1574 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['source_link'] == 'lo':

1575 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][

1576 
ADDR_TYPE
].
	`¥l™
("/")[0]

1577 
ADDR_TYPE
 == 'ipv4':

1578 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1579 
ÃighbÜ_
]['state']

1580 #P“¸
up
 
time
 
diùiÚ¬y


1581 
³”U±ime_aá”_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1582 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1583 
ÃighbÜ_
]['peerUptime']

1585 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv6Unicast']['peers'][

1586 
ÃighbÜ_
]['state']

1587 #P“¸
up
 
time
 
diùiÚ¬y


1588 
³”U±ime_aá”_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1589 
show_bgp_jsÚ
['ipv6Unicast']['peers'][

1590 
ÃighbÜ_
]['peerUptime']

1592 
nh_¡©e
 == 'Established':

1593 
no_of_³”
 += 1

1595 #PhysiÿÈ
š‹rçû


1596 
ÃighbÜLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'].\

1597 
	$™”™ems
():

1598 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1599 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
][

1600 'lšks'][
ÃighbÜLšk
[0]][

1601 
ADDR_TYPE
].
	`¥l™
("/")[0]

1602 
ADDR_TYPE
 == 'ipv4':

1603 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv4Unicast'][

1604 '³”s'][
ÃighbÜ_
]['state']

1605 #P“¸
up
 
time
 
diùiÚ¬y


1606 
³”U±ime_aá”_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1607 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1608 
ÃighbÜ_
]['peerUptime']

1610 
nh_¡©e
 = 
show_bgp_jsÚ
['ipv6Unicast'][

1611 '³”s'][
ÃighbÜ_
]['state']

1612 #P“¸
up
 
time
 
diùiÚ¬y


1613 
³”U±ime_aá”_ş—r_bgp
[
bgp_ÃighbÜ
] = \

1614 
show_bgp_jsÚ
['ipv4Unicast']['peers'][

1615 
ÃighbÜ_
]['peerUptime']

1617 
nh_¡©e
 == 'Established':

1618 
no_of_³”
 += 1

1620 
no_of_³”
 =ğ
tÙ®_³”
:

1621 
logg”
.
	`šfo
('BGP is Converged for„outer {}‡fter bgp clear'.

1622 
	$fÜm©
(
rou‹r
))

1625 
logg”
.
	`w¬nšg
('BGP is‚ot yet Converged for„outer {}‡fter'

1626 ' bg°ş—r'.
	$fÜm©
(
rou‹r
))

1628 #Com·riung 
³”U±ime
 
diùiÚ¬›s


1629 
³”U±ime_befÜe_ş—r_bgp
 !ğ
³”U±ime_aá”_ş—r_bgp
:

1630 
logg”
.
	`šfo
('BGP‚eighborship is„eset‡fter clear BGP on„outer {}'.

1631 
	$fÜm©
(
dut
))

1633 
”rÜmsg
 = 'BGP‚eighborship is‚ot„eset‡fter clear bgp on„outer' \

1634 ' {}'.
	$fÜm©
(
dut
)

1635  
”romsg


1637 
logg”
.
	`šfo
("Exiting†ib API: clear_bgp()")

1638  
True


1640 
def
 
	$v”ify_bgp_tim”s_ªd_funùiÚ®™y
(
ADDR_TYPE
, 
tg’
, 
šput_diù
, 
tİo
):

1642 
This
 
API
 
is
 
to
 
v”ify
 
bgp
 
tim”s
 
ªd
 
funùiÚ®™y
.

1644 * `
ADDR_TYPE
`: 

 
ty³
, 
v4
/
v6


1645 * `
tg’
`: 
tİog’
 
objeù


1646 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
, 
bgp
 
tim”s
 
Ãeds


1647 
to
 
be
 
v”if›d


1648 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1651 
logg”
.
	`šfo
("Entering†ib API: verify_bgp_timers_and_functionality()")

1653 
dut
 
š
 
šput_diù
.
	$keys
():

1654 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

1655 
rou‹r
, 
ºode
 
š
 
rou‹r_li¡
.
	$™”™ems
():

1656 
rou‹r
 !ğ
dut
:

1659 
logg”
.
	`šfo
('Verifying bgpimers functionality, DUT is {}:'.

1660 
	$fÜm©
(
rou‹r
))

1662 
show__bgp_ÃighbÜ_jsÚ
 = \

1663 
ºode
.
	`vtysh_cmd
("show i°bg°ÃighbÜ jsÚ", 
isjsÚ
=
True
)

1664 
bgp_ÃighbÜ
 
š
 
šput_diù
[
rou‹r
]["bgp"]["bgp_ÃighbÜs"].
	$keys
():

1665 
k“·liv‘im”
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]\

1666 [
bgp_ÃighbÜ
]["keepalivetimer"]

1667 
hŞddowÁim”
 = 
šput_diù
[
rou‹r
]["bgp"]["bgp_neighbors"]\

1668 [
bgp_ÃighbÜ
]["holddowntimer"]

1670 #P“¸
d‘as


1671 
³”
 = 
tİo
['rou‹rs'][
rou‹r
]["bgp"]["bgp_ÃighbÜs"][
bgp_ÃighbÜ
]\

1673 
de¡_lšk
 = 
³”
['dest_link']

1675 #Loİback 
š‹rçû


1676 "sourû_lšk" 
š
 
³”
 
ªd
…eer['source_link'] == 'lo':

1677 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][
ADDR_TYPE
].\

1678 
	`¥l™
('/')[0]

1680 #PhysiÿÈ
IÁ”çû


1681 
de¡Rou‹rLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'].\

1682 
	$™”™ems
():

1683 
de¡_lšk
 =ğ
de¡Rou‹rLšk
[0]:

1684 
ÃighbÜ_
 = \

1685 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lšks'][
de¡Rou‹rLšk
[0]]\

1686 [
ADDR_TYPE
].
	`¥l™
("/")[0]

1688 #V”ify 
HŞdDownTim”
 
ÃighbÜ


1689 
bgpHŞdTimeM£cs
 = 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]\

1691 
bgpHŞdTimeM£cs
 !ğ
hŞddowÁim”
 * 1000:

1692 
”rÜmsg
 = "V”ifyšg hŞddowÁim” fÜ bg°ÃighbÜ {} und” duˆ{},\
: {} buˆex³ùed: {}".
	$fÜm©
(
ÃighbÜ_
, 
rou‹r
,

1694 
bgpHŞdTimeM£cs
,

1695 
hŞddowÁim”
 * 1000)

1696  
”rÜmsg


1698 #V”ify 
K“pAliveTim”
 
ÃighbÜ


1699 
bgpK“pAliveTimeM£cs
 = 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]\

1701 
bgpK“pAliveTimeM£cs
 !ğ
k“·liv‘im”
 * 1000:

1702 
”rÜmsg
 = "V”ifyšg k“·liv‘im” fÜ bg°ÃighbÜ {} und” duˆ{},\
: {} buˆex³ùed: {}".
	$fÜm©
(
ÃighbÜ_
, 
rou‹r
,

1704 
bgpK“pAliveTimeM£cs
,

1705 
k“·liv‘im”
 * 1000)

1706  
”rÜmsg


1708 #K“°
®ive
 
mes§ge
 
couÁ
 
befÜe
 
shu‰šg
 
down
 
ÃighbÜ
 
š‹rçû


1709 
show__bgp_ÃighbÜ_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show ip bgp‚eighbor json",

1710 
isjsÚ
=
True
)

1711 
k“·live_msg_couÁ_befÜe
 = 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]\

1714 #ShutdowÀ
š‹rçû


1715 
tİÙe¡
.
	`š‹rçû_£t_¡©us
(
rou‹r_li¡
[
bgp_ÃighbÜ
], "r2-r1-eth0",

1716 
içûaùiÚ
=
F®£
)

1718 #V”ifyšg 
funùiÚ®™y


1719 
tim”
 
š
 
	`¿nge
(
k“·liv‘im”
, 
hŞddowÁim”
 + keepalivetimer,

1720 (
hŞddowÁim”
/3)):

1721 
logg”
.
	`šfo
("Wa™šg fÜ {} sec..".
	$fÜm©
(
k“·liv‘im”
))

1722 
	$¦“p
 (
k“·liv‘im”
)

1723 
show_bgp_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show bg°summ¬y jsÚ", 
isjsÚ
=
True
)

1724 
de¡_lšk
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_ÃighbÜs"][
bgp_ÃighbÜ
]\

1726 #Loİback 
š‹rçû


1727 "sourû_lšk" 
š
 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_neighbors"]\

1728 [
bgp_ÃighbÜ
]["³”"] 
ªd
 \

1729 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_ÃighbÜs"][
bgp_ÃighbÜ
]\

1731 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][
ADDR_TYPE
].\

1732 
	`¥l™
("/")[0]

1733 
ADDR_TYPE
 == 'ipv4':

1734 
nh_¡©e
 = 
show_bgp_jsÚ
["v4Uniÿ¡"]["³”s"][
ÃighbÜ_
]\

1737 
nh_¡©e
 = 
show_bgp_jsÚ
["v6Uniÿ¡"]["³”s"][
ÃighbÜ_
]\

1740 
tim”
 =ğ
hŞddowÁim”
:

1741 
nh_¡©e
 == "Established":

1742 
”rÜmsg
 = ("BGP‚eighborship has‚ot gone down in {} sec for"

1743 "‚eighbÜ {}".
	$fÜm©
(
tim”
, 
bgp_ÃighbÜ
))

1744  
”rÜmsg


1746 
logg”
.
	`šfo
("BGP‚eighborship has gone down in {} sec for "

1747 "ÃighbÜ {}".
	$fÜm©
(
tim”
, 
bgp_ÃighbÜ
))

1749 #PhysiÿÈ
š‹rçû


1750 
ÃighbÜLšk
 
š
 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lšks'].
	$™”™ems
():

1751 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1752 
ÃighbÜ_
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lšks'][
ÃighbÜLšk
[0]]\

1753 [
ADDR_TYPE
].
	`¥l™
("/")[0]

1754 
ADDR_TYPE
 == 'ipv4':

1755 
nh_¡©e
 = 
show_bgp_jsÚ
["v4Uniÿ¡"]["³”s"][
ÃighbÜ_
]\

1758 
nh_¡©e
 = 
show_bgp_jsÚ
["v6Uniÿ¡"]["³”s"][
ÃighbÜ_
]\

1761 
tim”
 =ğ
hŞddowÁim”
:

1762 
nh_¡©e
 == "Established":

1763 
”rÜmsg
 = ("BGP‚eighborship has‚ot gone down in {} sec for "

1764 "ÃighbÜ {}".
	$fÜm©
(
tim”
, 
bgp_ÃighbÜ
))

1765  
”rÜmsg


1767 
logg”
.
	`šfo
("BGP‚eighborship has gone down in {} sec for "

1768 "ÃighbÜ {}".
	$fÜm©
(
tim”
, 
bgp_ÃighbÜ
))

1770 #K“°
®ive
 
mes§ge
 
couÁ
 
befÜe
 
shu‰šg
 
down
 
ÃighbÜ
 
š‹rçû


1771 
show__bgp_ÃighbÜ_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show i°bg°ÃighbÜ jsÚ", 
isjsÚ
=
True
)

1772 
k“·live_msg_couÁ_aá”
 = 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["messageStats"]\

1775 #V”ifyšg 
k“·live
 
msg
 
couÁ


1776 
k“·live_msg_couÁ_aá”
 - 
k“·live_msg_couÁ_befÜe
 == 3:

1777 
logg”
.
	`šfo
("Total 3 keepAlive messages‡re sento‚eighbor, untill bgp "

1780 
”rÜmsg
 = ("Inconsistancy in keepAlive messages, which‡re sento "

1782  
”rÜmsg


1784 
logg”
.
	`šfo
("Exiting†ib API: verify_bgp_timers_and_functionality()")

1785  
True


1792 
def
 
	$v”ify_GR_¡©us
(
ADDR_TYPE
, 
tg’
, 
šput_diù
, 
tİo
):

1794 
This
 
API
 
is
 
to
 
v”ify
 
AS
 
numb”s


1796 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1797 * `
tg’
`: 
tİog’
 
objeù


1798 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
, 
AS
 
numb”s
 
Ãeds
 
to


1799 
be
 
v”if›d


1800 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1803 
logg”
.
	`šfo
("Entering†ib API: verify_AS_numbers()")

1805 
dut
 
š
 
šput_diù
.
	$keys
():

1806 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1807 
rou‹r
 !ğ
dut
:

1810 
logg”
.
	`šfo
('V”ifyšg AS‚umb” fÜ duˆ{}:'.
	$fÜm©
(
rou‹r
))

1812 
show__bgp_ÃighbÜ_jsÚ
 = 
ºode
.
	`vtysh_cmd
(

1813 "show i°bg°ÃighbÜ jsÚ", 
isjsÚ
=
True
)

1814 
loÿl_as
 = 
šput_diù
[
rou‹r
]["local_as"]

1815 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_neighbors"]

1817 
bgp_ÃighbÜ
, 
d©a
 
š
 
bgp_ÃighbÜs
.
	$™”™ems
():

1818 
de¡_lšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["dest_link"]

1819 
rou‹r_d©a
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]

1820 
»mÙe_as
 = 
šput_diù
[
rou‹r
]["bgp_ÃighbÜs"][
bgp_ÃighbÜ
]["remote_as"]

1822 #Loİback 
š‹rçû


1823 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"] \

1824 
ªd
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["source_link"] == 'lo':

1825 
ADDR_TYPE
 == "ipv4":

1826 
ÃighbÜ_
 = 
rou‹r_d©a
['lo'][
ADDR_TYPE
].
	`¥l™
("/")[0]

1828 
ADDR_TYPE
 = 'ipv6'

1829 
ÃighbÜ_
 = 
rou‹r_d©a
['lo'][
ADDR_TYPE
].
	`¥l™
("/")[0]

1830 #PhysiÿÈ
š‹rçû


1832 
ÃighbÜLšk
 
š
 
rou‹r_d©a
['lšks'].
	$™”™ems
():

1833 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1834 
ADDR_TYPE
 == 'ipv4':

1835 
ÃighbÜ_
 = 
rou‹r_d©a
['links'][

1836 
ÃighbÜLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1838 
ADDR_TYPE
 = 'ipv6'

1839 
ÃighbÜ_
 = 
rou‹r_d©a
['links'][

1840 
ÃighbÜLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1842 #V”ify 
Loÿl
 
AS
 
rou‹r


1843 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["loÿlAs"] !ğ
loÿl_as
:

1844 
”rÜmsg
 = "Failed: Verify†ocal_as for dut {}, found: {}" \

1845 " buˆex³ùed: {}".
	`fÜm©
(
rou‹r
,

1846 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["localAs"],

1847 
loÿl_as
)

1848  
”rÜmsg


1850 
logg”
.
	`šfo
("Verified†ocal_as for dut {}, foundƒxpected:"

1851 " {}".
	$fÜm©
(
rou‹r
, 
loÿl_as
))

1853 #V”ify 
RemÙe
 
AS
 
ÃighbÜ


1854 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["»mÙeAs"] !ğ
»mÙe_as
:

1855 
”rÜmsg
 = "Failed: Verify„emote_as for dut {}'s" \

1857 
	`fÜm©
(
rou‹r
, 
bgp_ÃighbÜ
,

1858 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["remoteAs"],

1859 
»mÙe_as
)

1860  
”rÜmsg


1862 
logg”
.
	`šfo
("Verified„emote_as for dut {}'s‚eighbor {},"

1863 " foundƒx³ùed: {}".
	$fÜm©
(
rou‹r
,

1864 
bgp_ÃighbÜ
,

1865 
»mÙe_as
))

1867 
logg”
.
	`šfo
("Exiting†ib API: verify_AS_numbers()")

1882 
def
 
	$v”ify_AS_numb”s
(
ADDR_TYPE
, 
tg’
, 
šput_diù
, 
tİo
):

1884 
This
 
API
 
is
 
to
 
v”ify
 
AS
 
numb”s


1886 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1887 * `
tg’
`: 
tİog’
 
objeù


1888 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
, 
AS
 
numb”s
 
Ãeds
 
to


1889 
be
 
v”if›d


1890 * `
tİo
`: 
šput
 
jsÚ
 
fe
 
d©a


1893 
logg”
.
	`šfo
("Entering†ib API: verify_AS_numbers()")

1895 
dut
 
š
 
šput_diù
.
	$keys
():

1896 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1897 
rou‹r
 !ğ
dut
:

1900 
logg”
.
	`šfo
('V”ifyšg AS‚umb” fÜ duˆ{}:'.
	$fÜm©
(
rou‹r
))

1902 
show__bgp_ÃighbÜ_jsÚ
 = 
ºode
.
	`vtysh_cmd
(

1903 "show i°bg°ÃighbÜ jsÚ", 
isjsÚ
=
True
)

1904 
loÿl_as
 = 
šput_diù
[
rou‹r
]["local_as"]

1905 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
rou‹r
]['bgp']["bgp_neighbors"]

1907 
bgp_ÃighbÜ
, 
d©a
 
š
 
bgp_ÃighbÜs
.
	$™”™ems
():

1908 
de¡_lšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["dest_link"]

1909 
rou‹r_d©a
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]

1910 
»mÙe_as
 = 
šput_diù
[
rou‹r
]["bgp_ÃighbÜs"][
bgp_ÃighbÜ
]["remote_as"]

1912 #Loİback 
š‹rçû


1913 "sourû_lšk" 
š
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"] \

1914 
ªd
 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]["peer"]["source_link"] == 'lo':

1915 
ADDR_TYPE
 == "ipv4":

1916 
ÃighbÜ_
 = 
rou‹r_d©a
['lo'][
ADDR_TYPE
].
	`¥l™
("/")[0]

1918 
ADDR_TYPE
 = 'ipv6'

1919 
ÃighbÜ_
 = 
rou‹r_d©a
['lo'][
ADDR_TYPE
].
	`¥l™
("/")[0]

1920 #PhysiÿÈ
š‹rçû


1922 
ÃighbÜLšk
 
š
 
rou‹r_d©a
['lšks'].
	$™”™ems
():

1923 
de¡_lšk
 =ğ
ÃighbÜLšk
[0]:

1924 
ADDR_TYPE
 == 'ipv4':

1925 
ÃighbÜ_
 = 
rou‹r_d©a
['links'][

1926 
ÃighbÜLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1928 
ADDR_TYPE
 = 'ipv6'

1929 
ÃighbÜ_
 = 
rou‹r_d©a
['links'][

1930 
ÃighbÜLšk
[0]][
ADDR_TYPE
].
	`¥l™
("/")[0]

1932 #V”ify 
Loÿl
 
AS
 
rou‹r


1933 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["loÿlAs"] !ğ
loÿl_as
:

1934 
”rÜmsg
 = "Failed: Verify†ocal_as for dut {}, found: {}" \

1935 " buˆex³ùed: {}".
	`fÜm©
(
rou‹r
,

1936 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["localAs"],

1937 
loÿl_as
)

1938  
”rÜmsg


1940 
logg”
.
	`šfo
("Verified†ocal_as for dut {}, foundƒxpected:"

1941 " {}".
	$fÜm©
(
rou‹r
, 
loÿl_as
))

1943 #V”ify 
RemÙe
 
AS
 
ÃighbÜ


1944 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["»mÙeAs"] !ğ
»mÙe_as
:

1945 
”rÜmsg
 = "Failed: Verify„emote_as for dut {}'s" \

1947 
	`fÜm©
(
rou‹r
, 
bgp_ÃighbÜ
,

1948 
show__bgp_ÃighbÜ_jsÚ
[
ÃighbÜ_
]["remoteAs"],

1949 
»mÙe_as
)

1950  
”rÜmsg


1952 
logg”
.
	`šfo
("Verified„emote_as for dut {}'s‚eighbor {},"

1953 " foundƒx³ùed: {}".
	$fÜm©
(
rou‹r
,

1954 
bgp_ÃighbÜ
,

1955 
»mÙe_as
))

1957 
logg”
.
	`šfo
("Exiting†ib API: verify_AS_numbers()")

1958  
True


1961 
def
 
	$v”ify_bgp_©Œibu‹s
(
ADDR_TYPE
, 
dut
, 
tg’
, 
¡©ic_rou‹s
, 
rm­_Çme
,

1962 
šput_diù
):

1964 
This
 
API
 
is
 
to
 
v”ify
 
AS
 
numb”s


1966 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1967 * `
dut
`: 
Deviû
 
Und”
 
Te¡


1968 * `
tg’
`: 
tİog’
 
objeù


1969 * `
¡©ic_rou‹s
`: 
Stic
 
Rou‹s
 
which
 
BGP
 
£t
 
©Œibu‹s
 
Ãeds
 
to
 
be


1970 
v”if›d


1971 * `
rm­_Çme
`: 
rou‹
 
m­
 
Çme
 
which
 
£t
 
ü™”Ÿ
 
Ãeds
 
to
 
be
 
v”if›d


1972 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
, 
AS
 
numb”s
 
Ãeds


1973 
to
 
be
 
v”if›d


1976 
logg”
.
	`šfo
("Entering†ib API: verify_bgp_attributes()")

1978 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1979 
rou‹r
 !ğ
dut
:

1982 
logg”
.
	`šfo
('V”ifyšg BGP s‘‡‰ribu‹ fÜ duˆ{}:'.
	$fÜm©
(
rou‹r
))

1984 
¡©ic_rou‹
 
š
 
¡©ic_rou‹s
:

1985 
cmd
 = "show bg°{} {} jsÚ".
	$fÜm©
(
ADDR_TYPE
, 
¡©ic_rou‹
)

1986 
show_bgp_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
cmd
, 
isjsÚ
=
True
)

1987 
logg”
.
	$šfo
(
show_bgp_jsÚ
)

1989 
rm­_rou‹r
 
š
 
šput_diù
.
	$keys
():

1990 
rm­
 
š
 
šput_diù
[
rm­_rou‹r
]["rou‹_m­s"].
	$keys
():

1991 
rm­
 =ğ
rm­_Çme
:

1992 
rm­_diù
 
š
 
šput_diù
[
rm­_rou‹r
]["route_maps"][

1993 
rm­_Çme
]:

1994 "£t" 
š
 
rm­_diù
:

1995 
ü™”Ÿ
 
š
 
rm­_diù
["£t"].
	$keys
():

1996 
rm­_diù
["£t"][
ü™”Ÿ
] == \

1997 
show_bgp_jsÚ
["·ths"][0][
ü™”Ÿ
]:

1998 
logg”
.
	`šfo
("Verifying BGP‡ttribute"

2002 
	`fÜm©
(
ü™”Ÿ
,

2003 
¡©ic_rou‹
,

2004 
dut
,

2005 
rm­_diù
["set"][

2006 
ü™”Ÿ
]))

2008 
”rÜmsg
=("Failed: Verifying BGP"

2012 
	`fÜm©
(
ü™”Ÿ
, 
¡©ic_rou‹
,

2013 
dut
,

2014 
rm­_diù
["£t"][
ü™”Ÿ
],

2015 
show_bgp_jsÚ
['·ths'][0][
ü™”Ÿ
]))

2016  
”rÜmsg


2018 
logg”
.
	`šfo
("Exiting†ib API: verify_bgp_attributes()")

2019  
True


2021 
def
 
	$v”ify_be¡_·th_as_³r_bgp_©Œibu‹
(
ADDR_TYPE
, 
dut
, 
šput_diù
, 
tg’
, 
©Œibu‹
):

2023 
This
 
API
 
is
 
to
 
fšd
 
ªd
 
v”ify
 
be¡
 
·th
 
accÜdšg
Ø
BGP
 
©Œibu‹s
.

2025 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


2026 * `
dut
`: 
Deviû
 
Und”
 
Te¡
, 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


2027 * `
šput_diù
`: 
havšg
 
rou‹
 
d‘as
, 
which
 
wl
 
h–p
 
to
 
ÿlcuÏ‹
 
be¡
 
·th


2028 * `
tg’
` : 
tİog’
 
objeù


2029 * `
©Œibu‹
` : 
ÿlcuÏ‹
 
be¡
 
·th
 
usšg
 
this
‡ttribute

2032 
logg”
.
	`šfo
("Entering†ib API: verify_best_path_as_per_bgp_attribute()")

2034 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

2035 
rou‹r
, 
ºode
 
š
 
rou‹r_li¡
.
	$™”™ems
():

2036 
rou‹r
 !ğ
dut
:

2039 #V”ifyšg 
show
 
bgp
 
jsÚ


2040 
commªd
 = "show bg°{} jsÚ".
	$fÜm©
(
ADDR_TYPE
)

2042 
	$¦“p
(2)

2043 
logg”
.
	`šfo
('V”ifyšg„ou‹¸{} RIB fÜ be¡…©h:'.
	$fÜm©
(
rou‹r
))

2044 
sh__bgp_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
commªd
, 
isjsÚ
=
True
)

2046 
rou‹s_äom_rou‹r
 
š
 
šput_diù
.
	$keys
():

2047 
ÃtwÜks
 = 
šput_diù
[
rou‹s_äom_rou‹r
]["advertise_networks"]

2048 
ÃtwÜk
 
š
 
ÃtwÜks
:

2049 
rou‹
 = 
ÃtwÜk
["start_ip"]

2051 
rou‹_©Œibu‹s
 = 
sh__bgp_jsÚ
["rou‹s"][
rou‹
]

2052 
_Ãxt_hİ
 = 
NÚe


2053 
com·»
 = 
NÚe


2054 
©Œibu‹_diù
 = {
	}
}

2055 
rou‹_©Œibu‹
 
š
 
rou‹_©Œibu‹s
:

2056 
Ãxt_hİs
 = 
rou‹_©Œibu‹
["nexthops"]

2057 
Ãxt_hİ
 
š
 
Ãxt_hİs
:

2058 
Ãxt_hİ_
 = 
Ãxt_hİ
["ip"]

2059 
©Œibu‹_diù
[
Ãxt_hİ_
] = 
rou‹_©Œibu‹
[
©Œibu‹
]

2061 #AS_PATH 
©Œibu‹


2062 
©Œibu‹
 == "aspath":

2063 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
mšimum
 
as_·th


2064 
_Ãxt_hİ
 = 
mš
(
©Œibu‹_diù
, 
key
ğ
Ïmbda
 
x
: 
Ën
(
	$£t
(

2065 
©Œibu‹_diù
[
x
])))

2066 
com·»
 = "SHORTEST"

2068 #LOCAL_PREF 
©Œibu‹


2069 
–if
 
©Œibu‹
 == "localpref":

2070 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
highe¡
 
loÿl
 
´eã»nû


2071 
_Ãxt_hİ
 = 
	`max
(
©Œibu‹_diù
, 
key
=(
Ïmbda
 
k
:

2072 
©Œibu‹_diù
[
k
]))

2073 
com·»
 = "HIGHEST"

2075 #WEIGHT 
©Œibu‹


2076 
–if
 
©Œibu‹
 == "weight":

2077 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
highe¡
 
weight


2078 
_Ãxt_hİ
 = 
	`max
(
©Œibu‹_diù
, 
key
=(
Ïmbda
 
k
:

2079 
©Œibu‹_diù
[
k
]))

2080 
com·»
 = "HIGHEST"

2082 #ORIGIN 
©Œibu‹


2083 
–if
 
©Œibu‹
 == "origin":

2084 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
IGP
 
as
 
Üigš
, -

2085 #- 
ruË
 
is
 
IGP
>
EGP
>
INCOMPLETE


2086 
_Ãxt_hİ
 = [
key
 key, 
v®ue
è
š
 
©Œibu‹_diù
.\

2087 
	$™”™ems
(è
v®ue
 == "IGP"][0]

2088 
com·»
 = ""

2090 #MED 
©Œibu‹


2091 
–if
 
©Œibu‹
 == "med":

2092 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
LOWEST
 
MED


2093 
_Ãxt_hİ
 = 
	`mš
(
©Œibu‹_diù
, 
key
=(
Ïmbda
 
k
:

2094 
©Œibu‹_diù
[
k
]))

2095 
com·»
 = "LOWEST"

2097 #Show 

 
rou‹


2098 
ADDR_TYPE
 == "ipv4":

2099 
commªd
 = "show ip„oute json"

2101 
commªd
 = "show ipv6„oute json"

2103 
rib_rou‹s_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
commªd
, 
isjsÚ
=
True
)

2105 #V”ifyšg 
ouut
 
diùiÚ¬y
 
rib_rou‹s_jsÚ
 
is
 
nÙ
 
em±y


2106 
	`boŞ
(
rib_rou‹s_jsÚ
è=ğ
F®£
:

2107 
”rÜmsg
 = "No {}„oute found in RIB of„outer {}..".\

2108 
	$fÜm©
(
´ÙocŞ
, 
rou‹r
)

2109  
”rÜmsg


2111 
¡_found
 = 
F®£


2112 
nh_found
 = 
F®£


2113 #Fšd 
be¡
 
is
 
š¡®Ëd
 
š
 
RIB


2114 
rou‹
 
š
 
rib_rou‹s_jsÚ
:

2115 
¡_found
 = 
True


2116 #V”ify 
Ãxt_hİ
 
š
 
rib_rou‹s_jsÚ


2117 
rib_rou‹s_jsÚ
[
rou‹
][0]['nexthops'][0]['ip'] == \

2118 
_Ãxt_hİ
:

2119 
nh_found
 = 
True


2121 
”rÜmsg
 = ("Incorrect Nexthop for BGP„oute {}"

2123 
	`fÜm©
(
rou‹
, 
dut
, 
rib_rou‹s_jsÚ
[rou‹][0]['Ãxthİs'][0][''], 
_Ãxt_hİ
))

2124  
”rÜmsg


2126 
¡_found
 
ªd
 
nh_found
:

2127 
logg”
.
	`šfo
("Best…ath for…refix: {} is installed‡ccording"

2129 
	$fÜm©
(
rou‹
, 
com·»
, 
©Œibu‹
,

2130 
©Œibu‹_diù
[
_Ãxt_hİ
], 
dut
))

2132 
logg”
.
	`šfo
("Exiting†ib API: verify_best_path_as_per_bgp_attribute()")

2133  
True


2135 
def
 
	$v”ify_be¡_·th_as_³r_admš_di¡ªû
(
ADDR_TYPE
, 
dut
, 
šput_diù
, 
tg’
, 
©Œibu‹
):

2137 
This
 
API
 
is
 
to
 
fšd
 
ªd
 
v”ify
 
be¡
 
·th
 
as
 
³r
 
admš
 
di¡ªû


2139 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


2140 * `
dut
`: 
Deviû
 
Und”
 
Te¡
, 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


2141 * `
šput_diù
`: 
havšg
 
rou‹
 
d‘as
, 
which
 
wl
 
h–p
 
to
 
ÿlcuÏ‹
 
be¡
 
·th


2142 * `
tg’
` : 
tİog’
 
objeù


2143 * `
©Œibu‹
` : 
ÿlcuÏ‹
 
be¡
 
·th
 
usšg
 
this
‡ttribute

2146 
logg”
.
	`šfo
("Entering†ib API: verify_best_path_as_per_admin_distance()")

2148 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

2149 
rou‹r
, 
ºode
 
š
 
rou‹r_li¡
.
	$™”™ems
():

2150 
rou‹r
 !ğ
dut
:

2153 
	$¦“p
(2)

2154 
logg”
.
	`šfo
('Verifying„outer {} RIB for best…ath:'.

2155 
	$fÜm©
(
rou‹r
))

2157 #Show 

 
rou‹
 
cmd


2158 
ADDR_TYPE
 == "ipv4":

2159 
commªd
 = "show ip„oute json"

2161 
commªd
 = "show ipv6„oute json"

2163 
rou‹s_äom_rou‹r
 
š
 
šput_diù
.
	$keys
():

2164 
sh__rou‹_jsÚ
 = 
rou‹r_li¡
[
rou‹s_äom_rou‹r
].
	`vtysh_cmd
(\

2165 
commªd
, 
isjsÚ
=
True
)

2166 
ÃtwÜks
 = 
šput_diù
[
rou‹s_äom_rou‹r
]["static_routes"]

2167 
ÃtwÜk
 
š
 
ÃtwÜks
:

2168 
rou‹
 = 
ÃtwÜk
["network"]

2170 
rou‹_©Œibu‹s
 = 
sh__rou‹_jsÚ
[
rou‹
]

2171 
_Ãxt_hİ
 = 
NÚe


2172 
com·»
 = 
NÚe


2173 
©Œibu‹_diù
 = {
	}
}

2174 
rou‹_©Œibu‹
 
š
 
rou‹_©Œibu‹s
:

2175 
Ãxt_hİs
 = 
rou‹_©Œibu‹
["nexthops"]

2176 
Ãxt_hİ
 
š
 
Ãxt_hİs
:

2177 
Ãxt_hİ_
 = 
Ãxt_hİ
["ip"]

2178 
©Œibu‹_diù
[
Ãxt_hİ_
] = 
rou‹_©Œibu‹
["distance"]

2180 #Fšd 
Ãxt_hİ
 
the
 
rou‹
 
have
 
LOWEST
 
Admš
 
Di¡ªû


2181 
_Ãxt_hİ
 = 
mš
(
©Œibu‹_diù
, 
key
=(
Ïmbda
 
k
: \

2182 
©Œibu‹_diù
[
k
]))

2183 
com·»
 = "LOWEST"

2185 #Show 

 
rou‹


2186 
rib_rou‹s_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
commªd
, 
isjsÚ
=
True
)

2188 #V”ifyšg 
ouut
 
diùiÚ¬y
 
rib_rou‹s_jsÚ
 
is
 
nÙ
 
em±y


2189 
	`boŞ
(
rib_rou‹s_jsÚ
è=ğ
F®£
:

2190 
”rÜmsg
 = "No {}„oute found in RIB of„outer {}..".\

2191 
	$fÜm©
(
´ÙocŞ
, 
rou‹r
)

2192  
”rÜmsg


2194 
¡_found
 = 
F®£


2195 
nh_found
 = 
F®£


2196 #Fšd 
be¡
 
is
 
š¡®Ëd
 
š
 
RIB


2197 
rou‹
 
š
 
rib_rou‹s_jsÚ
:

2198 
¡_found
 = 
True


2199 #V”ify 
Ãxt_hİ
 
š
 
rib_rou‹s_jsÚ


2200 
rib_rou‹s_jsÚ
[
rou‹
][0]['nexthops'][0]['ip'] == \

2201 
_Ãxt_hİ
:

2202 
nh_found
 = 
True


2204 
”rÜmsg
 = ("Nexthop {} is Missing for BGP„oute {}"

2205 " iÀRIB oàrou‹¸{}\n".
	$fÜm©
(
_Ãxt_hİ
, 
rou‹
, 
dut
))

2206  
”rÜmsg


2208 
¡_found
 
ªd
 
nh_found
:

2209 
logg”
.
	`šfo
("Best…ath for…refix: {} is installed‡ccording"

2211 
	`fÜm©
(
rou‹
, 
com·»
, 
©Œibu‹
, \

2212 
©Œibu‹_diù
[
_Ãxt_hİ
], 
dut
))

2214 
logg”
.
	`šfo
("Exiting†ib API: verify_best_path_as_per_admin_distance()")

2215  
True


2218 
def
 
	$v”ify_bgp_commun™y
(
addr_ty³
, 
dut
, 
tg’
, 
ÃtwÜk
, 
šput_diù
 = 
NÚe
):

2220 
This
 
API
 
is
 
to
 
BGP
 
commun™›ss


2222 * `
addr_ty³
` : 

 
ty³
, 
v4
/
v6


2223 * `
dut
`: 
Deviû
 
Und”
 
Te¡


2224 * `
tg’
`: 
tİog’
 
objeù


2225 * `
ÃtwÜk
`:‚‘wÜk 
which
 
£t
 
ü™”Ÿ
 
Ãeds
 
to
 
be
 
v”if›d


2226 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
, 
AS
 
numb”s
 
Ãeds


2227 
to
 
be
 
v”if›d


2230 
logg”
.
	`šfo
("Entering†ib API: verify_bgp_community()")

2232 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

2233 
rou‹r
 !ğ
dut
:

2236 
logg”
.
	`šfo
('V”ifyšg BGP s‘‡‰ribu‹ fÜ duˆ{}:'.
	$fÜm©
(
rou‹r
))

2238 
	$¦“p
(5)

2239 
Ãt
 
š
 
ÃtwÜk
:

2240 
cmd
 = "show bg°{} {} jsÚ".
	$fÜm©
(
addr_ty³
, 
Ãt
)

2241 
show_bgp_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
cmd
, 
isjsÚ
=
True
)

2242 
logg”
.
	$šfo
(
show_bgp_jsÚ
)

2243 "·ths" 
nÙ
 
š
 
show_bgp_jsÚ
:

2244  "NØ´efix…©h found oÀrou‹r: {}".
	$fÜm©
(
dut
)

2246 
as_·ths
 = 
show_bgp_jsÚ
["paths"]

2247 
found
 = 
F®£


2248 
i
 
š
 
	`¿nge
(
	$Ën
(
as_·ths
)):

2249 "ÏrgeCommun™y" 
š
 
show_bgp_jsÚ
["·ths"][
i
]:

2250 
found
 = 
True


2251 
logg”
.
	`šfo
("Large Community‡ttribute is found for„oute: "

2252 "{} iÀrou‹r: {} ".
	$fÜm©
(
Ãt
, 
dut
))

2253 
šput_diù
 !ğ
NÚe
:

2254 
ü™”Ÿ
, 
comm_v®
 
š
 
šput_diù
.
	$™ems
():

2255 
show_v®
 = 
show_bgp_jsÚ
["·ths"][
i
][
ü™”Ÿ
]['string']

2256 
comm_v®
 =ğ
show_v®
:

2257 
logg”
.
	`šfo
("Verifying BGP {} for…refix: {} in"

2259 
	$fÜm©
(
ü™”Ÿ
, 
Ãt
, 
dut
, 
comm_v®
))

2261 
”rÜmsg
 = \

2264 "found: {}".
	$fÜm©
(
ü™”Ÿ
, 
Ãt
, 
dut
, 
comm_v®
,

2265 
show_v®
))

2266  
”rÜmsg


2268 
nÙ
 
found
:

2269 
”rÜmsg
 = ("Large Community‡ttribute is‚ot found for„oute: "

2270 "{} iÀrou‹r: {} ".
	$fÜm©
(
Ãt
, 
dut
))

2271  
”rÜmsg


2273 
logg”
.
	`šfo
("Exiting†ib API: verify_bgp_community()")

2274  
True


2277 
def
 
	$v”ify_bgp_rib
(
ADDR_TYPE
, 
dut
, 
tg’
, 
šput_diù
, 
Ãxt_hİ
 = 
NÚe
, 
´ÙocŞ
 = None):

2279 
This
 
API
 
is
 
to
 
v”ify
 
RIB
 
BGP
 
rou‹s
.

2281 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


2282 * `
dut
`: 
Deviû
 
Und”
 
Te¡
, 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


2283 * `
šput_diù
` : 
šput
 
diù
, 
has
 
d‘as
 
of
 
rou‹s


2284 * `
tg’
` : 
tİog’
 
objeù


2285 * `
Ãxt_hİ
`[
İtiÚ®
]:‚ext_hİ 
which
 
Ãeds
 
to
 
be
 
v”if›d
,  = 

2286 * `
´ÙocŞ
`[
İtiÚ®
]:…rÙocŞ,  = 
NÚe


2289 
logg”
.
	`šfo
("Entering†ib API: verify_bgp_rib()")

2291 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

2292 
rou‹rIÅut
 
š
 
šput_diù
.
	$keys
():

2293 
rou‹r
, 
ºode
 
š
 
rou‹r_li¡
.
	$™”™ems
():

2294 
rou‹r
 !ğ
dut
:

2297 #V”ifyšg 
RIB
 
rou‹s


2298 
commªd
 = "show bg°{} jsÚ".
	$fÜm©
(
ADDR_TYPE
)

2300 
	$¦“p
(2)

2301 
logg”
.
	`šfo
('Checkšg„ou‹¸{} RIB:'.
	$fÜm©
(
dut
))

2302 
rib_rou‹s_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
commªd
, 
isjsÚ
=
True
)

2303 
	$´št
(
rib_rou‹s_jsÚ
)

2305 #V”ifyšg 
ouut
 
diùiÚ¬y
 
rib_rou‹s_jsÚ
 
is
 
nÙ
 
em±y


2306 
	`boŞ
(
rib_rou‹s_jsÚ
è=ğ
F®£
:

2307 
”rÜmsg
 = "No {}„oute found in„ib of„outer {}..".\

2308 
	$fÜm©
(
´ÙocŞ
, 
rou‹r
)

2309  
”rÜmsg


2311 '¡©ic_rou‹s' 
š
 
šput_diù
[
rou‹rIÅut
]:

2312 
¡©ic_rou‹s
 = 
šput_diù
[
rou‹rIÅut
]["static_routes"]

2313 
¡©ic_rou‹
 
š
 
¡©ic_rou‹s
:

2314 
found_rou‹s
 = []

2315 
missšg_rou‹s
 = []

2316 
ÃtwÜk
 = 
¡©ic_rou‹
["network"]

2317 "no_of_" 
š
 
¡©ic_rou‹
:

2318 
no_of_
 = 
¡©ic_rou‹
["no_of_ip"]

2320 
no_of_
 = 0

2322 #G’”©šg 
IPs
 
v”ifiÿtiÚ


2323 
_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
ÃtwÜk
, 
no_of_
)

2324 
¡_¹
 
š
 
_li¡
:

2325 
¡_¹
 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(
¡_¹
)))

2327 
¡_found
 = 
F®£


2328 
nh_found
 = 
F®£


2329 
¡_¹
 
š
 
rib_rou‹s_jsÚ
["routes"]:

2330 
¡_found
 = 
True


2331 
found_rou‹s
.
	$­³nd
(
¡_¹
)

2333 
Ãxt_hİ
 !ğ
NÚe
:

2334 
rib_rou‹s_jsÚ
["rou‹s"][
¡_¹
][0]['nexthops'][0]['ip'] \

2335 =ğ
Ãxt_hİ
:

2336 
nh_found
 = 
True


2338 
”rÜmsg
 = ("Nexthop {} is Missing for {}"

2340 " {}\n".
	$fÜm©
(
Ãxt_hİ
, 
´ÙocŞ
,

2341 
¡_¹
, 
dut
))

2342  
”rÜmsg


2344 
missšg_rou‹s
.
	$­³nd
(
¡_¹
)

2345 
nh_found
:

2346 
logg”
.
	`šfo
("Found‚ext_hop {} for‡ll {}„outes in RIB of"

2347 "„ou‹¸{}\n".
	$fÜm©
(
Ãxt_hİ
, 
´ÙocŞ
, 
rou‹r
))

2349 
nÙ
 
¡_found
 
ªd
 
	`Ën
(
missšg_rou‹s
) > 0:

2350 
”rÜmsg
 = "Missing„oute in RIB of„outer {},„outes: {}" \

2351 " \n".
	$fÜm©
(
dut
, 
missšg_rou‹s
)

2352  
”rÜmsg


2354 
logg”
.
	`šfo
("Verified„outes in„outer {} RIB, found„outes"

2355 "‡»: {}\n".
	$fÜm©
(
dut
, 
found_rou‹s
))

2357 'adv”ti£_ÃtwÜks' 
š
 
šput_diù
[
rou‹rIÅut
]:

2358 
found_rou‹s
 = []

2359 
missšg_rou‹s
 = []

2360 
adv”ti£_ÃtwÜk
 = 
šput_diù
[
rou‹rIÅut
]['advertise_networks']

2361 
adv”ti£_ÃtwÜk_diù
 
š
 
adv”ti£_ÃtwÜk
:

2362 
¡¬t_
 = 
adv”ti£_ÃtwÜk_diù
['start_ip']

2363 'no_of_ÃtwÜk' 
š
 
adv”ti£_ÃtwÜk_diù
:

2364 
no_of_ÃtwÜk
 = 
adv”ti£_ÃtwÜk_diù
['no_of_network']

2366 
no_of_ÃtwÜk
 = 0

2368 #G’”©šg 
IPs
 
v”ifiÿtiÚ


2369 
_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
¡¬t_
, 
no_of_ÃtwÜk
)

2370 
¡_¹
 
š
 
_li¡
:

2371 
¡_¹
 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(
¡_¹
)))

2373 
found
 = 
F®£


2374 
¡_¹
 
š
 
rib_rou‹s_jsÚ
:

2375 
found
 = 
True


2376 
found_rou‹s
.
	$­³nd
(
¡_¹
)

2378 
missšg_rou‹s
.
	$­³nd
(
¡_¹
)

2380 
nÙ
 
found
 
ªd
 
	`Ën
(
missšg_rou‹s
) > 0:

2381 
”rÜmsg
 = "Missing„oute in RIB of„outer {},‡re: {}" \

2382 " \n".
	$fÜm©
(
dut
, 
missšg_rou‹s
)

2383  
”rÜmsg


2385 
logg”
.
	`šfo
("Verified„outes in„outer {} RIB, found„outes"

2386 "‡»: {}\n".
	$fÜm©
(
dut
, 
found_rou‹s
))

2388 
logg”
.
	`šfo
("Exiting†ib API: verify_bgp_rib()")

2389  
True


	@lib/bgprib.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #Cİyrighˆ2018, 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

4 #
#Thi 
´og¿m
 
is
 
ä“
 
soáw¬e
; 
you
 
ÿn
 
»di¡ribu‹
 
™
 
ªd
/
Ü


6 #modify 
™
 
und”
 
the
 
‹rms
 
of
h
GNU
 
G’”®
 
Public
 
Liûn£


7 #a 
published
 
by
 
the
 
F»e
 
Soáw¬e
 
Found©iÚ
; 
e™h”
 
v”siÚ
 2

8 #oà
the
 
Liûn£
, 
Ü
 (
©
 
your
 
İtiÚ
è
ªy
 
Ï‹r
 
v”siÚ
.

9 #
#Thi 
´og¿m
 
is
 
di¡ribu‹d
 
š
 
the
 
hİe
 
th©
 
™
 
wl
 
be
 
u£ful
,

11 #buˆ
WITHOUT
 
ANY
 
WARRANTY
; 
w™hout
 
ev’
 
the
 
im¶›d
 
w¬¿Áy
 
of


12 #MERCHANTABILITY 
Ü
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
. 
S“
 
the


13 #GNU 
G’”®
 
Public
 
Liûn£
 
mÜe
 
d‘as
.

14 #
#You 
should
 
have
 
»ûived
 
a
 
cİy
 
of
 
the
 
GNU
 
G’”®
 
Public
 
Liûn£
 
®Úg


16 #w™h 
this
 
´og¿m
; 
£e
 
the
 
fe
 
COPYING
; 
nÙ
, 
wr™e
 
to
h
F»e
 
Soáw¬e


17 #Found©iÚ, 
Inc
., 51 
F¿nklš
 
St
, 
Fiáh
 
FloÜ
, 
Bo¡Ú
, 
MA
 02110-1301 
USA


26 #
#ribRequœeV²Rou‹s('r2','Cu¡om”„ou‹s',
wªt_rd_rou‹s
)

32 #
#ribRequœeUniÿ¡Rou‹s('r1','v4','r1-cu¡1','Cu¡om”„ou‹ š vrf',
wªt_uniÿ¡_rou‹s
)

34 #ribRequœeUniÿ¡Rou‹s('r1','v4','','Cu¡om”„ou‹ š deçuÉ',
wªt_uniÿ¡_rou‹s
)

37 
äom
 
lut
 
impÜt
 
luCommªd
,
luResuÉ


38 
impÜt
 
jsÚ


39 
impÜt
 
»


41 #gpz: 
g‘
 
rib
 
š
 
jsÚ
 
fÜm
 
ªd
 
com·»
 
agaš¡
 
desœed
 
rou‹s


42 
şass
 
BgpRib
:

43 
def
 
	$rou‹s_šşude_wª‹d
(
£lf
,
pfxtbl
,
wªt
,
debug
):

44 #h–³¸
funùiÚ
 
to
 
RequœeV²Rou‹s


45 
pfx
 
š
 
pfxtbl
.
	$™”keys
():

46 
debug
:

47 
´št
 'Œyšg…fx ' + 
pfx


48 
pfx
 !ğ
wªt
['p']:

49 
debug
:

50 
´št
 'wªˆpfx=' + 
wªt
['p'] + ',‚Ù ' + 
pfx


52 
debug
:

53 
´št
 'havpfx=' + 
pfx


54 
r
 
š
 
pfxtbl
[
pfx
]:

55 
debug
:

56 
´št
 'trying„oute'

57 
Ãxthİs
 = 
r
['nexthops']

58 
nh
 
š
 
Ãxthİs
:

59 
debug
:

60 
´št
 'Œyšg‚h ' + 
nh
['ip']

61 
nh
[''] =ğ
wªt
['n']:

62 
debug
:

63 
´št
 'found ' + 
wªt
['n']

66 
debug
:

67 
´št
 'wªˆnh=' + 
wªt
['n'] + ',‚Ù ' + 
nh
['ip']

68 
debug
:

69 
´št
 'missšg„ou‹:…fx=' + 
wªt
['p'] + ',‚h=' + want['n']

72 
def
 
	$RequœeV²Rou‹s
(
£lf
, 
rg‘
, 
t™Ë
, 
wªŒou‹s
, 
debug
=0):

73 
impÜt
 
jsÚ


74 
log¡r
 = "RequœeV²Rou‹ " + 
	$¡r
(
wªŒou‹s
)

75 #nÚ 
jsÚ
 
fÜm
 
humªs


76 
	`luCommªd
(
rg‘
,'vtysh -c "show bgp ipv4 vpn"','.','None','Get VPN RIB (non-json)')

77 
»t
 = 
	`luCommªd
(
rg‘
,'vtysh -c "show bgp ipv4 vpn json"','.*','None','Get VPN RIB (json)')

78 
»
.
	`£¬ch
(
r
'^\s*$', 
»t
):

79 #deg’”©: 
em±y
 
jsÚ
 
m—ns
 
no
 
rou‹s


80 
	`Ën
(
wªŒou‹s
) > 0:

81 
	$luResuÉ
(
rg‘
, 
F®£
, 
t™Ë
, 
log¡r
)

83 
	$luResuÉ
(
rg‘
, 
True
, 
t™Ë
, 
log¡r
)

84 
rib
 = 
jsÚ
.
	$lßds
(
»t
)

85 
rds
 = 
rib
['routes']['routeDistinguishers']

86 
wªt
 
š
 
wªŒou‹s
:

87 
found
 = 0

88 
debug
:

89 
´št
 "wªˆrd " + 
wªt
['rd']

90 
rd
 
š
 
rds
.
	$™”keys
():

91 
rd
 !ğ
wªt
['rd']:

93 
debug
:

94 
´št
 "found„d " + 
rd


95 
bË
 = 
rds
[
rd
]

96 
£lf
.
	$rou‹s_šşude_wª‹d
(
bË
,
wªt
,
debug
):

97 
found
 = 1

99 
nÙ
 
found
:

100 
	$luResuÉ
(
rg‘
, 
F®£
, 
t™Ë
, 
log¡r
)

102 
	$luResuÉ
(
rg‘
, 
True
, 
t™Ë
, 
log¡r
)

104 
def
 
	$RequœeUniÿ¡Rou‹s
(
£lf
,
rg‘
,
afi
,
vrf
,
t™Ë
,
wªŒou‹s
,
debug
=0):

105 
log¡r
 = "RequœeV²Rou‹ " + 
	$¡r
(
wªŒou‹s
)

106 
vrf¡r
 = ''

107 
vrf
 != '':

108 
vrf¡r
 = 'vrà%s' % (
vrf
)

110 ià(
afi
 !ğ'v4'è
	`ªd
 (afi != 'ipv6'):

111 
´št
 "ERROR invalid‡fi";

113 
cmd¡r
 = 'show bg°% % uniÿ¡' % (
vrf¡r
, 
afi
)

114 #nÚ 
jsÚ
 
fÜm
 
humªs


115 
cmd
 = 'vtysh -ø"%s"' % 
cmd¡r


116 
	`luCommªd
(
rg‘
,
cmd
,'.','NÚe','G‘ % % RIB (nÚ-jsÚ)' % (
vrf¡r
, 
afi
))

117 
cmd
 = 'vtysh -ø"% jsÚ"' % 
cmd¡r


118 
»t
 = 
	`luCommªd
(
rg‘
,
cmd
,'.*','NÚe','G‘ % % RIB (jsÚ)' % (
vrf¡r
, 
afi
))

119 
»
.
	`£¬ch
(
r
'^\s*$', 
»t
):

120 #deg’”©: 
em±y
 
jsÚ
 
m—ns
 
no
 
rou‹s


121 
	`Ën
(
wªŒou‹s
) > 0:

122 
	$luResuÉ
(
rg‘
, 
F®£
, 
t™Ë
, 
log¡r
)

124 
	$luResuÉ
(
rg‘
, 
True
, 
t™Ë
, 
log¡r
)

125 
rib
 = 
jsÚ
.
	$lßds
(
»t
)

126 
Œy
:

127 
bË
 = 
rib
['routes']

128 #KeyE¼Ü: 'rou‹s' 
´obably
 
m—ns
 
missšg
/
bad
 
VRF


129 
exû±
 
KeyE¼Ü
 
as
 
”r
:

130 
vrf
 != '':

131 
”r¡r
 = '-süˆERROR: check iàwrÚg vrà(%s)' % (
vrf
)

133 
”r¡r
 = '-script ERROR: check if vrf missing'

134 
	`luResuÉ
(
rg‘
, 
F®£
, 
t™Ë
 + 
”r¡r
, 
log¡r
)

136 
wªt
 
š
 
wªŒou‹s
:

137 
nÙ
 
£lf
.
	$rou‹s_šşude_wª‹d
(
bË
,
wªt
,
debug
):

138 
	$luResuÉ
(
rg‘
, 
F®£
, 
t™Ë
, 
log¡r
)

140 
	$luResuÉ
(
rg‘
, 
True
, 
t™Ë
, 
log¡r
)

143 
BgpRib
=
	$BgpRib
()

145 
def
 
	$bg´ibRequœeV²Rou‹s
(
rg‘
, 
t™Ë
, 
wªŒou‹s
, 
debug
=0):

146 
BgpRib
.
	$RequœeV²Rou‹s
(
rg‘
, 
t™Ë
, 
wªŒou‹s
, 
debug
)

148 
def
 
	$bg´ibRequœeUniÿ¡Rou‹s
(
rg‘
, 
afi
, 
vrf
, 
t™Ë
, 
wªŒou‹s
, 
debug
=0):

149 
BgpRib
.
	`RequœeUniÿ¡Rou‹s
(
rg‘
, 
afi
, 
vrf
, 
t™Ë
, 
wªŒou‹s
, 
debug
)

	@lib/common_config.py

1 #
#Cİyrighˆ(
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

3 #U£d 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
.

4 #("N‘DEF"è
š
 
this
 
fe
.

5 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


7 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


8 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


9 #š 
®l
 
cİ›s
.

10 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


12 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


13 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


14 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


15 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

16 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


17 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


18 #OF 
THIS
 
SOFTWARE
.

21 
impÜt
 
os


22 
impÜt
 
sys


23 
impÜt
 
SŒšgIO


24 
impÜt
 
Œaûback


25 
impÜt
 
add»ss


26 
impÜt
 
CÚfigP¬£r


27 
äom
 
time
 
impÜt
 
¦“p


28 
äom
 
d©‘ime
 
impÜt
 
	gd©‘ime


30 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


31 
äom
 
lib
 
impÜt
 
tİÙe¡


32 
äom
 
	glib
.
tİog’
 
impÜt
 
	gTİog’
, 
	gTİoRou‹r
, 
g‘_tİog’


33 
äom
 
	glib
.
tİŞog
 
impÜt
 
	glogg”
, 
logg”_cÚfig


35 
	gsys
.
	gv”siÚ_šfo
 >= (3,):

36 
impÜt
 
io


38 
impÜt
 
cSŒšgIO


40 
PERMIT
 = 1

41 
DENY
 = 0

42 
ADDR_TYPE_IPv4
 = 1

43 
ADDR_TYPE_IPv6
 = 2

44 
IPv4_UNICAST
 = 1

45 
VPNv4_UNICAST
 = 2

46 
IPv6_UNICAST
 = 3

47 
FRRCFG_FILE
 = 'frr_json.conf'

48 
är_cfg
 = {}

51 
CD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

52 
py‹¡ši_·th
 = 
os
.
·th
.
	`još
(
CD
, '../pytest.ini')

54 #NOTE: 
to
 
§ve
 
executiÚ
 
logs
Ø
log
 
fe
 
ä¹e¡_log_dœ
 
mu¡
 
be
 
cÚfigu»d


55 #š `
py‹¡
.
ši
`.

56 
cÚfig
 = 
CÚfigP¬£r
.
	$CÚfigP¬£r
()

57 
cÚfig
.
	$»ad
(
py‹¡ši_·th
)

59 
CONFIG_SECTION
 = 'topogen'

61 
cÚfig
.
	`has_İtiÚ
('topogen', 'verbosity'):

62 
logËv–
 = 
cÚfig
.
	`g‘
('topogen', 'verbosity')

63 
logËv–
 =†ogËv–.
	$uµ”
()

65 
logËv–
 = 'INFO'

67 
cÚfig
.
	`has_İtiÚ
('topogen', 'frrtest_log_dir'):

68 
ä¹e¡_log_dœ
 = 
cÚfig
.
	`g‘
('topogen', 'frrtest_log_dir')

69 
time_¡amp
 = 
d©‘ime
.
	`time
(d©‘ime.
	$now
())

70 
logfe_Çme
 = "frr_test_bgp_"

71 
ä¹e¡_log_fe
 = 
ä¹e¡_log_dœ
 + 
logfe_Çme
 + 
	$¡r
(
time_¡amp
)

73 
logg”
 = 
logg”_cÚfig
.
	`g‘_logg”
(
Çme
='test_execution_logs',

74 
log_Ëv–
=
logËv–
,

75 
rg‘
=
ä¹e¡_log_fe
)

76 
´št
 "Log wÈb£ÁØlogfe: {}".
	$fÜm©
(
ä¹e¡_log_fe
)

78 
cÚfig
.
	`has_İtiÚ
('topogen', 'show_router_config'):

79 
show_rou‹r_cÚfig
 = 
cÚfig
.
	`g‘
('topogen', 'show_router_config')

81 
show_rou‹r_cÚfig
 = 
F®£


83 ###
 RoutšgPB:

86 
def
 
	$__š™__
(
£lf
):

87 
£lf
.
š‹rçûs_cfg
 = 
NÚe


88 
£lf
.
¡©ic_rou‹
 = []

89 
£lf
.
´efix_li¡s
 = []

90 
£lf
.
rou‹_m­s
 = []

93 
şass
 
FRRCÚfig
:

95 
def
 
	$__š™__
(
£lf
, 
rou‹r
, 
routšg_cfg_msg
, 
ärcfg_fe
):

96 
£lf
.
rou‹r
 =„outer

97 
£lf
.
routšg_pb
 = 
routšg_cfg_msg


98 
£lf
.
”rÜs
 = []

99 
£lf
.
š‹rçûs_cfg
 = 
	$g‘_SŒšgIO
()

100 
£lf
.
routšg_commÚ
 = 
	$g‘_SŒšgIO
()

101 
£lf
.
¡©ic_rou‹s
 = 
	$g‘_SŒšgIO
()

102 
£lf
.
as_·th_´•’d
 = 
F®£


103 
£lf
.
acûss_li¡s
 = 
	$g‘_SŒšgIO
()

104 
£lf
.
´efix_li¡s
 = 
	$g‘_SŒšgIO
()

105 
£lf
.
rou‹_m­s
 = 
	$g‘_SŒšgIO
()

106 
£lf
.
_rou‹_m­_£q_id
 = 0

107 
£lf
.
ärcfg_fe
 = frrcfg_file

109 
def
 
	$»£t_rou‹_m­_£q_id
(
£lf
):

110 
£lf
.
_rou‹_m­_£q_id
 = 0

112 
def
 
	$»£t_™
(
£lf
):

113 
£lf
.
”rÜs
 = []

114 
£lf
.
š‹rçûs_cfg
 = 
	$g‘_SŒšgIO
()

115 
£lf
.
routšg_commÚ
 = 
	$g‘_SŒšgIO
()

116 
£lf
.
¡©ic_rou‹s
 = 
	$g‘_SŒšgIO
()

117 
£lf
.
as_·th_´•’d
 = 
F®£


118 
£lf
.
acûss_li¡s
 = 
	$g‘_SŒšgIO
()

119 
£lf
.
´efix_li¡s
 = 
	$g‘_SŒšgIO
()

120 
£lf
.
rou‹_m­s
 = 
	$g‘_SŒšgIO
()

122 
def
 
	$cu¼’t_rou‹_m­_£q_id
(
£lf
):

123  
£lf
.
_rou‹_m­_£q_id


125 
def
 
	$g‘_rou‹_m­_£q_id
(
£lf
):

126 
£lf
.
_rou‹_m­_£q_id
 = self._route_map_seq_id + 10

127  
£lf
.
_rou‹_m­_£q_id


129 
def
 
	$g‘_commun™y_li¡_»gex_Çme
(
£lf
):

130 
£lf
.
_commun™y_li¡_»gex_šdex
 = self._community_list_regex_index + 1

131  'comm-li¡-»gex-' + 
	$¡r
(
£lf
.
_commun™y_li¡_»gex_šdex
)

133 
def
 
	$´št_commÚ_cÚfig_to_fe
(
£lf
, 
tİo
):

134 
Œy
:

135 
ärcfg
 = 
	`İ’
(
£lf
.
ärcfg_fe
, 'w')

136 
exû±
 
IOE¼Ü
 
as
 
”r
:

137 
logg”
.
	`”rÜ
('Unableo open FRR Config File.ƒrror(%s): %s' %

138 (
”r
.
”ºo
,ƒ¼.
¡»¼Ü
))

139  
F®£


141 
ärcfg
.
	`wr™e
('! FRR General Config\n')

142 
ärcfg
.
	`wr™e
(
£lf
.
routšg_commÚ
.
	$g‘v®ue
())

143 
ärcfg
.
	`wr™e
('! Interfaces Config\n')

144 
ärcfg
.
	`wr™e
(
£lf
.
š‹rçûs_cfg
.
	$g‘v®ue
())

145 #Ià
bgp
 
ÃighbÜsh
 
is
 
bešg
 
dÚe
 
usšg
 
loİback
 
š‹rçû
 -

146 #- 
th’
 
we
 
have
 
make
 
the
 
loİback
 
š‹rçû
 
»achab™y
 
up
 -

147 #- 
th©
 
we
 
¬e
 
addšg
 
rou‹s
 -

148 
deviû
 = 
tİo
['rou‹rs']['{}'.
	`fÜm©
(
£lf
.
rou‹r
)]

149 "bgp" 
š
 
deviû
:

150 
ÃighbÜs
 = 
deviû
["bgp"]['bgp_neighbors']

151 
key
, 
v®ue
 
š
 
ÃighbÜs
.
	$™”™ems
():

152 
³”
 = 
ÃighbÜs
[
key
]['peer']

153 "sourû" 
š
 
³”
 
ªd
…eer['source'] == 'lo':

154 
	`add_¡©ic_rou‹_fÜ_loİback_š‹rçûs
(

155 'v4', 
£lf
.
rou‹r
, 
tİo
, 
ärcfg
)

157 
ärcfg
.
	`wr™e
('! Static Route Config\n')

158 
ärcfg
.
	`wr™e
(
£lf
.
¡©ic_rou‹s
.
	$g‘v®ue
())

159 
ärcfg
.
	`wr™e
('! Access List Config\n')

160 
ärcfg
.
	`wr™e
(
£lf
.
acûss_li¡s
.
	$g‘v®ue
())

161 
ärcfg
.
	`wr™e
('! Prefix List Config\n')

162 
ärcfg
.
	`wr™e
(
£lf
.
´efix_li¡s
.
	$g‘v®ue
())

163 
ärcfg
.
	`wr™e
('! Route Maps Config\n')

164 
ärcfg
.
	`wr™e
(
£lf
.
rou‹_m­s
.
	$g‘v®ue
())

166 
ärcfg
.
	`wr™e
('line vty\n')

167 
ärcfg
.
	$şo£
()

168  
True


170 
def
 
	$şo£
(
£lf
):

171 
£lf
.
routšg_commÚ
.
	$şo£
()

172 
£lf
.
¡©ic_rou‹s
.
	$şo£
()

173 
£lf
.
´efix_li¡s
.
	$şo£
()

174 
£lf
.
rou‹_m­s
.
	$şo£
()

176 
def
 
	$ü—‹_commÚ_cÚfigu¿tiÚ
(
ADDR_TYPE
, 
tg’
, 
CWD
, 
tİo
, 
rou‹r
):

178 
It
 
wl
 
§ve
 
rou‹rs
 
commÚ
 
cÚfigu¿tiÚ
 
to
 
är
.
cÚf
 
fe


180 * `
ADDR_TYPE
` : 

 
ty³
 
v4
/
v6


181 * `
tg’
` : 
Tİog’
 
objeù


182 * `
CWD
` : 
ÿÎ”
's current working directory

183 * `
tİo
` : 
jsÚ
 
fe
 
d©a


184 * `
rou‹r
` : 
cu¼’t
„outer

187 
Œy
:

188 
glob®
 
är_cfg


189 
li¡Rou‹rs
 = []

190 
rou‹rN
 
š
 
tİo
['rou‹rs'].
	$™”™ems
():

191 
li¡Rou‹rs
.
	$­³nd
(
rou‹rN
[0])

193 
li¡Rou‹rs
.
	$sÜt
()

195 
curRou‹r
 
š
 
li¡Rou‹rs
:

196 
curRou‹r
 !ğ
rou‹r
:

199 
¹_cfg
 = 
	$RoutšgPB
()

200 
âame
 = '{}/{}/{}'.
	$fÜm©
(
CWD
, 
rou‹r
, 
FRRCFG_FILE
)

201 
är_cfg
[
rou‹r
] = 
	$FRRCÚfig
(
rou‹r
, 
¹_cfg
, 
âame
)

203 
šput_diù
 = 
tİo
['routers']

204 'lšks' 
š
 
tİo
['rou‹rs'][
rou‹r
] 
Ü
 'lo' inopo['routers'][router]:

205 
är_cfg
[
rou‹r
].
routšg_pb
.
š‹rçûs_cfg
 = 
	$ü—‹_š‹rçûs_cfg
(

206 
rou‹r
, 
tİo
)

207 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

208 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

209 #Lßd 
cÚfigu¿tiÚ
 
to
 
rou‹r


210 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

212 '¡©ic_rou‹s' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

213 
»suÉ
 = 
	$ü—‹_¡©ic_rou‹s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
,

214 
tİo
)

215 
as£¹
 
»suÉ
 =ğ
True
, ("API: create_static_routes() :Failed"

216 " \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
))

218 '´efix_li¡s' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

219 
»suÉ
 = 
	$ü—‹_´efix_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
,

220 
tİo
)

221 
as£¹
 
»suÉ
 =ğ
True
, ("API: create_prefix_lists() :Failed "

222 "\ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
))

224 'rou‹_m­s' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

225 
»suÉ
 = 
	$ü—‹_rou‹_m­s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
)

226 
as£¹
 
»suÉ
 =ğ
True
, ("API: create_route_maps() :Failed"

227 " \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
))

229 
exû±
 
Exû±iÚ
 
as
 
e
:

230 
logg”
.
	`”rÜ
(
Œaûback
.
	$fÜm©_exc
())

231  
F®£


233  
True


235 #############################################
#H–³¸
şas£s
 
to
 
§ve
 
cÚfigu¿tiÚ


239 #IÁ”çû 
h–³r
 
şass
 
š‹rçû
 
cÚfigu¿tiÚ


240 
şass
 
IÁ”çû
:

242 
def
 
	$__š™__
(
£lf
, 
š‹rçû_Çme
, 
š‹rçû__add»s£s
):

243 
£lf
.
š‹rçû_Çme
 = interface_name

244 
£lf
.
š‹rçû__add»s£s
 = interface_ip_addresses

247 
şass
 
IÁ”çûs
:

249 
def
 
	$__š™__
(
£lf
):

250 
£lf
.
š‹rçûs
 = []

252 
def
 
	$add_š‹rçû
(
£lf
, 
š‹rçû_Çme
, 
š‹rçû__add»s£s
):

253 
n
 
š
 
£lf
.
š‹rçûs
:

254 
n
.
š‹rçû_Çme
 == interface_name:

255 
n
.
š‹rçû__add»ss
.
	$­³nd
(
š‹rçû__add»s£s
)

258 
š‹rçû
 = 
	$IÁ”çû
(
š‹rçû_Çme
, 
š‹rçû__add»s£s
)

259 
£lf
.
š‹rçûs
.
	$­³nd
(
š‹rçû
)

260  
š‹rçû


263 
def
 
	$_´št_š‹rçûs_cfg
(
är_cfg
, 
š‹rçû
):

264 
š‹rçû_Çme
 = 
š‹rçû
.interface_name

265 
š‹rçû__add»s£s
 = 
š‹rçû
.interface_ip_addresses

266 
är_cfg
.
š‹rçûs_cfg
.
	`wr™e
('š‹rçû ' + 
	`¡r
(
š‹rçû_Çme
) + '\n')

267 
add»ss
 
š
 
š‹rçû__add»s£s
:

268 '::' 
š
 
add»ss
:

269 
är_cfg
.
š‹rçûs_cfg
.
	`wr™e
('v6‡dd»s ' + 
	`¡r
(
add»ss
) + '\n')

271 
är_cfg
.
š‹rçûs_cfg
.
	`wr™e
('‡dd»s ' + 
	`¡r
(
add»ss
) + '\n')

274 
def
 
	$š‹rçûs_cfg
(
är_cfg
):

275 
içûs
 = 
är_cfg
.
routšg_pb
.
š‹rçûs_cfg


276 
š‹rçû
 
š
 
içûs
.
š‹rçûs
:

277 
	$_´št_š‹rçûs_cfg
(
är_cfg
, 
š‹rçû
)

279 #H–³¸
şass
 
Stic
 
rou‹
 
Ãxthİ
 
cÚfigu¿tiÚ


280 
şass
 
Nexthİ
:

282 
def
 
	$__š™__
(
£lf
, 

, 
bÏckhŞe
 = 
F®£
, 
admš_di¡ªû
 = 1,

283 
if_Çme
 = 
NÚe
, 
g
 = None):

284 
£lf
.

 = ip

285 
£lf
.
bÏckhŞe
 = blackhole

286 
£lf
.
admš_di¡ªû
 =‡dmin_distance

287 
£lf
.
if_Çme
 = if_name

288 
£lf
.
g
 =ag

290 #H–³¸
şass
 
Stic
 
rou‹
 

-
´efix
 
cÚfigu¿tiÚ


291 
şass
 
Rou‹
:

293 
def
 
	$__š™__
(
£lf
, 
´efix
):

294 
£lf
.
´efix
 =…refix

295 
£lf
.
Ãxthİs
 = []

297 
def
 
	$add_Ãxthİ
(
£lf
, 

, 
bÏckhŞe
, 
admš_di¡ªû
, 
if_Çme
, 
g
):

298 
nhİ
 = 
	$Nexthİ
(

, 
bÏckhŞe
, 
admš_di¡ªû
, 
if_Çme
, 
g
)

299 
£lf
.
Ãxthİs
.
	$­³nd
(
nhİ
)

302 
def
 
	$¡©ic_¹_nh
(
nh
):

303 
rc
 = 0

304 
Ãxthİ
 = ''

305 
admš_di¡
 = '1'

306 
g
 = 
NÚe


307 
nh
.

:

308 
Ãxthİ
 = 
	$IpAdd»ssMsg_to_¡r
(
nh
.

)

309 
–if
 
nh
.
bÏckhŞe
:

310 
Ãxthİ
 = 'blackhole'

311 
nh
.
if_Çme
 !ğ
NÚe
:

312 
Ãxthİ
 =‚exthİ + ' ' + 
nh
.
if_Çme


313 
nh
.
admš_di¡ªû
 > 0:

314 
admš_di¡
 = 
	$¡r
(
nh
.
admš_di¡ªû
)

315 
nh
.
g
 !ğ
NÚe
:

316 
g
 = 
nh
.tag

317  (
rc
, 
Ãxthİ
, 
admš_di¡
, 
g
)

319 
def
 
	$¡©ic_¹_cfg
(
är_cfg
):

320 
är_cfg
.
routšg_pb
.
¡©ic_rou‹
 =ğ
NÚe
:

322 
¡
 
š
 
är_cfg
.
routšg_pb
.
¡©ic_rou‹
:

323 
´efix
 = 
	$IpAdd»ssMsg_to_¡r
(
¡
.
´efix
)

324 
addr_ty³
 = 
¡
.
´efix
.
afi


325 
_cmd
 = 
	$g‘__cmd
(
addr_ty³
)

326 
nh
 
š
 
¡
.
Ãxthİs
:

327 
rc
, 
Ãxthİ
, 
admš_di¡
, 
g
 = 
	$¡©ic_¹_nh
(
nh
)

328 
rc
 == 0:

329 
g
 =ğ
NÚe
:

330 
är_cfg
.
¡©ic_rou‹s
.
	`wr™e
(' '.
	`još
([
_cmd
,

331 'rou‹', 
´efix
, 
Ãxthİ
, 
admš_di¡
, '\n']))

333 
är_cfg
.
¡©ic_rou‹s
.
	`wr™e
(' '.
	`još
([
_cmd
,

334 'rou‹', 
´efix
, 
Ãxthİ
, 'g', 
	`¡r
(
g
), 
admš_di¡
, '\n']))

336 
är_cfg
.
”rÜs
.
	`­³nd
('StiøRou‹: ' + 
´efix
 + 'w™h Nexthİ: ' + 
	$¡r
(
nh
))

338 #H–³¸
şass
 
g’”®
 
N‘wÜk
 
cÚfigu¿tiÚ


339 
şass
 
N‘wÜk
:

341 
def
 
	$__š™__
(
£lf
, 
afi
, 
v4
, 
v6
, 
´efix_Ëngth
):

342 
£lf
.
afi
 =‡fi

343 
£lf
.
v4
 = ipv4

344 
£lf
.
v6
 = ipv6

345 
£lf
.
´efix_Ëngth
 =…refix_length

348 #H–³¸
şass
 
Add»ss
 
ty³
 
cÚfigu¿tiÚ


349 
şass
 
Add»ss
:

351 
def
 
	$__š™__
(
£lf
, 
afi
, 
v4
, 
v6
):

352 
£lf
.
afi
 =‡fi

353 
£lf
.
v4
 = ipv4

354 
£lf
.
v6
 = ipv6

356 #H–³¸
şass
 
IP
 
P»fix
 
li¡
 
cÚfigu¿tiÚ


357 
şass
 
Pfx
:

358 
def
 
	$__š™__
(
£lf
, 
Ëss_Ü_equ®_b™s
, 
g»©”_Ü_equ®_b™s
, 
aùiÚ
, 
ÃtwÜk
, 
£qid
):

359 
£lf
.
Ëss_Ü_equ®_b™s
 =†ess_or_equal_bits

360 
£lf
.
g»©”_Ü_equ®_b™s
 = greater_or_equal_bits

361 
£lf
.
aùiÚ
 =‡ction

362 
£lf
.
ÃtwÜk
 =‚etwork

363 
£lf
.
£q_id
 = 
£qid


365 
şass
 
P»fixLi¡
:

366 
def
 
	$__š™__
(
£lf
, 
Çme
):

367 
£lf
.
´efix_li¡_uuid_Çme
 = 
Çme


368 
£lf
.
´efix
 = []

369 
def
 
	$add_pfx
(
£lf
, 
pfx
):

370 
£lf
.
´efix
.
	$­³nd
(
pfx
)

372 
def
 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
):

373 
rou‹_m­_£q
.
aùiÚ
 =ğ
PERMIT
:

378 
def
 
	$´efixli¡_cfg
(
är_cfg
, 
ADDR_TYPE
):

379 
är_cfg
.
routšg_pb
.
´efix_li¡s
 =ğ
NÚe
:

381 
´efixli¡
 
š
 
är_cfg
.
routšg_pb
.
´efix_li¡s
:

382 
Çme
 = 
´efixli¡
.
´efix_li¡_uuid_Çme


383 
´efix
 
š
 
´efixli¡
.prefix:

384 
Ë_ge
 = ""

386 
´efix
.
ÃtwÜk
 !ğ
NÚe
:

387 ià(
´efix
.
Ëss_Ü_equ®_b™s
 
ªd


388 
´efix
.
ÃtwÜk
.
´efix_Ëngth
 <ğ´efix.
Ëss_Ü_equ®_b™s
):

389 
Ë_ge
 = " ".
	`još
([Ë_ge, "Ë", 
	`¡r
(
´efix
.
Ëss_Ü_equ®_b™s
)])

391 ià(
´efix
.
g»©”_Ü_equ®_b™s
 
ªd


392 
´efix
.
g»©”_Ü_equ®_b™s
 >ğ´efix.
ÃtwÜk
.
´efix_Ëngth
):

393 
Ë_ge
 = " ".
	`još
([Ë_ge, "ge", 
	`¡r
(
´efix
.
g»©”_Ü_equ®_b™s
)])

395 
ÃtwÜk
 = 
	$IpP»fixMsg_to_¡r
(
´efix
.
ÃtwÜk
)

396 
_cmd
 = 
	$g‘__cmd
(
´efix
.
ÃtwÜk
.
afi
)

397 
är_cfg
.
´efix_li¡s
.
	`wr™e
(' '.
	`još
([

398 
_cmd
, '´efix-li¡', 
Çme
, '£q', 
	`¡r
(
´efix
.
£q_id
),

399 
´efix
.
aùiÚ
, 
ÃtwÜk
, 
Ë_ge
, '\n']))

401 
ÃtwÜk
 = 'any'

402 
ADDR_TYPE
 == "ipv4":

403 
är_cfg
.
´efix_li¡s
.
	`wr™e
(' '.
	`još
([

404 '', '´efix-li¡', 
Çme
, '£q', 
	`¡r
(
´efix
.
£q_id
),

405 
´efix
.
aùiÚ
, 
ÃtwÜk
, '\n']))

407 
är_cfg
.
´efix_li¡s
.
	`wr™e
(' '.
	`još
([

408 'v6', '´efix-li¡', 
Çme
, '£q', 
	`¡r
(
´efix
.
£q_id
),

409 
´efix
.
aùiÚ
, 
ÃtwÜk
, '\n']))

411 #H–³¸
şass
 
Rou‹
-
M­s
 
cÚfigu¿tiÚ


412 
şass
 
Rou‹M­M©ch
:

413 
def
 
	$__š™__
(
£lf
):

414 
£lf
.
g
 = 
NÚe


415 
£lf
.
´efix_li¡
 = []

416 
£lf
.
commun™y_li¡
 = []

417 
£lf
.
Ïrge_commun™y_li¡
 = []

419 
def
 
	$add_´efix_li¡
(
£lf
, 
´efix_li¡
):

420 
£lf
.
´efix_li¡
.
	$­³nd
(
´efix_li¡
)

422 
def
 
	$add_commun™y_li¡
(
£lf
, 
commun™y_li¡
):

423 
£lf
.
commun™y_li¡
.
	$­³nd
(
commun™y_li¡
)

425 
def
 
	$add_Ïrge_commun™y_li¡
(
£lf
, 
Ïrge_commun™y_li¡
):

426 
£lf
.
Ïrge_commun™y_li¡
.
	$­³nd
(
Ïrge_commun™y_li¡
)

428 
şass
 
Rou‹M­S‘
:

429 
def
 
	$__š™__
(
£lf
, 
loÿl_´eã»nû
=
NÚe
, 
m‘ric
=NÚe, 
as_·th_´•’d
=None,

430 
commun™y
=
NÚe
, 
commun™y_add™ive
=NÚe, 
weight
=None,

431 
Ïrge_commun™y
=
NÚe
, 
£t_aùiÚ
=NÚe, 
med
=None):

432 
£lf
.
loÿl_´eã»nû
 =†ocal_preference

433 
£lf
.
m‘ric
 = metric

434 
£lf
.
as_·th_´•’d
 =‡s_path_prepend

435 
£lf
.
commun™y
 = community

436 
£lf
.
commun™y_add™ive
 = community_additive

437 
£lf
.
weight
 = weight

438 
£lf
.
Ïrge_commun™y
 =†arge_community

439 
£lf
.
£t_aùiÚ
 = set_action

440 
£lf
.
med
 = med

442 
şass
 
Rou‹M­Seq
:

443 
def
 
	$__š™__
(
£lf
, 
m©ch
, 
aùiÚ
, 
rou‹_m­_£t
):

444 
£lf
.
m©ch
 = match

445 
£lf
.
aùiÚ
 =‡ction

446 
£lf
.
rou‹_m­_£t
 =„oute_map_set

448 
şass
 
Rou‹M­
:

449 
def
 
	$__š™__
(
£lf
, 
Çme
):

450 
£lf
.
rou‹_m­_uuid_Çme
 = 
Çme


451 
£lf
.
rou‹_m­_£q
 = []

453 
def
 
	$add_£q
(
£lf
, 
m©ch
, 
aùiÚ
, 
rou‹_m­_£t
):

454 
rm­_£q
 = 
	$Rou‹M­Seq
(
m©ch
, 
aùiÚ
, 
rou‹_m­_£t
)

455 
£lf
.
rou‹_m­_£q
.
	$­³nd
(
rm­_£q
)

457 
def
 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
):

458 
rou‹_m­_£q
.
aùiÚ
 =ğ
PERMIT
:

463 
def
 
	$rou‹_m­_£t_cfg
(
är_cfg
, 
rou‹_m­_£t
):

465 
add™ive
 = ''

466 
rou‹_m­_£t
.
commun™y_add™ive
:

467 
add™ive
 = 'additive'

469 #LoÿÈ
P»ã»nû


470 
rou‹_m­_£t
.
loÿl_´eã»nû
:

471 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

472 '£t', 'loÿl-´eã»nû', 
	`¡r
(
rou‹_m­_£t
.
loÿl_´eã»nû
), "\n"]))

475 
rou‹_m­_£t
.
m‘ric
:

476 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

477 '£t', 'm‘ric', 
	`¡r
(
rou‹_m­_£t
.
m‘ric
), "\n"]))

479 #AS 
P©h
 
P»³nd


480 
rou‹_m­_£t
.
as_·th_´•’d
 !ğ
NÚe
:

481 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

482 '£t', 'as-·th', '´•’d', 
rou‹_m­_£t
.
as_·th_´•’d
, "\n"]))

485 
rou‹_m­_£t
.
commun™y
:

486 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

487 '£t', 'commun™y', 
rou‹_m­_£t
.
commun™y
, 
add™ive
, 
£t_aùiÚ
, "\n"]))

489 #L¬ge-
Commun™y
 
w™h
 
d–‘e


490 
rou‹_m­_£t
.
£t_aùiÚ
 !ğ
NÚe
 
ªd
„oute_map_set.set_action == "delete":

491 
rou‹_m­_£t
.
Ïrge_commun™y
:

492 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(

493 ['£t', 'Ïrge-comm-li¡', 
rou‹_m­_£t
.
Ïrge_commun™y
,

494 
rou‹_m­_£t
.
£t_aùiÚ
, "\n"]))

496 #L¬ge-
Commun™y


497 
rou‹_m­_£t
.
Ïrge_commun™y
:

498 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(

499 ['£t', 'Ïrge-commun™y', 
rou‹_m­_£t
.
Ïrge_commun™y
,

500 
add™ive
, "\n"]))

503 
rou‹_m­_£t
.
weight
:

504 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

505 '£t', 'weight', 
	`¡r
(
rou‹_m­_£t
.
weight
), "\n"]))

507 
def
 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
):

508 
rou‹_m­_£q
.
rou‹_m­_£t
 !ğ
NÚe
:

509 
	$rou‹_m­_£t_cfg
(
är_cfg
, 
rou‹_m­_£q
.
rou‹_m­_£t
)

511 
def
 
	$hªdË_m©ch_´efix_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
):

512 
Çme
 = 
rou‹m­
.
rou‹_m­_uuid_Çme


513 
aùiÚ
 = 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
)

515 
ADDR_TYPE
 == 'ipv4':

516 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

517 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

518 
	`¡r
(
£q_id
), "\n"]))

520 
´efix_li¡
 
š
 
rou‹_m­_£q
.
m©ch
.prefix_list:

521 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

523 
´efix_li¡
.
´efix_li¡_uuid_Çme
, '\n']))

525 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

526 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

530 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

531 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

532 
	`¡r
(
£q_id
), "\n"]))

534 
´efix_li¡
 
š
 
rou‹_m­_£q
.
m©ch
.prefix_list:

535 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

537 
´efix_li¡
.
´efix_li¡_uuid_Çme
, '\n']))

539 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

540 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

542 
def
 
	$hªdË_m©ch_g
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
):

543 
Çme
 = 
rou‹m­
.
rou‹_m­_uuid_Çme


544 
aùiÚ
 = 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
)

548 
ADDR_TYPE
 == 'ipv4':

549 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

550 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

551 
	`¡r
(
£q_id
), "\n"]))

552 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

553 'm©ch', 'g', 
	`¡r
(
rou‹_m­_£q
.
m©ch
.
g
), '\n']))

555 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

556 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

560 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

561 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

562 
	`¡r
(
£q_id
), "\n"]))

563 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

564 'm©ch', 'g', 
	`¡r
(
rou‹_m­_£q
.
m©ch
.
g
), '\n']))

566 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

567 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

569 
def
 
	$hªdË_m©ch_commun™y_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
):

570 
Çme
 = 
rou‹m­
.
rou‹_m­_uuid_Çme


571 
aùiÚ
 = 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
)

573 
commun™y
 
š
 
rou‹_m­_£q
.
m©ch
.
commun™y_li¡
:

575 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

576 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

577 
	`¡r
(
£q_id
), "\n"]))

578 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

579 'm©ch', 'commun™y', 
commun™y
, '\n']))

581 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

582 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

584 
def
 
	$hªdË_m©ch_Ïrge_commun™y_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
):

585 
Çme
 = 
rou‹m­
.
rou‹_m­_uuid_Çme


586 
aùiÚ
 = 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
)

588 
commun™y
 
š
 
rou‹_m­_£q
.
m©ch
.
Ïrge_commun™y_li¡
:

590 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

591 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
,

592 
	`¡r
(
£q_id
), "\n"]))

593 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
([

594 'm©ch', 'Ïrge-commun™y', 
commun™y
, '\n']))

596 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

597 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

599 
def
 
	$hªdË_no_m©ch_£t_Úly
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
):

600 
Çme
 = 
rou‹m­
.
rou‹_m­_uuid_Çme


601 
aùiÚ
 = 
	$g‘_aùiÚ_äom_rou‹_m­_£q
(
rou‹_m­_£q
)

602 
£q_id
 = 
är_cfg
.
	$g‘_rou‹_m­_£q_id
()

603 
är_cfg
.
rou‹_m­s
.
	`wr™e
(' '.
	`još
(['rou‹-m­', 
Çme
, 
aùiÚ
, 
	`¡r
(
£q_id
), "\n"]))

605 
	$hªdË_rou‹_m­_£q_£t
(
är_cfg
, 
rou‹_m­_£q
)

606 
är_cfg
.
rou‹_m­s
.
	`wr™e
("! END oà" + 
Çme
 + " - " + 
	`¡r
(
£q_id
) + "\n")

608 
def
 
	$rou‹m­_cfg
(
är_cfg
, 
ADDR_TYPE
):

609 
är_cfg
.
routšg_pb
.
rou‹_m­s
 =ğ
NÚe
:

611 
rou‹m­
 
š
 
är_cfg
.
routšg_pb
.
rou‹_m­s
:

612 
rou‹_m­_£q
 
š
 
rou‹m­
.route_map_seq:

613 #NØ
M©ch
 - 
OÆy
 
S‘


614 
rou‹_m­_£q
.
m©ch
 =ğ
NÚe
:

615 
	$hªdË_no_m©ch_£t_Úly
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
)

617 #M©ch 
by
 
P»fix
 
Li¡


618 
	`Ën
(
rou‹_m­_£q
.
m©ch
.
´efix_li¡
) > 0:

619 
	$hªdË_m©ch_´efix_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
)

620 #M©ch 
by
 
g


621 
–if
 
rou‹_m­_£q
.
m©ch
.
g
 !ğ
NÚe
:

622 
	$hªdË_m©ch_g
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
)

623 #M©ch 
by
 
Commun™y


624 
–if
 
	`Ën
(
rou‹_m­_£q
.
m©ch
.
commun™y_li¡
) > 0:

625 
	$hªdË_m©ch_commun™y_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
)

626 #M©ch 
by
 
Ïrge
-
Commun™y


627 
–if
 
	`Ën
(
rou‹_m­_£q
.
m©ch
.
Ïrge_commun™y_li¡
) > 0:

628 
	$hªdË_m©ch_Ïrge_commun™y_li¡
(
är_cfg
, 
rou‹m­
, 
rou‹_m­_£q
, 
ADDR_TYPE
)

630 #############################################
#CommÚ 
APIs
, 
wl
 
be
 
u£d
 
by
 
®l
 
´ÙocŞs


632 #############################################
 g‘_SŒšgIO():

634 
sys
.
v”siÚ_šfo
 >= (3,):

635  
io
.
	$SŒšgIO
()

637  
cSŒšgIO
.
	$SŒšgIO
()

639 
def
 
	$g‘_add»ss_çmy
(
addr_çmy
):

643 * "addr_çmy": 
add»ss
 
çmy
 
ty³
 
IPv4_UNICAST
/
IPv6_UNICAST
/
VPNv4_UNICAST


645 
addr_çmy
 =ğ
IPv4_UNICAST
:

647 
addr_çmy
 =ğ
IPv6_UNICAST
:

649 
addr_çmy
 =ğ
VPNv4_UNICAST
:

651 
as£¹
 'Unknown‡ddress family'

653 
def
 
	$g‘__cmd
(
addr_ty³
):

657 * "addr_ty³": 

 
ty³
 
v4
/
v6


659 
addr_ty³
 =ğ
ADDR_TYPE_IPv4
:

664 
def
 
	$IpP»fixMsg_to_¡r
(
addr
, 
subÃt
 = 
True
):

668 * "addr": 

 
ty³
 
v4
/
v6


670 
_¡ršg
 = ''

671 
_¡ršg
 = 
	$IpAdd»ssMsg_to_¡r
(
addr
)

672 
subÃt
 
ªd
 
addr
.
´efix_Ëngth
:

673 
_¡ršg
 = ip_¡ršg + '/' + 
	$¡r
(
addr
.
´efix_Ëngth
)

674  
_¡ršg


676 
def
 
	$IpAdd»ssMsg_to_¡r
(
addr
):

680 * "addr": 

 
ty³
 
v4
/
v6


683 
addr
.
afi
 =ğ
ADDR_TYPE_IPv4
:

684  
addr
.
v4


686  
addr
.
v6


688 
def
 
	$numb”_to_row
(
rou‹rName
):

690 
R‘uºs
 
the
 
numb”
 th
rou‹r
.

691 
C®cuÏtiÚ
 
ba£d
 
Ú
 
Çme
 
a0
 = 
row
 0, 
a1
 =„ow 1, 
b2
 =„ow 2, 
z23
 =„ow 23 
‘c


693  (
rou‹rName
[1:])

695 
def
 
	$numb”_to_cŞumn
(
rou‹rName
):

697 
R‘uºs
 
the
 
numb”
 th
rou‹r
.

698 
C®cuÏtiÚ
 
ba£d
 
Ú
 
Çme
 
a0
 = 
cŞumÂ
 0, 
a1
 = 
cŞumn
 0, 
b2
= column 1,

699 
z23
 = 
cŞumn
 26 
‘c


701  
	`Üd
(
rou‹rName
[0]) - 97

703 
def
 
	$g’”©e_s
(
ADDR_TYPE
, 
¡¬t_
, 
no_of_s
):

705 
R‘uºs
 
li¡
 
of
 
IPs
.

706 
ba£d
 
Ú
 
¡¬t_
 
ªd
 
no_of_s


708 * `
ADDR_TYPE
` : 
to
 
id’tify
 

 
add»ss
 
ty³
 
ex
- 
v4
/
v6


709 * `
¡¬t_
` : 
äom
 
h”e
 
the
 

 
wl
 
¡¬t
 
g’”©šg
, s¹_ wÈ
be


710 
fœ¡
 



711 * `
no_of_s
` : 
the£
 
mªy
 
IPs
 
wl
 
be
 
g’”©ed


713 
Lim™©iÚ
: 
It
 
wl
 
g’”©e
 
IPs
 
Úly
 
_mask
 32

717 '/' 
š
 
¡¬t_
:

718 
¡¬t_
 = s¹_.
	`¥l™
("/")[0]

720 
ADDR_TYPE
 == 'ipv4':

721 
¡¬t_
 = 
add»ss
.
	`IPv4Add»ss
(
	$unicode
(
¡¬t_
))

723 
¡¬t_
 = 
add»ss
.
	`IPv6Add»ss
(
	$unicode
(
¡¬t_
))

724 
add»ss_li¡
 = [
¡¬t_
]

725 
Ãxt_
 = 
¡¬t_


726 
couÁ
 = 1

727 
couÁ
 <ğ
no_of_s
:

728 
Ãxt_
 += 1

729 
add»ss_li¡
.
	$­³nd
(
Ãxt_
)

730 
couÁ
 += 1

732  
add»ss_li¡


734 
def
 
	$fšd_š‹rçû_w™h_g»©”_
(
ADDR_TYPE
, 
tİo
, 
rou‹r
):

736 
R‘uºs
 
highe¡
 
š‹rçû
 

 
v4
/
v6


738 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


739 * `
tİo
` : 
jsÚ
 
fe
 
d©a


740 * `
rou‹r
` :„ou‹¸
which
 
high‹¡
 
š‹rçû
 
should
 
be
 
ÿlcuÏ‹d


743 
lšk_d©a
 = 
tİo
['rou‹rs'][
rou‹r
]['links']

744 
ADDR_TYPE
 == "ipv4":

745 'lo' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

746  
tİo
['rou‹rs'][
rou‹r
]['lo']['v4'].
	`¥l™
('/')[0]

747 
š‹rçûs_li¡
 = []

748 
de¡Rou‹r
 
š
 
	`sÜ‹d
(
lšk_d©a
.
	$™”™ems
()):

749 
lšk
 
š
 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹r
[0]].
	$™”™ems
():

750 'v4' 
š
 
lšk_d©a
[
de¡Rou‹r
[0]][
lšk
[0]]:

751 
_add»ss
 = 
lšk_d©a
[
de¡Rou‹r
[0]][
lšk
[0]]['v4'].
	`¥l™
('/')[0]

752 
š‹rçûs_li¡
.
	`­³nd
(
add»ss
.
	$IPv4Add»ss
(
_add»ss
))

754 'lo' 
š
 
tİo
['rou‹rs'][
rou‹r
]:

755 
_add»ss
 = 
tİo
['rou‹rs'][
rou‹r
]['lo']['v6'].
	`¥l™
('/')[0]

756  
add»ss
.
	$IPv4Add»ss
(
_add»ss
)

757 
š‹rçûs_li¡
 = []

758 
de¡Rou‹r
 
š
 
	`sÜ‹d
(
lšk_d©a
.
	$™”™ems
()):

759 
lšk
 
š
 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹r
[0]].
	$™”™ems
():

760 'v6' 
š
 
lšk_d©a
[
de¡Rou‹r
[0]][
lšk
[0]]:

761 
_add»ss
 = 
lšk_d©a
[
de¡Rou‹r
[0]][
lšk
[0]]['v6'].
	`¥l™
('/')[0]

762 
š‹rçûis_li¡
.
	`­³nd
(
add»ss
.
	$IPv4Add»ss
(
_add»ss
))

764  
	`sÜ‹d
(
š‹rçûs_li¡
)[-1]

766 
def
 
	$¡¬t_d—mÚs_ªd_rou‹rs
(
tg’
, 
CWD
):

768 
It
 
wl
 
ü—‹
 
‹mpÜ¬y
 
fŞd”s
 
ªd
 
fes
 
to
 
¡¬t


769 
d—mÚs
 
ªd
 
rou‹rs
.

771 * `
tg’
` : 
tİog’
 
objeù


772 * `
CWD
` : 
C®Ër
's current working directory

775 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

776 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

777 
Œy
:

778 
os
.
	$chdœ
(
CWD
)

779 #D–‘šg 
rou‹r
 
Çmed
 
dœs
 
exi¡s


780 
os
.
·th
.
	`exi¡s
('{}'.
	$fÜm©
(
ºame
)):

781 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

783 #C»©šg 
rou”
 
Çmed
 
dœ
 
ªd
 
em±y
 
zeb¿
.
cÚf
 
bgpd
.cÚà
fes


784 #šsid
the
 
cu¼’t
 
dœeùÜy


785 
os
.
	`mkdœ
('{}'.
	$fÜm©
(
ºame
))

786 
os
.
	`chdœ
('{}/{}'.
	$fÜm©
(
CWD
, 
ºame
))

787 
os
.
	`sy¡em
('touch zebra.conf bgpd.conf')

789 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

790 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

792 #Lßdšg 
em±y
 
zeb¿
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 zeb¿ 
d—mÚ


793 
rou‹r
.
	`lßd_cÚfig
(

794 
TİoRou‹r
.
RD_ZEBRA
,

795 '{}/{}/zeb¿.cÚf'.
	$fÜm©
(
CWD
, 
ºame
)

796 #os.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
(
ºame
))

798 #Lßdšg 
em±y
 
bgpd
.
cÚf
 
fe
 
to
 
rou‹r
,Ø
¡¬t
 
the
 
bgp
 
d—mÚ


799 
rou‹r
.
	`lßd_cÚfig
(

800 
TİoRou‹r
.
RD_BGP
,

801 '{}/{}/bgpd.cÚf'.
	$fÜm©
(
CWD
, 
ºame
)

802 #os.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	`fÜm©
(
ºame
))

805 #S¹šg 
rou‹rs
, 
Úû
 
d—mÚs
 
¡¬‹d


806 
logg”
.
	`šfo
("Starting‡ll„outers onceopology is created")

807 
tg’
.
	$¡¬t_rou‹r
()

809 
def
 
	$»move_‹mp_fes
(
tg’
, 
CWD
):

811 
It
 
wl
 
»move
 
‹mpÜ¬y
 
dœs
 
ªd
 
fes
.

813 * `
tg’
` : 
tİog’
 
objeù


814 * `
CWD
` : 
C®Ër
's current working directory

817 #Removšg 
tmp
 
dœs
 
ªd
 
fes


818 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

819 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

820 
Œy
:

821 
os
.
	$chdœ
(
CWD
)

822 
os
.
	`sy¡em
("rm -rà{}".
	$fÜm©
(
ºame
))

823 
exû±
 
IOE¼Ü
 
	$as
 (
”ºo
, 
¡»¼Ü
):

824 
logg”
.
	`”rÜ
("I/Oƒ¼Ü({0}): {1}".
	$fÜm©
(
”ºo
, 
¡»¼Ü
))

826 
def
 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹rName
):

828 
This
 
API
 
is
 
to
 
ü—‹
 
a
 
d–
 
of
 
ruÂšg
 
cÚfig
 
ªd
 
u£r
 
defšed
 config,

829 
u¶ßd
 
the
 
d–
 
cÚfig
 
to
 
rou‹r
.

831 * `
tg’
` : 
Tİog’
 
objeù


832 * `
CWD
` : 
ÿÎ”
's current working directory

833 * `
rou‹rName
` : 
rou‹r
 
which
 
d–
 
cÚfig
 
should
 
be
 
g’”©ed
 
ªd
 
u¶ßded


836 
logg”
.
	`šfo
('Entering API:†oad_common_config_to_router')

838 
Œy
:

839 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

840 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

841 
ºame
 =ğ
rou‹rName
:

843 
cfg
 = 
rou‹r
.
	`run
("vtysh -c 'show„unning'")

844 
âame
 = '{}/{}/är.§v'.
	$fÜm©
(
CWD
, 
ºame
)

845 
dÇme
 = '{}/{}/d–.cÚf'.
	$fÜm©
(
CWD
, 
ºame
)

846 
f
 = 
	`İ’
(
âame
, 'w')

847 
lše
 
š
 
cfg
.
	`¥l™
('\n'):

848 
lše
 =†še.
	$¡r
()

850 ià(
lše
 =ğ'Budšg cÚfigu¿tiÚ...' 
Ü


851 
lše
 =ğ'Cu¼’ˆcÚfigu¿tiÚ:' 
Ü


852 
nÙ
 
lše
):

854 
f
.
	$wr™e
(
lše
)

855 
f
.
	`wr™e
('\n')

857 
f
.
	$şo£
()

859 
Œy
:

860 
f’ames
 = ['bgp_json.conf', 'frr_json.conf']

861 
w™h
 
	`İ’
('{}/{}/är.cÚf'.
	`fÜm©
(
CWD
, 
ºame
), 'w'è
as
 
cfg
:

862 
f_Çme
 
š
 
f’ames
:

863 
os
.
·th
.
	`exi¡s
('{}/{}/{}'.
	$fÜm©
(
CWD
, 
ºame
, 
f_Çme
)):

864 
w™h
 
	`İ’
('{}/{}/{}'.
	`fÜm©
(
CWD
, 
ºame
, 
f_Çme
),

865 'r'è
as
 
šfe
:

866 
lše
 
š
 
šfe
:

867 
cfg
.
	$wr™e
(
lše
)

868 
exû±
 
IOE¼Ü
 
as
 
”r
:

869 
logg”
.
	`w¬nšg
('Unableo open config File.ƒrror(%s): %s' %

870 (
”r
.
”ºo
,ƒ¼.
¡»¼Ü
))

871  
F®£


873 
commªd
 = '/usr/lib/frr/frr-reload.py --input {}/{}/frr.sav' \

874 ' --‹¡ {}/{}/är.cÚà> {}'.
	$fÜm©
(
CWD
, 
ºame
, CWD,

875 
ºame
, 
dÇme
)

876 
»suÉ
 = 
os
.
	$sy¡em
(
commªd
)

878 #As£¹ 
commªd
 
ç


879 
»suÉ
 != 0:

880 
commªd_ouut
 = 
F®£


881 
as£¹
 
commªd_ouut
, ('Command:{} is failed dueo '

882 'nÚ-z”Øex™ code'.
	$fÜm©
(

883 
commªd
))

885 
f
 = 
	`İ’
(
dÇme
, 'r')

886 
d–
 = 
SŒšgIO
.
	$SŒšgIO
()

887 
d–
.
	`wr™e
('configureerminal\n')

888 
t_d–
 = 
f
.
	$»ad
()

889 
lše
 
š
 
t_d–
.
	`¥l™
('\n'):

890 
lše
 =†še.
	$¡r
()

891 ià(
lše
 =ğ'Lše TØD–‘e' 
Ü


892 
lše
 =ğ'===============' 
Ü


893 
lše
 =ğ'Lše TØAdd' 
Ü


894 
lše
 =ğ'============' 
Ü


895 
nÙ
 
lše
):

897 
d–
.
	$wr™e
(
lše
)

898 
d–
.
	`wr™e
('\n')

900 
d–
.
	`wr™e
('end\n')

901 
rou‹r
.
	`vtysh_muÉicmd
(
d–
.
	$g‘v®ue
())

902 
logg”
.
	`šfo
('New cÚfigu¿tiÚ fÜ„ou‹¸{}:'.
	$fÜm©
(
ºame
))

903 
d–
.
	$şo£
()

904 
d–
 = 
SŒšgIO
.
	$SŒšgIO
()

905 
cfg
 = 
rou‹r
.
	`run
("vtysh -c 'show„unning'")

906 
lše
 
š
 
cfg
.
	`¥l™
('\n'):

907 
lše
 =†še.
	$¡r
()

908 
d–
.
	$wr™e
(
lše
)

909 
d–
.
	`wr™e
('\n')

911 #Rou‹¸
cu¼’t
 
cÚfigu¿tiÚ
 
to
 
log
 
fe
 
Ü
 
cÚsŞe
 

912 #"
show_rou‹r_cÚfig
" i defšed iÀ"
py‹¡
.
ši
"

913 
show_rou‹r_cÚfig
:

914 
logg”
.
	`šfo
(
d–
.
	$g‘v®ue
())

915 
d–
.
	$şo£
()

916 
exû±
 
Exû±iÚ
 
as
 
e
:

917 
logg”
.
	`”rÜ
(
Œaûback
.
	$fÜm©_exc
())

918  
F®£


920 
logg”
.
	`šfo
('Exting API:†oad_common_config_to_router')

921  
True


923 #############################################
#The£ 
APIs
, 
wl
 
u£d
 
by
 
‹¡ÿ£


925 #############################################
 c»©e_š‹rçûs_cfg(curRou‹r,İo):

928 
§ve
 
the
 
cÚfigu¿tiÚ
 
to
 
är
.
cÚf
 
fe
. 
Basic
 
IÁ”çû
 configuration

929 
is
 
´ovided
 
š
 
šput
 
jsÚ
 
fe
.

931 * `
curRou‹r
` : 
rou‹r
 
which
 
š‹rçû
 
cÚfig
 
should
 
be
 
ü—‹d


932 * `
tİo
` : 
jsÚ
 
fe
 
d©a


935 
Œy
:

936 
š‹rçûs
 = 
	$IÁ”çûs
()

937 
c_rou‹r
 = 
tİo
['rou‹rs'][
curRou‹r
]

938 'lo' 
š
 
c_rou‹r
:

939 
š‹rçû_Çme
 = 'lo'

940 
lo_add»s£s
 = []

941 'v4' 
š
 
c_rou‹r
['lo']:

942 
lo_add»s£s
.
	`­³nd
(
c_rou‹r
['lo']['ipv4'])

943 'v6' 
š
 
c_rou‹r
['lo']:

944 
lo_add»s£s
.
	`­³nd
(
c_rou‹r
['lo']['ipv6'])

945 
š‹rçûs
.
	$add_š‹rçû
(
š‹rçû_Çme
, 
lo_add»s£s
)

946 
de¡Rou‹rLšk
, 
d©a
 
š
 
	`sÜ‹d
(
c_rou‹r
['lšks'].
	$™”™ems
()):

947 
š‹rçû_Çme
 = 
c_rou‹r
['lšks'][
de¡Rou‹rLšk
]['interface']

948 
št_add»s£s
 = []

949 'v4' 
š
 
c_rou‹r
['lšks'][
de¡Rou‹rLšk
]:

950 
št_add»s£s
.
	`­³nd
(
c_rou‹r
['lšks'][
de¡Rou‹rLšk
]['ipv4'])

951 'v6' 
š
 
c_rou‹r
['lšks'][
de¡Rou‹rLšk
]:

952 
št_add»s£s
.
	`­³nd
(
c_rou‹r
['lšks'][
de¡Rou‹rLšk
]['ipv6'])

953 
š‹rçûs
.
	$add_š‹rçû
(
š‹rçû_Çme
, 
št_add»s£s
)

955 
exû±
 
Exû±iÚ
 
as
 
e
:

956 
logg”
.
	`”rÜ
(
Œaûback
.
	$fÜm©_exc
())

957  
F®£


959  
š‹rçûs


961 
def
 
	$add_¡©ic_rou‹_fÜ_loİback_š‹rçûs
(
ADDR_TYPE
, 
curRou‹r
, 
tİo
, 
ärcfg
):

963 
Add
 
rou‹s
 
loİback
 
š‹rçûs
 
»achab™y
, 
It
 
wl
 
add
 

964 
rou‹s
 
š
 
cu¼’t
 
rou‹r
 
Ùh”
„outer's†oopback interfaces oshe

965 
»achab™y
 
wl
 
be
 
up
 
ªd
 
so
 wÈ
BGP
 
ÃighbÜsh
.

967 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


968 * `
curRou‹r
` : 
Deviû
 
Und”
 
Te¡


969 * `
tİo
` : 
jsÚ
 
fe
 
d©a


970 * `
ärcfg
` : 
är
 
cÚfig
 
fe


973 
bgp_ÃighbÜs
 = 
tİo
['rou‹rs'][
curRou‹r
]['bgp']['bgp_neighbors']

974 
bgp_ÃighbÜ
 
š
 
bgp_ÃighbÜs
.
	$keys
():

975 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['source'] == 'lo':

976 
_addr
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['lo'][
ADDR_TYPE
]

977 
de¡Rou‹rLšk
 = 
bgp_ÃighbÜs
[
bgp_ÃighbÜ
]['peer']['link']

978 
Ãxt_hİ
 = 
tİo
['rou‹rs'][
bgp_ÃighbÜ
]['links'][

979 
de¡Rou‹rLšk
][
ADDR_TYPE
].
	`¥l™
("/")[0]

981 
ADDR_TYPE
 == "ipv4":

982 
ärcfg
.
	`wr™e
("„ou‹ " + 
_addr
 + " " + 
Ãxt_hİ
 + "\n")

984 
ärcfg
.
	`wr™e
("v6„ou‹ " + 
_addr
 + " " + 
Ãxt_hİ
 + "\n")

987 
def
 
	$ü—‹_¡©ic_rou‹s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

989 
C»©e
 
rou‹s
 
giv’
 
rou‹r
 
as
 
defšed
 
š
 
šput_diù


991 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


992 * `
šput_diù
` : 
šput
 
to
 
ü—‹
 
rou‹s
 
giv’
 
rou‹r


993 * `
tg’
` : 
Tİog’
 
objeù


994 * `
CWD
` : 
ÿÎ”
's current working directory

995 * `
tİo
` : 
jsÚ
 
fe
 
d©a


998 
Œy
:

999 
glob®
 
är_cfg


1000 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1001 "¡©ic_rou‹s" 
š
 
šput_diù
[
rou‹r
]:

1002 
¡©ic_rou‹s_li¡
 = []

1004 #Re£ˆ
cÚfig
 
rou‹rs


1005 
är_cfg
[
rou‹r
].
	$»£t_™
()

1007 
¡©ic_rou‹s
 = 
šput_diù
[
rou‹r
]["static_routes"]

1008 
¡©ic_rou‹
 
š
 
¡©ic_rou‹s
:

1009 
ÃtwÜk
 = 
¡©ic_rou‹
["network"]

1010 #NØ
of
 
IPs


1011 "no_of_" 
š
 
¡©ic_rou‹
:

1012 
no_of_
 = 
¡©ic_rou‹
["no_of_ip"]

1014 
no_of_
 = 0

1016 "admš_di¡ªû" 
š
 
¡©ic_rou‹
:

1017 
admš_di¡ªû
 = 
¡©ic_rou‹
["admin_distance"]

1019 
admš_di¡ªû
 = 1

1021 "g" 
š
 
¡©ic_rou‹
:

1022 
g
 = 
¡©ic_rou‹
["tag"]

1024 
g
 = 
NÚe


1026 "if_Çme" 
š
 
¡©ic_rou‹
:

1027 
if_Çme
 = 
¡©ic_rou‹
["if_name"]

1029 
if_Çme
 = 
NÚe


1031 
Ãxt_hİ
 = 
¡©ic_rou‹
["next_hop"]

1033 
_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
ÃtwÜk
, 
no_of_
)

1034 

 
š
 
_li¡
:

1035 

 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(

)))

1036 
ADDR_TYPE
 == "ipv4":

1037 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 

, 
NÚe
)

1038 
rou‹
 = 
	$Rou‹
(
addr
)

1039 
nh
 = 
	$Add»ss
(
ADDR_TYPE_IPv4
, 
Ãxt_hİ
, 
NÚe
)

1041 
addr
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 

)

1042 
rou‹
 = 
	$Rou‹
(
addr
)

1043 
nh
 = 
	$Add»ss
(
ADDR_TYPE_IPv6
, 
NÚe
, 
Ãxt_hİ
)

1044 
rou‹
.
	$add_Ãxthİ
(
nh
, 
NÚe
, 
admš_di¡ªû
, 
if_Çme
, 
g
)

1046 
¡©ic_rou‹s_li¡
.
	$­³nd
(
rou‹
)

1047 
är_cfg
[
rou‹r
].
routšg_pb
.
¡©ic_rou‹
 = 
¡©ic_rou‹s_li¡


1049 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1050 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1051 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1052 #Lßd 
cÚfigu¿tiÚ
 
to
 
rou‹r


1053 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1055 
exû±
 
Exû±iÚ
 
as
 
e
:

1056 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1057 
logg”
.
	$”rÜ
(
”rÜmsg
)

1058  
”rÜmsg


1060  
True


1062 
def
 
	$modify_admš_di¡ªû_fÜ_¡©ic_rou‹s
(
šput_diù
, 
CWD
, 
tg’
, 
tİo
):

1064 
Modify
 
admš
 
di¡ªû
 
giv’
 
rou‹
/
s


1066 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


1067 * `
CWD
` : 
ÿÎ”
's current working directory

1068 * `
tg’
` : 
Tİog’
 
objeù


1069 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1071 
logg”
.
	`šfo
("Entering†ib API: modify_admin_distance_for_static_routes()")

1073 
Œy
:

1074 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1075 #Re£ˆ
cÚfig
 
rou‹rs


1076 
är_cfg
[
rou‹r
].
	$»£t_™
()

1078 
¡©ic_rou‹
 
š
 
šput_diù
[
rou‹r
].
	$keys
():

1079 
Ãxt_hİ
 = 
šput_diù
[
rou‹r
][
¡©ic_rou‹
]['next_hop']

1080 
admš_di¡ªû
 = 
šput_diù
[
rou‹r
][
¡©ic_rou‹
]['admin_distance']

1082 
¡
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.
¡©ic_rou‹
:

1083 
¡__´efix
 = 
	$IpAdd»ssMsg_to_¡r
(
¡
.
´efix
)

1084 
nh
 
š
 
¡
.
Ãxthİs
:

1085 
¡__´efix
 =ğ
¡©ic_rou‹
 
ªd
 \

1086 
	`IpAdd»ssMsg_to_¡r
(
nh
.

è=ğ
Ãxt_hİ
:

1087 
nh
.
admš_di¡ªû
 =‡dmin_distance

1089 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1090 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1091 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1092 #Lßd 
cÚfig
 
to
 
rou‹r


1093 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1095 
exû±
 
Exû±iÚ
 
as
 
e
:

1096 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1097 
logg”
.
	$”rÜ
(
”rÜmsg
)

1098  
”rÜmsg


1100 
logg”
.
	`šfo
("Exiting†ib API: modify_admin_distance_for_static_routes")

1101  
True


1103 
def
 
	$ü—‹_´efix_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1105 
C»©e
 

 
´efix
 
li¡s


1107 * `
ADDR_TYPE
` : 
_ty³
, 
v4
/
v6


1108 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


1109 * `
tg’
` : 
Tİog’
 
objeù


1110 * `
CWD
` : 
ÿÎ”
's current working directory

1111 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1114 
logg”
.
	`šfo
("Entering†ib API: create_prefix_lists()")

1116 
Œy
:

1117 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1118 "´efix_li¡s" 
š
 
šput_diù
[
rou‹r
]:

1119 #Re£ˆ
cÚfig
 
rou‹rs


1120 
är_cfg
[
rou‹r
].
	$»£t_™
()

1122 
´efix_li¡
 
š
 
šput_diù
[
rou‹r
]['´efix_li¡s'].
	$keys
():

1123 
´efix_diù
 
š
 
šput_diù
[
rou‹r
]['´efix_li¡s'][
´efix_li¡
]:

1124 
ÃtwÜk_addr
 = 
´efix_diù
['network']

1125 
aùiÚ
 = 
´efix_diù
['action']

1126 'Ë' 
š
 
´efix_diù
:

1127 
Ë
 = 
´efix_diù
['le']

1129 
Ë
 = 
NÚe


1131 'ge' 
š
 
´efix_diù
:

1132 
ge
 = 
´efix_diù
['ge']

1134 
ge
 = 
NÚe


1136 '£qid' 
š
 
´efix_diù
:

1137 
£qid
 = 
´efix_diù
['seqid']

1139 
£qid
 = 
NÚe


1141 
ÃtwÜk_addr
 != 'any':

1142 #IP 
äom
 
ÃtwÜk
, 
»movšg
 
mask


1143 

 = 
ÃtwÜk_addr
.
	`¥l™
("/")[0]

1144 
mask
 = 
ÃtwÜk_addr
.
	`¥l™
("/")[1]

1146 

 = 'any'

1147 
mask
 = 
NÚe


1149 

 != 'any':

1150 
ADDR_TYPE
 == 'ipv4':

1151 
Ãt
 = 
	`N‘wÜk
(
ADDR_TYPE_IPv4
, 

, 
NÚe
, (
mask
))

1153 
Ãt
 = 
	`N‘wÜk
(
ADDR_TYPE_IPv6
, 
NÚe
, 

, (
mask
))

1155 
Ãt
 = 
NÚe


1157 
pfx
 = 
	$Pfx
(
Ë
, 
ge
, 
aùiÚ
, 
Ãt
, 
£qid
)

1158 
pfx_l
 = 
	$P»fixLi¡
(
´efix_li¡
)

1159 
pfx_l
.
	$add_pfx
(
pfx
)

1160 
är_cfg
[
rou‹r
].
routšg_pb
.
´efix_li¡s
.
	$­³nd
(
pfx_l
)

1162 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1163 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1164 
	$´efixli¡_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1165 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1166 #Lßd 
cÚfig
 
to
 
rou‹r


1167 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1168 
exû±
 
Exû±iÚ
 
as
 
e
:

1169 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1170 
logg”
.
	$”rÜ
(
”rÜmsg
)

1171  
”rÜmsg


1173 
logg”
.
	`šfo
("Exiting†ib API: create_prefix_lists()")

1174  
True


1176 
def
 
	$d–‘e_´efix_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1178 
D–‘e
 

 
´efix
 
li¡s


1180 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1181 * `
šput_diù
` : 
which
 
rou‹r
 
pf_li¡
 
has
 
to
 
be
 
d–‘ed


1182 * `
tg’
` : 
Tİog’
 
objeù


1183 * `
CWD
` : 
ÿÎ”
's current working directory

1184 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1186 
logg”
.
	`šfo
("Entering†ib API: delete_prefix_lists()")

1188 
Œy
:

1189 
glob®
 
är_cfg


1190 
dut
 
š
 
šput_diù
.
	$keys
():

1191 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1192 
rou‹r
 !ğ
dut
:

1195 #Re£ˆ
cÚfig
 
rou‹rs


1196 
är_cfg
[
rou‹r
].
	$»£t_™
()

1198 
£q_id
 = []

1199 
pfx_l
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.
´efix_li¡s
:

1200 
pfx
 
š
 
pfx_l
.
´efix
:

1202 
£q_id
.
	$­³nd
(
pfx
.
£q_id
)

1204 
´efix_li¡s
 = 
šput_diù
[
rou‹r
]["prefix_lists"]

1205 
£qid
 
š
 
£q_id
:

1206 
found
 = 
F®£


1207 
pfx_li¡_Çme
 
š
 
´efix_li¡s
:

1208 
pfx_l
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.
´efix_li¡s
:

1209 
pfx_l
.
´efix_li¡_uuid_Çme
 =ğ
pfx_li¡_Çme
:

1210 
found
 = 
True


1211 
pfx
 
š
 
pfx_l
.
´efix
:

1212 
pfx
.
£q_id
 =ğ
£qid
:

1213 
pfx_l
.
´efix
.
	$»move
(
pfx
)

1214 
	`Ën
(
pfx_l
.
´efix
) == 0:

1215 
är_cfg
[
rou‹r
].
routšg_pb
.
´efix_li¡s
.
	$»move
(
pfx_l
)

1216 
nÙ
 
found
:

1217 
”rÜmsg
 = ("Prefix†ist {}‚ot found in„outer {}".

1218 
	$fÜm©
(
pfx_li¡_Çme
, 
rou‹r
))

1219  
”rÜmsg


1221 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1222 
	$´efixli¡_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1223 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1224 #Lßd 
cÚfig
 
to
 
rou‹r


1225 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1226 
exû±
 
Exû±iÚ
 
as
 
e
:

1227 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1228 
logg”
.
	$”rÜ
(
”rÜmsg
)

1229  
”rÜmsg


1231 
logg”
.
	`šfo
("Exiting†ib API: delete_prefix_lists()")

1232  
True


1234 
def
 
	$modify_´efix_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1236 
Modify
 
´efix
 
li¡s


1238 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1239 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


1240 * `
tg’
` : 
Tİog’
 
objeù


1241 * `
CWD
` : 
ÿÎ”
's current working directory

1242 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1244 
logg”
.
	`šfo
("Entering†ib API: modify_prefix_lists()")

1246 
Œy
:

1247 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1248 #Re£ˆ
cÚfig
 
rou‹rs


1249 
är_cfg
[
rou‹r
].
	$»£t_™
()

1251 
´efix_li¡
 
š
 
šput_diù
[
rou‹r
]['´efix_li¡s'].
	$keys
():

1252 
´efix_diù
 
š
 
šput_diù
[
rou‹r
]['´efix_li¡s'][
´efix_li¡
]:

1253 
ÃtwÜk_addr
 = 
´efix_diù
['network']

1254 
aùiÚ
 = 
´efix_diù
['action']

1255 'Ë' 
š
 
´efix_diù
:

1256 
Ë
 = 
´efix_diù
['le']

1258 
Ë
 = 
NÚe


1260 'ge' 
š
 
´efix_diù
:

1261 
ge
 = 
´efix_diù
['ge']

1263 
ge
 = 
NÚe


1265 '£qid' 
š
 
´efix_diù
:

1266 
£qid
 = 
´efix_diù
['seqid']

1268 
£qid
 = 
NÚe


1270 
ÃtwÜk_addr
 != 'any':

1271 #IP 
äom
 
ÃtwÜk
, 
»movšg
 
mask


1272 

 = 
ÃtwÜk_addr
.
	`¥l™
("/")[0]

1273 
mask
 = 
ÃtwÜk_addr
.
	`¥l™
("/")[1]

1275 

 = 'any'

1276 
mask
 = 
NÚe


1278 

 != 'any':

1279 
ADDR_TYPE
 == 'ipv4':

1280 
Ãt
 = 
	`N‘wÜk
(
ADDR_TYPE_IPv4
, 

, 
NÚe
, (
mask
))

1282 
Ãt
 = 
	`N‘wÜk
(
ADDR_TYPE_IPv6
, 
NÚe
, 

, (
mask
))

1284 
Ãt
 = 
NÚe


1286 
pfx_l
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.
´efix_li¡s
:

1287 
pfx_l
.
´efix_li¡_uuid_Çme
 =ğ
´efix_li¡
:

1288 
pfx
 
š
 
pfx_l
.
´efix
:

1289 
£qid
 !ğ
NÚe
:

1290 
pfx
.
£q_id
 =ğ
£qid
:

1291 
pfx
.
ÃtwÜk
 = 
Ãt


1292 
pfx
.
Ëss_Ü_equ®_b™s
 = 
Ë


1293 
pfx
.
g»©”_Ü_equ®_b™s
 = 
ge


1294 
pfx
.
aùiÚ
 =‡ction

1295 
pfx
.
£qid
 = seqid

1297 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1298 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1299 
	$´efixli¡_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1300 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1301 #Lßd 
cÚfig
 
to
 
rou‹r


1302 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1304 
exû±
 
Exû±iÚ
 
as
 
e
:

1305 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1306 
logg”
.
	$”rÜ
(
”rÜmsg
)

1307  
”rÜmsg


1309 
logg”
.
	`šfo
("Exiting†ib API: modify_prefix_lists()")

1310  
True


1312 
def
 
	$ü—‹_rou‹_m­s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1314 
C»©e
 
rou‹
 
m­ss


1316 * `
ADDR_TYPE
` : 
_ty³
, 
v4
/
v6


1317 * `
šput_diù
` : 
which
 
rou‹
/
s
 
admš
 
di¡ªû
 
should
 
modif›d


1318 * `
tg’
` : 
Tİog’
 
objeù


1319 * `
CWD
` : 
ÿÎ”
's current working directory

1320 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1323 
logg”
.
	`šfo
("Entering†ib API: create_route_maps()")

1325 
Œy
:

1326 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1327 "rou‹_m­s" 
š
 
šput_diù
[
rou‹r
]:

1328 #Re£ˆ
cÚfig
 
rou‹rs


1329 
är_cfg
[
rou‹r
].
	$»£t_™
()

1331 
rm­_Çme
 
š
 
šput_diù
[
rou‹r
]["rou‹_m­s"].
	$keys
():

1332 
rm­_diù
 
š
 
šput_diù
[
rou‹r
]["rou‹_m­s"][
rm­_Çme
]:

1333 
rm­_aùiÚ
 = 
rm­_diù
["action"]

1335 
rm­_aùiÚ
 == 'PERMIT':

1336 
rm­_aùiÚ
 = 
PERMIT


1338 
rm­_aùiÚ
 = 
DENY


1340 
rm­
 = 
	$Rou‹M­
(
rm­_Çme
)

1341 
är_cfg
[
rou‹r
].
routšg_pb
.
rou‹_m­s
.
	$­³nd
(
rm­
)

1343 #V”ifyšg 
SET
 
ü™”Ÿ
 
is
 
defšed


1344 '£t' 
š
 
rm­_diù
:

1345 'loÿÍ»f' 
š
 
rm­_diù
["set"]:

1346 
loÿl_´eã»nû
 = 
rm­_diù
["set"]['localpref']

1348 
loÿl_´eã»nû
 = 
NÚe


1350 'med' 
š
 
rm­_diù
["set"]:

1351 
m‘ric
 = 
rm­_diù
["set"]['med']

1353 
m‘ric
 = 
NÚe


1355 'a¥©h' 
š
 
rm­_diù
["set"]:

1356 
as_·th
 = 
rm­_diù
["set"]['aspath']

1358 
as_·th
 = 
NÚe


1360 'weight' 
š
 
rm­_diù
["set"]:

1361 
weight
 = 
rm­_diù
["set"]['weight']

1363 
weight
 = 
NÚe


1365 'commun™y' 
š
 
rm­_diù
["set"]:

1366 
commun™y
 = 
rm­_diù
["set"]['community']

1368 
commun™y
 = 
NÚe


1370 'Ïrge_commun™y' 
š
 
rm­_diù
["set"]:

1371 
Ïrge_commun™y
 = 
rm­_diù
["set"]['large_community']

1373 
Ïrge_commun™y
 = 
NÚe


1375 '£t_aùiÚ' 
š
 
rm­_diù
["set"]:

1376 
£t_aùiÚ
 = 
rm­_diù
["set"]['set_action']

1378 
£t_aùiÚ
 = 
NÚe


1380 'commun™y_add™ive' 
š
 
rm­_diù
["set"]:

1381 
commun™y_add™ive
 = 
rm­_diù
["set"]['community_additive']

1383 
commun™y_add™ive
 = 
NÚe


1385 
£t_ü™”Ÿ
 = 
	$Rou‹M­S‘
(
loÿl_´eã»nû
, 
m‘ric
,

1386 
as_·th
, 
commun™y
, 
commun™y_add™ive
,

1387 
weight
, 
Ïrge_commun™y
, 
£t_aùiÚ
)

1389 
£t_ü™”Ÿ
 = 
NÚe


1391 #Addšg 
MATCH
 
ªd
 
SET
 
£qu’û
 
to
 
RMAP
 
defšed


1392 "m©ch" 
š
 
rm­_diù
:

1393 
m©ch
 = 
	$Rou‹M­M©ch
()

1394 
m©ch_ü™”Ÿ
 
š
 
rm­_diù
["m©ch"].
	$keys
():

1395 
m©ch_ü™”Ÿ
 == 'prefix_list':

1396 
pfx_li¡
 = 
rm­_diù
["m©ch"][
m©ch_ü™”Ÿ
]

1397 
´efix_li¡
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.\

1398 
´efix_li¡s
:

1399 
´efix_li¡s
 = []

1400 
´efix_li¡
.
´efix_li¡_uuid_Çme
 =ğ
pfx_li¡
:

1401 
´efix_li¡s
.
	$­³nd
(
´efix_li¡
)

1402 
m©ch
.
´efix_li¡
 = 
´efix_li¡s


1403 
rm­
.
	$add_£q
(
m©ch
, 
rm­_aùiÚ
, 
£t_ü™”Ÿ
)

1404 
–if
 
m©ch_ü™”Ÿ
 == 'community-list':

1405 
commun™y_li¡s
 = []

1406 
commun™›s
 = 
rm­_diù
["m©ch"][
m©ch_ü™”Ÿ
]

1407 
commun™y
 
š
 
commun™›s
:

1408 
commun™y_li¡s
.
	$­³nd
(
commun™y
)

1409 
m©ch
.
commun™y_li¡
 = 
commun™y_li¡s


1410 
rm­
.
	$add_£q
(
m©ch
, 
rm­_aùiÚ
, 
£t_ü™”Ÿ
)

1411 
–if
 
m©ch_ü™”Ÿ
 == 'large-community-list':

1412 
Ïrge_commun™y_li¡s
 = []

1413 
Ïrge_commun™›s
 = 
rm­_diù
["m©ch"][
m©ch_ü™”Ÿ
]

1414 
Ïrge_commun™y
 
š
 
Ïrge_commun™›s
:

1415 
Ïrge_commun™y_li¡s
.
	$­³nd
(
Ïrge_commun™y
)

1416 
m©ch
.
Ïrge_commun™y_li¡
 = 
Ïrge_commun™y_li¡s


1417 
rm­
.
	$add_£q
(
m©ch
, 
rm­_aùiÚ
, 
£t_ü™”Ÿ
)

1418 
–if
 
m©ch_ü™”Ÿ
 == 'tag':

1419 
g
 = 
rm­_diù
["m©ch"][
m©ch_ü™”Ÿ
]

1420 
m©ch
.
g
 =ag

1421 
rm­
.
	$add_£q
(
m©ch
, 
rm­_aùiÚ
, 
£t_ü™”Ÿ
)

1423 
m©ch
 = 
NÚe


1424 
rm­
.
	$add_£q
(
m©ch
, 
rm­_aùiÚ
, 
£t_ü™”Ÿ
)

1426 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1427 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1428 
	$´efixli¡_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1429 
	$rou‹m­_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1430 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1431 #Lßd 
cÚfig
 
to
 
rou‹r


1432 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1433 
exû±
 
Exû±iÚ
 
as
 
e
:

1434 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1435 
logg”
.
	$”rÜ
(
”rÜmsg
)

1436  
”rÜmsg


1438 
logg”
.
	`šfo
("Exiting†ib API: create_route_maps()")

1439  
True


1441 
def
 
	$d–‘e_rou‹_m­s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
, 
CWD
, 
tİo
):

1443 
D–‘e
 

 
rou‹
 
m­s


1445 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1446 * `
šput_diù
` : 
which
 
rou‹r
, 
rou‹
 
m­
 
has
 
to
 
be
 
d–‘ed


1447 * `
tg’
` : 
Tİog’
 
objeù


1448 * `
CWD
` : 
ÿÎ”
's current working directory

1449 * `
tİo
` : 
jsÚ
 
fe
 
d©a


1451 
logg”
.
	`šfo
("Entering†ib API: delete_route_maps()")

1453 
Œy
:

1454 
glob®
 
är_cfg


1455 
rou‹r
 
š
 
šput_diù
.
	$keys
():

1457 #Re£ˆ
cÚfig
 
rou‹rs


1458 
är_cfg
[
rou‹r
].
	$»£t_™
()

1460 
rou‹_m­s
 = 
šput_diù
[
rou‹r
]['route_maps']

1461 
found
 = 
F®£


1462 
rou‹_m­
 
š
 
rou‹_m­s
:

1463 
rm­
 
š
 
är_cfg
[
rou‹r
].
routšg_pb
.
rou‹_m­s
:

1464 
rm­
.
rou‹_m­_uuid_Çme
 =ğ
rou‹_m­
:

1465 
found
 = 
True


1466 
är_cfg
[
rou‹r
].
routšg_pb
.
rou‹_m­s
.
	$»move
(
rm­
)

1467 
nÙ
 
found
:

1468 
”rÜmsg
 = ("Route map {}‚ot found in„outer {}".

1469 
	$fÜm©
(
rou‹_m­
, 
rou‹r
))

1470  
”rÜmsg


1472 
	$š‹rçûs_cfg
(
är_cfg
[
rou‹r
])

1473 
	$¡©ic_¹_cfg
(
är_cfg
[
rou‹r
])

1474 
	$´efixli¡_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1475 
	$rou‹m­_cfg
(
är_cfg
[
rou‹r
], 
ADDR_TYPE
)

1476 
är_cfg
[
rou‹r
].
	$´št_commÚ_cÚfig_to_fe
(
tİo
)

1477 #Lßd 
cÚfig
 
to
 
rou‹r


1478 
	$lßd_cÚfig_to_rou‹r
(
tg’
, 
CWD
, 
rou‹r
)

1479 
exû±
 
Exû±iÚ
 
as
 
e
:

1480 
”rÜmsg
 = 
Œaûback
.
	$fÜm©_exc
()

1481 
logg”
.
	$”rÜ
(
”rÜmsg
)

1482  
”rÜmsg


1484 
logg”
.
	`šfo
("Exiting†ib API: delete_route_maps()")

1485  
True


1487 #############################################
## 
V”ifiÿtiÚ
 
APIs


1489 #############################################
 v”ify_rib(ADDR_TYPE, dut,g’, iÅut_diù,‚ext_hİ = NÚe,…rÙocŞ = NÚe):

1492 
This
 
API
 
is
 
to
 
v”ify
 
RIB
 
BGP
 
rou‹s
.

1494 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1495 * `
dut
`: 
Deviû
 
Und”
 
Te¡
, 
which
 
u£r
 
wªts
 
to
 
‹¡
 
the
 
d©a


1496 * `
šput_diù
` : 
šput
 
diù
, 
has
 
d‘as
 
of
 
rou‹s


1497 * `
tg’
` : 
tİog’
 
objeù


1498 * `
Ãxt_hİ
`[
İtiÚ®
]:‚ext_hİ 
which
 
Ãeds
 
to
 
be
 
v”if›d
,  = 

1499 * `
´ÙocŞ
`[
İtiÚ®
]:…rÙocŞ,  = 
NÚe


1502 
logg”
.
	`šfo
("Entering†ib API: verify_rib()")

1504 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

1505 
rou‹rIÅut
 
š
 
šput_diù
.
	$keys
():

1506 
rou‹r
, 
ºode
 
š
 
rou‹r_li¡
.
	$™”™ems
():

1507 
rou‹r
 !ğ
dut
:

1510 #V”ifyšg 
RIB
 
rou‹s


1511 
ADDR_TYPE
 == "ipv4":

1512 
´ÙocŞ
 !ğ
NÚe
:

1513 
commªd
 = "show i°rou‹ {} jsÚ".
	$fÜm©
(
´ÙocŞ
)

1515 
commªd
 = "show ip„oute json"

1517 
´ÙocŞ
 !ğ
NÚe
:

1518 
commªd
 = "show ipv6„ou‹ {} jsÚ".
	$fÜm©
(
´ÙocŞ
)

1520 
commªd
 = "show ipv6„oute json"

1522 
	$¦“p
(2)

1523 
logg”
.
	`šfo
('Checkšg„ou‹¸{} RIB:'.
	$fÜm©
(
rou‹r
))

1524 
rib_rou‹s_jsÚ
 = 
ºode
.
	$vtysh_cmd
(
commªd
, 
isjsÚ
=
True
)

1526 #V”ifyšg 
ouut
 
diùiÚ¬y
 
rib_rou‹s_jsÚ
 
is
 
nÙ
 
em±y


1527 
	`boŞ
(
rib_rou‹s_jsÚ
è=ğ
F®£
:

1528 
”rÜmsg
 = "No {}„oute found in„ib of„outer {}..".\

1529 
	$fÜm©
(
´ÙocŞ
, 
rou‹r
)

1530  
”rÜmsg


1532 '¡©ic_rou‹s' 
š
 
šput_diù
[
rou‹rIÅut
]:

1533 
¡©ic_rou‹s
 = 
šput_diù
[
rou‹rIÅut
]["static_routes"]

1534 
¡©ic_rou‹
 
š
 
¡©ic_rou‹s
:

1535 
found_rou‹s
 = []

1536 
missšg_rou‹s
 = []

1537 
ÃtwÜk
 = 
¡©ic_rou‹
["network"]

1538 "no_of_" 
š
 
¡©ic_rou‹
:

1539 
no_of_
 = 
¡©ic_rou‹
["no_of_ip"]

1541 
no_of_
 = 0

1543 #G’”©šg 
IPs
 
v”ifiÿtiÚ


1544 
_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
ÃtwÜk
, 
no_of_
)

1545 
¡_¹
 
š
 
_li¡
:

1546 
¡_¹
 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(
¡_¹
)))

1548 
¡_found
 = 
F®£


1549 
nh_found
 = 
F®£


1550 
¡_¹
 
š
 
rib_rou‹s_jsÚ
:

1551 
¡_found
 = 
True


1552 
found_rou‹s
.
	$­³nd
(
¡_¹
)

1554 
Ãxt_hİ
 !ğ
NÚe
:

1555 
rib_rou‹s_jsÚ
[
¡_¹
][0]['nexthops'][0]['ip'] \

1556 =ğ
Ãxt_hİ
:

1557 
nh_found
 = 
True


1559 
”rÜmsg
 = ("Nexthop {} is Missing for {}"

1561 " {}\n".
	$fÜm©
(
Ãxt_hİ
, 
´ÙocŞ
,

1562 
¡_¹
, 
dut
))

1563  
”rÜmsg


1565 
missšg_rou‹s
.
	$­³nd
(
¡_¹
)

1566 
nh_found
:

1567 
logg”
.
	`šfo
("Found‚ext_hop {} for‡ll {}„outes in RIB of"

1568 "„ou‹¸{}\n".
	$fÜm©
(
Ãxt_hİ
, 
´ÙocŞ
, 
dut
))

1570 
nÙ
 
¡_found
 
ªd
 
	`Ën
(
missšg_rou‹s
) > 0:

1571 
”rÜmsg
 = "Missing„oute in RIB of„outer {},„outes: {}" \

1572 " \n".
	$fÜm©
(
dut
, 
missšg_rou‹s
)

1573  
”rÜmsg


1575 
logg”
.
	`šfo
("Verified„outes in„outer {} RIB, found„outes"

1576 "‡»: {}\n".
	$fÜm©
(
dut
, 
found_rou‹s
))

1578 'adv”ti£_ÃtwÜks' 
š
 
šput_diù
[
rou‹rIÅut
]:

1579 
found_rou‹s
 = []

1580 
missšg_rou‹s
 = []

1581 
adv”ti£_ÃtwÜk
 = 
šput_diù
[
rou‹rIÅut
]['advertise_networks']

1582 
adv”ti£_ÃtwÜk_diù
 
š
 
adv”ti£_ÃtwÜk
:

1583 
¡¬t_
 = 
adv”ti£_ÃtwÜk_diù
['start_ip']

1584 'no_of_ÃtwÜk' 
š
 
adv”ti£_ÃtwÜk_diù
:

1585 
no_of_ÃtwÜk
 = 
adv”ti£_ÃtwÜk_diù
['no_of_network']

1587 
no_of_ÃtwÜk
 = 0

1589 #G’”©šg 
IPs
 
v”ifiÿtiÚ


1590 
_li¡
 = 
	$g’”©e_s
(
ADDR_TYPE
, 
¡¬t_
, 
no_of_ÃtwÜk
)

1591 
¡_¹
 
š
 
_li¡
:

1592 
¡_¹
 = 
	`¡r
(
add»ss
.
	`_ÃtwÜk
(
	$unicode
(
¡_¹
)))

1594 
found
 = 
F®£


1595 
¡_¹
 
š
 
rib_rou‹s_jsÚ
:

1596 
found
 = 
True


1597 
found_rou‹s
.
	$­³nd
(
¡_¹
)

1599 
missšg_rou‹s
.
	$­³nd
(
¡_¹
)

1601 
nÙ
 
found
 
ªd
 
	`Ën
(
missšg_rou‹s
) > 0:

1602 
”rÜmsg
 = "Missing„oute in RIB of„outer {},‡re: {}" \

1603 " \n".
	$fÜm©
(
dut
, 
missšg_rou‹s
)

1604  
”rÜmsg


1606 
logg”
.
	`šfo
("Verified„outes in„outer {} RIB, found„outes"

1607 "‡»: {}\n".
	$fÜm©
(
dut
, 
found_rou‹s
))

1609 
logg”
.
	`šfo
("Exiting†ib API: verify_rib()")

1610  
True


1612 
def
 
	$v”ify_admš_di¡ªû_fÜ_¡©ic_rou‹s
(
šput_diù
, 
tg’
):

1614 
This
 
API
 
is
 
to
 
v”ify
 
admš
 
di¡ªû
 
rou‹s
.

1616 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
 
ªd
 
rou‹s


1617 
admš
 
ds™ªû
 
Ãeds
 
to
 
be
 
v”if›d


1618 * `
tg’
` : 
tİog’
 
objeù


1621 
logg”
.
	`šfo
("Entering†ib API: verify_admin_distance_for_static_routes()")

1623 
dut
 
š
 
šput_diù
.
	$keys
():

1624 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1625 
rou‹r
 !ğ
dut
:

1628 
show__rou‹_jsÚ
 = 
ºode
.
	`vtysh_cmd
("show i°rou‹ jsÚ", 
isjsÚ
=
True
)

1629 
¡©ic_rou‹
 
š
 
šput_diù
[
dut
].
	$keys
():

1630 
logg”
.
	`šfo
('Verifying‡dmin distance for static„oute {}'

1631 ' und” duˆ{}:'.
	$fÜm©
(
¡©ic_rou‹
, 
rou‹r
))

1632 
Ãxt_hİ
 = 
šput_diù
[
dut
][
¡©ic_rou‹
]['next_hop']

1633 
admš_di¡ªû
 = 
šput_diù
[
dut
][
¡©ic_rou‹
]['admin_distance']

1635 
¡©ic_rou‹
 
š
 
show__rou‹_jsÚ
:

1636 
show__rou‹_jsÚ
[
¡©ic_rou‹
][0]['nexthops'][0]['ip']\

1637 =ğ
Ãxt_hİ
:

1638 
show__rou‹_jsÚ
[
¡©ic_rou‹
][0]['distance']\

1639 !ğ
admš_di¡ªû
:

1640 
”rÜmsg
 = ('Verification failed:‡dmin distance'

1642 ' found:{} buˆex³ùed:{}'.
	`fÜm©
(

1643 
¡©ic_rou‹
, 
rou‹r
,

1644 
show__rou‹_jsÚ
[
¡©ic_rou‹
][0]['distance'],

1645 
admš_di¡ªû
))

1646  
”rÜmsg


1648 
logg”
.
	`šfo
('Verification successful:‡dmin'

1650 ' duˆ{}, found:{}'.
	`fÜm©
(
¡©ic_rou‹
,

1651 
rou‹r
,

1652 
show__rou‹_jsÚ
[
¡©ic_rou‹
][0]['distance']))

1655 
”rÜmsg
 = ('Static„oute {}‚ot found in '

1657 
	$fÜm©
(
¡©ic_rou‹
, 
rou‹r
))

1658  
”rÜmsg


1660 
logg”
.
	`šfo
("Exiting†ib API: verify_admin_distance_for_static_routes()")

1661  
True


1663 
def
 
	$v”ify_´efix_li¡s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
):

1665 
This
 
API
 
is
 
to
 
v”ify
 
´efix
 
li¡s
.

1667 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1668 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
 
´efix


1669 
li¡s
 
has
 
to
 
be
 
d–‘ed


1670 * `
tg’
` : 
tİog’
 
objeù


1673 
logg”
.
	`šfo
("Entering†ib API: verify_prefix_lists()")

1675 
dut
 
š
 
šput_diù
.
	$keys
():

1676 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1677 
rou‹r
 !ğ
dut
:

1680 #Show 

 
´efix
 
li¡


1681 
show_´efix_li¡
 = 
ºode
.
	`vtysh_cmd
("show ip…refix-list")

1683 #V”ify 
P»fix
 
li¡
 
is
 
d–‘ed


1684 
´efix_li¡s
 = 
šput_diù
[
rou‹r
]["prefix_lists"]

1685 
´efix_li¡
 
š
 
´efix_li¡s
:

1686 
´efix_li¡
 
š
 
show_´efix_li¡
:

1687 
”rÜmsg
 = ("Prefix†ist {} is‚ot deleted from„outer"

1688 " {}".
	$fÜm©
(
´efix_li¡
, 
rou‹r
))

1689  
”rÜmsg


1691 
logg”
.
	`šfo
("Prefix†ist {} is/are deleted successfully from"

1692 "rou‹¸{}".
	$fÜm©
(
´efix_li¡s
, 
dut
))

1694 
logg”
.
	`šfo
("Exiting†ib API: verify_prefix_lissts()")

1695  
True


1698 
def
 
	$v”ify_rou‹_m­s
(
ADDR_TYPE
, 
šput_diù
, 
tg’
):

1700 
This
 
API
 
is
 
to
 
v”ify
 
rou‹
 
m­s
.

1702 * `
ADDR_TYPE
` : 

 
ty³
, 
v4
/
v6


1703 * `
šput_diù
`: 
havšg
 
d‘as
 
like
 - 
which
 
rou‹r
 
rou‹


1704 
m­s
 
has
 
to
 
be
 
d–‘ed


1705 * `
tg’
` : 
tİog’
 
objeù


1708 
logg”
.
	`šfo
("Entering†ib API: verify_route_maps()")

1710 
dut
 
š
 
šput_diù
.
	$keys
():

1711 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

1712 
rou‹r
 !ğ
dut
:

1715 #Show 

 
rou‹
-
m­


1716 
show_rou‹_m­s
 = 
ºode
.
	`vtysh_cmd
("show„oute-map")

1718 #V”ify 
rou‹
-
m­
 
is
 
d–‘ed


1719 
rou‹_m­s
 = 
šput_diù
[
rou‹r
]["route_maps"]

1720 
rou‹_m­
 
š
 
rou‹_m­s
:

1721 
rou‹_m­
 
š
 
show_rou‹_m­s
:

1722 
”rÜmsg
 = ("Route map {} is‚ot deleted from„outer"

1723 " {}".
	$fÜm©
(
rou‹_m­
, 
rou‹r
))

1724  
”rÜmsg


1726 
logg”
.
	`šfo
("Route map {} is/are deleted successfully from"

1727 "„ou‹¸{}".
	$fÜm©
(
rou‹_m­s
, 
rou‹r
))

1729 
logg”
.
	`šfo
("Exiting†ib API: verify_route_maps()")

1730  
True


	@lib/ltemplate.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


5 #
#Cİyrighˆ(
c
è2017 
by


7 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

8 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


10 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


11 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


12 #š 
®l
 
cİ›s
.

13 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


15 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


16 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


17 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


18 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

19 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


20 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


21 #OF 
THIS
 
SOFTWARE
.

25 
	gÉem¶©e
.
	gpy
: 
LabN
 
‹m¶©e
 
FRR
 
‹¡s
.

28 
impÜt
 
os


29 
impÜt
 
sys


30 
impÜt
 
¶©fÜm


31 
impÜt
 
py‹¡


32 
impÜt
 
imp


34 #pylšt: 
di§bË
=
C0413


35 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


36 
äom
 
lib
 
impÜt
 
tİÙe¡


37 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
	gTİoRou‹r
, 
g‘_tİog’


38 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


39 
äom
 
	glib
.
lut
 
	gimpÜt
 *

41 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

42 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


44 
	gcu¡omize
 = 
NÚe


46 
şass
 
	$LTem¶©e
():

47 
‹¡
 = 
NÚe


48 
‹¡dœ
 = 
NÚe


49 
sütdœ
 = 
NÚe


50 
logdœ
 = 
NÚe


51 
´e¡¬thooksucûss
 = 
True


52 
po¡¡¬thooksucûss
 = 
True


53 
rou‹2V”
 = 
NÚe


55 
def
 
	$__š™__
(
£lf
, 
‹¡
, 
‹¡dœ
):

56 
glob®
 
cu¡omize


57 
cu¡omize
 = 
imp
.
	`lßd_sourû
('cu¡omize', 
os
.
·th
.
	`još
(
‹¡dœ
, 'customize.py'))

58 
£lf
.
‹¡
 =est

59 
£lf
.
‹¡dœ
 =estdir

60 
£lf
.
sütdœ
 = 
‹¡dœ


61 
£lf
.
logdœ
 = '/tmp/tİÙe¡s/{0}.‹¡_{0}'.
	$fÜm©
(
‹¡
)

62 
logg”
.
	`šfo
('LTem¶©e: '+
‹¡
)

64 
def
 
	$£tup_moduË
(
£lf
, 
mod
):

66 #Thi 
funùiÚ
 
š™Ÿ‹s
 
the
 
tİŞogy
 
bud
 
w™h
 
Tİog’
...

67 
tg’
 = 
	$Tİog’
(
cu¡omize
.
ThisTe¡Tİo
, 
mod
.
__Çme__
)

68 #... 
ªd
 
h”e
 
™
 
ÿÎs
 
Mšš‘
 
š™Ÿliz©iÚ
 
funùiÚs
.

69 
tg’
.
	$¡¬t_tİŞogy
()

71 
logg”
.
	`šfo
('Topology started')

72 
Œy
:

73 
£lf
.
´e¡¬thooksucûss
 = 
cu¡omize
.
	$Éem¶©eP»Rou‹rS¹Hook
()

74 
exû±
 
A‰ribu‹E¼Ü
:

75 #nÙ 
defšed


76 
logg”
.
	`debug
("ltemplatePreRouterStartHook()‚ot defined")

77 
£lf
.
´e¡¬thooksucûss
 !ğ
True
:

78 
logg”
.
	`šfo
('ltemplatePreRouterStartHook() failed, skippingest')

81 #Thi 
is
 
a
 
§m¶e
 
of
 
cÚfigu¿tiÚ
 
lßdšg
.

82 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

84 #FÜ 
®l
 
»gi¡»d
 
rou‹rs
, 
lßd
 
the
 
zeb¿
 
cÚfigu¿tiÚ
 
fe


85 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

86 
	`´št
("S‘tšg u°%s" % 
ºame
)

87 
cÚfig
 = 
os
.
·th
.
	`još
(
£lf
.
‹¡dœ
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

88 
os
.
·th
.
	$exi¡s
(
cÚfig
):

89 
rou‹r
.
	$lßd_cÚfig
(
TİoRou‹r
.
RD_ZEBRA
, 
cÚfig
)

90 
cÚfig
 = 
os
.
·th
.
	`još
(
£lf
.
‹¡dœ
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

91 
os
.
·th
.
	$exi¡s
(
cÚfig
):

92 
rou‹r
.
	$lßd_cÚfig
(
TİoRou‹r
.
RD_OSPF
, 
cÚfig
)

93 
cÚfig
 = 
os
.
·th
.
	`još
(
£lf
.
‹¡dœ
, '{}/ldpd.cÚf'.
	$fÜm©
(
ºame
))

94 
os
.
·th
.
	$exi¡s
(
cÚfig
):

95 
rou‹r
.
	$lßd_cÚfig
(
TİoRou‹r
.
RD_LDP
, 
cÚfig
)

96 
cÚfig
 = 
os
.
·th
.
	`još
(
£lf
.
‹¡dœ
, '{}/bgpd.cÚf'.
	$fÜm©
(
ºame
))

97 
os
.
·th
.
	$exi¡s
(
cÚfig
):

98 
rou‹r
.
	$lßd_cÚfig
(
TİoRou‹r
.
RD_BGP
, 
cÚfig
)

99 
cÚfig
 = 
os
.
·th
.
	`još
(
£lf
.
‹¡dœ
, '{}/isisd.cÚf'.
	$fÜm©
(
ºame
))

100 
os
.
·th
.
	$exi¡s
(
cÚfig
):

101 
rou‹r
.
	$lßd_cÚfig
(
TİoRou‹r
.
RD_ISIS
, 
cÚfig
)

103 #Aá” 
lßdšg
 
the
 
cÚfigu¿tiÚs
, 
this
 
funùiÚ
 
lßds
 
cÚfigu»d
 
d«mÚs
.

104 
logg”
.
	`šfo
('Starting„outers')

105 
tg’
.
	$¡¬t_rou‹r
()

106 
Œy
:

107 
£lf
.
po¡¡¬thooksucûss
 = 
cu¡omize
.
	$Éem¶©ePo¡Rou‹rS¹Hook
()

108 
exû±
 
A‰ribu‹E¼Ü
:

109 #nÙ 
defšed


110 
logg”
.
	`debug
("ltemplatePostRouterStartHook()‚ot defined")

111 
	$luS¹
(
ba£SütDœ
=
£lf
.
sütdœ
, 
ba£LogDœ
=£lf.
logdœ
, 
Ãt
=
tg’
.net)

113 #š™Ÿlized 
by
 
Éem¶©e_¡¬t


114 
_É
 = 
NÚe


116 
def
 
	$£tup_moduË
(
mod
):

117 
glob®
 
_É


118 
roÙ
 = 
os
.
·th
.
	`dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
)))

119 
‹¡
 = 
mod
.
__Çme__
[:mod.__Çme__.
	`rfšd
(".")]

120 
‹¡dœ
 = 
os
.
·th
.
	$još
(
roÙ
, 
‹¡
)

122 #dÚ'ˆdØthi fÜ‚ow‡ »lßd didn'
t
 
wÜk
 
as
 
ex³ùed


123 #fixu°
sys
.
·th
, 
wªt
 
‹¡
 
dœ
 
th”e
 
Úly
 
Úû


125 #sys.
·th
.
	`»move
(
‹¡dœ
)

126 #exû± 
V®ueE¼Ü
:

127 #logg”.
	`debug
(
‹¡dœ
+"‚ot found in original sys.path")

128 #add 
‹¡dœ


129 #sys.
·th
.
	`­³nd
(
‹¡dœ
)

131 #š™ 
şass


132 
_É
 = 
	$LTem¶©e
(
‹¡
, 
‹¡dœ
)

133 
_É
.
	$£tup_moduË
(
mod
)

135 #drİ 
‹¡dœ


136 #sys.
·th
.
	`»move
(
‹¡dœ
)

138 
def
 
	$‹¬down_moduË
(
mod
):

139 
glob®
 
_É


141 
tg’
 = 
	$g‘_tİog’
()

143 
_É
 !ğ
NÚe
 
ªd
 _É.
sütdœ
 !ğNÚªd _É.
´e¡¬thooksucûss
 =ğ
True
:

144 
	`´št
(
	$luFšish
())

146 #Thi 
funùiÚ
 
‹¬s
 
down
 
the
 
whŞe
 
tİŞogy
.

147 
tg’
.
	$¡İ_tİŞogy
()

148 
_É
 = 
NÚe


150 
def
 
	$Éem¶©eTe¡
(
süt
, 
SkIfFaed
=
True
, 
C®lOnFa
=
NÚe
, 
CheckFuncSŒ
=NÚe, 
K“pGošg
=
F®£
):

151 
glob®
 
_É


152 
_É
 =ğ
NÚe
 
Ü
 _É.
´e¡¬thooksucûss
 !ğ
True
:

155 
tg’
 = 
	$g‘_tİog’
()

156 
nÙ
 
os
.
·th
.
	$isfe
(
süt
):

157 
nÙ
 
os
.
·th
.
	`isfe
(os.·th.
	$još
(
_É
.
sütdœ
, 
süt
)):

158 
logg”
.
	`”rÜ
('Could‚Ù fšd süˆfe: ' + 
süt
)

159 
as£¹
 'Could‚Ù fšd süˆfe: ' + 
süt


160 
logg”
.
	`šfo
("S¹šgem¶©‹¡: " + 
süt
)

161 
numEÁry
 = 
	$luNumFa
()

163 
SkIfFaed
 
ªd
 
tg’
.
	$rou‹rs_have_çu»
():

164 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

165 
numEÁry
 > 0:

166 
nÙ
 
K“pGošg
:

167 
py‹¡
.
	`sk
("Hav%dƒ¼Üs" % 
numEÁry
)

169 
CheckFuncSŒ
 !ğ
NÚe
:

170 
check
 = 
	$ev®
(
CheckFuncSŒ
)

171 
check
 !ğ
True
:

172 
py‹¡
.
	`sk
("Check funùiÚ '"+
CheckFuncSŒ
+"'„‘uºed: " + 
check
)

174 
C®lOnFa
 !ğ
NÚe
:

175 
C®lOnFa
 = 
	$ev®
(
C®lOnFa
)

176 
	$luInşude
(
süt
, 
C®lOnFa
)

177 
numFa
 = 
	`luNumFa
(è- 
numEÁry


178 
numFa
 > 0:

179 
	$luShowFa
()

180 
çl_”rÜ
 = "%de¡ çed" % 
numFa


181 
nÙ
 
K“pGošg
:

182 
as£¹
 "süts/ş—nup_®l.py faed" =ğ"S“ summ¬y ouuˆabove", 
çl_”rÜ


184 #MemÜy 
Ëak
 
‹¡
 
‹m¶©e


185 
def
 
	$‹¡_memÜy_Ëak
():

187 
tg’
 = 
	$g‘_tİog’
()

188 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

189 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

191 
tg’
.
	$»pÜt_memÜy_Ëaks
()

193 
şass
 
	$Éem¶©eRŒCmd
():

194 
def
 
	$__š™__
(
£lf
):

195 
£lf
.
	$»£tCouÁs
()

197 
def
 
	$doCmd
(
£lf
, 
tg’
, 
¹r
, 
cmd
, 
check¡r
 = 
NÚe
):

198 
ouut
 = 
tg’
.
Ãt
[
¹r
].
	`cmd
(
cmd
).
	$¡r
()

199 
	$Ën
(
ouut
):

200 
£lf
.
ouut
 += 1

201 
check¡r
 !ğ
NÚe
:

202 
»t
 = 
»
.
	$£¬ch
(
check¡r
, 
ouut
)

203 
»t
 =ğ
NÚe
:

204 
£lf
.
nom©ch
 += 1

206 
£lf
.
m©ch
 += 1

207  
»t


208 
logg”
.
	`šfo
('commªd: {} {}'.
	$fÜm©
(
¹r
, 
cmd
))

209 
logg”
.
	`šfo
('ouut: ' + 
ouut
)

210 
£lf
.
nÚe
 += 1

211  
NÚe


213 
def
 
	$»£tCouÁs
(
£lf
):

214 
£lf
.
m©ch
 = 0

215 
£lf
.
nom©ch
 = 0

216 
£lf
.
ouut
 = 0

217 
£lf
.
nÚe
 = 0

219 
def
 
	$g‘M©ch
(
£lf
):

220  
£lf
.
m©ch


222 
def
 
	$g‘NoM©ch
(
£lf
):

223  
£lf
.
nom©ch


225 
def
 
	$g‘Ouut
(
£lf
):

226  
£lf
.
ouut


228 
def
 
	$g‘NÚe
(
£lf
):

229  
£lf
.
nÚe


231 
def
 
	`Éem¶©eV”siÚCheck
(
v¡r
, 
ºame
='r1', 
comp¡r
='<',
şi
=
F®£
, 
k”Ãl
='4.9', 
rou‹2
=
NÚe
, 
m¶s
=
True
):

232 
tg’
 = 
	$g‘_tİog’
()

233 
rou‹r
 = 
tg’
.
g—rs
[
ºame
]

235 
şi
:

236 
logg”
.
	`šfo
('calling mininet CLI')

237 
tg’
.
	$mšš‘_şi
()

238 
logg”
.
	`šfo
('exited mininet CLI')

240 
_É
 =ğ
NÚe
:

241 
»t
 = 'Template‚ot initialized'

242  
»t


244 
_É
.
´e¡¬thooksucûss
 !ğ
True
:

245 
»t
 = 'ltemplatePreRouterStartHook failed'

246  
»t


248 
_É
.
po¡¡¬thooksucûss
 !ğ
True
:

249 
»t
 = 'ltemplatePostRouterStartHook failed'

250  
»t


252 
m¶s
 =ğ
True
 
ªd
 
tg’
.
hasm¶s
 != True:

253 
»t
 = 'MPLS‚ot initialized'

254  
»t


256 
k”Ãl
 !ğ
NÚe
:

257 
k»l
 = 
¶©fÜm
.
	$»Ëa£
()

258 
tİÙe¡
.
	`v”siÚ_cmp
(
k»l
, 
k”Ãl
) < 0:

259 
»t
 = 'Skpšge¡s, old k”ÃÈ({} < {})'.
	$fÜm©
(
k»l
, 
k”Ãl
)

260  
»t


262 
rou‹2
 !ğ
NÚe
:

263 
_É
.
rou‹2V”
 =ğ
NÚe
:

264 #cŞËù/
log
 
šfo
 
Ú
 
rou‹2


265 
cc
 = 
	$Éem¶©eRŒCmd
()

266 
found
 = 
cc
.
	`doCmd
(
tg’
, 
ºame
, 'apt-cache…olicy iproute2', 'Installed: ([\d\.]*)')

267 
found
 !ğ
NÚe
:

268 
rou‹2V”
 = 
found
.
	$group
(1)

270 
rou‹2V”
 = '0-unknown'

271 
logg”
.
	`šfo
('Havrou‹2 v”siÚ=' + 
rou‹2V”
)

273 
tİÙe¡
.
	`v”siÚ_cmp
(
rou‹2V”
, 
rou‹2
) < 0:

274 
»t
 = 'Skpšge¡s, old i´ou‹2 ({} < {})'.
	$fÜm©
(
rou‹2V”
, 
rou‹2
)

275  
»t


277 
»t
 = 
True


278 
Œy
:

279 
rou‹r
.
	$has_v”siÚ
(
comp¡r
, 
v¡r
):

280 
»t
 = 'Skpšge¡s, old FRR v”siÚ {} {}'.
	$fÜm©
(
comp¡r
, 
v¡r
)

281  
»t


282 
exû±
:

283 
»t
 = 
True


285  
»t


287 #fÜ 
‹¡šg


288 
__Çme__
 == '__main__':

289 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

290 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@lib/lutil.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #Cİyrighˆ2017, 
LabN
 
CÚsuÉšg
, 
L
.L.
C
.

4 #
#Thi 
´og¿m
 
is
 
ä“
 
soáw¬e
; 
you
 
ÿn
 
»di¡ribu‹
 
™
 
ªd
/
Ü


6 #modify 
™
 
und”
 
the
 
‹rms
 
of
h
GNU
 
G’”®
 
Public
 
Liûn£


7 #a 
published
 
by
 
the
 
F»e
 
Soáw¬e
 
Found©iÚ
; 
e™h”
 
v”siÚ
 2

8 #oà
the
 
Liûn£
, 
Ü
 (
©
 
your
 
İtiÚ
è
ªy
 
Ï‹r
 
v”siÚ
.

9 #
#Thi 
´og¿m
 
is
 
di¡ribu‹d
 
š
 
the
 
hİe
 
th©
 
™
 
wl
 
be
 
u£ful
,

11 #buˆ
WITHOUT
 
ANY
 
WARRANTY
; 
w™hout
 
ev’
 
the
 
im¶›d
 
w¬¿Áy
 
of


12 #MERCHANTABILITY 
Ü
 
FITNESS
 
FOR
 
A
 
PARTICULAR
 
PURPOSE
. 
S“
 
the


13 #GNU 
G’”®
 
Public
 
Liûn£
 
mÜe
 
d‘as
.

14 #
#You 
should
 
have
 
»ûived
 
a
 
cİy
 
of
 
the
 
GNU
 
G’”®
 
Public
 
Liûn£
 
®Úg


16 #w™h 
this
 
´og¿m
; 
£e
 
the
 
fe
 
COPYING
; 
nÙ
, 
wr™e
 
to
h
F»e
 
Soáw¬e


17 #Found©iÚ, 
Inc
., 51 
F¿nklš
 
St
, 
Fiáh
 
FloÜ
, 
Bo¡Ú
, 
MA
 02110-1301 
USA


19 
impÜt
 
os


20 
impÜt
 
»


21 
impÜt
 
sys


22 
impÜt
 
time


23 
impÜt
 
d©‘ime


24 
impÜt
 
jsÚ


25 
äom
 
tİŞog
 
impÜt
 
logg”


26 
äom
 
	gmšš‘
.
Ãt
 
impÜt
 
	gMšš‘


29 #L 
ut™y
 
funùiÚs


30 #
#The£ 
funùiÚs
 
¬e
 
š‹Ã‹d
 
to
 
´ovide
 
suµÜt
 
CI
 
‹¡šg
 
w™hš
 
MšiN‘


34 
şass
 
	glUt
:

35 #tØ
be
 
made
 
cÚfigu¿bË
 
š
 
the
 
futu»


36 
ba£_süt_dœ
 = '.'

37 
ba£_log_dœ
 = '.'

38 
fout_Çme
 = 'output.log'

39 
fsum_Çme
 = 'summary.txt'

40 
l_Ëv–
 = 9

41 
C®lOnFa
 = 
F®£


43 
l_tÙ®
 = 0

44 
l_·ss
 = 0

45 
l_ç
 = 0

46 
l_f’ame
 = ''

47 
l_Ï¡
 = 
NÚe


48 
l_lše
 = 0

49 
l_dÙ®l_ex³rim’t
 = 
F®£


50 
l_Ï¡_Æ
 = 
NÚe


52 
fout
 = ''

53 
fsum
 = ''

54 
Ãt
 = ''

56 
def
 
	$log
(
£lf
, 
¡r
):

57 
£lf
.
l_Ëv–
 > 0:

58 
£lf
.
fout
 == '':

59 
£lf
.
fout
 = 
	`İ’
(£lf.
fout_Çme
, 'w', 0)

60 
£lf
.
fout
.
	`wr™e
(
¡r
+'\n')

61 
£lf
.
l_Ëv–
 > 5:

62 
	$´št
(
¡r
)

64 
def
 
	$summ¬y
(
£lf
, 
¡r
):

65 
£lf
.
fsum
 == '':

66 
£lf
.
fsum
 = 
	`İ’
(£lf.
fsum_Çme
, 'w', 0)

67 
£lf
.
fsum
.
	`wr™e
('\
******************************************************************************\n')

69 
£lf
.
fsum
.
	`wr™e
('\
 Target Summary Pass Fail\n')

71 
£lf
.
fsum
.
	`wr™e
('\
******************************************************************************\n')

73 
£lf
.
fsum
.
	`wr™e
(
¡r
+'\n')

75 
def
 
	$»suÉ
(
£lf
, 
rg‘
, 
sucûss
, 
¡r
, 
log¡r
=
NÚe
):

76 
sucûss
:

77 
p
 = 1

78 
f
 = 0

79 
£lf
.
l_·ss
 += 1

80 
s¡r
 = "PASS"

82 
f
 = 1

83 
p
 = 0

84 
£lf
.
l_ç
 += 1

85 
s¡r
 = "FAIL"

86 
£lf
.
l_tÙ®
 += 1

87 
log¡r
 !ğ
NÚe
:

88 
£lf
.
	`log
("R:%d %s: %s" % (£lf.
l_tÙ®
, 
s¡r
, 
log¡r
))

89 
»s
 = "%-4d %-6 %-56 %-4d %d" % (
£lf
.
l_tÙ®
, 
rg‘
, 
¡r
, 
p
, 
f
)

90 
£lf
.
	`log
 ('R:'+
»s
)

91 
£lf
.
	$summ¬y
(
»s
)

92 
f
 =ğ1 
ªd
 
£lf
.
C®lOnFa
 !ğ
F®£
:

93 
£lf
.
	$C®lOnFa
()

95 
def
 
	$şo£Fes
(
£lf
):

96 
»t
 = '\
******************************************************************************\n\
 %-4d %-4d %d\n\
******************************************************************************'\

100 % (
£lf
.
l_tÙ®
, s–f.
l_·ss
, s–f.
l_ç
)

101 
£lf
.
fsum
 != '':

102 
£lf
.
fsum
.
	`wr™e
(
»t
 + '\n')

103 
£lf
.
fsum
.
	$şo£
()

104 
£lf
.
fsum
 = ''

105 
£lf
.
fout
 != '':

106 
os
.
·th
.
	$isfe
(
£lf
.
fsum_Çme
):

107 
r
 = 
	`İ’
(
£lf
.
fsum_Çme
, 'r')

108 
£lf
.
fout
.
	`wr™e
(
r
.
	$»ad
())

109 
r
.
	$şo£
()

110 
£lf
.
fout
.
	$şo£
()

111 
£lf
.
fout
 = ''

112  
»t


114 
def
 
	$£tF’ame
(
£lf
, 
Çme
):

115 
¡r
 = 'FILE: ' + 
Çme


116 
£lf
.
	$log
(
¡r
)

117 
£lf
.
	$summ¬y
(
¡r
)

118 
£lf
.
l_f’ame
 = 
Çme


119 
£lf
.
lše
 = 0

121 
def
 
	$g‘C®lOnFa
(
£lf
):

122  
£lf
.
C®lOnFa


124 
def
 
	$£tC®lOnFa
(
£lf
, 
C®lOnFa
):

125 
£lf
.
C®lOnFa
 = CallOnFail

127 
def
 
	$¡rToA¼ay
(
£lf
, 
¡ršg
):

128 
a
 = []

129 
c
 = 0

130 
’d
 = ''

131 
wÜds
 = 
¡ršg
.
	$¥l™
()

132 
	`Ën
(
wÜds
è< 1 
Ü
 wÜds[0].
	`¡¬tsw™h
('#'):

133  
a


134 
wÜds
 = 
¡ršg
.
	$¥l™
()

135 
wÜd
 
š
 
wÜds
:

136 
	`Ën
(
’d
) == 0:

137 
a
.
	$­³nd
(
wÜd
)

139 
a
[
c
] +ğ
	`¡r
(' '+
wÜd
)

140 
’d
 == '\\':

141 
’d
 = ''

142 
nÙ
 
wÜd
.
	`’dsw™h
('\\'):

143 
’d
 != '"':

144 
wÜd
.
	`¡¬tsw™h
('"'):

145 
’d
 = '"'

147 
c
 += 1

149 
wÜd
.
	`’dsw™h
('"'):

150 
’d
 = ''

151 
c
 += 1

153 
c
 += 1

155 
’d
 = '\\'

156 #ià
	`Ën
(
’d
) == 0:

157 #´št('%d:%s:' % (
c
, 
a
[c-1]))

159  
a


161 
def
 
	$execTe¡Fe
(
£lf
, 
t¡Fe
):

162 
os
.
·th
.
	$isfe
(
t¡Fe
):

163 
f
 = 
	$İ’
(
t¡Fe
)

164 
lše
 
š
 
f
:

165 
	`Ën
(
lše
) > 1:

166 
a
 = 
£lf
.
	$¡rToA¼ay
(
lše
)

167 
	`Ën
(
a
) >= 6:

168 
	$luCommªd
(
a
[1],‡[2],‡[3],‡[4],‡[5])

170 
£lf
.
l_lše
 += 1

171 
£lf
.
	`log
('%s:% %s' % (£lf.
l_f’ame
, s–f.
l_lše
 , 
lše
))

172 
	`Ën
(
a
) >= 2:

173 
a
[0] == 'sleep':

174 
time
.
	`¦“p
((
a
[1]))

175 
–if
 
a
[0] == 'include':

176 
£lf
.
	$execTe¡Fe
(
a
[1])

177 
f
.
	$şo£
()

179 
£lf
.
	`log
('uÇbËØ»ad: ' + 
t¡Fe
)

180 
sys
.
	$ex™
(1)

182 
def
 
	$commªd
(
£lf
, 
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
, 
»tuºJsÚ
):

183 
glob®
 
Ãt


184 
İ
 != 'wait':

185 
£lf
.
l_lše
 += 1

186 
£lf
.
	`log
('(#%d) %s:%s COMMAND:%s:%s:%s:%s:%s:' % \

187 (
£lf
.
l_tÙ®
+1,

188 
£lf
.
l_f’ame
, s–f.
l_lše
, 
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
))

189 
£lf
.
Ãt
 == '':

190  
F®£


191 #£lf.
	`log
("RuÂšg % %s" % (
rg‘
, 
commªd
))

192 
js
 = 
NÚe


193 
out
 = 
£lf
.
Ãt
[
rg‘
].
	`cmd
(
commªd
).
	$r¡r
()

194 
	`Ën
(
out
) == 0:

195 
»pÜt
 = "<no output>"

197 
»pÜt
 = 
out


198 
»tuºJsÚ
 =ğ
True
:

199 
Œy
:

200 
js
 = 
jsÚ
.
	$lßds
(
out
)

201 
exû±
:

202 
js
 = 
NÚe


203 
£lf
.
	`log
('WARNING: JSON†oad failed -- confirm command output is in JSON format.')

204 
£lf
.
	`log
('COMMAND OUTPUT:%s:' % 
»pÜt
)

206 #Ex³rim’t: 
ÿn
 
we
 
ach›ve
 
the
 
§me
 
m©ch
 
behaviÜ
 
vŸ
 
DOTALL


207 #w™houˆ
cÚv”tšg
 
Ãwlšes
 
to
 
¥aûs
?

208 
out_Æ
 = 
out


209 
£¬ch_Æ
 = 
»
.
	`£¬ch
(
»gexp
, 
out_Æ
,„e.
DOTALL
);

210 
£lf
.
l_Ï¡_Æ
 = 
£¬ch_Æ


211 #S‘ 
up
 
com·risÚ


212 
£¬ch_Æ
 !ğ
NÚe
:

213 
group_Æ
 = 
£¬ch_Æ
.
	$group
()

214 
group_Æ_cÚv”‹d
 = " ".
	`još
(
group_Æ
.
	$¥l™lšes
())

216 
group_Æ_cÚv”‹d
 = 
NÚe


218 
out
 = " ".
	`još
(out.
	$¥l™lšes
())

219 
£¬ch
 = 
»
.
	$£¬ch
(
»gexp
, 
out
)

220 
£lf
.
l_Ï¡
 = 
£¬ch


221 
£¬ch
 =ğ
NÚe
:

222 
İ
 == 'fail':

223 
sucûss
 = 
True


225 
sucûss
 = 
F®£


226 
»t
 = 
sucûss


228 
»t
 = 
£¬ch
.
	$group
()

229 
£lf
.
	`log
('found:%s:' % 
»t
)

230 
İ
 != 'fail':

231 
sucûss
 = 
True


233 
sucûss
 = 
F®£


234 #Ex³rim’t: 
com·»
 
m©ched
 
¡ršgs
 
obšed
 
—ch
 
way


235 
£lf
.
l_dÙ®l_ex³rim’t
 
	`ªd
 (
group_Æ_cÚv”‹d
 !ğ
»t
):

236 
£lf
.
	`log
('DOTALLƒx³rim’t: sŒšg difã¸dÙ®l=[%s] orig=[%s]' % (
group_Æ_cÚv”‹d
, 
»t
))

237 
İ
 =ğ'·ss' 
Ü
 op == 'fail':

238 
£lf
.
	$»suÉ
(
rg‘
, 
sucûss
, 
»suÉ
)

239 
js
 !ğ
NÚe
:

240  
js


241  
»t


243 
def
 
	$wa™
(
£lf
, 
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
, 
wa™
, 
»tuºJsÚ
):

244 
£lf
.
	`log
('%s:%s WAIT:%s:%s:%s:%s:%s:%s:' % \

245 (
£lf
.
l_f’ame
, s–f.
l_lše
, 
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
,
wa™
))

246 
Îev–
 = 
LUt
.
l_Ëv–


247 
found
 = 
F®£


248 
n
 = 0

249 
¡¬‰
 = 
time
.
	$time
()

250 
d–
 = 
time
.
	`time
(è- 
¡¬‰


251 
d–
 < 
wa™
 
ªd
 
found
 
is
 
F®£
:

252 
found
 = 
£lf
.
	$commªd
(
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
, 
»tuºJsÚ
)

253 
n
+=1

254 
LUt
.
l_Ëv–
 = 0

255 
d–
 = 
time
.
	`time
(è- 
¡¬‰


256 
d–
 < 
wa™
 
ªd
 
found
 
is
 
F®£
:

257 
time
.
	$¦“p
 (0.5)

258 
LUt
.
l_Ëv–
 = 
Îev–


259 
£lf
.
	`log
('DÚaá” %d†oİs,ime=%s, Found=%s' % (
n
, 
d–
, 
found
))

260 
found
 = 
£lf
.
	`commªd
(
rg‘
, 
commªd
, 
»gexp
, '·ss', '% +%4.2à£cs' % (
»suÉ
, 
d–
), 
»tuºJsÚ
)

261  
found


263 #š™Ÿlized 
by
 
luS¹


264 
LUt
=
NÚe


266 #’Œy 
ÿÎs


267 
def
 
	`luS¹
(
ba£SütDœ
='.', 
ba£LogDœ
='.', 
Ãt
='',

268 
fout
='ouut.log', 
fsum
='summ¬y.txt', 
Ëv–
=9):

269 
glob®
 
LUt


270 #š™ 
şass


271 
LUt
=
	$lUt
()

272 
LUt
.
ba£_süt_dœ
 = 
ba£SütDœ


273 
LUt
.
ba£_log_dœ
 = 
ba£LogDœ


274 
LUt
.
Ãt
 =‚et

275 
fout
 != '':

276 
LUt
.
fout_Çme
 = 
ba£LogDœ
 + '/' + 
fout


277 
fsum
 !ğ
NÚe
:

278 
LUt
.
fsum_Çme
 = 
ba£LogDœ
 + '/' + 
fsum


279 
LUt
.
l_Ëv–
 = 
Ëv–


280 
LUt
.
l_dÙ®l_ex³rim’t
 = 
F®£


281 
LUt
.
l_dÙ®l_ex³rim’t
 = 
True


283 
def
 
	`luCommªd
(
rg‘
, 
commªd
, 
»gexp
='.', 
İ
='nÚe', 
»suÉ
='', 
time
=10, 
»tuºJsÚ
=
F®£
):

284 
İ
 != 'wait':

285  
LUt
.
	$commªd
(
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
, 
»tuºJsÚ
)

287  
LUt
.
	$wa™
(
rg‘
, 
commªd
, 
»gexp
, 
İ
, 
»suÉ
, 
time
, 
»tuºJsÚ
)

289 
def
 
	$luLa¡
(
u£Æ
=
F®£
):

290 
u£Æ
:

291 
LUt
.
l_Ï¡_Æ
 !ğ
NÚe
:

292 
LUt
.
	`log
('luLa¡:%s:' % LUt.
l_Ï¡_Æ
.
	$group
())

293  
LUt
.
l_Ï¡_Æ


295 
LUt
.
l_Ï¡
 !ğ
NÚe
:

296 
LUt
.
	`log
('luLa¡:%s:' % LUt.
l_Ï¡
.
	$group
())

297  
LUt
.
l_Ï¡


299 
def
 
	$luInşude
(
f’ame
, 
C®lOnFa
=
NÚe
):

300 
t¡Fe
 = 
LUt
.
ba£_süt_dœ
 + '/' + 
f’ame


301 
LUt
.
	$£tF’ame
(
f’ame
)

302 
C®lOnFa
 !ğ
NÚe
:

303 
ŞdC®lOnFa
 = 
LUt
.
	$g‘C®lOnFa
()

304 
LUt
.
	$£tC®lOnFa
(
C®lOnFa
)

305 
f’ame
.
	`’dsw™h
('.py'):

306 
LUt
.
	`log
("luInşude:ƒxecf"+
t¡Fe
)

307 
	$execfe
(
t¡Fe
)

309 
LUt
.
	`log
("luInşude:ƒxecTe¡F"+
t¡Fe
)

310 
LUt
.
	$execTe¡Fe
(
t¡Fe
)

311 
C®lOnFa
 !ğ
NÚe
:

312 
LUt
.
	$£tC®lOnFa
(
ŞdC®lOnFa
)

314 
def
 
	$luFšish
():

315 
glob®
 
LUt


316 
»t
 = 
LUt
.
	$şo£Fes
()

318 
LUt
 = 
NÚe


319  
»t
;

321 
def
 
	$luNumFa
():

322  
LUt
.
l_ç


324 
def
 
	$luNumPass
():

325  
LUt
.
l_·ss


327 
def
 
	$luResuÉ
(
rg‘
, 
sucûss
, 
¡r
, 
log¡r
=
NÚe
):

328  
LUt
.
	$»suÉ
(
rg‘
, 
sucûss
, 
¡r
, 
log¡r
)

330 
def
 
	$luShowFa
():

331 
´š‹d
 = 0

332 
sf
 = 
	`İ’
(
LUt
.
fsum_Çme
, 'r')

333 
lše
 
š
 
sf
:

334 
lše
[-2] != "0":

335 
´š‹d
+=1

336 
logg”
.
	`”rÜ
(
lše
.
	$r¡r
())

337 
sf
.
	$şo£
()

338 
´š‹d
 > 0:

339 
logg”
.
	`”rÜ
("S“ % fÜ d‘a oà”rÜs" % 
LUt
.
fout_Çme
)

341 #fÜ 
‹¡šg


342 
__Çme__
 == '__main__':

343 
	`´št
(
os
.
·th
.
	`dœÇme
(os.·th.dœÇme(os.·th.
	`ab¥©h
(
__fe__
))) + '/lib')

344 
	$luS¹
()

345 
¬g
 
š
 
sys
.
¬gv
[1:]:

346 
	$luInşude
(
¬g
)

347 
	$luFšish
()

348 
sys
.
	`ex™
(0)

	@lib/test/__init__.py

	@lib/test/test_json.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_jsÚ.
py


5 #Te¡ 
lib¿ry
 
funùiÚ
: 
jsÚ_cmp
().

6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
Te¡s
 
the
 
	$jsÚ_cmp
(è
funùiÚ
.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
py‹¡


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
lib
 
fes
.

34 
CWD
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../../'))

37 #pylšt: 
di§bË
=
C0413


38 
äom
 
lib
.
tİÙe¡
 
impÜt
 
jsÚ_cmp


40 
def
 
	$‹¡_jsÚ_š‹r£ù_Œue
():

43 
dcom¶‘e
 = {

48 
	}
}

50 
dsub1
 = {

54 
dsub2
 = {

58 
dsub3
 = {

62 
dsub4
 = {

63 'i50': 
NÚe
,

67 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
NÚe


68 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
NÚe


69 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
NÚe


70 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub4
è
is
 
NÚe


72 
def
 
	$‹¡_jsÚ_š‹r£ù_çl£
():

75 
dcom¶‘e
 = {

80 
	}
}

82 #IncÜ»ù 
v®ue
 'i1'

83 
dsub1
 = {

87 #NÚ-
exi¡šg
 
key
 'i5'

88 
dsub2
 = {

92 #Key 
should
 
nÙ
 
exi¡


93 
dsub3
 = {

94 'i100': 
NÚe
,

97 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
nÙ
 
NÚe


98 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
nÙ
 
NÚe


99 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
nÙ
 
NÚe


101 
def
 
	$‹¡_jsÚ_š‹r£ù_muÉev–_Œue
():

104 
dcom¶‘e
 = {

119 
	}
}

121 
dsub1
 = {

126 'i10': 
NÚe
,

128 
dsub2
 = {

133 
dsub3
 = {

141 'i450': 
NÚe
,

145 
dsub4
 = {

150 'i450': 
NÚe
,

154 
dsub5
 = {

161 'i450': 
NÚe
,

166 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
NÚe


167 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
NÚe


168 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
NÚe


169 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub4
è
is
 
NÚe


170 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub5
è
is
 
NÚe


172 
def
 
	$‹¡_jsÚ_š‹r£ù_muÉev–_çl£
():

175 
dcom¶‘e
 = {

190 
	}
}

192 #IncÜ»ù 
sub
-
Ëv–
 
v®ue


193 
dsub1
 = {

198 'i10': 
NÚe
,

200 #IÃxi¡’ˆ
sub
-
Ëv–


201 
dsub2
 = {

204 'i3': 
NÚe
,

206 #IÃxi¡’ˆ
sub
-
Ëv–
 
v®ue


207 
dsub3
 = {

210 'i100': 
NÚe
,

213 #IÃxi¡’ˆ
sub
-sub-
Ëv–
 
v®ue


214 
dsub4
 = {

224 #Inv®id 
sub
-sub-
Ëv–
 
v®ue


225 
dsub5
 = {

235 #sub-
sub
-
Ëv–
 
should
 
be
 
v®ue


236 
dsub6
 = {

245 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
nÙ
 
NÚe


246 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
nÙ
 
NÚe


247 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
nÙ
 
NÚe


248 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub4
è
is
 
nÙ
 
NÚe


249 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub5
è
is
 
nÙ
 
NÚe


250 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub6
è
is
 
nÙ
 
NÚe


252 
def
 
	$‹¡_jsÚ_w™h_li¡_suûss
():

255 
dcom¶‘e
 = {

266 
	}
}

268 #Te¡ 
li¡
 
ty³


269 
dsub1
 = {

272 #Te¡ 
li¡
 
cÜ»ù
†i¡ 
™ems


273 
dsub2
 = {

281 #Te¡ 
li¡
 
cÜ»ù
†i¡ 
size


282 
dsub3
 = {

288 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
NÚe


289 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
NÚe


290 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
NÚe


292 
def
 
	$‹¡_jsÚ_w™h_li¡_çu»
():

295 
dcom¶‘e
 = {

306 
	}
}

308 #Te¡ 
li¡
 
ty³


309 
dsub1
 = {

312 #Te¡ 
li¡
 
šcÜ»ù
†i¡ 
™ems


313 
dsub2
 = {

321 #Te¡ 
li¡
 
cÜ»ù
†i¡ 
size


322 
dsub3
 = {

328 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
nÙ
 
NÚe


329 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
nÙ
 
NÚe


330 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
nÙ
 
NÚe


333 
def
 
	$‹¡_jsÚ_li¡_¡¬t_sucûss
():

336 
dcom¶‘e
 = [

340 
	}
},

351 
	gdsub1
 = [

358 
dsub2
 = [

369 
	gdsub3
 = [

376 
dsub4
 = [

379 
dsub5
 = [

385 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
NÚe


386 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
NÚe


387 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
NÚe


388 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub4
è
is
 
NÚe


389 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub5
è
is
 
NÚe


392 
def
 
	$‹¡_jsÚ_li¡_¡¬t_çu»
():

395 
dcom¶‘e
 = [

399 
	}
},

410 
	gdsub1
 = [

417 
dsub2
 = [

428 
	gdsub3
 = [

439 
	gdsub4
 = [

449 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub1
è
is
 
nÙ
 
NÚe


450 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub2
è
is
 
nÙ
 
NÚe


451 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub3
è
is
 
nÙ
 
NÚe


452 
as£¹
 
	$jsÚ_cmp
(
dcom¶‘e
, 
dsub4
è
is
 
nÙ
 
NÚe


455 
__Çme__
 == '__main__':

456 
sys
.
	`ex™
(
py‹¡
.
	`maš
())

	@lib/test/test_version.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_v”siÚ.
py


5 #Te¡ 
lib¿ry
 
funùiÚ
: 
v”siÚ_cmp
().

6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
Te¡s
 
the
 
	$v”siÚ_cmp
(è
funùiÚ
.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
py‹¡


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
lib
 
fes
.

34 
CWD
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../../'))

37 #pylšt: 
di§bË
=
C0413


38 
äom
 
lib
.
tİÙe¡
 
impÜt
 
v”siÚ_cmp


40 
def
 
	$‹¡_v®id_v”siÚs
():

43 
curv”
 = '3.0'

44 
§mev”
 = '3'

45 
Şdv”
 = '2.0'

46 
Ãwv”
 = '3.0.1'

47 
Ãw”v”
 = '3.0.11'

48 
v”cu¡om
 = '3.0-dev'

49 
v”ysm®lšc
 = '3.0.0.0.0.0.0.1'

51 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
Şdv”
) == 1

52 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
Ãwv”
) == -1

53 
as£¹
 
	`v”siÚ_cmp
(
curv”
, curver) == 0

54 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
Ãw”v”
) == -1

55 
as£¹
 
	`v”siÚ_cmp
(
Ãwv”
, 
Ãw”v”
) == -1

56 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
§mev”
) == 0

57 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
v”cu¡om
) == 0

58 
as£¹
 
	`v”siÚ_cmp
(
v”cu¡om
, vercustom) == 0

59 
as£¹
 
	`v”siÚ_cmp
(
v”cu¡om
, 
Şdv”
) == 1

60 
as£¹
 
	`v”siÚ_cmp
(
v”cu¡om
, 
Ãwv”
) == -1

61 
as£¹
 
	`v”siÚ_cmp
(
v”cu¡om
, 
§mev”
) == 0

62 
as£¹
 
	`v”siÚ_cmp
(
curv”
, 
v”ysm®lšc
) == -1

63 
as£¹
 
	`v”siÚ_cmp
(
Ãwv”
, 
v”ysm®lšc
) == 1

64 
as£¹
 
	`v”siÚ_cmp
(
v”ysm®lšc
, verysmallinc) == 0

65 
as£¹
 
	`v”siÚ_cmp
(
v”cu¡om
, 
v”ysm®lšc
) == -1

67 
def
 
	$‹¡_šv®id_v”siÚs
():

70 
curv”
 = '3.0'

71 
badv”1
 = '.1'

72 
badv”2
 = '-1.0'

73 
badv”3
 = '.'

74 
badv”4
 = '3.-0.3'

76 
w™h
 
py‹¡
.
	$¿i£s
(
V®ueE¼Ü
):

77 
as£¹
 
	$v”siÚ_cmp
(
curv”
, 
badv”1
)

78 
as£¹
 
	$v”siÚ_cmp
(
curv”
, 
badv”2
)

79 
as£¹
 
	$v”siÚ_cmp
(
curv”
, 
badv”3
)

80 
as£¹
 
	$v”siÚ_cmp
(
curv”
, 
badv”4
)

82 
def
 
	$‹¡_»g»ssiÚ_1
():

84 
Te¡
 
»g»ssiÚ
 
Ú
 
the
 
fŞlowšg
 
ty³
 
of
 
com·risÚ
: '3.0.2' > '3'

85 
Ex³ùed
 
»suÉ
 
is
 1.

87 
as£¹
 
	`v”siÚ_cmp
('3.0.2', '3') == 1

	@lib/topogen.py

1 #
#tİog’.
py


3 #Lib¿ry 
of
 
h–³r
 
funùiÚs
 
N‘DEF
 
TİŞogy
 
Te¡s


4 #
#Cİyrighˆ(
c
è2017 
by


6 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 
	$Tİog’
 (
TİŞogy
 
G’”©Ü
è
is
 
ª
 
ab¡¿ùiÚ
 
¬ound
 
TİÙe¡
 
ªd
 
Mšš‘
 
to


25 
h–p
 
»duû
 
bo”¶©e
 
code
 
ªd
 
´ovide
 
a
 
¡abË
 
š‹rçû
 
to
 
bud
 
tİŞogy


26 
‹¡s
 
Ú
.

28 
Basic
 
u§ge
 
š¡ruùiÚs
:

30 * 
Defše
 
a
 
TİŞogy
 
şass
 
w™h
‡ 
bud
 
m‘hod
 
usšg
 
mšš‘
.
tİo
.
Tİo
.

31 
S“
 
exam¶es
/
‹¡_‹m¶©e
.
py
.

32 * 
U£
 
Tİog’
 
šside
 
the
 
	$bud
(è
m‘hod
 
w™h
 
g‘_tİog’
.

33 
e
.
g
. 
	`g‘_tİog’
(
£lf
).

34 * 
S¹
 
up
 
your
 
tİŞogy
 
w™h
: 
	`Tİog’
(
YourTİŞogy
)

35 * 
In™Ÿlize
 
the
 
Mšš‘
 
w™h
 
your
 
tİŞogy
 w™h: 
tg’
.
	`¡¬t_tİŞogy
()

36 * 
CÚfigu»
 
your
 
rou‹rs
/
ho¡s
 
ªd
 
¡¬t
 
them


37 * 
Run
 
your
 
‹¡s
 / 
mšš‘
 
şi
.

38 * 
Aá”
 
ruÂšg
 
¡İ
 
Mšš‘
 
w™h
: 
tg’
.
	`¡İ_tİŞogy
()

41 
impÜt
 
os


42 
impÜt
 
sys


43 
impÜt
 
loggšg


44 
impÜt
 
jsÚ


45 
impÜt
 
CÚfigP¬£r


46 
impÜt
 
glob


47 
impÜt
 
g½


48 
impÜt
 
¶©fÜm


49 
impÜt
 
pwd


50 
impÜt
 
sub´oûss


51 
impÜt
 
py‹¡


53 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


54 
äom
 
mšš‘
.
log
 
impÜt
 
£tLogLev–


55 
äom
 
mšš‘
.
şi
 
impÜt
 
CLI


57 
äom
 
lib
 
impÜt
 
tİÙe¡


58 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”
, 
logg”_cÚfig


60 
CWD
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

62 #pylšt: 
di§bË
=
C0103


63 #Glob® 
Tİog’
 
v¬ŸbË
. 
This
 
is
 
bešg
 
u£d
 
to
 
k“p
 
the
 Tİog’ 
avaabË
 
Ú


64 #®È
‹¡
 
funùiÚs
 
w™hout
 
deş¬šg
 
a
e¡ 
loÿl
 
v¬ŸbË
.

65 
glob®_tg’
 = 
NÚe


67 
def
 
	$g‘_tİog’
(
tİo
=
NÚe
):

69 
H–³r
 
funùiÚ
 
to
 
»Œ›ve
 
Tİog’
. 
Mu¡
 
be
 
ÿÎed
 
w™h
 `
tİo
` 
wh’
 called

70 
šside
 
the
 
	$bud
(è
m‘hod
 
of
 
TİŞogy
 
şass
.

72 
tİo
 
is
 
nÙ
 
NÚe
:

73 
glob®_tg’
.
tİo
 =opo

74  
glob®_tg’


76 
def
 
	$£t_tİog’
(
tg’
):

78 #pylšt: 
di§bË
=
W0603


79 
glob®
 
glob®_tg’


80 
glob®_tg’
 = 
tg’


82 #
#Maš 
şass
: 
tİŞogy
 
bud”


86 #Tİog’ 
cÚfigu¿tiÚ
 
deçuÉs


87 
tg’_deçuÉs
 = {

92 'memËak_·th': 
NÚe
,

93 
	}
}

95 
şass
 
	$Tİog’
(
objeù
):

98 
CONFIG_SECTION
 = 'topogen'

100 
def
 
	`__š™__
(
£lf
, 
şs
, 
modÇme
='unnamed'):

102 
Tİog’
 
š™Ÿliz©iÚ
 
funùiÚ
, 
kes
 
the
 
fŞlowšg
 
¬gum’ts
:

103 * `
şs
`: 
the
 
tİŞogy
 
şass
 
th©
 
is
 
chd
 
of
 
mšš‘
.
tİo


104 * `
modÇme
`: 
moduË
 
Çme
 
mu¡
 
be
 
a
 
unique
‚am
to
 
id’tify
 
logs
 
Ï‹r
.

106 
£lf
.
cÚfig
 = 
NÚe


107 
£lf
.
tİo
 = 
NÚe


108 
£lf
.
Ãt
 = 
NÚe


109 
£lf
.
g—rs
 = {
	}
}

110 
£lf
.
rou‹º
 = 1

111 
£lf
.
sw™chn
 = 1

112 
£lf
.
modÇme
 = modname

113 
£lf
.
”rÜsd
 = {}

114 
£lf
.
”rÜs
 = ''

115 
£lf
.
³”n
 = 1

116 
£lf
.
	$_š™_tİo
(
şs
)

117 
logg”
.
	`šfo
('lßdšgİŞogy: {}'.
	`fÜm©
(
£lf
.
modÇme
))

119 @
¡©icm‘hod


120 
def
 
	$_mšš‘_»£t
():

122 #CËª 
up
 
the
 
mšš‘
 
’vœÚm’t


123 
os
.
	`sy¡em
('mn -c > /dev/null 2>&1')

125 
def
 
	$_š™_tİo
(
£lf
, 
şs
):

127 
In™Ÿlize
 
the
 
tİogy
 
´ovided
 
by
h
u£r
. 
The
 u£¸
tİŞogy
 
şass


128 
mu¡
 
ÿÎ
 
	$g‘_tİog’
(è
duršg
 
	$bud
(è
to
 
g‘
 
the
 
tİog’
 
objeù
.

130 #S‘ 
the
 
glob®
 
v¬ŸbË
 
so
h
‹¡
 
ÿ£s
 
ÿn
 
acûss
 
™
 
ªywh”e


131 
	$£t_tİog’
(
£lf
)

133 #Te¡ 
MPLS
 
K”Ãl
 
moduËs
 
avaabË


134 
£lf
.
hasm¶s
 = 
F®£


135 
nÙ
 
tİÙe¡
.
	`moduË_´e£Á
('mpls-router'):

136 
logg”
.
	`šfo
('MPLSests will‚ot„un (missing mpls-router kernel module)')

137 
–if
 
nÙ
 
tİÙe¡
.
	`moduË_´e£Á
('mpls-iptunnel'):

138 
logg”
.
	`šfo
('MPLSests will‚ot„un (missing mpls-iptunnel kernel module)')

140 
£lf
.
hasm¶s
 = 
True


141 #Lßd 
the
  
tİŞogy
 
cÚfigu¿tiÚs


142 
£lf
.
	$_lßd_cÚfig
()

144 #In™Ÿliz
the
 
API


145 
£lf
.
	$_mšš‘_»£t
()

146 
	$şs
()

147 
£lf
.
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=
£lf
.topo)

148 
g—r
 
š
 
£lf
.
g—rs
.
	$v®ues
():

149 
g—r
.
Ãt
 = 
£lf
.net

151 
def
 
	$_lßd_cÚfig
(
£lf
):

153 
Lßds
 
the
 
cÚfigu¿tiÚ
 
fe
 `
py‹¡
.
ši
` 
loÿ‹d
 
©
h
roÙ
 
dœ
 
of


154 
tİÙe¡s
.

156 
£lf
.
cÚfig
 = 
CÚfigP¬£r
.
	$CÚfigP¬£r
(
tg’_deçuÉs
)

157 
py‹¡ši_·th
 = 
os
.
·th
.
	`još
(
CWD
, '../pytest.ini')

158 
£lf
.
cÚfig
.
	$»ad
(
py‹¡ši_·th
)

160 
def
 
	$add_rou‹r
(
£lf
, 
Çme
=
NÚe
, 
şs
=
tİÙe¡
.
Rou‹r
, **
·¿ms
):

162 
Adds
 
a
 
Ãw
 
rou‹r
 
to
 
the
 
tİŞogy
. 
This
 
funùiÚ
 
has
h
fŞlowšg


163 
İtiÚs
:

164 * `
Çme
`: (
İtiÚ®
è
£Ëù
 
the
 
rou‹r
‚ame

165 * `
d«mÚdœ
`: (
İtiÚ®
è
cu¡om
 
d«mÚ
 
bš¬y
 
dœeùÜy


166 * `
rou‹¹y³
`: (
İtiÚ®
è`
quagga
` 
Ü
 `
är
`

167 
R‘uºs
 
a
 
TİoRou‹r
.

169 
Çme
 
is
 
NÚe
:

170 
Çme
 = 'r{}'.
	$fÜm©
(
£lf
.
rou‹º
)

171 
Çme
 
š
 
£lf
.
g—rs
:

172 
¿i£
 
	`KeyE¼Ü
('router‡lreadyƒxists')

174 
·¿ms
['ärdœ'] = 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'frrdir')

175 
·¿ms
['quaggadœ'] = 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'quaggadir')

176 
·¿ms
['memËak_·th'] = 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'memleak_path')

177 
nÙ
 
·¿ms
.
	`has_key
('routertype'):

178 
·¿ms
['rou‹¹y³'] = 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'routertype')

180 
£lf
.
g—rs
[
Çme
] = 
	$TİoRou‹r
(
£lf
, 
şs
, 
Çme
, **
·¿ms
)

181 
£lf
.
rou‹º
 += 1

182  
£lf
.
g—rs
[
Çme
]

184 
def
 
	$add_sw™ch
(
£lf
, 
Çme
=
NÚe
, 
şs
=
tİÙe¡
.
LegacySw™ch
):

186 
Adds
 
a
 
Ãw
 
to
 
the
 
tİŞogy
. 
This
 
funùiÚ
 
has
h
fŞlowšg


187 
İtiÚs
:

188 
Çme
: (
İtiÚ®
è
£Ëù
 
the
 name

189 
R‘uºs
 
the
 
Çme
 
ªd
 
numb”
.

191 
Çme
 
is
 
NÚe
:

192 
Çme
 = 's{}'.
	$fÜm©
(
£lf
.
sw™chn
)

193 
Çme
 
š
 
£lf
.
g—rs
:

194 
¿i£
 
	`KeyE¼Ü
('switch‡lreadyƒxists')

196 
£lf
.
g—rs
[
Çme
] = 
	$TİoSw™ch
(
£lf
, 
şs
, 
Çme
)

197 
£lf
.
sw™chn
 += 1

198  
£lf
.
g—rs
[
Çme
]

200 
def
 
	$add_exabgp_³”
(
£lf
, 
Çme
, 

, 
deçuÉRou‹
):

202 
Adds
 
a
 
Ãw
 
ExaBGP
 
³”
 
to
 
the
 
tİŞogy
. 
This
 
funùiÚ
 
has
h
fŞlowšg


203 
·¿m‘”s
:

204 * `

`: 
the
 
³”
 
	`add»ss
 (
e
.
g
. '1.2.3.4/24')

205 * `
deçuÉRou‹
`: 
the
 
³”
  
	`rou‹
 (
e
.
g
. 'via 1.2.3.1')

207 
Çme
 
is
 
NÚe
:

208 
Çme
 = '³”{}'.
	$fÜm©
(
£lf
.
³”n
)

209 
Çme
 
š
 
£lf
.
g—rs
:

210 
¿i£
 
	`KeyE¼Ü
('exabgp…eer‡lreadyƒxists')

212 
£lf
.
g—rs
[
Çme
] = 
	$TİoExaBGP
(
£lf
, 
Çme
, 

=, 
deçuÉRou‹
=defaultRoute)

213 
£lf
.
³”n
 += 1

214  
£lf
.
g—rs
[
Çme
]

216 
def
 
	$add_lšk
(
£lf
, 
node1
, 
node2
, 
iâame1
=
NÚe
, 
iâame2
=None):

218 
C»©es
 
a
 
cÚÃùiÚ
 
b‘w“n
 
node1
 
ªd
 
node2
. 
The
 
nodes
 
ÿn
 
be
 
the


219 
fŞlowšg
:

220 * 
TİoG—r


221 * 
TİoRou‹r


222 * 
TİoSw™ch


224 
nÙ
 
	$isš¡ªû
(
node1
, 
TİoG—r
):

225 
¿i£
 
	`V®ueE¼Ü
('invalid‚ode1ype')

226 
nÙ
 
	$isš¡ªû
(
node2
, 
TİoG—r
):

227 
¿i£
 
	`V®ueE¼Ü
('invalid‚ode2ype')

229 
iâame1
 
is
 
NÚe
:

230 
iâame1
 = 
node1
.
	$Ãw_lšk
()

231 
iâame2
 
is
 
NÚe
:

232 
iâame2
 = 
node2
.
	$Ãw_lšk
()

234 
node1
.
	$»gi¡”_lšk
(
iâame1
, 
node2
, 
iâame2
)

235 
node2
.
	$»gi¡”_lšk
(
iâame2
, 
node1
, 
iâame1
)

236 
£lf
.
tİo
.
	$addLšk
(
node1
.
Çme
, 
node2
.name,

237 
štfName1
=
iâame1
, 
štfName2
=
iâame2
)

239 
def
 
	$g‘_g—rs
(
£lf
, 
g—¹y³
):

241 
R‘uºs
 
a
 
diùiÚ¬y
 
of
 
®l
 
g—rs
 oà
ty³
 `
g—¹y³
`.

243 
NÜm®
 
u§ge
:

244 * 
DiùiÚ¬y
 
™”©iÚ
:

245 ```
py


246 
tg’
 = 
	$g‘_tİog’
()

247 
rou‹r_diù
 = 
tg’
.
	$g‘_g—rs
(
TİoRou‹r
)

248 
rou‹r_Çme
, 
rou‹r
 
š
 
rou‹r_diù
.
	$™”™ems
():

249 #DØ
¡uff


251 * 
Li¡
 
™”©iÚ
:

252 ```
py


253 
tg’
 = 
	$g‘_tİog’
()

254 
³”_li¡
 = 
tg’
.
	`g‘_g—rs
(
TİoExaBGP
).
	$v®ues
()

255 
³”
 
š
 
³”_li¡
:

256 #DØ
¡uff


259  
	`diù
((
Çme
, 
g—r
èÇme, g—¸
š
 
£lf
.
g—rs
.
	$™”™ems
()

260 
	$isš¡ªû
(
g—r
, 
g—¹y³
))

262 
def
 
	$rou‹rs
(
£lf
):

264 
R‘uºs
 
the
 
rou‹r
 
	`diùiÚ¬y
 (
key
 
is
hrou‹¸
Çme
 
ªd
 
v®ue
 ishe

265 
rou‹r
 
objeù
 
™£lf
).

267  
£lf
.
	$g‘_g—rs
(
TİoRou‹r
)

269 
def
 
	$exabgp_³”s
(
£lf
):

271 
R‘uºs
 
the
 
exabgp
 
³”
 
	`diùiÚ¬y
 (
key
 
is
h³” 
Çme
 
ªd
 
v®ue
 is

272 
the
 
³”
 
objeù
 
™£lf
).

274  
£lf
.
	$g‘_g—rs
(
TİoExaBGP
)

276 
def
 
	$¡¬t_tİŞogy
(
£lf
, 
log_Ëv–
=
NÚe
):

278 
S¹s
 
the
 
tİŞogy
 
şass
. 
PossibË
 `
log_Ëv–
`
s
 
¬e
:

279 'debug': 
®l
 
šfÜm©iÚ
 
possibË


280 'šfo': 
šfÜm©iÚ®
 
mes§ges


281 'ouut':  
loggšg
 
Ëv–
 
defšed
 
by
 
Mšš‘


282 'w¬nšg': 
Úly
 
w¬nšg
, 
”rÜ
 
ªd
 
ü™iÿl
 
mes§ges


283 '”rÜ': 
Úly
 
”rÜ
 
ªd
 
ü™iÿl
 
mes§ges


284 'ü™iÿl': 
Úly
 
ü™iÿl
 
mes§ges


286 #Ià
log_Ëv–
 
is
 
nÙ
 
¥ecif›d
 
u£
 
the
 
cÚfigu¿tiÚ
.

287 
log_Ëv–
 
is
 
NÚe
:

288 
log_Ëv–
 = 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'verbosity')

290 #S‘ 
pythÚ
 
logg”
 
Ëv–


291 
logg”_cÚfig
.
	$£t_log_Ëv–
(
log_Ëv–
)

293 #RuÀ
mšš‘


294 
log_Ëv–
 == 'debug':

295 
	$£tLogLev–
(
log_Ëv–
)

297 
logg”
.
	`šfo
('¡¬tšgİŞogy: {}'.
	$fÜm©
(
£lf
.
modÇme
))

298 
£lf
.
Ãt
.
	$¡¬t
()

300 
def
 
	$¡¬t_rou‹r
(
£lf
, 
rou‹r
=
NÚe
):

302 
C®l
 
the
 
rou‹r
 
¡¬tRou‹r
 
m‘hod
.

303 
If
 
no
 
rou‹r
 
is
 
¥ecif›d
 
™
 i 
ÿÎed
 
®l
 
»gi¡»d
 
rou‹rs
.

305 
rou‹r
 
is
 
NÚe
:

306 #pylšt: 
di§bË
=
r1704


307 
_
, 
rou‹r
 
š
 
£lf
.
	`rou‹rs
().
	$™”™ems
():

308 
rou‹r
.
	$¡¬t
()

310 
	$isš¡ªû
(
rou‹r
, 
¡r
):

311 
rou‹r
 = 
£lf
.
g—rs
[router]

313 
rou‹r
.
	$¡¬t
()

315 
def
 
	$¡İ_tİŞogy
(
£lf
):

317 
Stİs
 
the
 
ÃtwÜk
 
tİŞogy
. 
This
 
funùiÚ
 
wl
 
ÿÎ
h
	$¡İ
(è
funùiÚ


318 
of
 
®l
 
g—rs
 
befÜe
 
ÿÎšg
 
the
 
mšš‘
 
¡İ
 
funùiÚ
, 
so
 
they
 
ÿn
 
have


319 
theœ
 
İÜtun™y
 
to
 dØ
a
 
g¿ûful
 
shutdown
. 
	$¡İ
(è
is
 
ÿÎed
 
twiû
. 
The


320 
fœ¡
 
is
 
a
 
sim¶e
 
kl
 
w™h
 
no
 
¦“p
, 
the
 
£cÚd
 
wl
 sË• 
nÙ


321 
kËd
 
ªd
 
Œy
 
w™h
 
a
 
difã»Á
 
sigÇl
.

323 
logg”
.
	`šfo
('¡İpšgİŞogy: {}'.
	$fÜm©
(
£lf
.
modÇme
))

324 
”rÜs
 = ""

325 
g—r
 
š
 
£lf
.
g—rs
.
	$v®ues
():

326 
g—r
.
	$¡İ
(
F®£
, False)

327 
g—r
 
š
 
£lf
.
g—rs
.
	$v®ues
():

328 
”rÜs
 +ğ
g—r
.
	$¡İ
(
True
, 
F®£
)

329 
	`Ën
(
”rÜs
) > 0:

330 
as£¹
 "E¼Ü found…o¡ shutdowÀ- d‘a fŞlow:" =ğ0, 
”rÜs


332 
£lf
.
Ãt
.
	$¡İ
()

334 
def
 
	$mšš‘_şi
(
£lf
):

336 
IÁ”ru±
 
the
 
‹¡
 
ªd
 
ÿÎ
h
commªd
 
lše
 
š‹rçû
 
mªu®


337 
š¥eùiÚ
. 
Should
 
be
 
Úly
 
u£d
 
Ú
 
nÚ
 
´oduùiÚ
 
code
.

339 
nÙ
 
sys
.
¡dš
.
	$i§‰y
():

340 
¿i£
 
	`EnvœÚm’tE¼Ü
(

343 
	$CLI
(
£lf
.
Ãt
)

345 
def
 
	$is_memËak_’abËd
(
£lf
):

347 #OÀ
rou‹r
 
çu»
 
we
 
ÿn
't„unhe memory†eakest

348 
£lf
.
	$rou‹rs_have_çu»
():

349  
F®£


351 
memËak_fe
 = (
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
Ü


352 
£lf
.
cÚfig
.
	`g‘
(£lf.
CONFIG_SECTION
, 'memleak_path'))

353 
memËak_fe
 
is
 
NÚe
:

354  
F®£


355  
True


357 
def
 
	$»pÜt_memÜy_Ëaks
(
£lf
, 
‹¡Çme
=
NÚe
):

359 
nÙ
 
£lf
.
	$is_memËak_’abËd
():

362 #Ià
no
 
Çme
 
was
 
¥ecif›d
, 
u£
 
the
 
‹¡
 
moduË
‚ame

363 
‹¡Çme
 
is
 
NÚe
:

364 
‹¡Çme
 = 
£lf
.
modÇme


366 
rou‹r_li¡
 = 
£lf
.
	`rou‹rs
().
	$v®ues
()

367 
rou‹r
 
š
 
rou‹r_li¡
:

368 
rou‹r
.
	$»pÜt_memÜy_Ëaks
(
£lf
.
modÇme
)

370 
def
 
	$£t_”rÜ
(
£lf
, 
mes§ge
, 
code
=
NÚe
):

372 
logg”
.
	$šfo
(
mes§ge
)

374 #Ià
no
 
code
 
is
 
defšed
 
u£
 
a
 
£qu’tŸl
 
numb”


375 
code
 
is
 
NÚe
:

376 
code
 = 
	$Ën
(
£lf
.
”rÜsd
)

378 
£lf
.
”rÜsd
[
code
] = 
mes§ge


379 
£lf
.
”rÜs
 +ğ'\n{}: {}'.
	$fÜm©
(
code
, 
mes§ge
)

381 
def
 
	$has_”rÜs
(
£lf
):

383  
	`Ën
(
£lf
.
”rÜsd
) > 0

385 
def
 
	$rou‹rs_have_çu»
(
£lf
):

387 
£lf
.
	$has_”rÜs
():

388  
True


390 
”rÜs
 = ''

391 
rou‹r_li¡
 = 
£lf
.
	`rou‹rs
().
	$v®ues
()

392 
rou‹r
 
š
 
rou‹r_li¡
:

393 
»suÉ
 = 
rou‹r
.
	$check_rou‹r_ruÂšg
()

394 
»suÉ
 != '':

395 
”rÜs
 +ğ
»suÉ
 + '\n'

397 
”rÜs
 != '':

398 
£lf
.
	`£t_”rÜ
(
”rÜs
, 'router_error')

399 
as£¹
 
F®£
, 
”rÜs


400  
True


401  
F®£


403 #
#TİŞogy 
	`g—rs
 (
equm’t
)

407 
şass
 
	$TİoG—r
(
objeù
):

410 
def
 
	$__š™__
(
£lf
):

411 
£lf
.
tg’
 = 
NÚe


412 
£lf
.
Çme
 = 
NÚe


413 
£lf
.
şs
 = 
NÚe


414 
£lf
.
lšks
 = {
	}
}

415 
£lf
.
lškn
 = 0

417 
def
 
	$__¡r__
(
£lf
):

418 
lšks
 = ''

419 
myif
, 
de¡
 
š
 
£lf
.
lšks
.
	$™”™ems
():

420 
_
, 
de¡if
 = 
de¡


421 
lšks
 != '':

422 
lšks
 += ','

423 
lšks
 +ğ'"{}"<->"{}"'.
	$fÜm©
(
myif
, 
de¡if
)

425  'TİoG—r<Çme="{}",lšks=[{}]>'.
	$fÜm©
(
£lf
.
Çme
, 
lšks
)

427 
def
 
	$¡¬t
(
£lf
):

429 
logg”
.
	`šfo
('¡¬tšg "{}"'.
	$fÜm©
(
£lf
.
Çme
))

431 
def
 
	$¡İ
(
£lf
, 
wa™
=
True
, 
as£¹OnE¼Ü
=True):

433 
logg”
.
	`šfo
('¡İpšg "{}"'.
	$fÜm©
(
£lf
.
Çme
))

436 
def
 
	$run
(
£lf
, 
commªd
):

438 
Runs
 
the
 
´ovided
 
commªd
 
¡ršg
 
š
h
rou‹r
 
ªd
 
»tuºs
 
a
 string

439 
w™h
 
the
 
»¥Ú£
.

441  
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$cmd
(
commªd
)

443 
def
 
	$add_lšk
(
£lf
, 
node
, 
myif
=
NÚe
, 
nodeif
=None):

445 
C»©es
 
a
 
	$lšk
 (
cÚÃùiÚ
è
b‘w“n
 
my£lf
 
ªd
 
the
 
¥ecif›d
 
node
.

446 
IÁ”çûs
 
Çme
 
ÿn
 
be
 
¥efic›d
 
w™h
:

447 
myif
: 
the
 
š‹rçû
 
Çme
 
th©
 
wl
 
be
 
ü—‹d
 
š
 
this
 
node


448 
nodeif
: 
the
 
rg‘
 
š‹rçû
 
Çme
 
th©
 
wl
 
be
 
ü—‹d
 
Ú
h
»mÙe
 
node
.

450 
£lf
.
tg’
.
	$add_lšk
(
£lf
, 
node
, 
myif
, 
nodeif
)

452 
def
 
	$lšk_’abË
(
£lf
, 
myif
, 
’abËd
=
True
, 
ÃŠs
=
NÚe
):

454 
S‘
 
this
 
node
 
š‹rçû
 
admši¡¿tive
 
¡©e
.

455 
myif
: 
this
 
node
 
š‹rçû
 
Çme


456 
’abËd
: 
wh‘h”
 
we
 
should
 
’abË
 
Ü
 
di§bË
 
the
 
š‹rçû


458 
myif
 
nÙ
 
š
 
£lf
.
lšks
.
	$keys
():

459 
¿i£
 
	`KeyE¼Ü
('interface doesn\'tƒxists')

461 
’abËd
 
is
 
True
:

462 
İ”©iÚ
 = 'up'

464 
İ”©iÚ
 = 'down'

466 
logg”
.
	`šfo
('£‰šg‚od"{}"†šk "{}"Ø¡©"{}"'.
	$fÜm©
(

467 
£lf
.
Çme
, 
myif
, 
İ”©iÚ


469 
exŒaù
=''

470 
ÃŠs
 
is
 
nÙ
 
NÚe
:

471 
exŒaù
 = '‚‘n exeø{} '.
	$fÜm©
(
ÃŠs
)

472  
£lf
.
	`run
('{}†šk s‘ dev {} {}'.
	$fÜm©
(
exŒaù
, 
myif
, 
İ”©iÚ
))

474 
def
 
	$³”_lšk_’abË
(
£lf
, 
myif
, 
’abËd
=
True
, 
ÃŠs
=
NÚe
):

476 
S‘
 
the
 
³”
 
š‹rçû
 
admši¡¿tive
 
¡©e
.

477 
myif
: 
this
 
node
 
š‹rçû
 
Çme


478 
’abËd
: 
wh‘h”
 
we
 
should
 
’abË
 
Ü
 
di§bË
 
the
 
š‹rçû


480 
NOTE
: 
this
 
is
 
u£d
 
to
 
simuÏ‹
 
a
 
lšk
 
down
 
Ú
hi 
node
, 
sšû
 
wh’
 
the


481 
³”
 
di§bËs
 
theœ
 
š‹rçû
 
our
 iÁ”çû 
¡©us
 
chªges
 
to
 
no
 
lšk
.

483 
myif
 
nÙ
 
š
 
£lf
.
lšks
.
	$keys
():

484 
¿i£
 
	`KeyE¼Ü
('interface doesn\'tƒxists')

486 
node
, 
nodeif
 = 
£lf
.
lšks
[
myif
]

487 
node
.
	$lšk_’abË
(
nodeif
, 
’abËd
, 
ÃŠs
)

489 
def
 
	$Ãw_lšk
(
£lf
):

491 
G’”©es
 
a
 
Ãw
 
unique
 
lšk
 
Çme
.

493 
NOTE
: 
This
 
funùiÚ
 
should
 
Úly
 
be
 
ÿÎed
 
by
 
Tİog’
.

495 
iâame
 = '{}-‘h{}'.
	$fÜm©
(
£lf
.
Çme
, s–f.
lškn
)

496 
£lf
.
lškn
 += 1

497  
iâame


499 
def
 
	$»gi¡”_lšk
(
£lf
, 
myif
, 
node
, 
nodeif
):

501 
Regi¡”
 
lšk
 
b‘w“n
 
this
 
node
 
š‹rçû
 
ªd
 
outside
‚ode.

503 
NOTE
: 
This
 
funùiÚ
 
should
 
Úly
 
be
 
ÿÎed
 
by
 
Tİog’
.

505 
myif
 
š
 
£lf
.
lšks
.
	$keys
():

506 
¿i£
 
	`KeyE¼Ü
('interface‡lreadyƒxists')

508 
£lf
.
lšks
[
myif
] = (
node
, 
nodeif
)

510 
şass
 
	$TİoRou‹r
(
TİoG—r
):

512 
Rou‹r
 
ab¡¿ùiÚ
.

515 #Th 
»quœed
 
dœeùÜ›s
 
by
 
Quagga
/
FRR


516 
PRIVATE_DIRS
 = [

524 #Rou‹¸
D«mÚ
 
’um”©iÚ
 
defš™iÚ
.

525 
RD_ZEBRA
 = 1

526 
RD_RIP
 = 2

527 
RD_RIPNG
 = 3

528 
RD_OSPF
 = 4

529 
RD_OSPF6
 = 5

530 
RD_ISIS
 = 6

531 
RD_BGP
 = 7

532 
RD_LDP
 = 8

533 
RD_PIM
 = 9

534 
RD_EIGRP
 = 10

535 
RD_NHRP
 = 11

536 
RD_STATIC
 = 12

537 
RD
 = {

538 
RD_ZEBRA
: 'zebra',

539 
RD_RIP
: 'ripd',

540 
RD_RIPNG
: 'ripngd',

541 
RD_OSPF
: 'ospfd',

542 
RD_OSPF6
: 'ospf6d',

543 
RD_ISIS
: 'isisd',

544 
RD_BGP
: 'bgpd',

545 
RD_PIM
: 'pimd',

546 
RD_LDP
: 'ldpd',

547 
RD_EIGRP
: 'eigrpd',

548 
RD_NHRP
: 'nhrpd',

549 
RD_STATIC
: 'staticd',

550 
	}
}

552 
def
 
	$__š™__
(
£lf
, 
tg’
, 
şs
, 
Çme
, **
·¿ms
):

554 
The
 
cÚ¡ruùÜ
 
has
 
the
 
fŞlowšg
 
·¿m‘”s
:

555 * 
tg’
: 
Tİog’
 
objeù


556 * 
şs
: 
rou‹r
 
şass
 
th©
 
wl
 
be
 
u£d
 
to
 
š¡ªtŸ‹


557 * 
Çme
: 
rou‹r
‚ame

558 * 
d«mÚdœ
: 
d«mÚ
 
bš¬y
 
dœeùÜy


559 * 
rou‹¹y³
: 'quagga' 
Ü
 'frr'

561 
	`su³r
(
TİoRou‹r
, 
£lf
).
	$__š™__
()

562 
£lf
.
tg’
 =gen

563 
£lf
.
Ãt
 = 
NÚe


564 
£lf
.
Çme
 =‚ame

565 
£lf
.
şs
 = cls

566 
£lf
.
İtiÚs
 = {
	}
}

567 
£lf
.
rou‹¹y³
 = 
·¿ms
.
g‘
('routertype', 'frr')

568 
nÙ
 
	g·¿ms
.
has_key
('privateDirs'):

569 
·¿ms
['´iv©eDœs'] = 
£lf
.
PRIVATE_DIRS


571 
£lf
.
İtiÚs
['memËak_·th'] = 
·¿ms
.
g‘
('memËak_·th', 
NÚe
)

573 #C»©
Ãw
 
log
 
dœeùÜy


574 
	g£lf
.
	glogdœ
 = '/tmp/tİÙe¡s/{}'.
	$fÜm©
(
£lf
.
tg’
.
modÇme
)

575 #CËª 
up
 
befÜe
 
¡¬tšg
 
Ãw
 
log
 
fes
: 
avoids
 
»movšg
 
ju¡
 
ü—‹d


576 #log 
fes
.

577 
£lf
.
	$_´•¬e_tmpfes
()

578 #Prİag©
the
 
rou‹r
 
log
 
dœeùÜy


579 
·¿ms
['logdœ'] = 
£lf
.
logdœ


581 #£tu°
the
 
³r
 
node
 
dœeùÜy


582 
dœ
 = '{}/{}'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
)

583 
os
.
	`sy¡em
('mkdœ -°' + 
dœ
)

584 
os
.
	`sy¡em
('chmod -R go+rw /tmp/topotests')

586 #O³À
rou‹r
 
log
 
fe


587 
logfe
 = '{0}/{1}.log'.
	$fÜm©
(
dœ
, 
Çme
)

589 
£lf
.
logg”
 = 
logg”_cÚfig
.
	$g‘_logg”
(
Çme
òame, 
rg‘
=
logfe
)

590 
£lf
.
tg’
.
tİo
.
	$addNode
(
£lf
.
Çme
, 
şs
=£lf.şs, **
·¿ms
)

592 
def
 
	$__¡r__
(
£lf
):

593 
g—r
 = 
	`su³r
(
TİoRou‹r
, 
£lf
).
	$__¡r__
()

594 
g—r
 += ' TopoRouter<>'

595  
g—r


597 
def
 
	$_´•¬e_tmpfes
(
£lf
):

598 #C»©
dœeùÜ›s
 
they
 
dÚ
'tƒxist

599 
Œy
:

600 
os
.
	$makedœs
(
£lf
.
logdœ
, 0755)

601 
exû±
 
OSE¼Ü
:

602 
·ss


604 #AÎow 
uÅriveged
 
d«mÚ
 
	`u£r
 (
är
/
quagga
è
to
 
ü—‹
 
log
 
fes


605 
Œy
:

606 #OÆy 
®low
 
group
, 
™
 
exi¡
.

607 
gid
 = 
g½
.
	`g‘gºam
(
£lf
.
rou‹¹y³
)[2]

608 
os
.
	$chown
(
£lf
.
logdœ
, 0, 
gid
)

609 
os
.
	$chmod
(
£lf
.
logdœ
, 0775)

610 
exû±
 
KeyE¼Ü
:

611 #AÎow 
ªyÚe
, 
but
 
£t
 
the
 
¡icky
 
b™
 
to
 
avoid
 
fe
 
d–‘iÚs


612 
os
.
	$chmod
(
£lf
.
logdœ
, 01777)

614 #Try 
to
 
fšd
 
»Ëvªt
 
Şd
 
logfes
 
š
 /
tmp
 
ªd
 
d–‘e
 
them


615 
	`m­
(
os
.
»move
, 
glob
.
	`glob
('{}/{}/*.log'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
)))

616 #Remov
Şd
 
cÜe
 
fes


617 
	`m­
(
os
.
»move
, 
glob
.
	`glob
('{}/{}/*.dmp'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
)))

619 
def
 
	$check_ÿ·b™y
(
£lf
, 
d«mÚ
, 
·¿m
):

621 
Checks
 
a
 
ÿ·b™y
 
d«mÚ
 
agaš¡
 
ª
 
¬gum’t
 
İtiÚ


622 
R‘uº
 
True
 
ÿ·b™y
 
avaabË
. 
F®£
 
Ùh”wi£


624 
d«mÚ¡r
 = 
£lf
.
RD
.
	$g‘
(
d«mÚ
)

625 
£lf
.
logg”
.
	`šfo
('check c­ab™y {} fÜ "{}"'.
	$fÜm©
(
·¿m
, 
d«mÚ¡r
))

626  
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$checkC­ab™y
(
d«mÚ¡r
, 
·¿m
)

628 
def
 
	$lßd_cÚfig
(
£lf
, 
d«mÚ
, 
sourû
=
NÚe
, 
·¿m
=None):

630 
Lßds
 
d«mÚ
 
cÚfigu¿tiÚ
 
äom
 
the
 
¥ecif›d
 
sourû


631 
PossibË
 
d«mÚ
 
v®ues
 
¬e
: 
TİoRou‹r
.
RD_ZEBRA
, TİoRou‹r.
RD_RIP
,

632 
TİoRou‹r
.
RD_RIPNG
, TİoRou‹r.
RD_OSPF
, TİoRou‹r.
RD_OSPF6
,

633 
TİoRou‹r
.
RD_ISIS
, TİoRou‹r.
RD_BGP
, TİoRou‹r.
RD_LDP
,

634 
TİoRou‹r
.
RD_PIM
.

636 
d«mÚ¡r
 = 
£lf
.
RD
.
	$g‘
(
d«mÚ
)

637 
£lf
.
logg”
.
	`šfo
('lßdšg "{}" cÚfigu¿tiÚ: {}'.
	$fÜm©
(
d«mÚ¡r
, 
sourû
))

638 
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$lßdCÚf
(
d«mÚ¡r
, 
sourû
, 
·¿m
)

640 
def
 
	$check_rou‹r_ruÂšg
(
£lf
):

642 
Run
 
a
 
£r›s
 
of
 
checks
 
ªd
 
»tuºs
‡ 
¡©us
 
¡ršg
.

644 
£lf
.
logg”
.
	`šfo
('checking if daemons‡re„unning')

645  
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$checkRou‹rRuÂšg
()

647 
def
 
	$¡¬t
(
£lf
):

649 
S¹
 
rou‹r
:

650 * 
Lßd
 
moduËs


651 * 
CËª
 
up
 
fes


652 * 
CÚfigu»
 
š‹rçûs


653 * 
S¹
 
	`d«mÚs
 (
e
.
g
. 
FRR
/
Quagga
)

654 * 
CÚfigu»
 
d«mÚ
 
loggšg
 
fes


656 
£lf
.
logg”
.
	`debug
('starting')

657 
Äou‹r
 = 
£lf
.
tg’
.
Ãt
[£lf.
Çme
]

658 
»suÉ
 = 
Äou‹r
.
	$¡¬tRou‹r
(
£lf
.
tg’
)

660 #EÇbË 
®l
 
d«mÚ
 
commªd
 
loggšg
,†oggšg 
fes


661 #ªd 
£t
 
them
 
to
 
the
 
¡¬t
 
dœ
.

662 
d«mÚ
, 
’abËd
 
š
 
Äou‹r
.
d«mÚs
.
	$™”™ems
():

663 
’abËd
 == 0:

665 
£lf
.
	`vtysh_cmd
('cÚfigu»”mš®\Æog commªds\Æog f{}.log'.
	`fÜm©
(

666 
d«mÚ
), daemon=daemon)

668 
»suÉ
 != '':

669 
£lf
.
tg’
.
	$£t_”rÜ
(
»suÉ
)

671  
»suÉ


673 
def
 
	$¡İ
(
£lf
, 
wa™
=
True
, 
as£¹OnE¼Ü
=True):

675 
Stİ
 
rou‹r
:

676 * 
Kl
 
d«mÚs


678 
£lf
.
logg”
.
	`debug
('stopping')

679  
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$¡İRou‹r
(
wa™
, 
as£¹OnE¼Ü
)

681 
def
 
	$vtysh_cmd
(
£lf
, 
commªd
, 
isjsÚ
=
F®£
, 
d«mÚ
=
NÚe
):

683 
Runs
 
the
 
´ovided
 
commªd
 
¡ršg
 
š
h
vty
 
sh–l
 
ªd
 
»tuºs
 
a
 string

684 
w™h
 
the
 
»¥Ú£
.

686 
This
 
funùiÚ
 
®so
 
acû±s
 
muÉË
 
commªds
, 
but
 
this
 
mode
 
dÛs
 
nÙ


687  
ouut
 
—ch
 
commªd
. 
S“
 
	$vtysh_muÉicmd
(è
mÜe
 
d‘as
.

689 #D‘eù 
muÉi
 
lše
 
commªds


690 
commªd
.
	`fšd
('\n') != -1:

691  
£lf
.
	$vtysh_muÉicmd
(
commªd
, 
d«mÚ
=daemon)

693 
d·¿m
 = ''

694 
d«mÚ
 
is
 
nÙ
 
NÚe
:

695 
d·¿m
 +ğ'-d {}'.
	$fÜm©
(
d«mÚ
)

697 
vtysh_commªd
 = 'vtysh {} -ø"{}" 2>/dev/nuÎ'.
	$fÜm©
(
d·¿m
, 
commªd
)

699 
ouut
 = 
£lf
.
	$run
(
vtysh_commªd
)

700 
£lf
.
logg”
.
	`šfo
('\nvtysh commªd => {}\nvtysh ouuˆ<ğ{}'.
	$fÜm©
(

701 
commªd
, 
ouut
))

702 
isjsÚ
 
is
 
F®£
:

703  
ouut


705 
Œy
:

706  
jsÚ
.
	$lßds
(
ouut
)

707 
exû±
 
V®ueE¼Ü
:

708 
logg”
.
	`w¬nšg
('vtysh_cmd: failedo convert json output')

709  {
	}
}

711 
def
 
	$vtysh_muÉicmd
(
£lf
, 
commªds
, 
´‘ty_ouut
=
True
, 
d«mÚ
=
NÚe
):

713 
Runs
 
the
 
´ovided
 
commªds
 
š
h
vty
 
sh–l
 
ªd
 h
»suÉ
 
of


714 
executiÚ
.

716 
´‘ty_ouut
: 
defšes
 
how
 
the
  
v®ue
 
wl
 
be
 
´e£Áed
. 
Wh’


717 
True
 
™
 
wl
 
show
 
the
 
commªd
 
as
 
they
 
w”e
 
execu‹d
 
š
h
vty
 
sh–l
,

718 
Ùh”wi£
 
™
 
wl
 
Úly
 
show
 
lšes
 
th©
 
çed
.

720 #P»·» 
the
 
‹mpÜ¬y
 
fe
 
th©
 
wl
 
hŞd
h
commªds


721 
âame
 = 
tİÙe¡
.
	$g‘_fe
(
commªds
)

723 
d·¿m
 = ''

724 
d«mÚ
 
is
 
nÙ
 
NÚe
:

725 
d·¿m
 +ğ'-d {}'.
	$fÜm©
(
d«mÚ
)

727 #RuÀ
the
 
commªds
 
ªd
 
d–‘e
h
‹mpÜ¬y
 
fe


728 
´‘ty_ouut
:

729 
tİÙe¡
.
	`v”siÚ_cmp
(
¶©fÜm
.
	`»Ëa£
(), '4.5') < 0:

730 
vtysh_commªd
 = 'vtysh {} < {} -p'.
	$fÜm©
(
d·¿m
, 
âame
)

732 
vtysh_commªd
 = 'vtysh {} < {}'.
	$fÜm©
(
d·¿m
, 
âame
)

734 
tİÙe¡
.
	`v”siÚ_cmp
(
¶©fÜm
.
	`»Ëa£
(), '4.5') < 0:

735 
vtysh_commªd
 = 'vtysh {} -à{} -p'.
	$fÜm©
(
d·¿m
, 
âame
)

737 
vtysh_commªd
 = 'vtysh {} -à{}'.
	$fÜm©
(
d·¿m
, 
âame
)

739 
»s
 = 
£lf
.
	$run
(
vtysh_commªd
)

740 
os
.
	$uÆšk
(
âame
)

742 
£lf
.
logg”
.
	`šfo
('\nvtysh commªd => "{}"\nvtysh ouuˆ<ğ"{}"'.
	$fÜm©
(

743 
vtysh_commªd
, 
»s
))

745  
»s


747 
def
 
	$»pÜt_memÜy_Ëaks
(
£lf
, 
‹¡Çme
):

749 
Runs
 
the
 
rou‹r
 
memÜy
 
Ëak
 
check
 
‹¡
. 
Has
h
fŞlowšg
 
·¿m‘”
:

750 
‹¡Çme
: 
the
 
‹¡
 
fe
 
Çme
 
id’tifiÿtiÚ


752 
NOTE
: 
to
 
run
 
this
 
you
 
mu¡
 
have
 
the
 
’vœÚm’t
 
v¬ŸbË


753 
TOPOTESTS_CHECK_MEMLEAK
 
£t
 
Ü
 
memËak_·th
 
cÚfigu»d
 
š
 `
py‹¡
.
ši
`.

755 
memËak_fe
 = 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
Ü
 
£lf
.
İtiÚs
['memleak_path']

756 
memËak_fe
 
is
 
NÚe
:

759 
£lf
.
	$¡İ
()

760 
£lf
.
logg”
.
	`šfo
('running memory†eak„eport')

761 
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$»pÜt_memÜy_Ëaks
(
memËak_fe
, 
‹¡Çme
)

763 
def
 
	$v”siÚ_šfo
(
£lf
):

765 
ouut
 = 
£lf
.
	`vtysh_cmd
('show v”siÚ').
	`¥l™
('\n')[0]

766 
cŞumns
 = 
tİÙe¡
.
	`nÜm®ize_‹xt
(
ouut
).
	`¥l™
(' ')

767 
Œy
:

769 'ty³': 
cŞumns
[0],

770 'v”siÚ': 
cŞumns
[1],

771 
	}
}

772 
exû±
 
IndexE¼Ü
:

774 'ty³': 
NÚe
,

775 'v”siÚ': 
NÚe
,

778 
def
 
	$has_v”siÚ
(
£lf
, 
cmpİ
, 
v”siÚ
):

780 
Com·»s
 
rou‹r
 
v”siÚ
 
usšg
 
İ”©iÚ
 `
cmpİ
` 
w™h
 `version`.

781 
V®id
 `
cmpİ
` 
v®ues
:

782 * `>=`: 
has
 
the
 
§me
 
v”siÚ
 
Ü
 
g»©”


783 * '>': 
has
 
g»©”
 
v”siÚ


784 * '=': 
has
 
the
 
§me
 
v”siÚ


785 * '<': 
has
 
a
 
Ës£r
 
v”siÚ


786 * '<=': 
has
 
the
 
§me
 
v”siÚ
 
Ü
 
Ës£r


788 
U§ge
 
exam¶e
: 
rou‹r
.
	`has_v”siÚ
('>', '1.0')

790  
£lf
.
tg’
.
Ãt
[£lf.
Çme
].
	$checkRou‹rV”siÚ
(
cmpİ
, 
v”siÚ
)

792 
def
 
	$has_ty³
(
£lf
, 
¹y³
):

794 
Com·»s
 
rou‹r
 
ty³
 
w™h
 `
¹y³
`. 
R‘uºs
 `
True
` 
the
y³ 
m©ches
,

795 
Ùh”wi£
 `
çl£
`.

797 
cu¹y³
 = 
£lf
.
	`v”siÚ_šfo
()['type']

798  
¹y³
 =ğ
cu¹y³


800 
def
 
	$has_m¶s
(
£lf
):

801 
Äou‹r
 = 
£lf
.
tg’
.
Ãt
[£lf.
Çme
]

802  
Äou‹r
.
hasm¶s


804 
şass
 
	$TİoSw™ch
(
TİoG—r
):

806 
Sw™ch
 
ab¡¿ùiÚ
. 
Has
 
the
 
fŞlowšg
 
´İ”t›s
:

807 * 
şs
: 
şass
 
th©
 
wl
 
be
 
u£d
 
to
 
š¡ªtŸ‹


808 * 
Çme
: name

810 #pylšt: 
di§bË
=
too
-
ãw
-
public
-
m‘hods


812 
def
 
	$__š™__
(
£lf
, 
tg’
, 
şs
, 
Çme
):

813 
	`su³r
(
TİoSw™ch
, 
£lf
).
	$__š™__
()

814 
£lf
.
tg’
 =gen

815 
£lf
.
Ãt
 = 
NÚe


816 
£lf
.
Çme
 =‚ame

817 
£lf
.
şs
 = cls

818 
£lf
.
tg’
.
tİo
.
	$addSw™ch
(
Çme
, 
şs
=
£lf
.cls)

820 
def
 
	$__¡r__
(
£lf
):

821 
g—r
 = 
	`su³r
(
TİoSw™ch
, 
£lf
).
	$__¡r__
()

822 
g—r
 += ' TopoSwitch<>'

823  
g—r


825 
şass
 
	$TİoHo¡
(
TİoG—r
):

827 #pylšt: 
di§bË
=
too
-
ãw
-
public
-
m‘hods


829 
def
 
	$__š™__
(
£lf
, 
tg’
, 
Çme
, **
·¿ms
):

831 
Mšš‘
 
has
 
the
 
fŞlowšg
 
known
 `
·¿ms
` 
ho¡s
:

832 * `

`: 
the
 
IP
 
	$add»ss
 (
¡ršg
è
the
 
ho¡
 
š‹rçû


833 * `
deçuÉRou‹
`: 
the
  
rou‹
 
th©
 
wl
 
be
 
š¡®Ëd


834 (
e
.
g
. 'via 10.0.0.1')

835 * `
´iv©eDœs
`: 
dœeùÜ›s
 
th©
 
wl
 
be
 
mouÁed
 
Ú
 
a
 
difã»Á
 
domaš


836 (
e
.
g
. '/etc/important_dir').

838 
	`su³r
(
TİoHo¡
, 
£lf
).
	$__š™__
()

839 
£lf
.
tg’
 =gen

840 
£lf
.
Ãt
 = 
NÚe


841 
£lf
.
Çme
 =‚ame

842 
£lf
.
İtiÚs
 = 
·¿ms


843 
£lf
.
tg’
.
tİo
.
	$addHo¡
(
Çme
, **
·¿ms
)

845 
def
 
	$__¡r__
(
£lf
):

846 
g—r
 = 
	`su³r
(
TİoHo¡
, 
£lf
).
	$__¡r__
()

847 
g—r
 +ğ' TİoHo¡<="{}",deçuÉRou‹="{}",´iv©eDœs="{}">'.
	`fÜm©
(

848 
£lf
.
İtiÚs
['ip'], self.options['defaultRoute'],

849 
	`¡r
(
£lf
.
İtiÚs
['privateDirs']))

850  
g—r


852 
şass
 
	$TİoExaBGP
(
TİoHo¡
):

854 #pylšt: 
di§bË
=
too
-
ãw
-
public
-
m‘hods


856 
PRIVATE_DIRS
 = [

862 
def
 
	$__š™__
(
£lf
, 
tg’
, 
Çme
, **
·¿ms
):

864 
ExaBGP
 
usu®ly
 
u£s
 
the
 
fŞlowšg
 
·¿m‘”s
:

865 * `

`: 
the
 
IP
 
	$add»ss
 (
¡ršg
è
the
 
ho¡
 
š‹rçû


866 * `
deçuÉRou‹
`: 
the
  
rou‹
 
th©
 
wl
 
be
 
š¡®Ëd


867 (
e
.
g
. 'via 10.0.0.1')

869 
NÙe
: 
the
 
difã»Á
 
b‘w“n
 
a
 
ho¡
 
ªd
‡ 
ExaBGP
 
³”
 
is
 
th©
 
this
 
şass


870 
has
 
a
 
´iv©eDœs
 
®»ady
 
defšed
 
ªd
 
cÚšs
 
funùiÚs
 
to
 
hªdË
 
ExaBGP


871 
thšgs
.

873 
·¿ms
['´iv©eDœs'] = 
£lf
.
PRIVATE_DIRS


874 
	`su³r
(
TİoExaBGP
, 
£lf
).
	$__š™__
(
tg’
, 
Çme
, **
·¿ms
)

875 
£lf
.
tg’
.
tİo
.
	$addHo¡
(
Çme
, **
·¿ms
)

877 
def
 
	$__¡r__
(
£lf
):

878 
g—r
 = 
	`su³r
(
TİoExaBGP
, 
£lf
).
	$__¡r__
()

879 
g—r
 +ğ' TİoExaBGP<>'.
	$fÜm©
()

880  
g—r


882 
def
 
	$¡¬t
(
£lf
, 
³”_dœ
, 
’v_fe
=
NÚe
):

884 
S¹
 
ruÂšg
 
ExaBGP
 
d«mÚ
:

885 * 
Cİy
 
®l
 
³”
* 
fŞd”
 
cÚ‹Ás
 
što
 /
‘c
/
exabgp


886 * 
Cİy
 
exabgp
 
’v
 
fe
 
¥ecif›d


887 * 
Make
 
®l
 
pythÚ
 
fes
 
ruÂabË


888 * 
Run
 
ExaBGP
 
w™h
 
’v
 
fe
 `
’v_fe
` 
ªd
 
cÚfigu¿tiÚ
 
³”
*/
exabgp
.
cfg


890 
£lf
.
	`run
('mkdir /etc/exabgp')

891 
£lf
.
	`run
('chmod 755 /etc/exabgp')

892 
£lf
.
	`run
('ı {}/* /‘c/exabgp/'.
	$fÜm©
(
³”_dœ
))

893 
’v_fe
 
is
 
nÙ
 
NÚe
:

894 
£lf
.
	`run
('ı {} /‘c/exabgp/exabgp.’v'.
	$fÜm©
(
’v_fe
))

895 
£lf
.
	`run
('chmod 644 /etc/exabgp/*')

896 
£lf
.
	`run
('chmod‡+x /etc/exabgp/*.py')

897 
£lf
.
	`run
('chown -Rƒxabgp:exabgp /etc/exabgp')

898 
ouut
 = 
£lf
.
	`run
('exabgp -e /etc/exabgp/exabgp.env /etc/exabgp/exabgp.cfg')

899 
ouut
 =ğ
NÚe
 
Ü
 
	`Ën
(output) == 0:

900 
ouut
 = '<none>'

901 
logg”
.
	`šfo
('{}ƒxabg°¡¬‹d, ouut={}'.
	$fÜm©
(
£lf
.
Çme
, 
ouut
))

903 
def
 
	$¡İ
(
£lf
, 
wa™
=
True
, 
as£¹OnE¼Ü
=True):

905 
£lf
.
	`run
('kill `cat /var/run/exabgp/exabgp.pid`')

909 #
#DŸgno¡iø
funùiÚ


913 #Di§bË 
lš‹r
 
b¿nch
 
w¬nšg
. 
It
 
is
 
ex³ùed
 
to
 
have
 
the£
 
h”e
.

914 #pylšt: 
di§bË
=
R0912


915 
def
 
	$dŸgno£_’v
():

917 
Run
 
dŸgno¡ics
 
š
 
the
 
ruÂšg
 
’vœÚm’t
. 
R‘uºs
 `
True
` 
wh’
 
ev”ythšg


918 
is
 
ok
, 
Ùh”wi£
 `
F®£
`.

920 
»t
 = 
True


922 #Te¡ 
log
 
·th
 
exi¡s
 
befÜe
 
š¡®lšg
 
hªdËr
.

923 
nÙ
 
os
.
·th
.
	`isdœ
('/tmp'):

924 
logg”
.
	`w¬nšg
('could‚ot find /tmp for†ogs')

926 
os
.
	`sy¡em
('mkdir /tmp/topotests')

927 #Log 
dŸgno¡ics
 
to
 
fe
 
so
 
™
 
ÿn
 
be
 
examšed
 
Ï‹r
.

928 
fhªdËr
 = 
loggšg
.
	`FeHªdËr
(
f’ame
='/tmp/topotests/diagnostics.txt')

929 
fhªdËr
.
	$£tLev–
(
loggšg
.
DEBUG
)

930 
fhªdËr
.
	`£tFÜm©‹r
(

931 
loggšg
.
	`FÜm©‹r
(
fmt
='%(asctime)s %(levelname)s: %(message)s')

933 
logg”
.
	$addHªdËr
(
fhªdËr
)

935 
logg”
.
	`šfo
('Runningƒnvironment diagnostics')

937 #Lßd 
cÚfigu¿tiÚ


938 
cÚfig
 = 
CÚfigP¬£r
.
	$CÚfigP¬£r
(
tg’_deçuÉs
)

939 
py‹¡ši_·th
 = 
os
.
·th
.
	`još
(
CWD
, '../pytest.ini')

940 
cÚfig
.
	$»ad
(
py‹¡ši_·th
)

942 #As£¹ 
th©
 
we
 
¬e
 
ruÂšg
 
as
 
roÙ


943 
os
.
	`g‘uid
() != 0:

944 
logg”
.
	`”rÜ
('you must„unopotest‡s„oot')

945 
»t
 = 
F®£


947 #As£¹ 
th©
 
we
 
have
 
mšš‘


948 
os
.
	`sy¡em
('which mn >/dev/null 2>/dev/null') != 0:

949 
logg”
.
	`”rÜ
('could‚ot find mininet binary (mininet is‚ot installed)')

950 
»t
 = 
F®£


952 #As£¹ 
th©
 
we
 
have
 
rou‹
 
š¡®Ëd


953 
os
.
	`sy¡em
('which ip >/dev/null 2>/dev/null') != 0:

954 
logg”
.
	`”rÜ
('could‚ot find ip binary (iproute is‚ot installed)')

955 
»t
 = 
F®£


957 #As£¹ 
th©
 
we
 
have
 
gdb
 
š¡®Ëd


958 
os
.
	`sy¡em
('which gdb >/dev/null 2>/dev/null') != 0:

959 
logg”
.
	`”rÜ
('could‚ot find gdb binary (gdb is‚ot installed)')

960 
»t
 = 
F®£


962 #As£¹ 
th©
 
FRR
 
ut™›s
 
exi¡


963 
ärdœ
 = 
cÚfig
.
	`g‘
('topogen', 'frrdir')

964 
hasär
 = 
F®£


965 
nÙ
 
os
.
·th
.
	$isdœ
(
ärdœ
):

966 
logg”
.
	`”rÜ
('could‚Ù fšd {} dœeùÜy'.
	$fÜm©
(
ärdœ
))

967 
»t
 = 
F®£


969 
hasär
 = 
True


970 
Œy
:

971 
pwd
.
	`g‘pwÇm
('frr')[2]

972 
exû±
 
KeyE¼Ü
:

973 
logg”
.
	`w¬nšg
('could‚ot find "frr" user')

975 
Œy
:

976 
g½
.
	`g‘gºam
('frr')[2]

977 
exû±
 
KeyE¼Ü
:

978 
logg”
.
	`w¬nšg
('could‚ot find "frr" group')

980 
Œy
:

981 'är' 
nÙ
 
š
 
g½
.
	`g‘gºam
('ärvty').
gr_mem
:

982 
logg”
.
	`”rÜ
('"frr" user‡nd groupƒxist, but user is‚ot under "frrvty"')

983 
exû±
 
KeyE¼Ü
:

984 
logg”
.
	`w¬nšg
('could‚ot find "frrvty" group')

986 
âame
 
š
 ['zebra', 'ospfd', 'ospf6d', 'bgpd', 'ripd', 'ripngd',

988 
·th
 = 
os
.·th.
	$još
(
ärdœ
, 
âame
)

989 
nÙ
 
os
.
·th
.
	$isfe
(
·th
):

990 #LDPd 
is
 
ª
 
exû±iÚ


991 
âame
 == 'ldpd':

992 
logg”
.
	`šfo
('could‚Ù fšd {} iÀ{}'.
	`fÜm©
(
âame
, 
ärdœ
) +

996 
logg”
.
	`w¬nšg
('could‚Ù fšd {} iÀ{}'.
	$fÜm©
(
âame
, 
ärdœ
))

997 
»t
 = 
F®£


999 
âame
 != 'zebra':

1002 
os
.
	`sy¡em
(

1003 '{} -v 2>&1 >/tmp/tİÙe¡s/är_zeb¿.txt'.
	$fÜm©
(
·th
)

1006 #As£¹ 
th©
 
Quagga
 
ut™›s
 
exi¡


1007 
quaggadœ
 = 
cÚfig
.
	`g‘
('topogen', 'quaggadir')

1008 
hasär
:

1009 #ià
we
 
have
 
är
, 
dÚ
't check for quagga

1010 
·ss


1011 
–if
 
nÙ
 
os
.
·th
.
	$isdœ
(
quaggadœ
):

1012 
logg”
.
	`šfo
('could‚Ù fšd {} dœeùÜy (quagg¨‹¡ wÈnÙ„un)'.
	$fÜm©
(
quaggadœ
))

1014 
»t
 = 
True


1015 
Œy
:

1016 
pwd
.
	`g‘pwÇm
('quagga')[2]

1017 
exû±
 
KeyE¼Ü
:

1018 
logg”
.
	`šfo
('could‚ot find "quagga" user')

1020 
Œy
:

1021 
g½
.
	`g‘gºam
('quagga')[2]

1022 
exû±
 
KeyE¼Ü
:

1023 
logg”
.
	`šfo
('could‚ot find "quagga" group')

1025 
Œy
:

1026 'quagga' 
nÙ
 
š
 
g½
.
	`g‘gºam
('quaggavty').
gr_mem
:

1027 
logg”
.
	`”rÜ
('"quagga" user‡nd groupƒxist, but user is‚ot under "quaggavty"')

1028 
exû±
 
KeyE¼Ü
:

1029 
logg”
.
	`w¬nšg
('could‚ot find "quaggavty" group')

1031 
âame
 
š
 ['zebra', 'ospfd', 'ospf6d', 'bgpd', 'ripd', 'ripngd',

1033 
·th
 = 
os
.·th.
	$još
(
quaggadœ
, 
âame
)

1034 
nÙ
 
os
.
·th
.
	$isfe
(
·th
):

1035 
logg”
.
	`w¬nšg
('could‚Ù fšd {} iÀ{}'.
	$fÜm©
(
âame
, 
quaggadœ
))

1036 
»t
 = 
F®£


1038 
âame
 != 'zebra':

1041 
os
.
	`sy¡em
(

1042 '{} -v 2>&1 >/tmp/tİÙe¡s/quagga_zeb¿.txt'.
	$fÜm©
(
·th
)

1045 #Te¡ 
MPLS
 
avaab™y


1046 
k»l
 = 
¶©fÜm
.
	$»Ëa£
()

1047 
tİÙe¡
.
	`v”siÚ_cmp
(
k»l
, '4.5') < 0:

1048 
logg”
.
	`šfo
('LDPde¡ wÈnÙ„uÀ(havk”ÃÈ"{}", buˆ™„equœe 4.5)'.
	$fÜm©
(
k»l
))

1050 #Te¡ 
MPLS
 
K”Ãl
 
moduËs
 
avaabË


1051 
nÙ
 
tİÙe¡
.
	`moduË_´e£Á
('m¶s-rou‹r', 
lßd
=
F®£
) != 0:

1052 
logg”
.
	`šfo
('LDPdests will‚ot„un (missing mpls-router kernel module)')

1053 
nÙ
 
tİÙe¡
.
	`moduË_´e£Á
('m¶s-tuÂ–', 
lßd
=
F®£
) != 0:

1054 
logg”
.
	`šfo
('LDPdests will‚ot„un (missing mpls-iptunnel kernel module)')

1056 #TODO 
»move
 
me
 
wh’
 
we
 
¡¬t
 
suµÜtšg
 
exabgp
 >= 4

1057 
Œy
:

1058 
ouut
 = 
sub´oûss
.
	`check_ouut
(['exabgp', '-v'])

1059 
lše
 = 
ouut
.
	`¥l™
('\n')[0]

1060 
v”siÚ
 = 
lše
.
	`¥l™
(' ')[2]

1061 
tİÙe¡
.
	`v”siÚ_cmp
(
v”siÚ
, '4') >= 0:

1062 
logg”
.
	`w¬nšg
('BGPopologies‡re still usingƒxabgp version 3,ƒxpect failures')

1064 #W
wªt
 
to
 
ÿtch
 
®l
 
exû±iÚs


1065 #pylšt: 
di§bË
=
W0702


1066 
exû±
:

1067 
logg”
.
	`w¬nšg
('failedo findƒxabgp or„eturnedƒrror')

1069 #Aá” 
we
 
logged
 
the
 
ouut
 
to
 
fe
, 
»move
h
hªdËr
.

1070 
logg”
.
	$»moveHªdËr
(
fhªdËr
)

1072  
»t


	@lib/topojson.py

1 #
#Modif›d 
wÜk
 
Cİyright
 (
c
è2019 
by
 
VMw¬e
, 
Inc
. ("VMware")

3 #Origš® 
wÜk
 
Cİyright
 (
c
è2018 
by
 
N‘wÜk
 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

4 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


6 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


7 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


8 #š 
®l
 
cİ›s
.

9 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
VMWARE
 
DISCLAIMS
 
ALL
 
WARRANTIES


11 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


12 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
VMWARE
 
BE
 
LIABLE
 
FOR


13 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


14 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

15 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


16 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


17 #OF 
THIS
 
SOFTWARE
.

20 
impÜt
 
os


21 
impÜt
 
sys


22 
impÜt
 
jsÚ


23 
impÜt
 
add»ss


24 
äom
 
	glib
.
tİŞog
 
impÜt
 
	glogg”
, 
	glogg”_cÚfig


26 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

27 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


29 
äom
 
	glib
.
bgp
 
impÜt
 *

31 
def
 
	$bud_tİo_äom_jsÚ
(
tg’
, 
tİo
):

33 
Buds
 
tİŞogy
 
äom
 
jsÚ


35 * `
tg’
`: 
Tİog’
 
objeù


36 * `
tİo
`: 
jsÚ
 
fe
 
d©a


39 
logg”
.
	`šfo
("Testing flow - Buildingopo####################")

40 
li¡Rou‹rs
 = []

41 
rou‹rN
 
š
 
	`sÜ‹d
(
tİo
['rou‹rs'].
	$™”™ems
()):

42 
logg”
.
	`šfo
('Tİo: Add„ou‹¸{}'.
	$fÜm©
(
rou‹rN
[0]))

43 
tg’
.
	$add_rou‹r
(
rou‹rN
[0])

44 
li¡Rou‹rs
.
	$­³nd
(
rou‹rN
[0])

46 
li¡Rou‹rs
.
	$sÜt
()

47 'v4ba£' 
š
 
tİo
:

48 
v4Next
 = 
add»ss
.
	`IPv4Add»ss
(
tİo
['link_ip_start']['ipv4'])

49 
v4S‹p
 = 2 ** (32 - 
tİo
['link_ip_start']['v4mask'])

50 
tİo
['link_ip_start']['v4mask'] < 32:

51 
v4Next
 += 1

52 'v6ba£' 
š
 
tİo
:

53 
v6Next
 = 
add»ss
.
	`IPv6Add»ss
(
tİo
['link_ip_start']['ipv6'])

54 
v6S‹p
 = 2 ** (128 - 
tİo
['link_ip_start']['v6mask'])

55 
tİo
['link_ip_start']['v6mask'] < 127:

56 
v6Next
 += 1

57 
rou‹r
 
š
 
li¡Rou‹rs
:

58 
tİo
['rou‹rs'][
rou‹r
]['nextIfname'] = 0

60 
li¡Rou‹rs
 != []:

61 
curRou‹r
 = 
li¡Rou‹rs
.
	$pİ
(0)

62 #PhysiÿÈ
IÁ”çûs


63 'lšks' 
š
 
tİo
['rou‹rs'][
curRou‹r
]:

64 
de¡Rou‹rLšk
, 
d©a
 
š
 
	`sÜ‹d
(
tİo
['rou‹rs'][
curRou‹r
]['links'].\

65 
	$™”™ems
()):

66 "-" 
š
 
de¡Rou‹rLšk
:

67 #S¶™šg 
ªd
 
¡Üšg
 
de¡Rou‹rLšk
 
d©a
 
š
 
‹mpLi¡


68 
‹mpLi¡
 = 
de¡Rou‹rLšk
.
	`¥l™
("-")

71 
de¡Rou‹r
 = 
‹mpLi¡
.
	$pİ
(0)

73 #Cu¼’ˆ
Rou‹r
 
Lšk


74 
‹mpLi¡
.
	$š£¹
(0, 
curRou‹r
)

75 
curRou‹rLšk
 = "-".
	$još
(
‹mpLi¡
)

77 
de¡Rou‹r
 = 
de¡Rou‹rLšk


78 
curRou‹rLšk
 = 
curRou‹r


80 
de¡Rou‹r
 
š
 
li¡Rou‹rs
:

81 #Assignšg 
Çme
 
to
 
š‹rçûs


82 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]['interface'] = \

83 '{}-{}-‘h{}'.
	`fÜm©
(
curRou‹r
, 
de¡Rou‹r
, 
tİo
['routers']\

84 [
curRou‹r
]['nextIfname'])

85 
tİo
['rou‹rs'][
de¡Rou‹r
]['lšks'][
curRou‹rLšk
]['interface'] = \

86 '{}-{}-‘h{}'.
	`fÜm©
(
de¡Rou‹r
, 
curRou‹r
, 
tİo
['routers']\

87 [
de¡Rou‹r
]['nextIfname'])

88 
tİo
['rou‹rs'][
curRou‹r
]['nextIfname'] += 1

89 
tİo
['rou‹rs'][
de¡Rou‹r
]['nextIfname'] += 1

91 #Lškšg 
rou‹rs
 
to
 
—ch
 
Ùh”
 
as
 
defšed
 
š
 
JSON
 
fe


92 
tg’
.
g—rs
[
curRou‹r
].
	`add_lšk
Ñg’.g—rs[
de¡Rou‹r
], \

93 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]\

94 ['š‹rçû'], 
tİo
['rou‹rs'][
de¡Rou‹r
]['links']\

95 [
curRou‹rLšk
]['interface'])

98 'v4' 
š
 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]:

99 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]['ipv4'] == \

101 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]['ipv4'] = \

102 '{}/{}'.
	`fÜm©
(
v4Next
, 
tİo
['link_ip_start']['v4mask'])

103 
tİo
['rou‹rs'][
de¡Rou‹r
]['lšks'][
curRou‹rLšk
]['ipv4'] = \

104 '{}/{}'.
	`fÜm©
(
v4Next
 + 1, 
tİo
['link_ip_start']['v4mask'])

105 
v4Next
 +ğ
v4S‹p


107 'v6' 
š
 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]:

108 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]['ipv6'] == \

110 
tİo
['rou‹rs'][
curRou‹r
]['lšks'][
de¡Rou‹rLšk
]['ipv6'] = \

111 '{}/{}'.
	`fÜm©
(
v6Next
, 
tİo
['link_ip_start']['v6mask'])

112 
tİo
['rou‹rs'][
de¡Rou‹r
]['lšks'][
curRou‹rLšk
]['ipv6'] = \

113 '{}/{}'.
	`fÜm©
(
v6Next
 + 1, 
tİo
['link_ip_start']['v6mask'])

114 
v6Next
 = 
add»ss
.
	`IPv6Add»ss
((v6Nextè+ 
v6S‹p
)

116 #Loİback 
š‹rçûs


117 'lo' 
š
 
tİo
['rou‹rs'][
curRou‹r
]:

118 
tİo
['rou‹rs'][
curRou‹r
]['lo']['ipv4'] == 'auto':

119 
tİo
['rou‹rs'][
curRou‹r
]['lo']['ipv4'] = '{}{}.{}/{}'.\

120 
	`fÜm©
(
tİo
['lo_´efix']['v4'], 
	`numb”_to_row
(
curRou‹r
),\

121 
	`numb”_to_cŞumn
(
curRou‹r
), 
tİo
['lo_prefix']['v4mask'])

122 
tİo
['rou‹rs'][
curRou‹r
]['lo']['ipv6'] == 'auto':

123 
tİo
['rou‹rs'][
curRou‹r
]['lo']['ipv6'] = '{}{}:{}/{}'.\

124 
	`fÜm©
(
tİo
['lo_´efix']['v6'], 
	`numb”_to_row
(
curRou‹r
),\

125 
	`numb”_to_cŞumn
(
curRou‹r
), 
tİo
['lo_prefix']['v6mask'])

127 
def
 
	$bud_cÚfig_äom_jsÚ
(
tg’
, 
tİo
, 
CWD
):

129 
Buds
 
cÚfigu¿tiÚ
 
äom
 
jsÚ


131 * `
tg’
`: 
Tİog’
 
objeù


132 * `
tİo
`: 
jsÚ
 
fe
 
d©a


133 * `
CWD
`: 
ÿÎ”
's current working directory

136 
logg”
.
	`šfo
("######## Testing flow - Building configuration ########")

138 
li¡Rou‹rs
 = []

139 
rou‹rN
 
š
 
	`sÜ‹d
(
tİo
['rou‹rs'].
	$™”™ems
()):

140 
li¡Rou‹rs
.
	$­³nd
(
rou‹rN
[0])

142 
li¡Rou‹rs
.
	$sÜt
()

143 
li¡Rou‹rs
 != []:

144 
curRou‹r
 = 
li¡Rou‹rs
.
	$pİ
(0)

146 
logg”
.
	`šfo
('CÚfiguršg„ou‹¸{}..'.
	$fÜm©
(
curRou‹r
))

148 #C»©
ªd
 
lßd
 
rou‹rs
 
commÚ
 
cÚfigu¿tiÚs
, 
ex
- 
š‹rçû_cÚfig
, 
¡©ic_rou‹s
,

149 #´efix_l™ 
ªd
 
rou‹_m­s
...
‘c
 
to
 
rou‹r


150 
»suÉ
 = 
	`ü—‹_commÚ_cÚfigu¿tiÚ
('v4', 
tg’
, 
CWD
, 
tİo
, 
curRou‹r
)

151 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, \

152 "tİojsÚ.ü—‹_commÚ_cÚfigu¿tiÚ(è:Faed \ÀE¼Ü: {}".
	$fÜm©
(
»suÉ
)

154 #C»©
ªd
 
lßd
 
bgp
‡nd 
commun™y_li¡
 
cÚfigu¿tiÚ
 
to
 
rou‹r


155 
»suÉ
 = 
	`ü—‹_bgp_cÚfigu¿tiÚ
('v4', 
tg’
, 
CWD
, 
tİo
, 
curRou‹r
)

156 
»suÉ
 !ğ
True
 : 
as£¹
 
F®£
, \

157 "tİojsÚ.ü—‹_bgp_cÚfigu¿tiÚ(è:Faed \ÀE¼Ü: {}".
	`fÜm©
(
»suÉ
)

	@lib/topolog.py

1 #
#tİŞog.
py


3 #Lib¿ry 
of
 
h–³r
 
funùiÚs
 
N‘DEF
 
TİŞogy
 
Te¡s


4 #
#Cİyrighˆ(
c
è2017 
by


6 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

7 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


9 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


10 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


11 #š 
®l
 
cİ›s
.

12 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


14 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


15 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


16 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


17 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

18 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


19 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


20 #OF 
THIS
 
SOFTWARE
.

24 
Loggšg
 
ut™›s
 
tİŞogy
 
	g‹¡s
.

26 
This
 
fe
 
defšes
 
our
 
loggšg
 
	gab¡¿ùiÚ
.

29 
impÜt
 
sys


30 
impÜt
 
	gloggšg


32 #H–³¸
diùiÚ¬y
 
to
 
cÚv”t
 
Tİog’
 
loggšg
 
Ëv–s
Ø
PythÚ
's†ogging.

33 
	gDEBUG_TOPO2LOGGING
 = {

34 'debug': 
loggšg
.
DEBUG
,

35 'šfo': 
loggšg
.
INFO
,

36 'ouut': 
loggšg
.
INFO
,

37 'w¬nšg': 
loggšg
.
WARNING
,

38 '”rÜ': 
loggšg
.
ERROR
,

39 'ü™iÿl': 
loggšg
.
CRITICAL
,

42 
şass
 
	$InfoF‹r
(
loggšg
.
F‹r
):

43 
def
 
	$f‹r
(
£lf
, 
»c
):

44  
»c
.
Ëv–no
 
	$š
 (
loggšg
.
DEBUG
,†oggšg.
INFO
)

46 #
#Logg” 
şass
 
defš™iÚ


50 
şass
 
	$Logg”
(
objeù
):

52 
Logg”
 
şass
 
th©
 
’ÿpsuÏ‹s
 
loggšg
 
funùiÚs
, 
š‹º®y
 
™
 
u£s
 
PythÚ


53 
loggšg
 
moduË
 
w™h
 
a
 
£·¿‹d
 
š¡ªû
 
š¡—d
 
of
 
glob®
.

55 
DeçuÉ
 
loggšg
 
Ëv–
 
is
 'info'.

58 
def
 
	$__š™__
(
£lf
):

59 #C»© 
glob®
 
logg”


60 
£lf
.
log_Ëv–
 = 
loggšg
.
INFO


61 
£lf
.
logg”
 = 
loggšg
.
	`Logg”
('tİŞog', 
Ëv–
=£lf.
log_Ëv–
)

63 
hªdËr_¡dout
 = 
loggšg
.
	$SŒ—mHªdËr
(
sys
.
¡dout
)

64 
hªdËr_¡dout
.
	$£tLev–
(
loggšg
.
DEBUG
)

65 
hªdËr_¡dout
.
	`addF‹r
(
	$InfoF‹r
())

66 
hªdËr_¡dout
.
	`£tFÜm©‹r
(

67 
loggšg
.
	`FÜm©‹r
(
fmt
='%(asctime)s %(levelname)s: %(message)s')

69 
hªdËr_¡d”r
 = 
loggšg
.
	$SŒ—mHªdËr
()

70 
hªdËr_¡d”r
.
	$£tLev–
(
loggšg
.
WARNING
)

71 
hªdËr_¡d”r
.
	`£tFÜm©‹r
(

72 
loggšg
.
	`FÜm©‹r
(
fmt
='%(asctime)s %(levelname)s: %(message)s')

75 
£lf
.
logg”
.
	$addHªdËr
(
hªdËr_¡dout
)

76 
£lf
.
logg”
.
	$addHªdËr
(
hªdËr_¡d”r
)

78 #HªdË 
mÜe
 
logg”s


79 
£lf
.
logg”s
 = {'tİŞog': s–f.
logg”
}

81 
def
 
	$£t_log_Ëv–
(
£lf
, 
Ëv–
):

83 
£lf
.
log_Ëv–
 = 
DEBUG_TOPO2LOGGING
.
	$g‘
(
Ëv–
)

84 
£lf
.
logg”
.
	$£tLev–
(
£lf
.
log_Ëv–
)

86 
def
 
	`g‘_logg”
(
£lf
, 
Çme
='tİŞog', 
log_Ëv–
=
NÚe
, 
rg‘
=
sys
.
¡dout
):

88 
G‘
 
a
 
Ãw
 
logg”
 
’Œy
. 
AÎows
 
ü—tšg
 
difã»Á
 
logg”s
 
fÜm©šg
,

89 
f‹ršg
 
Ü
 
	`hªdlšg
 (
fe
, 
¡»am
 o¸
¡dout
/
¡d”r
).

91 
log_Ëv–
 
is
 
NÚe
:

92 
log_Ëv–
 = 
£lf
.log_level

93 
£lf
.
logg”s
.
	$has_key
(
Çme
):

94  
£lf
.
logg”s
[
Çme
]

96 
Æogg”
 = 
loggšg
.
	$Logg”
(
Çme
, 
Ëv–
=
log_Ëv–
)

97 
	$isš¡ªû
(
rg‘
, 
¡r
):

98 
hªdËr
 = 
loggšg
.
	$FeHªdËr
(
f’ame
=
rg‘
)

100 
hªdËr
 = 
loggšg
.
	$SŒ—mHªdËr
(
¡»am
=
rg‘
)

102 
hªdËr
.
	`£tFÜm©‹r
(

103 
loggšg
.
	`FÜm©‹r
(
fmt
='%(asctime)s %(levelname)s: %(message)s')

105 
Æogg”
.
	$addHªdËr
(
hªdËr
)

106 
£lf
.
logg”s
[
Çme
] = 
Æogg”


107  
Æogg”


109 #
#Glob® 
v¬ŸbËs


113 
logg”_cÚfig
 = 
	$Logg”
()

114 
logg”
 = 
logg”_cÚfig
.logger

	@lib/topotest.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#tİÙe¡.
py


5 #Lib¿ry 
of
 
h–³r
 
funùiÚs
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2016 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

25 
impÜt
 
jsÚ


26 
impÜt
 
os


27 
impÜt
 
”ºo


28 
impÜt
 
»


29 
impÜt
 
sys


30 
impÜt
 
funùoŞs


31 
impÜt
 
glob


32 
impÜt
 
SŒšgIO


33 
impÜt
 
sub´oûss


34 
impÜt
 
‹mpfe


35 
impÜt
 
¶©fÜm


36 
impÜt
 
difæib


37 
impÜt
 
time


39 
äom
 
	glib
.
tİŞog
 
impÜt
 
logg”


41 
äom
 
	gmšš‘
.
tİo
 
impÜt
 
Tİo


42 
äom
 
	gmšš‘
.
Ãt
 
impÜt
 
Mšš‘


43 
äom
 
	gmšš‘
.
node
 
impÜt
 
	gNode
, 
	gOVSSw™ch
, 
Ho¡


44 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


45 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


46 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


48 
şass
 
	$jsÚ_cmp_»suÉ
(
objeù
):

51 
def
 
	$__š™__
(
£lf
):

52 
£lf
.
”rÜs
 = []

54 
def
 
	$add_”rÜ
(
£lf
, 
”rÜ
):

56 
lše
 
š
 
”rÜ
.
	$¥l™lšes
():

57 
£lf
.
”rÜs
.
	$­³nd
(
lše
)

59 
def
 
	$has_”rÜs
(
£lf
):

61  
	`Ën
(
£lf
.
”rÜs
) > 0

63 
def
 
	$g‘_‹¡_logdœ
(
node
=
NÚe
, 
š™
=
F®£
):

65 
R‘uº
 
the
 
cu¼’t
 
‹¡
 
log
 
dœeùÜy
 
ba£d
 
Ú
 
PYTEST_CURRENT_TEST


66 
’vœÚm’t
 
v¬ŸbË
.

67 
O±iÚ®
 
·¿m‹rs
:

68 
node
: 
wh’
 
£t
, 
adds
 
the
‚od
¥ecific
 
log
 
dœeùÜy
 
to
h
š™
 
dœ


69 
š™
: 
wh’
 
£t
, 
š™Ÿlizes
 
the
 
log
 
dœeùÜy
 
ªd
 
fixes
 
·th
 
³rmissiÚs


71 
cur_‹¡
 = 
os
.
’vœÚ
['PYTEST_CURRENT_TEST']

73 
»t
 = '/tmp/tİÙe¡s/' + 
cur_‹¡
[0:cur_‹¡.
	`fšd
(".py")].
	`»¶aû
('/','.')

74 
node
 !ğ
NÚe
:

75 
dœ
 = 
»t
 + "/" + 
node


76 
š™
:

77 
os
.
	`sy¡em
('mkdœ -°' + 
dœ
)

78 
os
.
	`sy¡em
('chmod -R go+rw /tmp/topotests')

79  
»t


81 
def
 
	$jsÚ_diff
(
d1
, 
d2
):

83 
R‘uºs
 
a
 
¡ršg
 
w™h
 
the
 
difã»nû
 
b‘w“n
 
JSON
 
d©a
.

85 
jsÚ_fÜm©_İts
 = {

87 'sÜt_keys': 
True
,

88 
	}
}

89 
d¡r1
 = 
jsÚ
.
	$dumps
(
d1
, **
jsÚ_fÜm©_İts
)

90 
d¡r2
 = 
jsÚ
.
	$dumps
(
d2
, **
jsÚ_fÜm©_İts
)

91  
	`difæšes
(
d¡r2
, 
d¡r1
, 
t™Ë1
='Ex³ùed v®ue', 
t™Ë2
='Cu¼’ˆv®ue', 
n
=0)

94 
def
 
	$_jsÚ_li¡_cmp
(
li¡1
, 
li¡2
, 
·»Á
, 
»suÉ
):

96 #Check 
£cÚd
 
li¡2
 
ty³


97 
nÙ
 
	`isš¡ªû
(
li¡1
, 
	$ty³
([])è
Ü
 
nÙ
 
	`isš¡ªû
(
li¡2
, 
	$ty³
([])):

98 
»suÉ
.
	`add_”rÜ
(

99 '{} ha difã»Áy³hªƒx³ùed '.
	`fÜm©
(
·»Á
) +

100 '(hav{},ƒx³ùed {}):\n{}'.
	`fÜm©
(

101 
	`ty³
(
li¡1
),y³(
li¡2
), 
	$jsÚ_diff
(
li¡1
, 
li¡2
)))

104 #Check 
li¡
 
size


105 
	`Ën
(
li¡2
è> 
	$Ën
(
li¡1
):

106 
»suÉ
.
	`add_”rÜ
(

107 '{}oØãw i‹m '.
	`fÜm©
(
·»Á
) +

108 '(hav{},ƒx³ùed {}:\À{})'.
	`fÜm©
(

109 
	`Ën
(
li¡1
),†’(
li¡2
),

110 
	$jsÚ_diff
(
li¡1
, 
li¡2
)))

113 #Li¡ 
®l
 
unm©ched
 
™ems
 
”rÜs


114 
unm©ched
 = []

115 
ex³ùed
 
š
 
li¡2
:

116 
m©ched
 = 
F®£


117 
v®ue
 
š
 
li¡1
:

118 
	`jsÚ_cmp
({'jsÚ': 
v®ue
}, {'jsÚ':ƒx³ùed}èi NÚe:

119 
m©ched
 = 
True


122 
nÙ
 
m©ched
:

123 
unm©ched
.
	$­³nd
(
ex³ùed
)

125 #Ià
th”e
 
¬e
 
unm©ched
 
™ems
, 
”rÜ
 
out
.

126 
unm©ched
:

127 
»suÉ
.
	`add_”rÜ
(

128 '{} v®ui difã»Á (\n{})'.
	`fÜm©
(

129 
·»Á
, 
	$jsÚ_diff
(
li¡1
, 
li¡2
)))

132 
def
 
	$jsÚ_cmp
(
d1
, 
d2
):

134 
JSON
 
com·»
 
funùiÚ
. 
Reûives
 
two
 
·¿m‘”s
:

135 * `
d1
`: 
jsÚ
 
v®ue


136 * `
d2
`: 
jsÚ
 
sub£t
 
which
 
we
 
ex³ù


138 
R‘uºs
 `
NÚe
` 
wh’
 
®l
 
keys
 
th©
 `
d1
` 
has
 
m©ches
 `
d2
`,

139 
Ùh”wi£
 
a
 
¡ršg
 
cÚššg
 
wh©
 
çed
.

141 
NÙe
: 
key
 
ab£nû
 
ÿn
 
be
 
‹¡ed
 
by
 
addšg
 
a
 key 
w™h
 
v®ue
 `
NÚe
`.

143 
squeue
 = [(
d1
, 
d2
, 'json')]

144 
»suÉ
 = 
	$jsÚ_cmp_»suÉ
()

146 
s
 
š
 
squeue
:

147 
nd1
, 
nd2
, 
·»Á
 = 
s


149 #HªdË 
JSON
 
begšnšg
 
w™h
 
li¡s
.

150 
	`isš¡ªû
(
nd1
, 
	$ty³
([])è
Ü
 
	`isš¡ªû
(
nd2
, 
	$ty³
([])):

151 
	$_jsÚ_li¡_cmp
(
nd1
, 
nd2
, 
·»Á
, 
»suÉ
)

152 
»suÉ
.
	$has_”rÜs
():

153  
»suÉ


155  
NÚe


157 #Ex³ù 
®l
 
»quœed
 
f›lds
 
to
 
exi¡
.

158 
s1
, 
s2
 = 
	`£t
(
nd1
), 
	$£t
(
nd2
)

159 
s2_»q
 = 
	$£t
([
key
 key 
š
 
nd2
 nd2[key] 
is
 
nÙ
 
NÚe
])

160 
diff
 = 
s2_»q
 - 
s1


161 
diff
 !ğ
	`£t
({
	}
}):

162 
»suÉ
.
add_”rÜ
('ex³ùed key(sè{} iÀ{} (hav{}):\n{}'.
fÜm©
(

163 
¡r
(
li¡
(
diff
)), 
·»Á
, sŒÖi¡(
s1
)), 
	$jsÚ_diff
(
nd1
, 
nd2
)))

165 
key
 
š
 
s2
.
	$š‹r£ùiÚ
(
s1
):

166 #Te¡ 
nÚ
 
exi¡’û
 
of
 
key
 
š
 
d2


167 
nd2
[
key
] 
is
 
NÚe
:

168 
»suÉ
.
	`add_”rÜ
('"{}" should‚Ùƒxi¡ iÀ{} (hav{}):\n{}'.
	`fÜm©
(

169 
key
, 
·»Á
, 
	`¡r
(
s1
), 
	$jsÚ_diff
(
nd1
[
key
], 
nd2
[key])))

172 #Ià
nd1
 
key
 
is
 
a
 
diù
, 
we
 
have
 
to
 
»cur£
 
š
 
™
 
Ï‹r
.

173 
	`isš¡ªû
(
nd2
[
key
], 
	`ty³
({
	}
})):

174 
nÙ
 
isš¡ªû
(
nd1
[
key
], 
ty³
({})):

175 
»suÉ
.
add_”rÜ
(

176 '{}["{}"] ha difã»Áy³hªƒx³ùed '.
fÜm©
(
·»Á
, 
key
) +

177 '(hav{},ƒx³ùed {}):\n{}'.
fÜm©
(

178 
ty³
(
nd1
[
key
]),y³(
nd2
[key]), 
	$jsÚ_diff
(
nd1
[
key
], 
nd2
[key])))

180 
Å¬’t
 = '{}["{}"]'.
	$fÜm©
(
·»Á
, 
key
)

181 
squeue
.
	`­³nd
((
nd1
[
key
], 
nd2
[key], 
Å¬’t
))

184 #Check 
li¡
 
™ems


185 
	`isš¡ªû
(
nd2
[
key
], 
	$ty³
([])):

186 
	$_jsÚ_li¡_cmp
(
nd1
[
key
], 
nd2
[key], 
·»Á
, 
»suÉ
)

189 #Com·» 
JSON
 
v®ues


190 
nd1
[
key
] !ğ
nd2
[key]:

191 
»suÉ
.
	`add_”rÜ
(

192 '{}["{}"] v®ui difã»Á (\n{})'.
	`fÜm©
(

193 
·»Á
, 
key
, 
	$jsÚ_diff
(
nd1
[
key
], 
nd2
[key])))

196 
»suÉ
.
	$has_”rÜs
():

197  
»suÉ


199  
NÚe


202 
def
 
	$rou‹r_ouut_cmp
(
rou‹r
, 
cmd
, 
ex³ùed
):

204 
Runs
 `
cmd
` 
š
 
rou‹r
 
ªd
 
com·»s
 
the
 
ouut
 
w™h
 `
ex³ùed
`.

206  
	`difæšes
(
	`nÜm®ize_‹xt
(
rou‹r
.
	`vtysh_cmd
(
cmd
)),

207 
	`nÜm®ize_‹xt
(
ex³ùed
),

208 
t™Ë1
="Current output",

209 
t™Ë2
="Expected output")

212 
def
 
	$rou‹r_jsÚ_cmp
(
rou‹r
, 
cmd
, 
d©a
):

214 
Runs
 `
cmd
` 
th©
 
»tuºs
 
JSON
 
	`d©a
 (
nÜm®ly
 
the
 
commªd
 
’ds
 
w™h
 'json')

215 
ªd
 
com·»
 
w™h
 `
d©a
` 
cÚ‹Ás
.

217  
	`jsÚ_cmp
(
rou‹r
.
	`vtysh_cmd
(
cmd
, 
isjsÚ
=
True
), 
d©a
)

220 
def
 
	$run_ªd_ex³ù
(
func
, 
wh©
, 
couÁ
=20, 
wa™
=3):

222 
Run
 `
func
` 
ªd
 
com·»
 
the
 
»suÉ
 
w™h
 `
wh©
`. 
Do
 
™
 `
couÁ
` 
times


223 
wa™šg
 `
wa™
` 
£cÚds
 
b‘w“n
 
Œ›s
. 
By
  
™
r› 20 
times
 
w™h


224 3 
£cÚds
 
d–ay
 
b‘w“n
 
Œ›s
.

226 
	`R‘uºs
 (
True
, 
func
-è
Ú
 
sucûss
 
Ü


227 (
F®£
, 
func
-è
Ú
 
çu»
.

231 
H–³r
 
funùiÚs
 
to
 
u£
 
w™h
 
this
 
funùiÚ
:

232 - 
rou‹r_ouut_cmp


233 - 
rou‹r_jsÚ_cmp


235 
¡¬t_time
 = 
time
.
	$time
()

236 
func_Çme
 = "<unknown>"

237 
func
.
__şass__
 =ğ
funùoŞs
.
·¹Ÿl
:

238 
func_Çme
 = 
func
.func.
__Çme__


240 
func_Çme
 = 
func
.
__Çme__


242 
logg”
.
	`šfo
(

243 "'{}'…Şlšg s¹ed (š‹rv® {} secs, maximum wa™ {} secs)".
	`fÜm©
(

244 
func_Çme
, 
wa™
, (wa™ * 
couÁ
)))

246 
couÁ
 > 0:

247 
»suÉ
 = 
	$func
()

248 
»suÉ
 !ğ
wh©
:

249 
time
.
	$¦“p
(
wa™
)

250 
couÁ
 -= 1

253 
’d_time
 = 
time
.
	$time
()

254 
logg”
.
	`šfo
("'{}' sucûeded‡á” {:.2f} secÚds".
	`fÜm©
(

255 
func_Çme
, 
’d_time
 - 
¡¬t_time
))

256  (
True
, 
»suÉ
)

258 
’d_time
 = 
time
.
	$time
()

259 
logg”
.
	`”rÜ
("'{}' faed‡á” {:.2f} secÚds".
	`fÜm©
(

260 
func_Çme
, 
’d_time
 - 
¡¬t_time
))

261  (
F®£
, 
»suÉ
)

264 
def
 
	$št2dpid
(
dpid
):

267 
Œy
:

268 
dpid
 = 
	`hex
(dpid)[2:]

269 
dpid
 = '0'*(16-
	`Ën
(dpid))+dpid

270  
dpid


271 
exû±
 
IndexE¼Ü
:

272 
¿i£
 
	`Exû±iÚ
('Unableo derive default datapath ID - '

276 
def
 
	$pid_exi¡s
(
pid
):

279 
pid
 <= 0:

280  
F®£


281 
Œy
:

282 
os
.
	$kl
(
pid
, 0)

283 
exû±
 
OSE¼Ü
 
as
 
”r
:

284 
”r
.
”ºo
 =ğ”ºo.
ESRCH
:

285 #ESRCH =ğ
No
 
such
 
´oûss


286  
F®£


287 
–if
 
”r
.
”ºo
 =ğ”ºo.
EPERM
:

288 #EPERM 
ş—¾y
 
m—ns
 
th”e
's‡…rocesso deny‡ccesso

289  
True


291 #AccÜdšg 
to
 "mª 2 kl" 
possibË
 
”rÜ
 
v®ues
 
¬e


292 #(
EINVAL
, 
EPERM
, 
ESRCH
)

293 
¿i£


295  
True


297 
def
 
	`g‘_‹xtdiff
(
‹xt1
, 
‹xt2
, 
t™Ë1
="", 
t™Ë2
="", **
İts
):

300 
diff
 = '\n'.
	`još
(
difæib
.
	$unif›d_diff
(
‹xt1
, 
‹xt2
,

301 
äomfe
=
t™Ë1
, 
tofe
=
t™Ë2
, **
İts
))

302 #CËª 
up
 
lše
 
’dšgs


303 
diff
 = 
os
.
lše£p
.
	`još
([
s
  
š
 diff.
	$¥l™lšes
(è
s
])

304  
diff


306 
def
 
	`difæšes
(
‹xt1
, 
‹xt2
, 
t™Ë1
='', 
t™Ë2
='', **
İts
):

308 
‹xt1
 = ('\n'.
	`još
Ñext1.
	`r¡r
().
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

309 
‹xt2
 = ('\n'.
	`još
Ñext2.
	`r¡r
().
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

310  
	$g‘_‹xtdiff
(
‹xt1
, 
‹xt2
, 
t™Ë1
, 
t™Ë2
, **
İts
)

312 
def
 
	$g‘_fe
(
cÚ‹Á
):

314 
G’”©es
 
a
 
‹mpÜ¬y
 
fe
 
š
 '/tmp' 
w™h
 `
cÚ‹Á
` 
ªd
 
»tuºs
 
the
 f
Çme
.

316 
fde
 = 
‹mpfe
.
	`NamedTempÜ¬yFe
(
mode
='w', 
d–‘e
=
F®£
)

317 
âame
 = 
fde
.
Çme


318 
fde
.
	$wr™e
(
cÚ‹Á
)

319 
fde
.
	$şo£
()

320  
âame


322 
def
 
	$nÜm®ize_‹xt
(
‹xt
):

324 
SŒs
 
fÜm©šg
 
¥aûs
/
bs
, 
ÿ¼Ÿge
 
»tuºs
 
ªd
 
Œašg
 
wh™e¥aû
.

326 
‹xt
 = 
»
.
	`sub
(
r
'[ \t]+', ' ',ext)

327 
‹xt
 = 
»
.
	`sub
(
r
'\r', '',ext)

329 #Remov
wh™e¥aû
 
š
 
the
 
middË
 
of
 
‹xt
.

330 
‹xt
 = 
»
.
	`sub
(
r
'[ \t]+\n', '\n',ext)

331 #Remov
wh™e¥aû
 
©
 
the
 
’d
 
of
h
‹xt
.

332 
‹xt
 =ext.
	$r¡r
()

334  
‹xt


336 
def
 
	$moduË_´e£Á
(
moduË
, 
lßd
=
True
):

338 
R‘uºs
 
wh‘h”
 `
moduË
` 
is
 
´e£Á
.

340 
If
 `
lßd
` 
is
 
Œue
, 
™
 
wl
 
Œy
 
to
†ßd iˆ
vŸ
 
mod´obe
.

342 
w™h
 
	`İ’
('/´oc/moduËs', 'r'è
as
 
moduËs_fe
:

343 
moduË
.
	`»¶aû
('-','_'è
š
 
moduËs_fe
.
	$»ad
():

344  
True


345 
cmd
 = '/sbš/mod´ob{}{}'.
	`fÜm©
('' 
lßd
 '-n ',

346 
moduË
)

347 
os
.
	`sy¡em
(
cmd
) != 0:

348  
F®£


350  
True


352 
def
 
	$v”siÚ_cmp
(
v1
, 
v2
):

354 
Com·»
 
two
 
v”siÚ
 
¡ršgs
 
ªd
 
»tuºs
:

356 * `-1`: `
v1
` 
is
 
Ëss
 
thª
 `
v2
`

357 * `0`: `
v1
` 
is
 
equ®
 
to
 `
v2
`

358 * `1`: `
v1
` 
is
 
g»©”
 
thª
 `
v2
`

360 
Rai£s
 `
V®ueE¼Ü
` 
v”siÚs
 
¬e
 
nÙ
 
w–l
 
fÜm©ed
.

362 
v»gex
 = 
r
'(?P<whole>\d+(\.(\d+))*)'

363 
v1m
 = 
»
.
	$m©ch
(
v»gex
, 
v1
)

364 
v2m
 = 
»
.
	$m©ch
(
v»gex
, 
v2
)

365 
v1m
 
is
 
NÚe
 
Ü
 
v2m
 is None:

366 
¿i£
 
	`V®ueE¼Ü
("got‡ invalid version string")

368 #S¶™ 
v®ues


369 
v1g
 = 
v1m
.
	`group
('whŞe').
	`¥l™
('.')

370 
v2g
 = 
v2m
.
	`group
('whŞe').
	`¥l™
('.')

372 #G‘ 
the
 
lÚge¡
 
v”siÚ
 
¡ršg


373 
vnum
 = 
	$Ën
(
v1g
)

374 
	`Ën
(
v2g
è> 
vnum
:

375 
vnum
 = 
	$Ën
(
v2g
)

377 #Rev”£ 
li¡
 
beÿu£
 
we
 
¬e
 
gošg
 
to
 
pİ
 
the
 



378 
v1g
.
	$»v”£
()

379 
v2g
.
	$»v”£
()

380 
_
 
š
 
	$¿nge
(
vnum
):

381 
Œy
:

382 
v1n
 = (
v1g
.
	$pİ
())

383 
exû±
 
IndexE¼Ü
:

384 
v2g
:

385 
v2n
 = (
v2g
.
	$pİ
())

386 
v2n
 > 0:

390 
Œy
:

391 
v2n
 = (
v2g
.
	$pİ
())

392 
exû±
 
IndexE¼Ü
:

393 
v1n
 > 0:

395 
v1g
:

396 
v1n
 = (
v1g
.
	$pİ
())

397 
v1n
 > 0:

401 
v1n
 > 
v2n
:

403 
v1n
 < 
v2n
:

407 
def
 
	$š‹rçû_£t_¡©us
(
node
, 
içûÇme
, 
içûaùiÚ
=
F®£
, 
vrf_Çme
=
NÚe
):

408 
içûaùiÚ
:

409 
¡r_içûaùiÚ
 = 'no shutdown'

411 
¡r_içûaùiÚ
 = 'shutdown'

412 
vrf_Çme
 =ğ
NÚe
:

413 
cmd
 = 'vtysh -ø\"cÚfigu»”mš®\" -ø\"š‹rçû {0}\" -ø\"{1}\"'.
	$fÜm©
(
içûÇme
, 
¡r_içûaùiÚ
)

415 
cmd
 = 'vtysh -ø\"cÚfigu»”mš®\" -ø\"š‹rçû {0} vrà{1}\" -ø\"{2}\"'.
	$fÜm©
(
içûÇme
, 
vrf_Çme
, 
¡r_içûaùiÚ
)

417 
node
.
	$run
(
cmd
)

419 
def
 
	$4_rou‹_zeb¿
(
node
, 
vrf_Çme
=
NÚe
):

421 
G‘s
 
ª
 
ouut
 
of
 'show i°rou‹' 
commªd
. 
It
 
ÿn
 
be
 
u£d


422 
w™h
 
com·ršg
 
the
 
ouut
 
to
 
a
 
»ã»nû


424 
vrf_Çme
 =ğ
NÚe
:

425 
tmp
 = 
node
.
	`vtysh_cmd
('show ip„oute')

427 
tmp
 = 
node
.
	`vtysh_cmd
('show i°rou‹ vrà{0}'.
	$fÜm©
(
vrf_Çme
))

428 
ouut
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX", 
tmp
)

429  
ouut


431 
def
 
	$4_rou‹
(
node
):

433 
G‘s
 
a
 
¡ruùu»d
  
of
 
the
 
commªd
 '„ou‹'. 
It
 
ÿn
 
be
 
u£d
 
š


434 
cÚjuùiÚ
 
w™h
 
	$jsÚ_cmp
(è
to
 
´ovide
 
accu¿‹
 
as£¹
 
ex¶ª©iÚs
.

436 
R‘uº
 
exam¶e
:

447 
	}
}

449 
	gouut
 = 
nÜm®ize_‹xt
(
node
.
run
('„ou‹')).
	$¥l™lšes
()

450 
»suÉ
 = {
	}
}

451 
lše
 
š
 
ouut
:

452 
cŞumns
 = 
lše
.
¥l™
(' ')

453 
rou‹
 = 
»suÉ
[
cŞumns
[0]] = {}

454 
´ev
 = 
NÚe


455 
cŞumn
 
š
 
cŞumns
:

456 
´ev
 == 'dev':

457 
rou‹
['dev'] = 
cŞumn


458 
´ev
 == 'via':

459 
rou‹
['vŸ'] = 
cŞumn


460 
´ev
 == 'proto':

461 
rou‹
['´Ùo'] = 
cŞumn


462 
´ev
 == 'metric':

463 
rou‹
['m‘ric'] = 
cŞumn


464 
´ev
 == 'scope':

465 
rou‹
['scİe'] = 
cŞumn


466 
´ev
 = 
cŞumn


468  
»suÉ


470 
def
 
	$6_rou‹
(
node
):

472 
G‘s
 
a
 
¡ruùu»d
  
of
 
the
 
commªd
 ' -6„ou‹'. 
It
 
ÿn
 
be
 
u£d
 
š


473 
cÚjuùiÚ
 
w™h
 
	$jsÚ_cmp
(è
to
 
´ovide
 
accu¿‹
 
as£¹
 
ex¶ª©iÚs
.

475 
R‘uº
 
exam¶e
:

485 
	}
}

487 
ouut
 = 
nÜm®ize_‹xt
(
node
.
run
(' -6„ou‹')).
	$¥l™lšes
()

488 
»suÉ
 = {
	}
}

489 
lše
 
š
 
ouut
:

490 
cŞumns
 = 
lše
.
¥l™
(' ')

491 
rou‹
 = 
»suÉ
[
cŞumns
[0]] = {}

492 
´ev
 = 
NÚe


493 
cŞumn
 
š
 
cŞumns
:

494 
´ev
 == 'dev':

495 
rou‹
['dev'] = 
cŞumn


496 
´ev
 == 'via':

497 
rou‹
['vŸ'] = 
cŞumn


498 
´ev
 == 'proto':

499 
rou‹
['´Ùo'] = 
cŞumn


500 
´ev
 == 'metric':

501 
rou‹
['m‘ric'] = 
cŞumn


502 
´ev
 == 'pref':

503 
rou‹
['´ef'] = 
cŞumn


504 
´ev
 = 
cŞumn


506  
»suÉ


508 
def
 
	$¦“p
(
amouÁ
, 
»asÚ
=
NÚe
):

510 
SË•
 
w¿µ”
 
th©
 
»gi¡”s
 
š
 
the
 
log
h
amouÁ
 
of
 
¦“p


512 
»asÚ
 
is
 
NÚe
:

513 
logg”
.
	`šfo
('SË•šg fÜ {} secÚds'.
	$fÜm©
(
amouÁ
))

515 
logg”
.
	`šfo
(
»asÚ
 + ' ({} secÚds)'.
	$fÜm©
(
amouÁ
))

517 
time
.
	$¦“p
(
amouÁ
)

519 
def
 
	$checkAdd»ssSª™iz”E¼Ü
(
ouut
, 
rou‹r
, 
compÚ’t
):

522 
add»ssSªtiz”E¼Ü
 = 
»
.
	`£¬ch
('(==[0-9]+==)ERROR: Add»ssSª™iz”: ([^\s]*è', 
ouut
)

523 
add»ssSªtiz”E¼Ü
:

524 
sys
.
¡d”r
.
	`wr™e
("%s: % Œigg”ed‡Àexû±iÚ by Add»ssSª™iz”\n" % (
rou‹r
, 
compÚ’t
))

525 #Sª™iz” 
E¼Ü
 
found
 
š
 
log


526 
pidM¬k
 = 
add»ssSªtiz”E¼Ü
.
	$group
(1)

527 
add»ssSªtiz”Log
 = 
»
.
	`£¬ch
('%s(.*)%s' % (
pidM¬k
,…idM¬k), 
ouut
,„e.
DOTALL
)

528 
add»ssSªtiz”Log
:

529 
ÿÎšgTe¡
 = 
os
.
·th
.
	`ba£Çme
(
sys
.
	`_cu¼’t_äames
().
	`v®ues
()[0].
f_back
.f_back.
f_glob®s
['__file__'])

530 
ÿÎšgProc
 = 
sys
.
	`_g‘äame
(2).
f_code
.
co_Çme


531 
w™h
 
	`İ’
("/tmp/Add»ssSª™z”.txt", "a"è
as
 
addrSªFe
:

532 
sys
.
¡d”r
.
	`wr™e
('\n'.
	`još
(
add»ssSªtiz”Log
.
	`group
(1).
	`¥l™lšes
()) + '\n')

533 
addrSªFe
.
	`wr™e
("## E¼Ü: %s\n\n" % 
add»ssSªtiz”E¼Ü
.
	$group
(2))

534 
addrSªFe
.
	`wr™e
("### Add»ssSª™iz”ƒ¼Ü iÀtİÙe¡ `%s`,e¡ `%s`,„ou‹¸`%s`\n\n" % (
ÿÎšgTe¡
, 
ÿÎšgProc
, 
rou‹r
))

535 
addrSªFe
.
	`wr™e
(' '+ '\À '.
	`još
(
add»ssSªtiz”Log
.
	`group
(1).
	`¥l™lšes
()) + '\n')

536 
addrSªFe
.
	`wr™e
("\n---------------\n")

537  
True


538  
F®£


540 
def
 
	$addRou‹r
(
tİo
, 
Çme
):

543 
MyPriv©eDœs
 = ['/etc/frr',

548  
tİo
.
	$addNode
(
Çme
, 
şs
=
Rou‹r
, 
´iv©eDœs
=
MyPriv©eDœs
)

550 
def
 
	$£t_sysùl
(
node
, 
sysùl
, 
v®ue
):

552 
v®ue¡r
 = '{}'.
	$fÜm©
(
v®ue
)

553 
commªd
 = "sysùÈ{0}={1}".
	$fÜm©
(
sysùl
, 
v®ue¡r
)

554 
cmd»t
 = 
node
.
	$cmd
(
commªd
)

556 
m©ches
 = 
»
.
	`£¬ch
(
r
'([^ ]+èğ([^\s]+)', 
cmd»t
)

557 
m©ches
 
is
 
NÚe
:

558  
cmd»t


559 
m©ches
.
	`group
(1è!ğ
sysùl
:

560  
cmd»t


561 
m©ches
.
	`group
(2è!ğ
v®ue¡r
:

562  
cmd»t


564  
NÚe


566 
def
 
	$as£¹_sysùl
(
node
, 
sysùl
, 
v®ue
):

568 
as£¹
 
	$£t_sysùl
(
node
, 
sysùl
, 
v®ue
è
is
 
NÚe


570 
şass
 
	$LšuxRou‹r
(
Node
):

573 
def
 
	$cÚfig
(
£lf
, **
·¿ms
):

574 
	`su³r
(
LšuxRou‹r
, 
£lf
).
	$cÚfig
(**
·¿ms
)

575 #EÇbË 
fÜw¬dšg
 
Ú
 
the
 
rou‹r


576 
	`as£¹_sysùl
(
£lf
, 'net.ipv4.ip_forward', 1)

577 
	`as£¹_sysùl
(
£lf
, 'net.ipv6.conf.all.forwarding', 1)

578 
def
 
	$‹rmš©e
(
£lf
):

580 
T”mš©e
 
g’”ic
 
LšuxRou‹r
 
Mšš‘
 
š¡ªû


582 
	`£t_sysùl
(
£lf
, 'net.ipv4.ip_forward', 0)

583 
	`£t_sysùl
(
£lf
, 'net.ipv6.conf.all.forwarding', 0)

584 
	`su³r
(
LšuxRou‹r
, 
£lf
).
	$‹rmš©e
()

586 
şass
 
	$Rou‹r
(
Node
):

589 
def
 
	$__š™__
(
£lf
, 
Çme
, **
·¿ms
):

590 
	`su³r
(
Rou‹r
, 
£lf
).
	$__š™__
(
Çme
, **
·¿ms
)

591 
£lf
.
logdœ
 = 
·¿ms
.
	`g‘
('logdœ', 
	$g‘_‹¡_logdœ
(
Çme
, 
True
))

592 
£lf
.
d«mÚdœ
 = 
NÚe


593 
£lf
.
hasm¶s
 = 
F®£


594 
£lf
.
rou‹¹y³
 = 'frr'

595 
£lf
.
d«mÚs
 = {'zebra': 0, 'ripd': 0, 'ripngd': 0, 'ospfd': 0,

597 'ldpd': 0, 'eig½d': 0, 'nh½d': 0, '¡©icd': 0
	}
}

598 
£lf
.
d«mÚs_İtiÚs
 = {'zebra': ''}

599 
£lf
.
»pÜtCÜes
 = 
True


600 
£lf
.
v”siÚ
 = 
NÚe


602 
def
 
	$_cÚfig_är
(
£lf
, **
·¿ms
):

604 
£lf
.
d«mÚdœ
 = 
·¿ms
.
	`g‘
('frrdir')

605 
£lf
.
d«mÚdœ
 
is
 
NÚe
:

606 
£lf
.
d«mÚdœ
 = '/usr/lib/frr'

608 
zeb¿_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'zebra')

609 
nÙ
 
os
.
·th
.
	$isfe
(
zeb¿_·th
):

610 
¿i£
 
	`Exû±iÚ
("FRR zeb¿ bš¬y dÛ¢'ˆexi¡‡ˆ{}".
	$fÜm©
(
zeb¿_·th
))

612 
def
 
	$_cÚfig_quagga
(
£lf
, **
·¿ms
):

614 
£lf
.
d«mÚdœ
 = 
·¿ms
.
	`g‘
('quaggadir')

615 
£lf
.
d«mÚdœ
 
is
 
NÚe
:

616 
£lf
.
d«mÚdœ
 = '/usr/lib/quagga'

618 
zeb¿_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'zebra')

619 
nÙ
 
os
.
·th
.
	$isfe
(
zeb¿_·th
):

620 
¿i£
 
	`Exû±iÚ
("Quagg¨zeb¿ bš¬y dÛ¢'ˆexi¡‡ˆ{}".
	$fÜm©
(
zeb¿_·th
))

622 #pylšt: 
di§bË
=
W0221


623 #Som
·¿ms
 
¬e
 
Úly
 
m—nšgful
 
the
 
·»Á
 
şass
.

624 
def
 
	$cÚfig
(
£lf
, **
·¿ms
):

625 
	`su³r
(
Rou‹r
, 
£lf
).
	$cÚfig
(**
·¿ms
)

627 #U£¸
did
 
nÙ
 
¥ecify
 
the
 
d«mÚs
 
dœeùÜy
, 
Œy
 
to
 
autod‘eù
 
™
.

628 
£lf
.
d«mÚdœ
 = 
·¿ms
.
	`g‘
('daemondir')

629 
£lf
.
d«mÚdœ
 
is
 
NÚe
:

630 
£lf
.
rou‹¹y³
 = 
·¿ms
.
	`g‘
('routertype', 'frr')

631 
£lf
.
rou‹¹y³
 == 'quagga':

632 
£lf
.
	$_cÚfig_quagga
(**
·¿ms
)

634 
£lf
.
	$_cÚfig_är
(**
·¿ms
)

636 #Te¡ 
the
 
´ovided
 
·th


637 
z·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'zebra')

638 
nÙ
 
os
.
·th
.
	$isfe
(
z·th
):

639 
¿i£
 
	`Exû±iÚ
('NØzeb¿ bš¬y found iÀ{}'.
	$fÜm©
(
z·th
))

640 #AÎow 
u£r
 
to
 
¥ecify
 
rou‹¹y³
 
wh’
 
the
 
·th
 
was
 
¥ecif›d
.

641 
·¿ms
.
	`g‘
('rou‹¹y³'è
is
 
nÙ
 
NÚe
:

642 
£lf
.
rou‹¹y³
 = s–f.
·¿ms
.
	`g‘
('routertype')

644 #EÇbË 
fÜw¬dšg
 
Ú
 
the
 
rou‹r


645 
	`as£¹_sysùl
(
£lf
, 'net.ipv4.ip_forward', 1)

646 
	`as£¹_sysùl
(
£lf
, 'net.ipv6.conf.all.forwarding', 1)

647 #EÇbË 
cÜedumps


648 
	`as£¹_sysùl
(
£lf
, 'kernel.core_uses_pid', 1)

649 
	`as£¹_sysùl
(
£lf
, 'fs.suid_dumpable', 1)

650 #thi 
­¶›s
 
to
 
the
 
k”Ãl
 
nÙ
h
Çme¥aû
...

651 #Üigš® 
Ú
 
ubuÁu
 17.x, 
but
 
­pÜt
 
wÚ
't save‡s in‚amespace

652 #|/
u¤
/
sh¬e
/
­pÜt
/­pÜˆ%
p
 %
s
 %
c
 %
d
 %
P


653 
cÜefe
 = '%e_core-sig_%s-pid_%p.dmp'

654 
	`as£¹_sysùl
(
£lf
, 'k”Ãl.cÜe_·‰”n', 
cÜefe
)

655 
£lf
.
	`cmd
('ulimit -c unlimited')

656 #S‘ 
owÃrsh
 
of
 
cÚfig
 
fes


657 
£lf
.
	`cmd
('chowÀ{0}:{0}vty /‘c/{0}'.
	$fÜm©
(
£lf
.
rou‹¹y³
))

659 
def
 
	$‹rmš©e
(
£lf
):

660 #D–‘
RuÂšg
 
Quagga
 
Ü
 
FRR
 
D«mÚs


661 
£lf
.
	$¡İRou‹r
()

662 #rund«mÚ ğ
£lf
.
	`cmd
('l -1 /v¬/run/%s/*.pid' % s–f.
rou‹¹y³
)

663 #fÜ 
d
 
š
 
SŒšgIO
.
	`SŒšgIO
(
rund«mÚs
):

664 #£lf.
	`cmd
('kÈ-7 `ÿˆ%s`' % 
d
.
	`r¡r
())

665 #£lf.
	`wa™Ouut
()

666 #Di§bË 
fÜw¬dšg


667 
	`£t_sysùl
(
£lf
, 'net.ipv4.ip_forward', 0)

668 
	`£t_sysùl
(
£lf
, 'net.ipv6.conf.all.forwarding', 0)

669 
	`su³r
(
Rou‹r
, 
£lf
).
	$‹rmš©e
()

670 
os
.
	`sy¡em
('chmod -R go+rw /tmp/topotests')

672 
def
 
	`¡İRou‹r
(
£lf
, 
wa™
=
True
, 
as£¹OnE¼Ü
=True, 
mšE¼ÜV”siÚ
='5.1'):

673 #Stİ 
RuÂšg
 
Quagga
 
Ü
 
FRR
 
D«mÚs


674 
rund«mÚs
 = 
£lf
.
	`cmd
('l -1 /v¬/run/%s/*.pid' % s–f.
rou‹¹y³
)

675 
”rÜs
 = ""

676 
»
.
	`£¬ch
(
r
"NØsuch fÜ dœeùÜy", 
rund«mÚs
):

677  
”rÜs


678 
rund«mÚs
 
is
 
nÙ
 
NÚe
:

679 
numRuÂšg
 = 0

680 
d
 
š
 
SŒšgIO
.
	$SŒšgIO
(
rund«mÚs
):

681 
d«mÚpid
 = 
£lf
.
	`cmd
('ÿˆ%s' % 
d
.
	`r¡r
()).
	$r¡r
()

682 ià(
d«mÚpid
.
	$isdig™
(è
ªd
 
	`pid_exi¡s
((
d«mÚpid
))):

683 
logg”
.
	`šfo
('{}: stİpšg {}'.
	`fÜm©
(

684 
£lf
.
Çme
,

685 
os
.
·th
.
	`ba£Çme
(
d
.
	`r¡r
().
	`r¥l™
(".", 1)[0])

687 
£lf
.
	`cmd
('kÈ-TERM %s' % 
d«mÚpid
)

688 
£lf
.
	$wa™Ouut
()

689 
	`pid_exi¡s
((
d«mÚpid
)):

690 
numRuÂšg
 += 1

691 
wa™
 
ªd
 
numRuÂšg
 > 0:

692 
	`¦“p
(2, '{}: wa™šg fÜ d«mÚ ¡İpšg'.
	$fÜm©
(
£lf
.
Çme
))

693 #2
nd
 
round
 
of
 
kl
 
d«mÚs
 
didn
'tƒxit

694 
d
 
š
 
SŒšgIO
.
	$SŒšgIO
(
rund«mÚs
):

695 
d«mÚpid
 = 
£lf
.
	`cmd
('ÿˆ%s' % 
d
.
	`r¡r
()).
	$r¡r
()

696 ià(
d«mÚpid
.
	$isdig™
(è
ªd
 
	`pid_exi¡s
((
d«mÚpid
))):

697 
logg”
.
	`šfo
('{}: klšg {}'.
	`fÜm©
(

698 
£lf
.
Çme
,

699 
os
.
·th
.
	`ba£Çme
(
d
.
	`r¡r
().
	`r¥l™
(".", 1)[0])

701 
£lf
.
	`cmd
('kÈ-7 %s' % 
d«mÚpid
)

702 
£lf
.
	$wa™Ouut
()

703 
£lf
.
	`cmd
('rm -- {}'.
	`fÜm©
(
d
.
	$r¡r
()))

704 
wa™
:

705 
”rÜs
 = 
£lf
.
	$checkRou‹rCÜes
(
»pÜtOnû
=
True
)

706 
£lf
.
	`checkRou‹rV”siÚ
('<', 
mšE¼ÜV”siÚ
):

707 #ignÜ
”rÜs
 
š
 
Şd
 
v”siÚs


708 
”rÜs
 = ""

709 
as£¹OnE¼Ü
 
ªd
 
	`Ën
(
”rÜs
) > 0:

710 
as£¹
 "E¼Ü found - d‘a fŞlow:" =ğ0, 
”rÜs


711  
”rÜs


713 
def
 
	$»moveIPs
(
£lf
):

714 
š‹rçû
 
š
 
£lf
.
	$štfNames
():

715 
£lf
.
	`cmd
('‡dd»s æush', 
š‹rçû
)

717 
def
 
	$checkC­ab™y
(
£lf
, 
d«mÚ
, 
·¿m
):

718 
·¿m
 
is
 
nÙ
 
NÚe
:

719 
d«mÚ_·th
 = 
os
.
·th
.
	$još
(
£lf
.
d«mÚdœ
, 
d«mÚ
)

720 
d«mÚ_£¬ch_İtiÚ
 = 
·¿m
.
	`»¶aû
('-','')

721 
ouut
 = 
£lf
.
	`cmd
('{0} -h | g»°{1}'.
	$fÜm©
(

722 
d«mÚ_·th
, 
d«mÚ_£¬ch_İtiÚ
))

723 
d«mÚ_£¬ch_İtiÚ
 
nÙ
 
š
 
ouut
:

724  
F®£


725  
True


727 
def
 
	$lßdCÚf
(
£lf
, 
d«mÚ
, 
sourû
=
NÚe
, 
·¿m
=None):

728 #´šˆ"D«mÚ befÜe:", 
£lf
.
d«mÚs


729 
d«mÚ
 
š
 
£lf
.
d«mÚs
.
	$keys
():

730 
£lf
.
d«mÚs
[
d«mÚ
] = 1

731 
·¿m
 
is
 
nÙ
 
NÚe
:

732 
£lf
.
d«mÚs_İtiÚs
[
d«mÚ
] = 
·¿m


733 
sourû
 
is
 
NÚe
:

734 
£lf
.
	`cmd
('touch /‘c/%s/%s.cÚf' % (£lf.
rou‹¹y³
, 
d«mÚ
))

735 
£lf
.
	$wa™Ouut
()

737 
£lf
.
	`cmd
('ı % /‘c/%s/%s.cÚf' % (
sourû
, s–f.
rou‹¹y³
, 
d«mÚ
))

738 
£lf
.
	$wa™Ouut
()

739 
£lf
.
	`cmd
('chmod 640 /‘c/%s/%s.cÚf' % (£lf.
rou‹¹y³
, 
d«mÚ
))

740 
£lf
.
	$wa™Ouut
()

741 
£lf
.
	`cmd
('chowÀ%s:% /‘c/%s/%s.cÚf' % (£lf.
rou‹¹y³
, s–f.rou‹¹y³, s–f.rou‹¹y³, 
d«mÚ
))

742 
£lf
.
	$wa™Ouut
()

743 ià(
d«mÚ
 =ğ'zeb¿'è
	`ªd
 (
£lf
.
d«mÚs
['staticd'] == 0):

744 #Add 
¡©icd
 
w™h
 
zeb¿
 - 
™
 
exi¡s


745 
¡©icd_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'staticd')

746 
os
.
·th
.
	$isfe
(
¡©icd_·th
):

747 
£lf
.
d«mÚs
['staticd'] = 1

748 
£lf
.
d«mÚs_İtiÚs
['staticd'] = ''

749 #Auto-
S¹ed
 
¡©icd
 
has
 
no
 
cÚfig
, 
so
 
™
 
wl
 
»ad
 
äom
 
zeb¿
 config

751 
logg”
.
	`šfo
('NØd«mÚ {} known'.
	$fÜm©
(
d«mÚ
))

752 #´šˆ"D«mÚ aá”:", 
£lf
.
d«mÚs


754 
def
 
	$¡¬tRou‹r
(
£lf
, 
tg’
=
NÚe
):

755 #Di§bË 
š‹g¿‹d
-
vtysh
-
cÚfig


756 
£lf
.
	`cmd
('echØ"nØ£rviû iÁeg¿‹d-vtysh-cÚfig" >> /‘c/%s/vtysh.cÚf' % s–f.
rou‹¹y³
)

757 
£lf
.
	`cmd
('chowÀ%s:%svty /‘c/%s/vtysh.cÚf' % (£lf.
rou‹¹y³
, self.routertype, self.routertype))

758 #TODO 
»move
 
the
 
fŞlowšg
 
lšes
 
aá”
 
®l
 
‹¡s
 
¬e
 
mig¿‹d
 
to
 
Tİog’
.

759 #Try 
to
 
fšd
 
»Ëvªt
 
Şd
 
logfes
 
š
 /
tmp
 
ªd
 
d–‘e
 
them


760 
	`m­
(
os
.
»move
, 
glob
.
	`glob
('{}/{}/*.log'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
)))

761 #Remov
Şd
 
cÜe
 
fes


762 
	`m­
(
os
.
»move
, 
glob
.
	`glob
('{}/{}/*.dmp'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
)))

763 #Remov
IP
 
add»s£s
 
äom
 
OS
 
fœ¡
 - 
we
 
have
 
them
 
š
 
zeb¿
.
cÚf


764 
£lf
.
	$»moveIPs
()

765 #Ià
ldp
 
is
 
u£d
, 
check
 
LDP
 
to
 
be
 
comped
 
ªd
 
Lšux
 
K”Ãl
Øb4.5 
Ü
 
high”


766 #NØ
”rÜ
 - 
but
  
mes§ge
 
ªd
 
sk
 
®l
 
the
 
‹¡s


767 
£lf
.
d«mÚs
['ldpd'] == 1:

768 
ldpd_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'ldpd')

769 
nÙ
 
os
.
·th
.
	$isfe
(
ldpd_·th
):

770 
logg”
.
	`šfo
("LDP Test, but‚o†dpd compiled or installed")

773 
	`v”siÚ_cmp
(
¶©fÜm
.
	`»Ëa£
(), '4.5') < 0:

774 
logg”
.
	`šfo
("LDP Test‚eed Linux Kernel 4.5 minimum")

776 #Check 
have
 
m¶s


777 
tg’
 !ğ
NÚe
:

778 
£lf
.
hasm¶s
 = 
tg’
.hasmpls

779 
£lf
.
hasm¶s
 !ğ
True
:

780 
logg”
.
	`šfo
("LDP/MPLS Tests will be skipped,…latform missing module(s)")

782 #Te¡ 
MPLS
 
K”Ãl
 
moduËs
 
avaabË


783 
£lf
.
hasm¶s
 = 
F®£


784 
nÙ
 
	`moduË_´e£Á
('mpls-router'):

785 
logg”
.
	`šfo
('MPLSests will‚ot„un (missing mpls-router kernel module)')

786 
–if
 
nÙ
 
	`moduË_´e£Á
('mpls-iptunnel'):

787 
logg”
.
	`šfo
('MPLSests will‚ot„un (missing mpls-iptunnel kernel module)')

789 
£lf
.
hasm¶s
 = 
True


790 
£lf
.
hasm¶s
 !ğ
True
:

792 
£lf
.
	`cmd
('echo 100000 > /proc/sys/net/mpls/platform_labels')

794 
£lf
.
d«mÚs
['eigrpd'] == 1:

795 
eig½d_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'eigrpd')

796 
nÙ
 
os
.
·th
.
	$isfe
(
eig½d_·th
):

797 
logg”
.
	`šfo
("EIGRP Test, but‚oƒigrpd compiled or installed")

800 
£lf
.
	$»¡¬tRou‹r
()

803 
def
 
	$»¡¬tRou‹r
(
£lf
):

804 #S¹ 
aùu®
 
d«mÚs
 
w™hout
 
	`š™
 (
›
 
»¡¬t
)

805 #cd 
to
 
³r
 
node
 
dœeùÜy


806 
£lf
.
	`cmd
('cd {}/{}'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
))

807 
£lf
.
	`cmd
('umask 000')

808 #Re-
’abË
 
to
 
®low
 
»pÜt
 
³r
 
run


809 
£lf
.
»pÜtCÜes
 = 
True


810 
£lf
.
v”siÚ
 =ğ
NÚe
:

811 
£lf
.
v”siÚ
 = s–f.
	`cmd
(
os
.
·th
.
	`još
(£lf.
d«mÚdœ
, 'bgpd')+' -v').
	`¥l™
()[2]

812 
logg”
.
	`šfo
('{}:„uÂšg v”siÚ: {}'.
	$fÜm©
(
£lf
.
Çme
,£lf.
v”siÚ
))

813 #S¹ 
Zeb¿
 
fœ¡


814 
£lf
.
d«mÚs
['zebra'] == 1:

815 
zeb¿_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'zebra')

816 
zeb¿_İtiÚ
 = 
£lf
.
d«mÚs_İtiÚs
['zebra']

817 
£lf
.
	`cmd
('{0} {1} > zeb¿.ouˆ2> zeb¿.”¸&'.
	$fÜm©
(

818 
zeb¿_·th
, 
zeb¿_İtiÚ
, 
£lf
.
logdœ
, s–f.
Çme


820 
£lf
.
	$wa™Ouut
()

821 
logg”
.
	`debug
('{}: {} zeb¿ s¹ed'.
	$fÜm©
(
£lf
, s–f.
rou‹¹y³
))

822 
	`¦“p
(1, '{}: wa™šg fÜ zeb¿Ø¡¬t'.
	$fÜm©
(
£lf
.
Çme
))

823 #S¹ 
¡©icd
 
Ãxt
 
»quœed


824 
£lf
.
d«mÚs
['staticd'] == 1:

825 
¡©icd_·th
 = 
os
.
·th
.
	`još
(
£lf
.
d«mÚdœ
, 'staticd')

826 
¡©icd_İtiÚ
 = 
£lf
.
d«mÚs_İtiÚs
['staticd']

827 
£lf
.
	`cmd
('{0} {1} > sticd.ouˆ2> sticd.”¸&'.
	$fÜm©
(

828 
¡©icd_·th
, 
¡©icd_İtiÚ
, 
£lf
.
logdœ
, s–f.
Çme


830 
£lf
.
	$wa™Ouut
()

831 
logg”
.
	`debug
('{}: {} sticd s¹ed'.
	$fÜm©
(
£lf
, s–f.
rou‹¹y³
))

832 
	`¦“p
(1, '{}: wa™šg fÜ sticdØ¡¬t'.
	$fÜm©
(
£lf
.
Çme
))

833 #Fix 
Lšk
-
Loÿl
 
Add»s£s


834 #Somehow (
Ú
 
Mšš‘
 
Úly
), 
Zeb¿
 
»moves
 
the
 
IPv6
 
Lšk
-
Loÿl
 
add»s£s
 oÀ
¡¬t
. 
Fix
 
this


835 
£lf
.
	`cmd
('for i in `ls /sys/class/net/` ; do mac=`cat /sys/class/net/$i/address`; IFS=\':\'; set $mac; unset IFS; ip‡ddress‡dd dev $i scope†ink fe80::$(printf %02x $((0x$1 ^ 2)))$2:${3}ff:fe$4:$5$6/64; done')

836 #Now 
¡¬t
 
®l
 
the
 
Ùh”
 
d«mÚs


837 
d«mÚ
 
š
 
£lf
.
d«mÚs
:

838 #Sk 
di§bËd
 
d«mÚs
 
ªd
 
zeb¿


839 
£lf
.
d«mÚs
[
d«mÚ
] =ğ0 
Ü
 daemon == 'zebra' or daemon == 'staticd':

841 
d«mÚ_·th
 = 
os
.
·th
.
	$još
(
£lf
.
d«mÚdœ
, 
d«mÚ
)

842 
£lf
.
	`cmd
('{0} > {3}.ouˆ2> {3}.”¸&'.
	$fÜm©
(

843 
d«mÚ_·th
, 
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ


845 
£lf
.
	$wa™Ouut
()

846 
logg”
.
	`debug
('{}: {} {} s¹ed'.
	$fÜm©
(
£lf
, s–f.
rou‹¹y³
, 
d«mÚ
))

847 
def
 
	$g‘StdE¼
(
£lf
, 
d«mÚ
):

848  
£lf
.
	`g‘Log
('”r', 
d«mÚ
)

849 
def
 
	$g‘StdOut
(
£lf
, 
d«mÚ
):

850  
£lf
.
	`g‘Log
('out', 
d«mÚ
)

851 
def
 
	$g‘Log
(
£lf
, 
log
, 
d«mÚ
):

852  
£lf
.
	`cmd
('ÿˆ{}/{}/{}.{}'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ
, 
log
))

854 
def
 
	$checkRou‹rCÜes
(
£lf
, 
»pÜtL—ks
=
True
, 
»pÜtOnû
=
F®£
):

855 
»pÜtOnû
 
ªd
 
nÙ
 
£lf
.
»pÜtCÜes
:

857 
»pÜtMade
 = 
F®£


858 
Œaûs
 = ""

859 
d«mÚ
 
š
 
£lf
.
d«mÚs
:

860 ià(
£lf
.
d«mÚs
[
d«mÚ
] == 1):

861 #Look 
cÜe
 
fe


862 
cÜefes
 = 
glob
.
	`glob
('{}/{}/{}_cÜe*.dmp'.
	$fÜm©
(

863 
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ
))

864 ià(
	`Ën
(
cÜefes
) > 0):

865 
d«mÚ_·th
 = 
os
.
·th
.
	$još
(
£lf
.
d«mÚdœ
, 
d«mÚ
)

866 
backŒaû
 = 
sub´oûss
.
	`check_ouut
([

867 "gdb {} {} --b©ch -ex bˆ2> /dev/nuÎ".
	`fÜm©
(
d«mÚ_·th
, 
cÜefes
[0])

868 ], 
sh–l
=
True
)

869 
sys
.
¡d”r
.
	`wr™e
("\n%s: % üashed. CÜffound - BackŒaû fŞlows:\n" % (
£lf
.
Çme
, 
d«mÚ
))

870 
sys
.
¡d”r
.
	`wr™e
("%s" % 
backŒaû
)

871 
Œaûs
 =¿û + "\n%s: % üashed. CÜffound - BackŒaû fŞlows:\n%s" % (
£lf
.
Çme
, 
d«mÚ
, 
backŒaû
)

872 
»pÜtMade
 = 
True


873 
–if
 
»pÜtL—ks
:

874 
log
 = 
£lf
.
	$g‘StdE¼
(
d«mÚ
)

875 "mem¡©s" 
š
 
log
:

876 
sys
.
¡d”r
.
	`wr™e
("%s: % ha memÜy†—ks:\n" % (
£lf
.
Çme
, 
d«mÚ
))

877 
Œaûs
 =¿û + "\n%s: % ha memÜy†—ks:\n" % (
£lf
.
Çme
, 
d«mÚ
)

878 
log
 = 
»
.
	`sub
("core_handler: ", "",†og)

879 
log
 = 
»
.
	`sub
(
r
"(showing‡ctive‡llocations in memory group [a-zA-Z0-9]+)",„"\n ## \1",†og)

880 
log
 = 
»
.
	`sub
("memstats: ", " ",†og)

881 
sys
.
¡d”r
.
	$wr™e
(
log
)

882 
»pÜtMade
 = 
True


883 #Look 
Add»ssSª™iz”
 
E¼Üs
 
ªd
 
­³nd
 
to
 /
tmp
/
Add»ssSª™z”
.
txt
 
found


884 
	`checkAdd»ssSª™iz”E¼Ü
(
£lf
.
	`g‘StdE¼
(
d«mÚ
), s–f.
Çme
, daemon):

885 
sys
.
¡d”r
.
	`wr™e
("%s: D«mÚ % kËd by Add»ssSª™iz”" % (
£lf
.
Çme
, 
d«mÚ
))

886 
Œaûs
 =¿û + "\n%s: D«mÚ % kËd by Add»ssSª™iz”" % (
£lf
.
Çme
, 
d«mÚ
)

887 
»pÜtMade
 = 
True


888 
»pÜtMade
:

889 
£lf
.
»pÜtCÜes
 = 
F®£


890  
Œaûs


892 
def
 
	$checkRou‹rRuÂšg
(
£lf
):

895 
glob®
 
çl_”rÜ


897 
d«mÚsRuÂšg
 = 
£lf
.
	`cmd
('vtysh -c "show†og" | grep "Logging configuration for"')

898 #Look 
Add»ssSª™iz”
 
E¼Üs
 
š
 
vtysh
 
ouut
 
ªd
 
­³nd
 
to
 /
tmp
/
Add»ssSª™z”
.
txt
 
found


899 
	`checkAdd»ssSª™iz”E¼Ü
(
d«mÚsRuÂšg
, 
£lf
.
Çme
, "vtysh"):

900  "%s: vtysh kËd by Add»ssSª™iz”" % (
£lf
.
Çme
)

902 
d«mÚ
 
š
 
£lf
.
d«mÚs
:

903 
	`v”siÚ_cmp
(
¶©fÜm
.
	`»Ëa£
(), '4.5'è< 0 
ªd
 
d«mÚ
 == 'staticd':

906 ià(
£lf
.
d«mÚs
[
d«mÚ
] =ğ1è
ªd
 
	$nÙ
 (
d«mÚ
 
š
 
d«mÚsRuÂšg
):

907 
sys
.
¡d”r
.
	`wr™e
("%s: D«mÚ % nÙ„uÂšg\n" % (
£lf
.
Çme
, 
d«mÚ
))

908 
d«mÚ
 
is
 "staticd":

909 
sys
.
¡d”r
.
	`wr™e
("You may have‡ copy of staticd installed but‡re‡ttemptingoest‡gainst\n")

910 
sys
.
¡d”r
.
	`wr™e
("a version of FRRhat does‚ot have staticd,…lease cleanuphe install dir\n")

912 #Look 
cÜe
 
fe


913 
cÜefes
 = 
glob
.
	`glob
('{}/{}/{}_cÜe*.dmp'.
	$fÜm©
(

914 
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ
))

915 ià(
	`Ën
(
cÜefes
) > 0):

916 
d«mÚ_·th
 = 
os
.
·th
.
	$još
(
£lf
.
d«mÚdœ
, 
d«mÚ
)

917 
backŒaû
 = 
sub´oûss
.
	`check_ouut
([

918 "gdb {} {} --b©ch -ex bˆ2> /dev/nuÎ".
	`fÜm©
(
d«mÚ_·th
, 
cÜefes
[0])

919 ], 
sh–l
=
True
)

920 
sys
.
¡d”r
.
	`wr™e
("\n%s: % üashed. CÜffound - BackŒaû fŞlows:\n" % (
£lf
.
Çme
, 
d«mÚ
))

921 
sys
.
¡d”r
.
	`wr™e
("%s\n" % 
backŒaû
)

923 #NØ
cÜe
 
found
 - 
If
 
we
 
fšd
 
m©chšg
 
logfe
 
š
 /
tmp
, 
th’
 
´št
 
Ï¡
 20 
lšes
 
äom
 
™
.

924 
os
.
·th
.
	`isfe
('{}/{}/{}.log'.
	$fÜm©
(
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ
)):

925 
log_
 = 
sub´oûss
.
	`check_ouut
([

926 " -n20 {}/{}/{}.log 2> /dev/nuÎ".
	`fÜm©
(

927 
£lf
.
logdœ
, s–f.
Çme
, 
d«mÚ
)

928 ], 
sh–l
=
True
)

929 
sys
.
¡d”r
.
	`wr™e
("\nFrom % % % log fe:\n" % (
£lf
.
rou‹¹y³
, s–f.
Çme
, 
d«mÚ
))

930 
sys
.
¡d”r
.
	`wr™e
("%s\n" % 
log_
)

932 #Look 
Add»ssSª™iz”
 
E¼Üs
 
ªd
 
­³nd
 
to
 /
tmp
/
Add»ssSª™z”
.
txt
 
found


933 
	`checkAdd»ssSª™iz”E¼Ü
(
£lf
.
	`g‘StdE¼
(
d«mÚ
), s–f.
Çme
, daemon):

934  "%s: D«mÚ % nÙ„uÂšg - kËd by Add»ssSª™iz”" % (
£lf
.
Çme
, 
d«mÚ
)

936  "%s: D«mÚ % nÙ„uÂšg" % (
£lf
.
Çme
, 
d«mÚ
)

939 
def
 
	$checkRou‹rV”siÚ
(
£lf
, 
cmpİ
, 
v”siÚ
):

941 
Com·»s
 
rou‹r
 
v”siÚ
 
usšg
 
İ”©iÚ
 `
cmpİ
` 
w™h
 `version`.

942 
V®id
 `
cmpİ
` 
v®ues
:

943 * `>=`: 
has
 
the
 
§me
 
v”siÚ
 
Ü
 
g»©”


944 * '>': 
has
 
g»©”
 
v”siÚ


945 * '=': 
has
 
the
 
§me
 
v”siÚ


946 * '<': 
has
 
a
 
Ës£r
 
v”siÚ


947 * '<=': 
has
 
the
 
§me
 
v”siÚ
 
Ü
 
Ës£r


949 
U§ge
 
exam¶e
: 
rou‹r
.
	`checkRou‹rV”siÚ
('>', '1.0')

951 
rv”siÚ
 = 
£lf
.
v”siÚ


952 
rv”siÚ
 
is
 
NÚe
:

953  
F®£


955 
»suÉ
 = 
	$v”siÚ_cmp
(
rv”siÚ
, 
v”siÚ
)

956 
cmpİ
 == '>=':

957  
»suÉ
 >= 0

958 
cmpİ
 == '>':

959  
»suÉ
 > 0

960 
cmpİ
 == '=':

961  
»suÉ
 == 0

962 
cmpİ
 == '<':

963  
»suÉ
 < 0

964 
cmpİ
 == '<':

965  
»suÉ
 < 0

966 
cmpİ
 == '<=':

967  
»suÉ
 <= 0

969 
def
 
	$g‘_v6_lškloÿl
(
£lf
):

972 
lškloÿl
 = []

974 
içûs
 = 
£lf
.
	`cmd
('ip -6‡ddress')

975 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

976 
içûs
 = ('\n'.
	`još
(içûs.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
()

977 
š‹rçû
=""

978 
Î_³r_if_couÁ
=0

979 
lše
 
š
 
içûs
:

980 
m
 = 
»
.
	`£¬ch
('[0-9]+: ([^:@]+)[@if0-9:]+ <', 
lše
)

981 
m
:

982 
š‹rçû
 = 
m
.
	$group
(1)

983 
Î_³r_if_couÁ
 = 0

984 
m
 = 
»
.
	`£¬ch
('š‘6 (ã80::[0-9a-f]+:[0-9a-f]+:[0-9a-f]+:[0-9a-f]+)[/0-9]* scİlšk', 
lše
)

985 
m
:

986 
loÿl
 = 
m
.
	$group
(1)

987 
Î_³r_if_couÁ
 += 1

988 ià(
Î_³r_if_couÁ
 > 1):

989 
lškloÿl
 +ğ[["%s-%s" % (
š‹rçû
, 
Î_³r_if_couÁ
), 
loÿl
]]

991 
lškloÿl
 +ğ[[
š‹rçû
, 
loÿl
]]

992  
lškloÿl


993 
def
 
	$d«mÚ_avaabË
(
£lf
, 
d«mÚ
):

996 
d«mÚ_·th
 = 
os
.
·th
.
	$još
(
£lf
.
d«mÚdœ
, 
d«mÚ
)

997 
nÙ
 
os
.
·th
.
	$isfe
(
d«mÚ_·th
):

998  
F®£


999 ià(
d«mÚ
 == 'ldpd'):

1000 
	`v”siÚ_cmp
(
¶©fÜm
.
	`»Ëa£
(), '4.5') < 0:

1001  
F®£


1002 
nÙ
 
	`moduË_´e£Á
('m¶s-rou‹r', 
lßd
=
F®£
):

1003  
F®£


1004 
nÙ
 
	`moduË_´e£Á
('m¶s-tuÂ–', 
lßd
=
F®£
):

1005  
F®£


1006  
True


1008 
def
 
	$g‘_rou‹¹y³
(
£lf
):

1011  
£lf
.
rou‹¹y³


1012 
def
 
	$»pÜt_memÜy_Ëaks
(
£lf
, 
f’ame_´efix
, 
‹¡süt
):

1015 
Ëakfound
 = 
F®£


1016 
f’ame
 = 
f’ame_´efix
 + 
»
.
	`sub
(
r
"\.py", "", 
‹¡süt
) + ".txt"

1017 
d«mÚ
 
š
 
£lf
.
d«mÚs
:

1018 ià(
£lf
.
d«mÚs
[
d«mÚ
] == 1):

1019 
log
 = 
£lf
.
	$g‘StdE¼
(
d«mÚ
)

1020 "mem¡©s" 
š
 
log
:

1021 #Found 
memÜy
 
Ëak


1022 
logg”
.
	`šfo
('\nRou‹¸{} {} StdE¼ Log:\n{}'.
	$fÜm©
(

1023 
£lf
.
Çme
, 
d«mÚ
, 
log
))

1024 
nÙ
 
Ëakfound
:

1025 
Ëakfound
 = 
True


1026 #Check 
fe
 
®»ady
 
exi¡s


1027 
f“xi¡s
 = 
os
.
·th
.
	$isfe
(
f’ame
)

1028 
Ëakfe
 = 
	`İ’
(
f’ame
, "a")

1029 
nÙ
 
f“xi¡s
:

1030 #New 
fe
 - 
add
 
h—d”


1031 
Ëakfe
.
	`wr™e
("# MemÜy L—k D‘eùiÚ fÜİÙe¡ %s\n\n" % 
‹¡süt
)

1032 
Ëakfe
.
	`wr™e
("## Rou‹¸%s\n" % 
£lf
.
Çme
)

1033 
Ëakfe
.
	`wr™e
("### Proûs %s\n" % 
d«mÚ
)

1034 
log
 = 
»
.
	`sub
("core_handler: ", "",†og)

1035 
log
 = 
»
.
	`sub
(
r
"(showing‡ctive‡llocations in memory group [a-zA-Z0-9]+)",„"\n#### \1\n",†og)

1036 
log
 = 
»
.
	`sub
("memstats: ", " ",†og)

1037 
Ëakfe
.
	$wr™e
(
log
)

1038 
Ëakfe
.
	`wr™e
("\n")

1039 
Ëakfound
:

1040 
Ëakfe
.
	$şo£
()

1043 
şass
 
	$LegacySw™ch
(
OVSSw™ch
):

1046 
def
 
	$__š™__
(
£lf
, 
Çme
, **
·¿ms
):

1047 
OVSSw™ch
.
	`__š™__
(
£lf
, 
Çme
, 
çMode
='¡ªd®Úe', **
·¿ms
)

1048 
£lf
.
sw™chIP
 = 
NÚe


	@lm-proxy-topo1/test_lm-proxy-topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_lm-
´oxy
-
tİo1
.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2018 
by
 
VŞ
 
N‘wÜks
, 
Inc
.

8 #
#Requœem’ts, 
so
 
the
 
‹¡
 
is
 
nÙ
 
sk³d
:

10 #- 
Lšux
 
k”Ãl
 
w™h
 
VRF
 
suµÜt


11 #- '' 
commªd
 
w™h
 
VRF
 
suµÜt
 (
e
.
g
. 
rou‹2
-
ss180129
 
wÜks
)

12 #- 
FRR
 
BGP
 
d«mÚ
 
suµÜtšg
 
Ïb–
 
mªag”
 
usšg
 
š¡ªû
 
id


13 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


15 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


16 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


17 #š 
®l
 
cİ›s
.

18 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


20 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


21 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


22 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


23 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

24 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


25 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


26 #OF 
THIS
 
SOFTWARE
.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
impÜt
 
py‹¡


33 
äom
 
funùoŞs
 
impÜt
 
	g·¹Ÿl


35 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

36 
	gCWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

37 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

39 #pylšt: 
di§bË
=
C0413


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


45 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


48 
vrf_Çme
 = 'A'

50 
şass
 
	$N‘wÜkTİo
(
Tİo
):

53 #R–©iÚsh 
b‘w“n
 
rou‹rs
, 
sw™ches
, 
ªd
 
ho¡s


54 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

57 
tg’
 = 
	$g‘_tİog’
(
£lf
)

59 #FRR 
rou‹rs


61 
rou‹r
 
š
 ['lm', 'ce1', 'pe1', 'p1', 'pe2', 'ce2']:

62 
tg’
.
	`add_rou‹r
(
rou‹r
);

66 ğ
tg’
.
	`add_sw™ch
('s1')

67 .
	`add_lšk
(
tg’
.
g—rs
['û1'], 
nodeif
='ce1-eth0')

68 .
	`add_lšk
(
tg’
.
g—rs
['³1'], 
nodeif
='pe1-eth0')

70 ğ
tg’
.
	`add_sw™ch
('s2')

71 .
	`add_lšk
(
tg’
.
g—rs
['³1'], 
nodeif
='pe1-eth1')

72 .
	`add_lšk
(
tg’
.
g—rs
['p1'], 
nodeif
='p1-eth0')

74 ğ
tg’
.
	`add_sw™ch
('s3')

75 .
	`add_lšk
(
tg’
.
g—rs
['p1'], 
nodeif
='p1-eth1')

76 .
	`add_lšk
(
tg’
.
g—rs
['³2'], 
nodeif
='pe2-eth1')

78 ğ
tg’
.
	`add_sw™ch
('s4')

79 .
	`add_lšk
(
tg’
.
g—rs
['û2'], 
nodeif
='ce2-eth0')

80 .
	`add_lšk
(
tg’
.
g—rs
['³2'], 
nodeif
='pe2-eth0')

82 #Te¡ 
’vœÚm’t
 
hªdlšg


84 
def
 
	$vrf_de¡roy
(
rou‹r
, 
vrf
):

85 
rou‹r
.
	`run
('†šk d–‘dev ' + 
vrf
)

87 
def
 
	$vrf_£tup
(
rou‹r
, 
‘h_š
, 
vrf
, 
vrf_bË
):

88 
cmds
 = ['ip†ink set dev†o up',

90 '†šk‡dd dev ' + 
vrf
 + 'y³ vràbË ' + 
vrf_bË
,

91 '†šk s‘ ' + 
vrf
 + ' up',

92 '†šk s‘ ' + 
‘h_š
 + ' vrà' + 
vrf
,

93 'echØ1 > /´oc/sys/Ãt/m¶s/cÚf/' + 
vrf
 + '/input'

95 
	$vrf_de¡roy
(
rou‹r
, 
vrf
)

96 
cmd
 
š
 
cmds
:

97 
logg”
.
	`šfo
('[vrf_£tup] cmd: ' + 
cmd
)

98 
out
 = 
rou‹r
.
	$run
(
cmd
)

99 
out
 !ğ
NÚe
 
ªd
 
	`Ën
(out) > 0:

100 
logg”
.
	`šfo
('[vrf_£tup] "{}"ƒ¼Ü: out="{}"'.
	$fÜm©
(
cmd
, 
out
))

102 
def
 
	$£tup_moduË
(
mod
):

105 
tg’
 = 
	$Tİog’
(
N‘wÜkTİo
, 
mod
.
__Çme__
)

106 
tg’
.
	$¡¬t_tİŞogy
()

108 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

110 #Lßd 
rou‹r
 
cÚfigu¿tiÚ


112 
ldp_id
 = 1

113 
bgp_id
 = 101

114 
lm_sock
 = '../lm/label_mgr.sock'

116 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

117 
ºame
 == 'lm' :

118 
rou‹r
.
	`lßd_cÚfig
(

119 
TİoRou‹r
.
RD_ZEBRA
,

120 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
(
ºame
)),

121 '-z ' + 
lm_sock


125 
¹y³
 = ''.
	`još
([
i
 ˜
š
 
ºame
 
nÙ
 i.
	`isdig™
()])

127 
rou‹r
.
	`lßd_cÚfig
(

128 
TİoRou‹r
.
RD_ZEBRA
,

129 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
(
ºame
)),

130 '-È' + 
lm_sock


133 
rou‹r
.
	`check_ÿ·b™y
(
TİoRou‹r
.
RD_ZEBRA
, '--vrfwÃŠs'è=ğ
F®£
:

134  
py‹¡
.
	`sk
('Skippingest:‚o VRF support')

136 
¹y³
 =ğ'û' 
Ü
„type == 'pe':

137 
rou‹r
.
	`check_ÿ·b™y
(
TİoRou‹r
.
RD_BGP
, '--št_num'è=ğ
F®£
:

138  
py‹¡
.
	`sk
('Skippingest:‚o BGP LM support')

139 
rou‹r
.
	`lßd_cÚfig
(

140 
TİoRou‹r
.
RD_BGP
,

141 
os
.
·th
.
	`još
(
CWD
, '{}/bgpd.cÚf'.
	`fÜm©
(
ºame
)),

142 '-I %d' % 
bgp_id


144 
bgp_id
 += 1

146 
¹y³
 =ğ'³' 
Ü
„type == 'p':

147 
rou‹r
.
	`lßd_cÚfig
(

148 
TİoRou‹r
.
RD_OSPF
,

149 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

151 
rou‹r
.
	`lßd_cÚfig
(

152 
TİoRou‹r
.
RD_LDP
,

153 
os
.
·th
.
	`još
(
CWD
, '{}/ldpd.cÚf'.
	`fÜm©
(
ºame
)),

154 '-À%d' % 
ldp_id


156 
ldp_id
 += 1

158 #P»·» 
VRF
's

160 
rou‹r
 = 
tg’
.
g—rs
['pe1']

161 
out
 = 
rou‹r
.
	`run
('ip -h 2>&1 | grep vrf | wc -l')

162 (
out
) == 0:

163  
py‹¡
.
	`sk
('Skippingest: ip/iproute2 has‚o VRF support')

165 
	`vrf_£tup
(
tg’
.
g—rs
['³1'], '³1-‘h0', 
vrf_Çme
, '1')

166 
	`vrf_£tup
(
tg’
.
g—rs
['³2'], '³2-‘h0', 
vrf_Çme
, '1')

168 #S¹ 
rou‹rs


170 
tg’
.
	`¡¬t_rou‹r
Ñg’.
g—rs
['lm'])

171 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

172 
ºame
 != 'lm':

173 
tg’
.
	$¡¬t_rou‹r
(
rou‹r
)

175 
def
 
	$‹¬down_moduË
(
mod
):

176 
tg’
 = 
	$g‘_tİog’
()

177 
rou‹r
 
š
 ['pe1', 'pe2']:

178 
	$vrf_de¡roy
(
tg’
.
g—rs
[
rou‹r
], 
vrf_Çme
)

179 
tg’
.
	$¡İ_tİŞogy
()

181 
def
 
	$‹¡_lm_´oxy
():

182 
logg”
.
	`šfo
('Test:†abel manager (LDP‡nd BGP)')

183 
tg’
 = 
	$g‘_tİog’
()

185 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


186 
tg’
.
	$rou‹rs_have_çu»
():

187 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

189 
cmd
 = 'show mpls†dp binding'

191 
rou‹r
 = 
tg’
.
g—rs
['p1']

193 
def
 
	$check_Ïb–s
(
rou‹r
, 
cmd
):

194 
ouut
 = 
rou‹r
.
	$vtysh_cmd
(
cmd
, 
isjsÚ
=
F®£
)

195 
logg”
.
	`šfo
('chk_Ïb– [' + 
cmd
 + ']: ' + 
ouut
)

196  
ouut
.
	`couÁ
('\n')

198 
‹¡_func
 = 
	$·¹Ÿl
(
check_Ïb–s
, 
rou‹r
, 
cmd
)

199 
»suÉ
, 
diff
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 12, 
couÁ
=6, 
wa™
=30)

200 
as£¹
 
»suÉ
, 'wrong†abels'

202 
__Çme__
 == '__main__':

203 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

204 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@ospf-sr-topo1/__init__.py

	@ospf-sr-topo1/test_ospf_sr_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_o¥f_¤_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_o¥f_¤_tİo1
.
	gpy
: 
Te¡
 
the
 
FRR
 
OSPF
 
routšg
 
d«mÚ
 
w™h
 
Segm’t
 
Routšg
.

29 
impÜt
 
os


30 
impÜt
 
sys


31 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


33 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

34 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

35 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

37 #pylšt: 
di§bË
=
C0413


38 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

39 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


44 #ªd 
Fš®ly
 
py‹¡


45 
impÜt
 
py‹¡


48 
şass
 
	$O¥fSrTİo
(
Tİo
):

50 
def
 
	$bud
(
£lf
):

52 
tg’
 = 
	$g‘_tİog’
(
£lf
)

54 #Check 
m¶s


55 
tg’
.
hasm¶s
 
is
 
nÙ
 
True
:

56 
tg’
.
	`£t_”rÜ
('MPLS‚ot‡vailable,ests will be skipped')

58 #C»©4 
rou‹rs


59 
rou‹º
 
š
 
	$¿nge
(1, 5):

60 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

62 #IÁ”cÚeù 
rou‹r
 1 
ªd
 2

63 ğ
tg’
.
	`add_sw™ch
('s1')

64 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

65 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

67 #IÁ”cÚeù 
rou‹r
 3 
ªd
 2

68 ğ
tg’
.
	`add_sw™ch
('s2')

69 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

70 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

72 #IÁ”cÚeù 
rou‹r
 4 
ªd
 2

73 ğ
tg’
.
	`add_sw™ch
('s3')

74 .
	`add_lšk
(
tg’
.
g—rs
['r4'])

75 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

78 
def
 
	$£tup_moduË
(
mod
):

81 
logg”
.
	`šfo
('\n\n---- Starting OSPF Segment Routingests ----\n')

83 
tg’
 = 
	$Tİog’
(
O¥fSrTİo
, 
mod
.
__Çme__
)

84 
tg’
.
	$¡¬t_tİŞogy
()

86 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

88 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

89 
rou‹r
.
	`lßd_cÚfig
(

90 
TİoRou‹r
.
RD_ZEBRA
,

91 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

93 
rou‹r
.
	`lßd_cÚfig
(

94 
TİoRou‹r
.
RD_OSPF
,

95 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

98 #In™Ÿliz
®l
 
rou‹rs
.

99 
tg’
.
	$¡¬t_rou‹r
()

101 #V”ify 
th©
 
v”siÚ
, 
MPLS
 
ªd
 
Segm’t
 
Routšg
 
¬e
 
OK


102 
rou‹r
 
š
 
rou‹r_li¡
.
	$v®ues
():

103 #Check 
V”siÚ


104 
rou‹r
.
	`has_v”siÚ
('<', '4'):

105 
tg’
.
	`£t_”rÜ
('Unsupported FRR version')

107 #Check 
th©
 
Segm’t
 
Routšg
 
is
 
avaabË


108 
ouut
 = 
tg’
.
g—rs
[
rou‹r
.
Çme
].
	`vtysh_cmd
(

110 
ouut
.
	`fšd
("Unknown") != -1:

111 
tg’
.
	`£t_”rÜ
('Segment Routing is‚ot‡vailable')

114 
def
 
	$‹¬down_moduË
(
mod
):

117 
tg’
 = 
	$g‘_tİog’
()

118 
tg’
.
	$¡İ_tİŞogy
()

120 
logg”
.
	`šfo
('\n\n---- OSPF Segment Routingests End ----\n')

122 #Sh¬ed 
‹¡
 
funùiÚ
 
to
 
v®id©e
 
ex³ùed
 
ouut
.

123 
def
 
	$com·»_o¥f_¤db
(
ºame
, 
ex³ùed
):

125 
C®ls
 'show i°o¥àd©aba£ segm’t-routšg jsÚ' 
rou‹r
 `
ºame
`

126 
ªd
 
com·»
 
the
 
obšed
 
»suÉ
 
w™h
h
ex³ùed
 
ouut
.

128 
tg’
 = 
	$g‘_tİog’
()

129 
cu¼’t
 = 
tg’
.
g—rs
[
ºame
].
	`vtysh_cmd
(

131  
tİÙe¡
.
	`difæšes
(
cu¼’t
, 
ex³ùed
,

132 
t™Ë1
="Current output",

133 
t™Ë2
="Expected output")

136 
def
 
	$com·»_m¶s_bË
(
ºame
, 
ex³ùed
):

138 
C®ls
 'show m¶ bË jsÚ' 
rou‹r
 `
ºame
` 
ªd
 
com·»
 
the
 
obšed


139 
»suÉ
 
w™h
 
the
 
ex³ùed
 
ouut
.

141 
tg’
 = 
	$g‘_tİog’
()

142 
cu¼’t
 = 
tg’
.
g—rs
[
ºame
].
	`vtysh_cmd
('show mplsable json')

143  
tİÙe¡
.
	`difæšes
(
cu¼’t
, 
ex³ùed
,

144 
t™Ë1
="Current output",

145 
t™Ë2
="Expected output")

148 
def
 
	$‹¡_o¥f_¤
():

150 
tg’
 = 
	$g‘_tİog’
()

151 
tg’
.
	$rou‹rs_have_çu»
():

152 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

154 
logg”
.
	`šfo
('---est OSPF Segment Routing Data Base ---')

156 
ºum
 
š
 
	$¿nge
(1, 5):

157 
rou‹r
 = 'r{}'.
	$fÜm©
(
ºum
)

159 
logg”
.
	`šfo
('\tRou‹¸"%s"', 
rou‹r
)

161 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


162 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥f_¤db.jsÚ'.
	$fÜm©
(
rou‹r
))

163 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

165 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

166 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_o¥f_¤db
, 
rou‹r
, 
ex³ùed
)

167 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

168 
couÁ
=25, 
wa™
=3)

169 
as£¹
 
»suÉ
, (

171 ).
	$fÜm©
(
rou‹r
, 
diff
)

174 
def
 
	$‹¡_o¥f_k”Ãl_rou‹
():

176 
tg’
 = 
	$g‘_tİog’
()

177 
tg’
.
	$rou‹rs_have_çu»
():

178 
py‹¡
.
	$sk
(
tg’
.
”rÜs
)

180 
logg”
.
	`šfo
('---est OSPF Segment Routing MPLSables ---')

182 
ºum
 
š
 
	$¿nge
(1, 5):

183 
rou‹r
 = 'r{}'.
	$fÜm©
(
ºum
)

185 
logg”
.
	`šfo
('\tRou‹¸"%s"', 
rou‹r
)

187 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


188 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿_m¶s.jsÚ'.
	$fÜm©
(
rou‹r
))

189 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

191 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

192 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_m¶s_bË
, 
rou‹r
, 
ex³ùed
)

193 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

194 
couÁ
=25, 
wa™
=3)

195 
as£¹
 
»suÉ
, (

197 ).
	$fÜm©
(
rou‹r
, 
diff
)

200 
def
 
	$‹¡_memÜy_Ëak
():

202 
tg’
 = 
	$g‘_tİog’
()

203 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

204 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

206 
tg’
.
	$»pÜt_memÜy_Ëaks
()

208 
__Çme__
 == '__main__':

209 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

210 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@ospf-topo1-vrf/__init__.py

	@ospf-topo1-vrf/test_ospf_topo1_vrf.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_o¥f_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_o¥f_tİo1
.
	gpy
: 
Te¡
 
the
 
FRR
/
Quagga
 
OSPF
 
routšg
 
d«mÚ
.

29 
impÜt
 
os


30 
impÜt
 
»


31 
impÜt
 
sys


32 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


33 
impÜt
 
py‹¡


35 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

36 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

37 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

39 #pylšt: 
di§bË
=
C0413


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


45 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


48 
şass
 
	$OSPFTİo
(
Tİo
):

50 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

52 
tg’
 = 
	$g‘_tİog’
(
£lf
)

54 #C»©3 
rou‹rs


55 
rou‹º
 
š
 
	$¿nge
(1, 4):

56 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

58 #C»©
a
 
em±y
 
ÃtwÜk
 
rou‹r
 1

59 ğ
tg’
.
	`add_sw™ch
('s1')

60 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

62 #C»©
a
 
em±y
 
ÃtwÜk
 
rou‹r
 2

63 ğ
tg’
.
	`add_sw™ch
('s2')

64 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

66 #IÁ”cÚeù 
rou‹r
 1, 2 
ªd
 3

67 ğ
tg’
.
	`add_sw™ch
('s3')

68 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

69 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

70 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

72 #C»©
em±y
 
Ãtowrk
 
rou‹r3


73 ğ
tg’
.
	`add_sw™ch
('s4')

74 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

77 
def
 
	$£tup_moduË
(
mod
):

79 
tg’
 = 
	$Tİog’
(
OSPFTİo
, 
mod
.
__Çme__
)

80 
tg’
.
	$¡¬t_tİŞogy
()

82 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

84 #check 
zeb¿
 
ÿ·b™y


85 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

86 
rou‹r
.
	`check_ÿ·b™y
(

87 
TİoRou‹r
.
RD_ZEBRA
,

89 è=ğ
F®£
:

90  
py‹¡
.
	`sk
('Skipping OSPF VRF NETNS feature. VRF NETNS backend‚ot‡vailable on FRR')

92 
os
.
	`sy¡em
('ip‚etns†ist') != 0:

93  
py‹¡
.
	`sk
('Skipping OSPF VRF NETNS Test. NETNS‚ot‡vailable on System')

95 
logg”
.
	`šfo
('Testing with VRF Namespace support')

97 
cmds
 = ['if [ -e /var/run/netns/{0}-cust1 ] ;hen ip‚etns del {0}-cust1 ; fi',

104 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

106 #ü—‹ 
VRF
 
rx
-
cu¡1
 
ªd
 
lšk
„x-
‘h0
 
to
„x-cust1

107 
cmd
 
š
 
cmds
:

108 
ouut
 = 
tg’
.
Ãt
[
ºame
].
	`cmd
(
cmd
.
	$fÜm©
(
ºame
))

110 
rou‹r
.
	`lßd_cÚfig
(

111 
TİoRou‹r
.
RD_ZEBRA
,

112 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	`fÜm©
(
ºame
)),

115 
rou‹r
.
	`lßd_cÚfig
(

116 
TİoRou‹r
.
RD_OSPF
,

117 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

120 #In™Ÿliz
®l
 
rou‹rs
.

121 
tg’
.
	$¡¬t_rou‹r
()

122 
rou‹r
 
š
 
rou‹r_li¡
.
	$v®ues
():

123 
rou‹r
.
	`has_v”siÚ
('<', '4.0'):

124 
tg’
.
	`£t_”rÜ
('unsupported version')

127 
def
 
	$‹¬down_moduË
(
mod
):

129 
tg’
 = 
	$g‘_tİog’
()

131 #mov
back
 
rx
-
‘h0
 
to
  
VRF


132 #d–‘
rx
-
vrf


133 
cmds
 = ['ip‚etnsƒxec {0}-cust1 ip†ink set {0}-eth0‚etns 1',

137 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

138 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

139 
cmd
 
š
 
cmds
:

140 
tg’
.
Ãt
[
ºame
].
	`cmd
(
cmd
.
	$fÜm©
(
ºame
))

141 
tg’
.
	$¡İ_tİŞogy
()

143 #Sh¬ed 
‹¡
 
funùiÚ
 
to
 
v®id©e
 
ex³ùed
 
ouut
.

144 
def
 
	$com·»_show__rou‹_vrf
(
ºame
, 
ex³ùed
):

146 
C®ls
 'show i°o¥àvrà[ºame]-cu¡1„ou‹' 
rou‹r
 `
ºame
` 
ªd
 
com·»
 
the
 
obšed


147 
»suÉ
 
w™h
 
the
 
ex³ùed
 
ouut
.

149 
tg’
 = 
	$g‘_tİog’
()

150 
vrf_Çme
 = '{0}-cu¡1'.
	$fÜm©
(
ºame
)

151 
cu¼’t
 = 
tİÙe¡
.
	$4_rou‹_zeb¿
(
tg’
.
g—rs
[
ºame
], 
vrf_Çme
)

152 
»t
 = 
tİÙe¡
.
	`difæšes
(
cu¼’t
, 
ex³ùed
,

153 
t™Ë1
="Current output",

154 
t™Ë2
="Expected output")

155  
»t


157 
def
 
	$‹¡_o¥f_cÚv”g’û
():

159 
tg’
 = 
	$g‘_tİog’
()

161 
tg’
.
	$rou‹rs_have_çu»
():

162 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

164 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

165 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" cÚv”g’û', 
ºame
)

167 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


168 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥äou‹.txt'.
	$fÜm©
(
ºame
))

169 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

171 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

172 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_ouut_cmp
,

173 
rou‹r
,

174 'show i°o¥àvrà{0}-cu¡1„ou‹'.
	`fÜm©
(
ºame
),

175 
ex³ùed
)

176 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

177 
couÁ
=160, 
wa™
=0.5)

178 
as£¹msg
 = 'OSPF did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
ºame
, 
diff
)

179 
as£¹
 
»suÉ
, 
as£¹msg


182 
def
 
	$‹¡_o¥f_k”Ãl_rou‹
():

184 
tg’
 = 
	$g‘_tİog’
()

186 
tg’
.
	$rou‹rs_have_çu»
():

187 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

189 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

190 
rou‹r
 
š
 
¾i¡
:

191 
logg”
.
	`šfo
('Checkšg OSPF IPv4 k”ÃÈrou‹ š "%s"', 
rou‹r
.
Çme
)

192 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿rou‹.txt'.
	$fÜm©
(
rou‹r
.
Çme
))

193 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

194 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

195 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show__rou‹_vrf
, 
rou‹r
.
Çme
, 
ex³ùed
)

196 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

197 
couÁ
=140, 
wa™
=0.5)

198 
as£¹msg
 = 'OSPF IPv4„ou‹ mism©ch iÀrou‹¸"{}": {}'.
	$fÜm©
(

199 
rou‹r
.
Çme
, 
diff
)

200 
as£¹
 
»suÉ
, 
as£¹msg


203 
def
 
	$‹¡_o¥f_jsÚ
():

205 
tg’
 = 
	$g‘_tİog’
()

207 
tg’
.
	$rou‹rs_have_çu»
():

208 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

210 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

211 
logg”
.
	`šfo
('Com·ršg„ou‹¸"%s" "show i°o¥àvrà%s-cu¡1 jsÚ" ouut', 
rou‹r
.
Çme
,„outer.name)

212 
ex³ùed
 = {

213 '{}-cu¡1'.
	`fÜm©
(
rou‹r
.
Çme
) : {

214 'vrfName': '{}-cu¡1'.
	`fÜm©
(
rou‹r
.
Çme
),

215 'rou‹rId': '10.0.255.{}'.
	`fÜm©
(
ºame
[1:]),

216 'tosRou‹sOÆy': 
True
,

217 'rfc2328CÚfÜm': 
True
,

229 
	}
}

230 #A»¨
¥ecific
 
add™iÚ®
 
checks


231 
rou‹r
.
Çme
 =ğ'r1' 
Ü
„outer.name == 'r2' or„outer.name == 'r3':

232 
ex³ùed
['{}-cu¡1'.
fÜm©
(
rou‹r
.
Çme
)]['areas']['0.0.0.0'] = {

236 'backbÚe': 
True
,

248 
‹¡_func
 = 
·¹Ÿl
(
tİÙe¡
.
rou‹r_jsÚ_cmp
,

249 
rou‹r
,

250 'show i°o¥àvrà{0}-cu¡1 jsÚ'.
fÜm©
(
ºame
),

251 
ex³ùed
)

252 
	g_
, 
	gdiff
 = 
tİÙe¡
.
	$run_ªd_ex³ù
(
‹¡_func
, 
NÚe
,

253 
couÁ
=10, 
wa™
=0.5)

254 
as£¹msg
 = '"{}" JSON ouuˆmism©ches'.
	$fÜm©
(
ºame
)

255 
as£¹
 
diff
 
is
 
NÚe
, 
as£¹msg


258 
def
 
	$‹¡_o¥f_lšk_down
():

260 
tg’
 = 
	$g‘_tİog’
()

262 
tg’
.
	$rou‹rs_have_çu»
():

263 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

265 #SimuÏ‹ 
a
 
ÃtwÜk
 
down
 
ev’t
 
Ú
 
rou‹r3
 
sw™ch3
 
š‹rçû
.

266 
rou‹r3
 = 
tg’
.
g—rs
['r3']

267 
tİÙe¡
.
	`š‹rçû_£t_¡©us
(
rou‹r3
, 'r3-‘h0', 
içûaùiÚ
=
F®£
, 
vrf_Çme
='r3-cust1')

269 #Ex³ù 
cÚv”g’û
 
Ú
 
®l
 
rou‹rs


270 
ºame
, 
rou‹r
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

271 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" cÚv”g’û‡á”†šk fau»', 
ºame
)

272 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


273 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥äou‹_down.txt'.
	$fÜm©
(
ºame
))

274 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

276 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

277 
‹¡_func
 = 
	`·¹Ÿl
(
tİÙe¡
.
rou‹r_ouut_cmp
,

278 
rou‹r
,

279 'show i°o¥àvrà{0}-cu¡1„ou‹'.
	`fÜm©
(
ºame
),

280 
ex³ùed
)

281 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

282 
couÁ
=140, 
wa™
=0.5)

283 
as£¹msg
 = 'OSPF did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
ºame
, 
diff
)

284 
as£¹
 
»suÉ
, 
as£¹msg


287 
def
 
	$‹¡_o¥f_lšk_down_k”Ãl_rou‹
():

289 
tg’
 = 
	$g‘_tİog’
()

291 
tg’
.
	$rou‹rs_have_çu»
():

292 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

294 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

295 
rou‹r
 
š
 
¾i¡
:

296 
logg”
.
	`šfo
('Checkšg OSPF IPv4 k”ÃÈrou‹ š "%s"‡á”†šk down', 
rou‹r
.
Çme
)

298 
¡r
='{0}-cu¡1'.
	$fÜm©
(
rou‹r
.
Çme
)

299 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿rou‹down.txt'.
	$fÜm©
(
rou‹r
.
Çme
))

300 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

301 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

302 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show__rou‹_vrf
, 
rou‹r
.
Çme
, 
ex³ùed
)

303 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

304 
couÁ
=140, 
wa™
=0.5)

305 
as£¹msg
 = 'OSPF IPv4„ou‹ mism©ch iÀrou‹¸"{}"‡á”†šk down: {}'.
	$fÜm©
(

306 
rou‹r
.
Çme
, 
diff
)

307 
as£¹
 
»suÉ
, 
as£¹msg


310 
def
 
	$‹¡_memÜy_Ëak
():

312 
tg’
 = 
	$g‘_tİog’
()

313 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

314 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

316 
tg’
.
	$»pÜt_memÜy_Ëaks
()

318 
__Çme__
 == '__main__':

319 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

320 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@ospf-topo1/__init__.py

	@ospf-topo1/test_ospf_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_o¥f_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_o¥f_tİo1
.
	gpy
: 
Te¡
 
the
 
FRR
/
Quagga
 
OSPF
 
routšg
 
d«mÚ
.

29 
impÜt
 
os


30 
impÜt
 
»


31 
impÜt
 
sys


32 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


33 
impÜt
 
py‹¡


35 #Sav
the
 
Cu¼’t
 
WÜkšg
 
DœeùÜy
 
to
 
fšd
 
cÚfigu¿tiÚ
 
fes
.

36 
CWD
 = 
os
.
·th
.
dœÇme
(os.·th.
	$»®·th
(
__fe__
))

37 
sys
.
·th
.
	`­³nd
(
os
.·th.
	`još
(
CWD
, '../'))

39 #pylšt: 
di§bË
=
C0413


40 #ImpÜˆ
tİog’
 
ªd
 
tİÙe¡
 
h–³rs


41 
äom
 
lib
 
impÜt
 
tİÙe¡


42 
äom
 
lib
.
tİog’
 
impÜt
 
Tİog’
, 
TİoRou‹r
, 
g‘_tİog’


43 
äom
 
lib
.
tİŞog
 
impÜt
 
logg”


45 #Requœed 
to
 
š¡ªtŸ‹
 
the
 
tİŞogy
 
bud”
 
şass
.

46 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


48 
şass
 
	$OSPFTİo
(
Tİo
):

50 
def
 
	$bud
(
£lf
, *
_¬gs
, **
_İts
):

52 
tg’
 = 
	$g‘_tİog’
(
£lf
)

54 #C»©4 
rou‹rs


55 
rou‹º
 
š
 
	$¿nge
(1, 5):

56 
tg’
.
	`add_rou‹r
('r{}'.
	$fÜm©
(
rou‹º
))

58 #C»©
a
 
em±y
 
ÃtwÜk
 
rou‹r
 1

59 ğ
tg’
.
	`add_sw™ch
('s1')

60 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

62 #C»©
a
 
em±y
 
ÃtwÜk
 
rou‹r
 2

63 ğ
tg’
.
	`add_sw™ch
('s2')

64 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

66 #IÁ”cÚeù 
rou‹r
 1, 2 
ªd
 3

67 ğ
tg’
.
	`add_sw™ch
('s3')

68 .
	`add_lšk
(
tg’
.
g—rs
['r1'])

69 .
	`add_lšk
(
tg’
.
g—rs
['r2'])

70 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

72 #C»©
em±y
 
Ãtowrk
 
rou‹r3


73 ğ
tg’
.
	`add_sw™ch
('s4')

74 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

76 #IÁ”cÚeù 
rou‹r
 3 
ªd
 4

77 ğ
tg’
.
	`add_sw™ch
('s5')

78 .
	`add_lšk
(
tg’
.
g—rs
['r3'])

79 .
	`add_lšk
(
tg’
.
g—rs
['r4'])

81 #C»©
a
 
em±y
 
ÃtwÜk
 
rou‹r
 4

82 ğ
tg’
.
	`add_sw™ch
('s6')

83 .
	`add_lšk
(
tg’
.
g—rs
['r4'])

85 
def
 
	$£tup_moduË
(
mod
):

87 
tg’
 = 
	$Tİog’
(
OSPFTİo
, 
mod
.
__Çme__
)

88 
tg’
.
	$¡¬t_tİŞogy
()

90 
o¥f6_cÚfig
 = 'ospf6d.conf'

91 
tg’
.
g—rs
['r1'].
	`has_v”siÚ
('<', '4.0'):

92 
o¥f6_cÚfig
 = 'ospf6d.conf-pre-v4'

94 
rou‹r_li¡
 = 
tg’
.
	$rou‹rs
()

95 
ºame
, 
rou‹r
 
š
 
rou‹r_li¡
.
	$™”™ems
():

96 
rou‹r
.
	`lßd_cÚfig
(

97 
TİoRou‹r
.
RD_ZEBRA
,

98 
os
.
·th
.
	`još
(
CWD
, '{}/zeb¿.cÚf'.
	$fÜm©
(
ºame
))

100 
rou‹r
.
	`lßd_cÚfig
(

101 
TİoRou‹r
.
RD_OSPF
,

102 
os
.
·th
.
	`još
(
CWD
, '{}/o¥fd.cÚf'.
	$fÜm©
(
ºame
))

104 
rou‹r
.
	`lßd_cÚfig
(

105 
TİoRou‹r
.
RD_OSPF6
,

106 
os
.
·th
.
	`još
(
CWD
, '{}/{}'.
	$fÜm©
(
ºame
, 
o¥f6_cÚfig
))

109 #In™Ÿliz
®l
 
rou‹rs
.

110 
tg’
.
	$¡¬t_rou‹r
()

112 
def
 
	$‹¬down_moduË
(
mod
):

114 
tg’
 = 
	$g‘_tİog’
()

115 
tg’
.
	$¡İ_tİŞogy
()

118 
def
 
	$com·»_show_v6_o¥f6
(
ºame
, 
ex³ùed
):

120 
C®ls
 'show ipv6 o¥f6„ou‹' 
rou‹r
 `
ºame
` 
ªd
 
com·»
 
the
 
obšed


121 
»suÉ
 
w™h
 
the
 
ex³ùed
 
ouut
.

123 
tg’
 = 
	$g‘_tİog’
()

124 
cu¼’t
 = 
tg’
.
g—rs
[
ºame
].
	`vtysh_cmd
('show ipv6 ospf6„oute')

126 #Remov
the
 
lšk
 
add»s£s


127 
cu¼’t
 = 
»
.
	`sub
(
r
'fe80::[^ ]+', 'fe80::xxxx:xxxx:xxxx:xxxx', current)

128 
ex³ùed
 = 
»
.
	`sub
(
r
'fe80::[^ ]+', 'fe80::xxxx:xxxx:xxxx:xxxx',ƒxpected)

130 #Remov
the
 
time


131 
cu¼’t
 = 
»
.
	`sub
(
r
'\d+:\d{2}:\d{2}', '', current)

132 
ex³ùed
 = 
»
.
	`sub
(
r
'\d+:\d{2}:\d{2}', '',ƒxpected)

134  
tİÙe¡
.
	`difæšes
ÑİÙe¡.
	`nÜm®ize_‹xt
(
cu¼’t
),

135 
tİÙe¡
.
	`nÜm®ize_‹xt
(
ex³ùed
),

136 
t™Ë1
="Current output",

137 
t™Ë2
="Expected output")

139 
def
 
	$‹¡_o¥f_cÚv”g’û
():

141 
tg’
 = 
	$g‘_tİog’
()

142 
tg’
.
	$rou‹rs_have_çu»
():

143 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

145 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

146 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" cÚv”g’û', 
rou‹r
)

148 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


149 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥äou‹.txt'.
	$fÜm©
(
rou‹r
))

150 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

152 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 80 
£cÚds
.

153 
‹¡_func
 = 
	`·¹Ÿl
(

154 
tİÙe¡
.
rou‹r_ouut_cmp
, 
ºode
, 'show i°o¥àrou‹', 
ex³ùed
)

155 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

156 
couÁ
=160, 
wa™
=0.5)

157 
as£¹
 
»suÉ
, 'OSPF did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
rou‹r
, 
diff
)

159 
def
 
	$‹¡_o¥f_k”Ãl_rou‹
():

161 
tg’
 = 
	$g‘_tİog’
()

162 
tg’
.
	$rou‹rs_have_çu»
():

163 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

165 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

166 
rou‹r
 
š
 
¾i¡
:

167 
logg”
.
	`šfo
('Checkšg OSPF IPv4 k”ÃÈrou‹ š "%s"', 
rou‹r
.
Çme
)

169 
rou‹s
 = 
tİÙe¡
.
	$4_rou‹
(
rou‹r
)

170 
ex³ùed
 = {

177 
	}
}

178 
as£¹msg
 = 'OSPF IPv4„ou‹ mism©ch iÀrou‹¸"{}"'.
	$fÜm©
(
rou‹r
.
Çme
)

179 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
rou‹s
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


181 
def
 
	$‹¡_o¥f6_cÚv”g’û
():

183 
tg’
 = 
	$g‘_tİog’
()

184 
tg’
.
	$rou‹rs_have_çu»
():

185 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

187 
o¥f6rou‹_fe
 = '{}/ospf6route_ecmp.txt'

188 
ºum
 
š
 
	$¿nge
(1, 5):

189 
rou‹r
 = 'r{}'.
	$fÜm©
(
ºum
)

191 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" IPv6 OSPF cÚv”g’û', 
rou‹r
)

193 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


194 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 
o¥f6rou‹_fe
.
	$fÜm©
(
rou‹r
))

195 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

197 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

198 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show_v6_o¥f6
, 
rou‹r
, 
ex³ùed
)

199 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

200 
couÁ
=25, 
wa™
=3)

201 ià(
nÙ
 
»suÉ
è
	$ªd
 (
ºum
 == 1):

203 
o¥f6rou‹_fe
 = '{}/ospf6route.txt'

205 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


206 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 
o¥f6rou‹_fe
.
	$fÜm©
(
rou‹r
))

207 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

209 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show_v6_o¥f6
, 
rou‹r
, 
ex³ùed
)

210 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

211 
couÁ
=1, 
wa™
=3)

212 
nÙ
 
»suÉ
:

214 #ªd 
ç


215 
o¥f6rou‹_fe
 = '{}/ospf6route_ecmp.txt'

217 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


218 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, 
o¥f6rou‹_fe
.
	$fÜm©
(
rou‹r
))

219 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

221 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show_v6_o¥f6
, 
rou‹r
, 
ex³ùed
)

222 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

223 
couÁ
=1, 
wa™
=3)

225 
as£¹
 
»suÉ
, 'OSPF6 did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
rou‹r
, 
diff
)

227 
def
 
	$‹¡_o¥f6_k”Ãl_rou‹
():

229 
tg’
 = 
	$g‘_tİog’
()

230 
tg’
.
	$rou‹rs_have_çu»
():

231 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

233 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

234 
rou‹r
 
š
 
¾i¡
:

235 
logg”
.
	`šfo
('Checkšg OSPF IPv6 k”ÃÈrou‹ š "%s"', 
rou‹r
.
Çme
)

237 
rou‹s
 = 
tİÙe¡
.
	$6_rou‹
(
rou‹r
)

238 
ex³ùed
 = {

245 
	}
}

246 
as£¹msg
 = 'OSPF IPv6„ou‹ mism©ch iÀrou‹¸"{}"'.
	$fÜm©
(
rou‹r
.
Çme
)

247 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
rou‹s
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


249 
def
 
	$‹¡_o¥f_jsÚ
():

251 
tg’
 = 
	$g‘_tİog’
()

252 
tg’
.
	$rou‹rs_have_çu»
():

253 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

255 
ºum
 
š
 
	$¿nge
(1, 5):

256 
rou‹r
 = 
tg’
.
g—rs
['r{}'.
	`fÜm©
(
ºum
)]

257 
logg”
.
	`šfo
('Com·ršg„ou‹¸"%s" "show i°o¥àjsÚ" ouut', 
rou‹r
.
Çme
)

258 
ex³ùed
 = {

259 'rou‹rId': '10.0.255.{}'.
	`fÜm©
(
ºum
),

260 'tosRou‹sOÆy': 
True
,

261 'rfc2328CÚfÜm': 
True
,

272 
	}
}

273 #A»¨
¥ecific
 
add™iÚ®
 
checks


274 
rou‹r
.
Çme
 =ğ'r1' 
Ü
„outer.name == 'r2' or„outer.name == 'r3':

275 
ex³ùed
['areas']['0.0.0.0'] = {

279 'backbÚe': 
True
,

290 
rou‹r
.
Çme
 =ğ'r3' 
Ü
„outer.name == 'r4':

291 
ex³ùed
['areas']['0.0.0.1'] = {

305 #r4 
has
 
mÜe
 
š‹rçûs
 
¬—
 0.0.0.1

306 
rou‹r
.
Çme
 == 'r4':

307 
ex³ùed
['¬—s']['0.0.0.1'].
upd©e
({

312 #rou‹¸3 
has
 
ª
 
add™iÚ®
 
¬—


313 
rou‹r
.
Çme
 == 'r3':

314 
ex³ùed
['attachedAreaCounter'] = 2

316 
ouut
 = 
rou‹r
.
vtysh_cmd
('show i°o¥àjsÚ', 
isjsÚ
=
True
)

317 
»suÉ
 = 
tİÙe¡
.
	$jsÚ_cmp
(
ouut
, 
ex³ùed
)

318 
as£¹
 
»suÉ
 
is
 
NÚe
, '"{}" JSON ouuˆmism©che thex³ùed„esuÉ'.
	$fÜm©
(
rou‹r
.
Çme
)

320 
def
 
	$‹¡_o¥f_lšk_down
():

322 
tg’
 = 
	$g‘_tİog’
()

323 
tg’
.
	$rou‹rs_have_çu»
():

324 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

326 #SimuÏ‹ 
a
 
ÃtwÜk
 
down
 
ev’t
 
Ú
 
rou‹r3
 
sw™ch3
 
š‹rçû
.

327 
rou‹r3
 = 
tg’
.
g—rs
['r3']

328 
rou‹r3
.
	`³”_lšk_’abË
('r3-‘h0', 
F®£
)

330 #Ex³ù 
cÚv”g’û
 
Ú
 
®l
 
rou‹rs


331 
rou‹r
, 
ºode
 
š
 
tg’
.
	`rou‹rs
().
	$™”™ems
():

332 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" cÚv”g’û‡á”†šk fau»', 
rou‹r
)

333 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


334 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥äou‹_down.txt'.
	$fÜm©
(
rou‹r
))

335 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

337 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 80 
£cÚds
.

338 
‹¡_func
 = 
	`·¹Ÿl
(

339 
tİÙe¡
.
rou‹r_ouut_cmp
, 
ºode
, 'show i°o¥àrou‹', 
ex³ùed
)

340 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

341 
couÁ
=140, 
wa™
=0.5)

342 
as£¹
 
»suÉ
, 'OSPF did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
rou‹r
, 
diff
)

344 
def
 
	$‹¡_o¥f_lšk_down_k”Ãl_rou‹
():

346 
tg’
 = 
	$g‘_tİog’
()

347 
tg’
.
	$rou‹rs_have_çu»
():

348 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

350 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

351 
rou‹r
 
š
 
¾i¡
:

352 
logg”
.
	`šfo
('Checkšg OSPF IPv4 k”ÃÈrou‹ š "%s"‡á”†šk down', 
rou‹r
.
Çme
)

354 
rou‹s
 = 
tİÙe¡
.
	$4_rou‹
(
rou‹r
)

355 
ex³ùed
 = {

362 
	}
}

363 
rou‹r
.
Çme
 =ğ'r1' 
Ü
„outer.name == 'r2':

364 
ex³ùed
.
upd©e
({

365 '10.0.10.0/24': 
NÚe
,

366 '172.16.0.0/24': 
NÚe
,

367 '172.16.1.0/24': 
NÚe
,

369 
–if
 
rou‹r
.
Çme
 =ğ'r3' 
Ü
„outer.name == 'r4':

370 
ex³ùed
.
upd©e
({

371 '10.0.1.0/24': 
NÚe
,

372 '10.0.2.0/24': 
NÚe
,

374 #Rou‹ '10.0.3.0' 
is
 
no
 
lÚg”
 
avaabË
 
r4
 
sšû
 
™
 i 
down
.

375 
rou‹r
.
Çme
 == 'r4':

376 
ex³ùed
.
upd©e
({

377 '10.0.3.0/24': 
NÚe
,

379 
as£¹msg
 = 'OSPF IPv4„ou‹ mism©ch iÀrou‹¸"{}"‡á”†šk down'.
	$fÜm©
(
rou‹r
.
Çme
)

380 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
rou‹s
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


382 
def
 
	$‹¡_o¥f6_lšk_down
():

384 
tg’
 = 
	$g‘_tİog’
()

385 
tg’
.
	$rou‹rs_have_çu»
():

386 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

388 
ºum
 
š
 
	$¿nge
(1, 5):

389 
rou‹r
 = 'r{}'.
	$fÜm©
(
ºum
)

391 
logg”
.
	`šfo
('Wa™šg fÜ„ou‹¸"%s" IPv6 OSPF cÚv”g’û‡á”†šk down', 
rou‹r
)

393 #Lßd 
ex³ùed
 
»suÉs
 
äom
 
the
 
commªd


394 
»ffe
 = 
os
.
·th
.
	`još
(
CWD
, '{}/o¥f6rou‹_down.txt'.
	$fÜm©
(
rou‹r
))

395 
ex³ùed
 = 
	`İ’
(
»ffe
).
	$»ad
()

397 #RuÀ
‹¡
 
funùiÚ
 
uÁ
 
we
 
g‘
 
ª
 
»suÉ
. 
Wa™
 
©
 
mo¡
 60 
£cÚds
.

398 
‹¡_func
 = 
	$·¹Ÿl
(
com·»_show_v6_o¥f6
, 
rou‹r
, 
ex³ùed
)

399 
»suÉ
, 
diff
 = 
tİÙe¡
.
	`run_ªd_ex³ù
(
‹¡_func
, '',

400 
couÁ
=25, 
wa™
=3)

401 
as£¹
 
»suÉ
, 'OSPF6 did‚Ù cÚv”gÚ {}:\n{}'.
	$fÜm©
(
rou‹r
, 
diff
)

403 
def
 
	$‹¡_o¥f6_lšk_down_k”Ãl_rou‹
():

405 
tg’
 = 
	$g‘_tİog’
()

406 
tg’
.
	$rou‹rs_have_çu»
():

407 
py‹¡
.
	`sk
('skipped because of„outer(s) failure')

409 
¾i¡
 = 
tg’
.
	`rou‹rs
().
	$v®ues
()

410 
rou‹r
 
š
 
¾i¡
:

411 
logg”
.
	`šfo
('Checkšg OSPF IPv6 k”ÃÈrou‹ š "%s"‡á”†šk down', 
rou‹r
.
Çme
)

413 
rou‹s
 = 
tİÙe¡
.
	$6_rou‹
(
rou‹r
)

414 
ex³ùed
 = {

421 
	}
}

422 
rou‹r
.
Çme
 =ğ'r1' 
Ü
„outer.name == 'r2':

423 
ex³ùed
.
upd©e
({

424 '2001:db8:100::/64': 
NÚe
,

425 '2001:db8:200::/64': 
NÚe
,

426 '2001:db8:300::/64': 
NÚe
,

428 
–if
 
rou‹r
.
Çme
 =ğ'r3' 
Ü
„outer.name == 'r4':

429 
ex³ùed
.
upd©e
({

430 '2001:db8:1::/64': 
NÚe
,

431 '2001:db8:2::/64': 
NÚe
,

433 #Rou‹ '2001:db8:3::/64' 
is
 
no
 
lÚg”
 
avaabË
 
r4
 
sšû
 
™
 i 
down
.

434 
rou‹r
.
Çme
 == 'r4':

435 
ex³ùed
.
upd©e
({

436 '2001:db8:3::/64': 
NÚe
,

438 
as£¹msg
 = 'OSPF IPv6„ou‹ mism©ch iÀrou‹¸"{}"‡á”†šk down'.
	$fÜm©
(
rou‹r
.
Çme
)

439 
as£¹
 
tİÙe¡
.
	$jsÚ_cmp
(
rou‹s
, 
ex³ùed
è
is
 
NÚe
, 
as£¹msg


441 
def
 
	$‹¡_memÜy_Ëak
():

443 
tg’
 = 
	$g‘_tİog’
()

444 
nÙ
 
tg’
.
	$is_memËak_’abËd
():

445 
py‹¡
.
	`sk
('Memory†eakest/report is disabled')

447 
tg’
.
	$»pÜt_memÜy_Ëaks
()

449 
__Çme__
 == '__main__':

450 
¬gs
 = ["-s"] + 
sys
.
¬gv
[1:]

451 
sys
.
	`ex™
(
py‹¡
.
	`maš
(
¬gs
))

	@ospf6-topo1/test_ospf6_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_o¥f6_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2016 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_o¥f6_tİo1
.
	gpy
:

29 
SW1
 - 
Stub
 
N‘
 1 
SW2
 - Stub Net 2 \

30 
fc00
:1:1:1::/64 fc00:2:2:2::/64 \

31 \
___________________
/ \___________________/ |

36 | 
R1
 | | 
R2
 | |

37 | 
FRRoutšg
 | | FRRouting | |

38 | 
RŒ
-
ID
: 10.0.0.1 | | Rtr-ID: 10.0.0.2 | |

41 \
______
 
___________
/ 
OSPFv3


42 \ / 
A»a
 0.0.0.0

45 ~~ 
SW5
 ~~ |

46 ~~ 
Sw™ch
 ~~ |

47 ~~ 
fc00
:
A
:A:A::/64 ~~ |

50 | ::3 | 
SW3
 - 
Stub
 
N‘
 3 |

51 +---------+---------+ /-+ 
fc00
:3:3:3::/64 |

52 | 
R3
 | / | /

53 | 
FRRoutšg
 +--/ \---- /

54 | 
RŒ
-
ID
: 10.0.0.3 | ::3 
___________
/

59 ~~ 
SW6
 ~~ |

60 ~~ 
Sw™ch
 ~~ |

61 ~~ 
fc00
:
B
:B:B::/64 ~~ \

62 ~~~~~~~~~~~~~~~~~~ 
OSPFv3


63 | 
A»a
 0.0.0.1

66 | 
R4
 | | 
SW4
 - 
Stub
 
N‘
 4 |

67 | 
FRRoutšg
 +------+ 
fc00
:4:4:4::/64 |

68 | 
RŒ
-
ID
: 10.0.0.4 | ::4 | /

73 
impÜt
 
os


74 
impÜt
 
»


75 
impÜt
 
sys


76 
impÜt
 
py‹¡


77 
äom
 
time
 
impÜt
 
¦“p


79 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


80 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


81 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


82 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


83 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


84 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


86 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


88 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

89 
äom
 
lib
 
impÜt
 
tİÙe¡


92 
çl_”rÜ
 = ""

97 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


101 
şass
 
	$N‘wÜkTİo
(
Tİo
):

104 
def
 
	$bud
(
£lf
, **
_İts
):

105 #
#Defš
Sw™ches
 
fœ¡


107 #
ğ{
	}
}

109 
i
 
š
 
	$¿nge
(1, 7):

110 [
i
] = 
£lf
.
	`addSw™ch
('SW%s' % i,

111 
dpid
=
tİÙe¡
.
	`št2dpid
(
i
),

112 
şs
=
tİÙe¡
.
LegacySw™ch
)

113 #
#Defš
FRR
/
Quagga
 
Rou‹rs


115 #
 = {}

117 
i
 
š
 
	$¿nge
(1, 5):

118 
rou‹r
[
i
] = 
tİÙe¡
.
	`addRou‹r
(
£lf
, 'r%s' % i)

120 #
#Wœ
up
 
the
 
sw™ches
 
ªd
 
rou‹rs


122 #
#Stub 
Ãts


124 
i
 
š
 
	$¿nge
(1, 5):

125 
£lf
.
	`addLšk
([
i
], 
rou‹r
[i], 
štfName2
='r%s-stubnet' % i)

127 
£lf
.
	`addLšk
([5], 
rou‹r
[1], 
štfName2
='r1-sw5')

128 
£lf
.
	`addLšk
([5], 
rou‹r
[2], 
štfName2
='r2-sw5')

129 
£lf
.
	`addLšk
([5], 
rou‹r
[3], 
štfName2
='r3-sw5')

131 
£lf
.
	`addLšk
([6], 
rou‹r
[3], 
štfName2
='r3-sw6')

132 
£lf
.
	`addLšk
([6], 
rou‹r
[4], 
štfName2
='r4-sw6')

137 ## 
Te¡s
 
¡¬tšg


141 
def
 
	$£tup_moduË
(
moduË
):

142 
glob®
 
tİo
, 
Ãt


144 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

145 
	`´št
("******************************************\n")

147 
	`´št
("Cleanup old Mininet„uns")

148 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

150 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

151 
tİo
 = 
	$N‘wÜkTİo
()

153 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

154 
Ãt
.
	$¡¬t
()

156 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Ãt
, 
but
 
befÜe
 s¹šg 
FRR
/
Quagga
, 
uncomm’t
 
the
 
Ãxt
 
lše


157 #CLI(
Ãt
)

159 
o¥f_cÚfig
 = 'ospf6d.conf'

160 
Ãt
['r1'].
	`checkRou‹rV”siÚ
('<', '4.0'):

161 
o¥f_cÚfig
 = 'ospf6d.conf-pre-v4'

163 #S¹šg 
Rou‹rs


164 
i
 
š
 
	$¿nge
(1, 5):

165 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

166 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('o¥f6d', '%s/r%s/%s' % (
thisDœ
, i, 
o¥f_cÚfig
))

167 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

169 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


170 #CLI(
Ãt
)

173 
def
 
	$‹¬down_moduË
(
moduË
):

174 
glob®
 
Ãt


176 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

177 
	`´št
("******************************************\n")

179 #End - 
Shutdown
 
ÃtwÜk


180 
Ãt
.
	$¡İ
()

183 
def
 
	$‹¡_rou‹r_ruÂšg
():

184 
glob®
 
çl_”rÜ


185 
glob®
 
Ãt


187 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


188 ià(
çl_”rÜ
 != ""):

189 
py‹¡
.
	$sk
(
çl_”rÜ
)

191 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

192 
	`´št
("******************************************\n")

193 
	$¦“p
(5)

195 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


196 
i
 
š
 
	$¿nge
(1, 5):

197 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

198 
as£¹
 
çl_”rÜ
 == "", fatal_error

200 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


201 #CLI(
Ãt
)

203 
def
 
	$‹¡_o¥f6_cÚv”ged
():

204 
glob®
 
çl_”rÜ


205 
glob®
 
Ãt


207 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


208 ià(
çl_”rÜ
 != ""):

209 
py‹¡
.
	$sk
(
çl_”rÜ
)

211 #Wa™ 
OSPF6
 
to
 
	`cÚv”ge
 (
AÎ
 
NeighbÜs
 
š
 
e™h”
 
FuÎ
 
Ü
 
TwoWay
 
S‹
)

212 
	`´št
("\n\n** Verify OSPF6 daemonso converge")

213 
	`´št
("******************************************\n")

214 
timeout
 = 60

215 
timeout
 > 0:

216 
	`´št
("Timeouˆš %s: " % 
timeout
),

217 
sys
.
¡dout
.
	$æush
()

218 #Look 
ªy
 
node
 
nÙ
 
y‘
 
cÚv”ged


219 
i
 
š
 
	$¿nge
(1, 5):

220 
nÙCÚv”ged
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -c "show ipv6 ospf‚eigh" 2> /dev/null | grep ^[0-9] | grep -v Full')

221 
nÙCÚv”ged
:

222 
	`´št
('Wa™šg fÜ„%s' %
i
)

223 
sys
.
¡dout
.
	$æush
()

225 
nÙCÚv”ged
:

226 
	$¦“p
(5)

227 
timeout
 -= 5

229 
	`´št
('Done')

230 
	$´št
(
nÙCÚv”ged
)

233 #Ba 
out
 
w™h
 
”rÜ
 
a
 
rou‹r
 
çs
 
to
 
cÚv”ge


234 
o¥fStus
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -c "show ipv6 ospf‚eigh"')

235 
çl_”rÜ
 = "OSPFv6 did‚ot converge"

236 
as£¹
 
F®£
, "OSPFv6 did‚Ù cÚv”ge:\n%s" % 
o¥fStus


238 
	`´št
("OSPFv3 converged.")

240 
timeout
 < 60:

241 #OÆy 
wa™
 
we
 
aùu®ly
 
w’t
 
through
 
a
 
cÚv”g’û


242 
	`´št
("\nwaiting 15s for„outeso…opulate")

243 
	$¦“p
(15)

245 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


246 
i
 
š
 
	$¿nge
(1, 5):

247 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

248 
as£¹
 
çl_”rÜ
 == "", fatal_error

250 
def
 
	$‹¡_o¥fv3_routšgTabË
():

251 
glob®
 
çl_”rÜ


252 
glob®
 
Ãt


254 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


255 ià(
çl_”rÜ
 != ""):

256 
py‹¡
.
	$sk
(
çl_”rÜ
)

258 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

260 #V”ify 
OSPFv3
 
Routšg
 
TabË


261 
	`´št
("\n\n** Verifying OSPFv3 Routing Table")

262 
	`´št
("******************************************\n")

263 
çu»s
 = 0

264 
i
 
š
 
	$¿nge
(1, 5):

265 
»fTabËFe
 = '%s/r%s/show_v6_rou‹.»f' % (
thisDœ
, 
i
)

266 
os
.
·th
.
	$isfe
(
»fTabËFe
):

267 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


268 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

269 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

270 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

272 #Aùu® 
ouut
 
äom
 
rou‹r


273 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show ipv6„ou‹" 2> /dev/nuÎ | g»°"^O"').
	$r¡r
()

274 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

275 
aùu®
 = 
»
.
	`sub
(
r
" fe80::[0-9a-f:]+", " fe80::XXXX:XXXX:XXXX:XXXX",‡ctual)

276 #Drİ 
tim”s
 
Ú
 
’d
 
of
 
	`lše
 (
Şd”
 
Quagga
 
V”siÚs
)

277 
aùu®
 = 
»
.
	`sub
(
r
", [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", "",‡ctual)

278 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

279 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

281 #G’”©
Diff


282 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

283 
t™Ë1
="actual OSPFv3 IPv6„outingable",

284 
t™Ë2
="expected OSPFv3 IPv6„outingable")

286 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

287 
diff
:

288 
sys
.
¡d”r
.
	`wr™e
('r% çed OSPFv3 (IPv6èRoutšg TabË Check:\n%s\n' % (
i
, 
diff
))

289 
çu»s
 += 1

291 
	`´št
("r% ok" % 
i
)

293 
as£¹
 
çu»s
 =ğ0, "OSPFv3 (IPv6èRoutšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

295 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


296 
i
 
š
 
	$¿nge
(1, 5):

297 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

298 
as£¹
 
çl_”rÜ
 == "", fatal_error

300 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


301 #CLI(
Ãt
)

303 
def
 
	$‹¡_lšux_v6_k”Ãl_routšgTabË
():

304 
glob®
 
çl_”rÜ


305 
glob®
 
Ãt


307 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


308 ià(
çl_”rÜ
 != ""):

309 
py‹¡
.
	$sk
(
çl_”rÜ
)

311 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

313 #V”ify 
Lšux
 
K”Ãl
 
Routšg
 
TabË


314 
	`´št
("\n\n** Verifying Linux IPv6 Kernel Routing Table")

315 
	`´št
("******************************************\n")

316 
çu»s
 = 0

318 #G‘ 
a
 
li¡
 
of
 
®l
 
cu¼’t
 
lšk
-
loÿl
 
add»s£s
 
fœ¡
 
as
 
they
 
chªge
 

319 #—ch 
run
 
ªd
 
we
 
Ãed
 
to
 
Œª¦©e
 
them


320 
lškloÿls
 = []

321 
i
 
š
 
	$¿nge
(1, 5):

322 
lškloÿls
 +ğ
Ãt
['r%s' % 
i
].
	$g‘_v6_lškloÿl
()

324 #Now 
com·»
 
the
 
routšg
 
	`bËs
 (
aá”
 
sub¡™utšg
 
lšk
-
loÿl
 
add»s£s
)

325 
i
 
š
 
	$¿nge
(1, 5):

326 
»fTabËFe
 = '%s/r%s/_6_add»ss.»f' % (
thisDœ
, 
i
)

327 
os
.
·th
.
	$isfe
(
»fTabËFe
):

329 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

330 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

331 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
())).
	$¥l™lšes
(1)

333 #Aùu® 
ouut
 
äom
 
rou‹r


334 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
(' -6„ou‹').
	$r¡r
()

335 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»s£s


336 
Î
 
š
 
lškloÿls
:

337 
aùu®
 =‡ùu®.
	`»¶aû
(
Î
[1], "fe80::__(%s)__" %†l[0])

338 #Mask 
out
 
´ÙocŞ
 
Çme
 
Ü
 
numb”


339 
aùu®
 = 
»
.
	`sub
(
r
"[ ]+proto [0-9a-z]+ +", "…roto XXXX ",‡ctual)

340 #Remov
ff00
::/8 
	`rou‹s
 (
£’
 
Ú
 
some
 
k”Ãls
 - 
nÙ
 
äom
 
FRR
)

341 
aùu®
 = 
»
.
	`sub
(
r
'ff00::/8.*', '',‡ctual)

343 #SŒ 
em±y
 
lšes


344 
aùu®
 =‡ùu®.
	$l¡r
()

345 
aùu®
 =‡ùu®.
	$r¡r
()

346 
aùu®
 = 
»
.
	`sub
(
r
' +', ' ',‡ctual)

348 
f‹»d_lšes
 = []

349 
lše
 
š
 
	`sÜ‹d
(
aùu®
.
	$¥l™lšes
()):

350 
lše
.
	`¡¬tsw™h
('fe80::/64 ') \

351 
Ü
 
lše
.
	`¡¬tsw™h
('unreachable fe80::/64 '):

353 
f‹»d_lšes
.
	$­³nd
(
lše
)

354 
aùu®
 = '\n'.
	`još
(
f‹»d_lšes
).
	$¥l™lšes
(1)

356 #Pršˆ
Aùu®
 
bË


357 #´št("Rou‹¸r% bË" % 
i
)

358 #fÜ 
lše
 
š
 
aùu®
:

359 #´št(
lše
.
	`r¡r
())

361 #G’”©
Diff


362 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

363 
t™Ë1
="actual OSPFv3 IPv6„outingable",

364 
t™Ë2
="expected OSPFv3 IPv6„outingable")

366 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

367 
diff
:

368 
sys
.
¡d”r
.
	`wr™e
('r% çed Lšux IPv6 K”ÃÈRoutšg TabË Check:\n%s\n' % (
i
, 
diff
))

369 
çu»s
 += 1

371 
	`´št
("r% ok" % 
i
)

373 
as£¹
 
çu»s
 =ğ0, "Lšux K”ÃÈIPv6 Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

375 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


376 #CLI(
Ãt
)

379 
def
 
	$‹¡_shutdown_check_¡d”r
():

380 
glob®
 
çl_”rÜ


381 
glob®
 
Ãt


383 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


384 ià(
çl_”rÜ
 != ""):

385 
py‹¡
.
	$sk
(
çl_”rÜ
)

387 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

388 
	`´št
("SKIPPED final check on StdErr output: Disabled (TOPOTESTS_CHECK_STDERR undefined)\n")

389 
py‹¡
.
	`sk
('Skippingest for Stderr output')

391 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

393 
	`´št
("\n\n** Verifying unexpected STDERR output from daemons")

394 
	`´št
("******************************************\n")

396 
i
 
š
 
	$¿nge
(1, 5):

397 
Ãt
['r%s' % 
i
].
	$¡İRou‹r
()

398 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('ospf6d')

399 
log
:

400 
	`´št
("\nRou‹¸r% OSPF6d StdE¼ Log:\n%s" % (
i
, 
log
))

401 
log
 = 
Ãt
['r%s' % 
i
].
	`g‘StdE¼
('zebra')

402 
log
:

403 
	`´št
("\nRou‹¸r% Zeb¿ StdE¼ Log:\n%s" % (
i
, 
log
))

406 
def
 
	$‹¡_shutdown_check_memËak
():

407 
glob®
 
çl_”rÜ


408 
glob®
 
Ãt


410 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


411 ià(
çl_”rÜ
 != ""):

412 
py‹¡
.
	$sk
(
çl_”rÜ
)

414 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
is
 
NÚe
:

415 
	`´št
("SKIPPED final check on Memory†eaks: Disabled (TOPOTESTS_CHECK_MEMLEAK undefined)\n")

416 
py‹¡
.
	`sk
('Skippingest for memory†eaks')

418 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

420 
i
 
š
 
	$¿nge
(1, 5):

421 
Ãt
['r%s' % 
i
].
	$¡İRou‹r
()

422 
Ãt
['r%s' % 
i
].
	`»pÜt_memÜy_Ëaks
(
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'), os.
·th
.
	$ba£Çme
(
__fe__
))

425 
__Çme__
 == '__main__':

427 
	`£tLogLev–
('info')

428 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


429 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

430 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

431 
sys
.
	`ex™
(
»tv®
)

	@rip-topo1/test_rip_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_r_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_r_tİo1
.
	gpy
: 
Te¡šg
 
RIPv2


30 
impÜt
 
os


31 
impÜt
 
»


32 
impÜt
 
sys


33 
impÜt
 
py‹¡


34 
äom
 
time
 
impÜt
 
¦“p


36 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


37 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


38 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


39 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


40 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


41 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


43 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


45 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

46 
äom
 
lib
 
impÜt
 
tİÙe¡


48 
çl_”rÜ
 = ""

53 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


57 
şass
 
	$N‘wÜkTİo
(
Tİo
):

60 
def
 
	$bud
(
£lf
, **
_İts
):

62 #S‘u°
Rou‹rs


63 
rou‹r
 = {
	}
}

64 #
#S‘u°
Maš
 
Rou‹r


66 
rou‹r
[1] = 
tİÙe¡
.
addRou‹r
(
£lf
, 'r1')

67 #
#S‘u°
RIP
 
Rou‹rs


69 
i
 
š
 
	$¿nge
(2, 4):

70 
rou‹r
[
i
] = 
tİÙe¡
.
	`addRou‹r
(
£lf
, 'r%s' % i)

71 #
#S‘u°
Sw™ches


73 ğ{
	}
}

74 #
#OÀ
maš
 
rou‹r


76 #Fœ¡ 
is
 
a
 
dummy
 
š‹rçû
 (
loÿl
 
ÃtwÜk
)

77 [1] = 
£lf
.
addSw™ch
('sw1', 
şs
=
tİÙe¡
.
LegacySw™ch
)

78 
£lf
.
addLšk
([1], 
rou‹r
[1], 
štfName2
='r1-eth0')

79 #
#Sw™che 
RIP


81 #sw™ch 2 
is
 
cÚÃùiÚ
 
to
 
RIP
 
rou‹r


82 [2] = 
£lf
.
addSw™ch
('sw2', 
şs
=
tİÙe¡
.
LegacySw™ch
)

83 
£lf
.
addLšk
([2], 
rou‹r
[1], 
štfName2
='r1-eth1')

84 
£lf
.
addLšk
([2], 
rou‹r
[2], 
štfName2
='r2-eth0')

85 #sw™ch 3 
is
 
b‘w“n
 
RIP
 
rou‹rs


86 [3] = 
£lf
.
addSw™ch
('sw3', 
şs
=
tİÙe¡
.
LegacySw™ch
)

87 
£lf
.
addLšk
([3], 
rou‹r
[2], 
štfName2
='r2-eth1')

88 
£lf
.
addLšk
([3], 
rou‹r
[3], 
štfName2
='r3-eth1')

89 #sw™ch 4 
is
 
¡ub
 
Ú
 
»mÙe
 
RIP
 
rou‹r


90 [4] = 
£lf
.
addSw™ch
('sw4', 
şs
=
tİÙe¡
.
LegacySw™ch
)

91 
£lf
.
addLšk
([4], 
rou‹r
[3], 
štfName2
='r3-eth0')

97 ## 
Te¡s
 
¡¬tšg


101 
def
 
	$£tup_moduË
(
moduË
):

102 
glob®
 
tİo
, 
Ãt


104 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

105 
	`´št
("******************************************\n")

107 
	`´št
("Cleanup old Mininet„uns")

108 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

110 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

111 
tİo
 = 
	$N‘wÜkTİo
()

113 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

114 
Ãt
.
	$¡¬t
()

116 #S¹šg 
Rou‹rs


117 #

i
 
š
 
	`¿nge
(1, 4):

119 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

120 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('rd', '%s/r%s/rd.cÚf' % (
thisDœ
, i))

121 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

123 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Quagga
/
FRR
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


124 #CLI(
Ãt
)

127 
def
 
	$‹¬down_moduË
(
moduË
):

128 
glob®
 
Ãt


130 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

131 
	`´št
("******************************************\n")

133 #End - 
Shutdown
 
ÃtwÜk


134 
Ãt
.
	$¡İ
()

137 
def
 
	$‹¡_rou‹r_ruÂšg
():

138 
glob®
 
çl_”rÜ


139 
glob®
 
Ãt


141 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


142 ià(
çl_”rÜ
 != ""):

143 
py‹¡
.
	$sk
(
çl_”rÜ
)

145 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

146 
	`´št
("******************************************\n")

147 
	$¦“p
(5)

149 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


150 
i
 
š
 
	$¿nge
(1, 4):

151 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

152 
as£¹
 
çl_”rÜ
 == "", fatal_error

154 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


155 #CLI(
Ãt
)

158 
def
 
	$‹¡_cÚv”ge_´ÙocŞs
():

159 
glob®
 
çl_”rÜ


160 
glob®
 
Ãt


162 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


163 ià(
çl_”rÜ
 != ""):

164 
py‹¡
.
	$sk
(
çl_”rÜ
)

166 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

168 
	`´št
("\n\n** Waiting for…rotocols convergence")

169 
	`´št
("******************************************\n")

171 #NÙ 
»®ly
 
im¶em’‹d
 
y‘
 - 
ju¡
 
¦“p
 60 
£cs
 
now


172 
	$¦“p
(60)

174 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


175 
i
 
š
 
	$¿nge
(1, 4):

176 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

177 
as£¹
 
çl_”rÜ
 == "", fatal_error

179 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


180 #CLI(
Ãt
)

183 
def
 
	$‹¡_r_¡©us
():

184 
glob®
 
çl_”rÜ


185 
glob®
 
Ãt


187 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


188 ià(
çl_”rÜ
 != ""):

189 
py‹¡
.
	$sk
(
çl_”rÜ
)

191 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

193 #V”ify 
RIP
 
Stus


194 
	`´št
("\n\n** Verifing RIP status")

195 
	`´št
("******************************************\n")

196 
çu»s
 = 0

197 
i
 
š
 
	$¿nge
(1, 4):

198 
»fTabËFe
 = '%s/r%s/r_¡©us.»f' % (
thisDœ
, 
i
)

199 
os
.
·th
.
	$isfe
(
»fTabËFe
):

200 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


201 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

202 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

203 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

205 #Aùu® 
ouut
 
äom
 
rou‹r


206 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°r stus" 2> /dev/nuÎ').
	$r¡r
()

207 #Drİ 
time
 
š
 
Ãxt
 
due


208 
aùu®
 = 
»
.
	`sub
(
r
"in [0-9]+ seconds", "in XX seconds",‡ctual)

209 #Drİ 
time
 
š
 
Ï¡
 
upd©e


210 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

211 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

212 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

214 #G’”©
Diff


215 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

216 
t™Ë1
="actual IP RIP status",

217 
t™Ë2
="expected IP RIP status")

219 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

220 
diff
:

221 
sys
.
¡d”r
.
	`wr™e
('r% çed IP RIP stu check:\n%s\n' % (
i
, 
diff
))

222 
çu»s
 += 1

224 
	`´št
("r% ok" % 
i
)

226 
as£¹
 
çu»s
 =ğ0, "IP RIP stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

228 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


229 
i
 
š
 
	$¿nge
(1, 4):

230 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

231 
as£¹
 
çl_”rÜ
 == "", fatal_error

233 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


234 #CLI(
Ãt
)

237 
def
 
	$‹¡_r_rou‹s
():

238 
glob®
 
çl_”rÜ


239 
glob®
 
Ãt


241 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


242 ià(
çl_”rÜ
 != ""):

243 
py‹¡
.
	$sk
(
çl_”rÜ
)

245 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

247 #V”ify 
RIP
 
Stus


248 
	`´št
("\n\n** Verifing RIP„outes")

249 
	`´št
("******************************************\n")

250 
çu»s
 = 0

251 
i
 
š
 
	$¿nge
(1, 4):

252 
»fTabËFe
 = '%s/r%s/show__r.»f' % (
thisDœ
, 
i
)

253 
os
.
·th
.
	$isfe
(
»fTabËFe
):

254 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


255 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

256 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

257 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

259 #Aùu® 
ouut
 
äom
 
rou‹r


260 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°r" 2> /dev/nuÎ').
	$r¡r
()

261 #Drİ 
Time


262 
aùu®
 = 
»
.
	`sub
(
r
"[0-9][0-9]:[0-5][0-9]", "XX:XX",‡ctual)

263 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

264 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

266 #G’”©
Diff


267 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

268 
t™Ë1
="actual SHOW IP RIP",

269 
t™Ë2
="expected SHOW IP RIP")

271 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

272 
diff
:

273 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW IP RIP check:\n%s\n' % (
i
, 
diff
))

274 
çu»s
 += 1

276 
	`´št
("r% ok" % 
i
)

278 
as£¹
 
çu»s
 =ğ0, "SHOW IP RIP faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

280 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


281 
i
 
š
 
	$¿nge
(1, 4):

282 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

283 
as£¹
 
çl_”rÜ
 == "", fatal_error

285 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


286 #CLI(
Ãt
)

289 
def
 
	$‹¡_zeb¿_v4_routšgTabË
():

290 
glob®
 
çl_”rÜ


291 
glob®
 
Ãt


293 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


294 ià(
çl_”rÜ
 != ""):

295 
py‹¡
.
	$sk
(
çl_”rÜ
)

297 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

299 #V”ify 
OSPFv3
 
Routšg
 
TabË


300 
	`´št
("\n\n** Verifing Zebra IPv4 Routing Table")

301 
	`´št
("******************************************\n")

302 
çu»s
 = 0

303 
i
 
š
 
	$¿nge
(1, 4):

304 
»fTabËFe
 = '%s/r%s/show__rou‹.»f' % (
thisDœ
, 
i
)

305 
os
.
·th
.
	$isfe
(
»fTabËFe
):

306 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


307 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

308 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

309 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

311 #Aùu® 
ouut
 
äom
 
rou‹r


312 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show i°rou‹" 2> /dev/nuÎ | g»°"^R"').
	$r¡r
()

313 #Drİ 
tim”s
 
Ú
 
’d
 
of
 
	`lše
 (
Şd”
 
Quagga
 
V”siÚs
)

314 
aùu®
 = 
»
.
	`sub
(
r
", [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", "",‡ctual)

315 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

316 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

318 #G’”©
Diff


319 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

320 
t™Ë1
="actual Zebra IPv4„outingable",

321 
t™Ë2
="expected Zebra IPv4„outingable")

323 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

324 
diff
:

325 
sys
.
¡d”r
.
	`wr™e
('r% çed Zeb¿ IPv4 Routšg TabË Check:\n%s\n' % (
i
, 
diff
))

326 
çu»s
 += 1

328 
	`´št
("r% ok" % 
i
)

330 
as£¹
 
çu»s
 =ğ0, "Zeb¿ IPv4 Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

332 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
¡l
 
ruÂšg


333 
i
 
š
 
	$¿nge
(1, 4):

334 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

335 
as£¹
 
çl_”rÜ
 == "", fatal_error

337 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


338 #CLI(
Ãt
)

341 
def
 
	$‹¡_shutdown_check_¡d”r
():

342 
glob®
 
çl_”rÜ


343 
glob®
 
Ãt


345 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


346 ià(
çl_”rÜ
 != ""):

347 
py‹¡
.
	$sk
(
çl_”rÜ
)

349 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

350 
py‹¡
.
	`sk
('Skippingest for Stderr output‡nd memory†eaks')

352 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

354 
	`´št
("\n\n** Verifing unexpected STDERR output from daemons")

355 
	`´št
("******************************************\n")

357 
Ãt
['r1'].
	$¡İRou‹r
()

359 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ripd')

360 
log
:

361 
	`´št
("\nRIPd StdE¼ Log:\n" + 
log
)

362 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('zebra')

363 
log
:

364 
	`´št
("\nZeb¿ StdE¼ Log:\n" + 
log
)

367 
__Çme__
 == '__main__':

369 
	`£tLogLev–
('info')

370 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


371 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

372 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

373 
sys
.
	`ex™
(
»tv®
)

	@ripng-topo1/test_ripng_topo1.py

1 #!/
u¤
/
bš
/
’v
 
pythÚ


3 #
#‹¡_rng_tİo1.
py


5 #P¬ˆ
of
 
N‘DEF
 
TİŞogy
 
Te¡s


6 #
#Cİyrighˆ(
c
è2017 
by


8 #N‘wÜk 
Deviû
 
EduÿtiÚ
 
Found©iÚ
, 
Inc
. ("NetDEF")

9 #
#P”missiÚ 
to
 
u£
, 
cİy
, 
modify
, 
ªd
/
Ü
 
di¡ribu‹
 
this
 
soáw¬e


11 #fÜ 
ªy
 
pu½o£
 
w™h
 
Ü
 
w™hout
 
ãe
 
is
 
h”eby
 
g¿Áed
, 
´ovided


12 #th© 
the
 
above
 
cİyright
 
nÙiû
 
ªd
 
this
 
³rmissiÚ
‚Ùiû 
­³¬


13 #š 
®l
 
cİ›s
.

14 #
#THE 
SOFTWARE
 
IS
 
PROVIDED
 "AS IS" 
AND
 
NETDEF
 
DISCLAIMS
 
ALL
 
WARRANTIES


16 #WITH 
REGARD
 
TO
 
THIS
 
SOFTWARE
 
INCLUDING
 
ALL
 
IMPLIED
 
WARRANTIES
 
OF


17 #MERCHANTABILITY 
AND
 
FITNESS
. 
IN
 
NO
 
EVENT
 
SHALL
 
NETDEF
 
BE
 
LIABLE
 
FOR


18 #ANY 
SPECIAL
, 
DIRECT
, 
INDIRECT
, 
OR
 
CONSEQUENTIAL
 
DAMAGES
 OR 
ANY


19 #DAMAGES 
WHATSOEVER
 
RESULTING
 
FROM
 
LOSS
 
OF
 
USE
, 
DATA
 
OR
 
PROFITS
,

20 #WHETHER 
IN
 
AN
 
ACTION
 
OF
 
CONTRACT
, 
NEGLIGENCE
 
OR
 
OTHER
 
TORTIOUS


21 #ACTION, 
ARISING
 
OUT
 
OF
 
OR
 
IN
 
CONNECTION
 
WITH
 
THE
 
USE
 OR 
PERFORMANCE


22 #OF 
THIS
 
SOFTWARE
.

26 
	g‹¡_rng_tİo1
.
	gpy
: 
Te¡
 
of
 
RIPng
 
TİŞogy


30 
impÜt
 
os


31 
impÜt
 
»


32 
impÜt
 
sys


33 
impÜt
 
py‹¡


34 
impÜt
 
unicoded©a


35 
äom
 
time
 
impÜt
 
¦“p


37 
äom
 
mšš‘
.
tİo
 
impÜt
 
Tİo


38 
äom
 
mšš‘
.
Ãt
 
impÜt
 
Mšš‘


39 
äom
 
mšš‘
.
node
 
impÜt
 
Node
, 
	gOVSSw™ch
, 
Ho¡


40 
äom
 
	gmšš‘
.
log
 
impÜt
 
	g£tLogLev–
, 
šfo


41 
äom
 
	gmšš‘
.
şi
 
impÜt
 
CLI


42 
äom
 
	gmšš‘
.
lšk
 
impÜt
 
IÁf


44 
äom
 
funùoŞs
 
impÜt
 
·¹Ÿl


46 
	gsys
.
	g·th
.
­³nd
(
os
.
·th
.
dœÇme
(os.·th.dœÇme(os.·th.
	$ab¥©h
(
__fe__
))))

47 
äom
 
lib
 
impÜt
 
tİÙe¡


49 
çl_”rÜ
 = ""

54 ## 
N‘wÜk
 
TİŞogy
 
Defš™iÚ


58 
şass
 
	$N‘wÜkTİo
(
Tİo
):

61 
def
 
	$bud
(
£lf
, **
_İts
):

63 #S‘u°
Rou‹rs


64 
rou‹r
 = {
	}
}

65 #
#S‘u°
Maš
 
Rou‹r


67 
rou‹r
[1] = 
tİÙe¡
.
addRou‹r
(
£lf
, 'r1')

68 #
#S‘u°
RIPng
 
Rou‹rs


70 
i
 
š
 
	$¿nge
(2, 4):

71 
rou‹r
[
i
] = 
tİÙe¡
.
	`addRou‹r
(
£lf
, 'r%s' % i)

73 #S‘u°
Sw™ches


74 ğ{
	}
}

75 #
#OÀ
maš
 
rou‹r


77 #Fœ¡ 
is
 
a
 
dummy
 
š‹rçû
 (
loÿl
 
ÃtwÜk
)

78 [1] = 
£lf
.
addSw™ch
('sw1', 
şs
=
tİÙe¡
.
LegacySw™ch
)

79 
£lf
.
addLšk
([1], 
rou‹r
[1], 
štfName2
='r1-eth0')

80 #
#Sw™che 
RIPng


82 #sw™ch 2 
is
 
cÚÃùiÚ
 
to
 
RIP
 
rou‹r


83 [2] = 
£lf
.
addSw™ch
('sw2', 
şs
=
tİÙe¡
.
LegacySw™ch
)

84 
£lf
.
addLšk
([2], 
rou‹r
[1], 
štfName2
='r1-eth1')

85 
£lf
.
addLšk
([2], 
rou‹r
[2], 
štfName2
='r2-eth0')

86 #sw™ch 3 
is
 
b‘w“n
 
RIP
 
rou‹rs


87 [3] = 
£lf
.
addSw™ch
('sw3', 
şs
=
tİÙe¡
.
LegacySw™ch
)

88 
£lf
.
addLšk
([3], 
rou‹r
[2], 
štfName2
='r2-eth1')

89 
£lf
.
addLšk
([3], 
rou‹r
[3], 
štfName2
='r3-eth1')

90 #sw™ch 4 
is
 
¡ub
 
Ú
 
»mÙe
 
RIP
 
rou‹r


91 [4] = 
£lf
.
addSw™ch
('sw4', 
şs
=
tİÙe¡
.
LegacySw™ch
)

92 
£lf
.
addLšk
([4], 
rou‹r
[3], 
štfName2
='r3-eth0')

98 ## 
Te¡s
 
¡¬tšg


102 
def
 
	$£tup_moduË
(
moduË
):

103 
glob®
 
tİo
, 
Ãt


105 
	`´št
("\n\n** %s: S‘u°TİŞogy" % 
moduË
.
__Çme__
)

106 
	`´št
("******************************************\n")

108 
	`´št
("Cleanup old Mininet„uns")

109 
os
.
	`sy¡em
('sudo mn -c > /dev/null 2>&1')

111 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

112 
tİo
 = 
	$N‘wÜkTİo
()

114 
Ãt
 = 
	$Mšš‘
(
cÚŒŞËr
=
NÚe
, 
tİo
=topo)

115 
Ãt
.
	$¡¬t
()

117 #S¹šg 
Rou‹rs


118 #

i
 
š
 
	`¿nge
(1, 4):

120 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('zeb¿', '%s/r%s/zeb¿.cÚf' % (
thisDœ
, i))

121 
Ãt
['r%s' % 
i
].
	`lßdCÚf
('rngd', '%s/r%s/rngd.cÚf' % (
thisDœ
, i))

122 
Ãt
['r%s' % 
i
].
	$¡¬tRou‹r
()

124 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
Quagga
/
FRR
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


125 #CLI(
Ãt
)

128 
def
 
	$‹¬down_moduË
(
moduË
):

129 
glob®
 
Ãt


131 
	`´št
("\n\n** %s: ShutdowÀTİŞogy" % 
moduË
.
__Çme__
)

132 
	`´št
("******************************************\n")

134 #End - 
Shutdown
 
ÃtwÜk


135 
Ãt
.
	$¡İ
()

138 
def
 
	$‹¡_rou‹r_ruÂšg
():

139 
glob®
 
çl_”rÜ


140 
glob®
 
Ãt


142 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


143 ià(
çl_”rÜ
 != ""):

144 
py‹¡
.
	$sk
(
çl_”rÜ
)

146 
	`´št
("\n\n** Check if FRR/Quagga is„unning onƒach Router‚ode")

147 
	`´št
("******************************************\n")

148 
	$¦“p
(5)

150 #S¹šg 
Rou‹rs


151 
i
 
š
 
	$¿nge
(1, 4):

152 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

153 
as£¹
 
çl_”rÜ
 == "", fatal_error

155 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


156 #CLI(
Ãt
)

159 
def
 
	$‹¡_cÚv”ge_´ÙocŞs
():

160 
glob®
 
çl_”rÜ


161 
glob®
 
Ãt


163 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


164 ià(
çl_”rÜ
 != ""):

165 
py‹¡
.
	$sk
(
çl_”rÜ
)

167 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

169 
	`´št
("\n\n** Waiting for…rotocols convergence")

170 
	`´št
("******************************************\n")

172 #NÙ 
»®ly
 
im¶em’‹d
 
y‘
 - 
ju¡
 
¦“p
 60 
£cs
 
now


173 
	$¦“p
(60)

175 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


176 
i
 
š
 
	$¿nge
(1, 4):

177 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

178 
as£¹
 
çl_”rÜ
 == "", fatal_error

180 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


181 #CLI(
Ãt
)

184 
def
 
	$‹¡_rng_¡©us
():

185 
glob®
 
çl_”rÜ


186 
glob®
 
Ãt


188 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


189 ià(
çl_”rÜ
 != ""):

190 
py‹¡
.
	$sk
(
çl_”rÜ
)

192 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

194 #V”ify 
RIP
 
Stus


195 
	`´št
("\n\n** Verifying RIPng status")

196 
	`´št
("******************************************\n")

197 
çu»s
 = 0

198 
i
 
š
 
	$¿nge
(1, 4):

199 
»fTabËFe
 = '%s/r%s/rng_¡©us.»f' % (
thisDœ
, 
i
)

200 
os
.
·th
.
	$isfe
(
»fTabËFe
):

201 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


202 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

203 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

204 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

206 #Aùu® 
ouut
 
äom
 
rou‹r


207 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show ipv6„ng stus" 2> /dev/nuÎ').
	$r¡r
()

208 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

209 
aùu®
 = 
»
.
	`sub
(
r
" fe80::[0-9a-f:]+", " fe80::XXXX:XXXX:XXXX:XXXX",‡ctual)

210 #Drİ 
time
 
š
 
Ãxt
 
due


211 
aùu®
 = 
»
.
	`sub
(
r
"in [0-9]+ seconds", "in XX seconds",‡ctual)

212 #Drİ 
time
 
š
 
Ï¡
 
upd©e


213 
aùu®
 = 
»
.
	`sub
(
r
" [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", " XX:XX:XX",‡ctual)

214 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

215 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

217 #G’”©
Diff


218 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

219 
t™Ë1
="actual IPv6 RIPng status",

220 
t™Ë2
="expected IPv6 RIPng status")

222 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

223 
diff
:

224 
sys
.
¡d”r
.
	`wr™e
('r% çed IPv6 RIPng stu check:\n%s\n' % (
i
, 
diff
))

225 
çu»s
 += 1

227 
	`´št
("r% ok" % 
i
)

229 
as£¹
 
çu»s
 =ğ0, "IPv6 RIPng stu çed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

231 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


232 
i
 
š
 
	$¿nge
(1, 4):

233 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

234 
as£¹
 
çl_”rÜ
 == "", fatal_error

236 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


237 #CLI(
Ãt
)

240 
def
 
	$‹¡_rng_rou‹s
():

241 
glob®
 
çl_”rÜ


242 
glob®
 
Ãt


244 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


245 ià(
çl_”rÜ
 != ""):

246 
py‹¡
.
	$sk
(
çl_”rÜ
)

248 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

250 #V”ify 
RIPng
 
Stus


251 
	`´št
("\n\n** Verifying RIPng„outes")

252 
	`´št
("******************************************\n")

253 
çu»s
 = 0

254 
i
 
š
 
	$¿nge
(1, 4):

255 
»fTabËFe
 = '%s/r%s/show_v6_rng.»f' % (
thisDœ
, 
i
)

256 
os
.
·th
.
	$isfe
(
»fTabËFe
):

257 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


258 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

259 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

260 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

262 #Aùu® 
ouut
 
äom
 
rou‹r


263 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show ipv6„ng" 2> /dev/nuÎ').
	$r¡r
()

264 #Drİ 
Time


265 
aùu®
 = 
»
.
	`sub
(
r
" [0-9][0-9]:[0-5][0-9]", " XX:XX",‡ctual)

266 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

267 
aùu®
 = 
»
.
	`sub
(
r
" fe80::[0-9a-f: ]+", " fe80::XXXX:XXXX:XXXX:XXXX ",‡ctual)

268 #Remov
Œašg
 
¥aûs
 
Ú
 
®l
 
lšes


269 
aùu®
 = '\n'.
	`još
([
lše
.
	$r¡r
(è
lše
 
š
 
aùu®
.
	`¥l™lšes
()])

271 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

272 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

274 #G’”©
Diff


275 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

276 
t™Ë1
="actual SHOW IPv6 RIPng",

277 
t™Ë2
="expected SHOW IPv6 RIPng")

279 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

280 
diff
:

281 
sys
.
¡d”r
.
	`wr™e
('r% çed SHOW IPv6 RIPng check:\n%s\n' % (
i
, 
diff
))

282 
çu»s
 += 1

284 
	`´št
("r% ok" % 
i
)

286 
as£¹
 
çu»s
 =ğ0, "SHOW IPv6 RIPng faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

288 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


289 
i
 
š
 
	$¿nge
(1, 4):

290 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

291 
as£¹
 
çl_”rÜ
 == "", fatal_error

293 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


294 #CLI(
Ãt
)

297 
def
 
	$‹¡_zeb¿_v6_routšgTabË
():

298 
glob®
 
çl_”rÜ


299 
glob®
 
Ãt


301 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


302 ià(
çl_”rÜ
 != ""):

303 
py‹¡
.
	$sk
(
çl_”rÜ
)

305 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

307 #V”ify 
OSPFv3
 
Routšg
 
TabË


308 
	`´št
("\n\n** Verifying Zebra IPv6 Routing Table")

309 
	`´št
("******************************************\n")

310 
çu»s
 = 0

311 
i
 
š
 
	$¿nge
(1, 4):

312 
»fTabËFe
 = '%s/r%s/show_v6_rou‹.»f' % (
thisDœ
, 
i
)

313 
os
.
·th
.
	$isfe
(
»fTabËFe
):

314 #R—d 
ex³ùed
 
»suÉ
 
äom
 
fe


315 
ex³ùed
 = 
	`İ’
(
»fTabËFe
).
	`»ad
().
	$r¡r
()

316 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

317 
ex³ùed
 = ('\n'.
	`još
Óx³ùed.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

319 #Aùu® 
ouut
 
äom
 
rou‹r


320 
aùu®
 = 
Ãt
['r%s' % 
i
].
	`cmd
('vtysh -ø"show ipv6„ou‹" 2> /dev/nuÎ | g»°"^R"').
	$r¡r
()

321 #Mask 
out
 
Lšk
-
Loÿl
 
mac
 
add»ss
 
pÜtiÚ
. 
They
 
¬e
 
¿ndom
...

322 
aùu®
 = 
»
.
	`sub
(
r
" fe80::[0-9a-f:]+", " fe80::XXXX:XXXX:XXXX:XXXX",‡ctual)

323 #Drİ 
tim”s
 
Ú
 
’d
 
of
 
	`lše
 (
Şd”
 
Quagga
 
V”siÚs
)

324 
aùu®
 = 
»
.
	`sub
(
r
", [0-2][0-9]:[0-5][0-9]:[0-5][0-9]", "",‡ctual)

325 #Fix 
	`Ãwlšes
 (
make
 
them
 
®l
 
the
 
§me
)

326 
aùu®
 = ('\n'.
	`još
×ùu®.
	`¥l™lšes
()è+ '\n').
	$¥l™lšes
(1)

328 #G’”©
Diff


329 
diff
 = 
tİÙe¡
.
	`g‘_‹xtdiff
(
aùu®
, 
ex³ùed
,

330 
t™Ë1
="actual Zebra IPv6„outingable",

331 
t™Ë2
="expected Zebra IPv6„outingable")

333 #Em±y 
¡ršg
 
™
 
m©ches
, 
Ùh”wi£
 
diff
 
cÚšs
 
unif›d
 diff

334 
diff
:

335 
sys
.
¡d”r
.
	`wr™e
('r% çed Zeb¿ IPv6 Routšg TabË Check:\n%s\n' % (
i
, 
diff
))

336 
çu»s
 += 1

338 
	`´št
("r% ok" % 
i
)

340 
as£¹
 
çu»s
 =ğ0, "Zeb¿ IPv6 Routšg TabË v”ifiÿtiÚ faed fÜ„ou‹¸r%s:\n%s" % (
i
, 
diff
)

342 #Mak
su»
 
th©
 
®l
 
d«mÚs
 
¬e
 
ruÂšg


343 
i
 
š
 
	$¿nge
(1, 4):

344 
çl_”rÜ
 = 
Ãt
['r%s' % 
i
].
	$checkRou‹rRuÂšg
()

345 
as£¹
 
çl_”rÜ
 == "", fatal_error

347 #FÜ 
debuggšg
 
aá”
 
¡¬tšg
 
FRR
/
Quagga
 
d«mÚs
, 
uncomm’t
 
the
 
Ãxt
 
lše


348 #CLI(
Ãt
)

351 
def
 
	$‹¡_shutdown_check_¡d”r
():

352 
glob®
 
çl_”rÜ


353 
glob®
 
Ãt


355 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


356 ià(
çl_”rÜ
 != ""):

357 
py‹¡
.
	$sk
(
çl_”rÜ
)

359 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_STDERR'è
is
 
NÚe
:

360 
	`´št
("SKIPPED final check on StdErr output: Disabled (TOPOTESTS_CHECK_STDERR undefined)\n")

361 
py‹¡
.
	`sk
('Skippingest for Stderr output')

363 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

365 
	`´št
("\n\n** Verifying unexpected STDERR output from daemons")

366 
	`´št
("******************************************\n")

368 
Ãt
['r1'].
	$¡İRou‹r
()

370 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('ripngd')

371 
log
:

372 
	`´št
("\nRIPngd StdE¼ Log:\n" + 
log
)

373 
log
 = 
Ãt
['r1'].
	`g‘StdE¼
('zebra')

374 
log
:

375 
	`´št
("\nZeb¿ StdE¼ Log:\n" + 
log
)

378 
def
 
	$‹¡_shutdown_check_memËak
():

379 
glob®
 
çl_”rÜ


380 
glob®
 
Ãt


382 #Sk 
´evious
 
çl
 
”rÜ
 
cÚd™iÚ
 
is
 
¿i£d


383 ià(
çl_”rÜ
 != ""):

384 
py‹¡
.
	$sk
(
çl_”rÜ
)

386 
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'è
is
 
NÚe
:

387 
	`´št
("SKIPPED final check on Memory†eaks: Disabled (TOPOTESTS_CHECK_MEMLEAK undefined)\n")

388 
py‹¡
.
	`sk
('Skippingest for memory†eaks')

390 
thisDœ
 = 
os
.
·th
.
	`dœÇme
(os.·th.
	$»®·th
(
__fe__
))

392 
Ãt
['r1'].
	$¡İRou‹r
()

393 
Ãt
['r1'].
	`»pÜt_memÜy_Ëaks
(
os
.
’vœÚ
.
	`g‘
('TOPOTESTS_CHECK_MEMLEAK'), os.
·th
.
	$ba£Çme
(
__fe__
))

396 
__Çme__
 == '__main__':

398 
	`£tLogLev–
('info')

399 #TØ
suµ»ss
 
Œaûbacks
, 
e™h”
 
u£
 
the
 
fŞlowšg
 
py‹¡
 
ÿÎ
 
Ü
 
add
 "--tbòo" 
to
 
şi


400 #»tv® = 
py‹¡
.
	`maš
(["-s", "--tb=no"])

401 
»tv®
 = 
py‹¡
.
	`maš
(["-s"])

402 
sys
.
	`ex™
(
»tv®
)

	@
1
.
1
/usr/include
137
4997
all-protocol-startup/test_all_protocol_startup.py
bfd-topo1/__init__.py
bfd-topo1/test_bfd_topo1.py
bfd-topo2/__init__.py
bfd-topo2/test_bfd_topo2.py
bgp-basic-functionality-topo1/__init__.py
bgp-basic-functionality-topo1/test_bgp_basic_functionality.py
bgp-ecmp-topo1/__init__.py
bgp-ecmp-topo1/peer1/exa-receive.py
bgp-ecmp-topo1/peer1/exa-send.py
bgp-ecmp-topo1/peer10/exa-receive.py
bgp-ecmp-topo1/peer10/exa-send.py
bgp-ecmp-topo1/peer11/exa-receive.py
bgp-ecmp-topo1/peer11/exa-send.py
bgp-ecmp-topo1/peer12/exa-receive.py
bgp-ecmp-topo1/peer12/exa-send.py
bgp-ecmp-topo1/peer13/exa-receive.py
bgp-ecmp-topo1/peer13/exa-send.py
bgp-ecmp-topo1/peer14/exa-receive.py
bgp-ecmp-topo1/peer14/exa-send.py
bgp-ecmp-topo1/peer15/exa-receive.py
bgp-ecmp-topo1/peer15/exa-send.py
bgp-ecmp-topo1/peer16/exa-receive.py
bgp-ecmp-topo1/peer16/exa-send.py
bgp-ecmp-topo1/peer17/exa-receive.py
bgp-ecmp-topo1/peer17/exa-send.py
bgp-ecmp-topo1/peer18/exa-receive.py
bgp-ecmp-topo1/peer18/exa-send.py
bgp-ecmp-topo1/peer19/exa-receive.py
bgp-ecmp-topo1/peer19/exa-send.py
bgp-ecmp-topo1/peer2/exa-receive.py
bgp-ecmp-topo1/peer2/exa-send.py
bgp-ecmp-topo1/peer20/exa-receive.py
bgp-ecmp-topo1/peer20/exa-send.py
bgp-ecmp-topo1/peer3/exa-receive.py
bgp-ecmp-topo1/peer3/exa-send.py
bgp-ecmp-topo1/peer4/exa-receive.py
bgp-ecmp-topo1/peer4/exa-send.py
bgp-ecmp-topo1/peer5/exa-receive.py
bgp-ecmp-topo1/peer5/exa-send.py
bgp-ecmp-topo1/peer6/exa-receive.py
bgp-ecmp-topo1/peer6/exa-send.py
bgp-ecmp-topo1/peer7/exa-receive.py
bgp-ecmp-topo1/peer7/exa-send.py
bgp-ecmp-topo1/peer8/exa-receive.py
bgp-ecmp-topo1/peer8/exa-send.py
bgp-ecmp-topo1/peer9/exa-receive.py
bgp-ecmp-topo1/peer9/exa-send.py
bgp-ecmp-topo1/test_bgp_ecmp_topo1.py
bgp-vrf-route-leak-basic/test_bgp.py
bgp_l3vpn_to_bgp_direct/__init__.py
bgp_l3vpn_to_bgp_direct/customize.py
bgp_l3vpn_to_bgp_direct/scripts/add_routes.py
bgp_l3vpn_to_bgp_direct/scripts/adjacencies.py
bgp_l3vpn_to_bgp_direct/scripts/check_routes.py
bgp_l3vpn_to_bgp_direct/scripts/cleanup_all.py
bgp_l3vpn_to_bgp_direct/test_bgp_l3vpn_to_bgp_direct.py
bgp_l3vpn_to_bgp_vrf/__init__.py
bgp_l3vpn_to_bgp_vrf/customize.py
bgp_l3vpn_to_bgp_vrf/scripts/add_routes.py
bgp_l3vpn_to_bgp_vrf/scripts/adjacencies.py
bgp_l3vpn_to_bgp_vrf/scripts/check_linux_mpls.py
bgp_l3vpn_to_bgp_vrf/scripts/check_linux_vrf.py
bgp_l3vpn_to_bgp_vrf/scripts/check_routes.py
bgp_l3vpn_to_bgp_vrf/scripts/cleanup_all.py
bgp_l3vpn_to_bgp_vrf/test_bgp_l3vpn_to_bgp_vrf.py
bgp_multiview_topo1/peer1/exa-receive.py
bgp_multiview_topo1/peer1/exa-send.py
bgp_multiview_topo1/peer2/exa-receive.py
bgp_multiview_topo1/peer2/exa-send.py
bgp_multiview_topo1/peer3/exa-receive.py
bgp_multiview_topo1/peer3/exa-send.py
bgp_multiview_topo1/peer4/exa-receive.py
bgp_multiview_topo1/peer4/exa-send.py
bgp_multiview_topo1/peer5/exa-receive.py
bgp_multiview_topo1/peer5/exa-send.py
bgp_multiview_topo1/peer6/exa-receive.py
bgp_multiview_topo1/peer6/exa-send.py
bgp_multiview_topo1/peer7/exa-receive.py
bgp_multiview_topo1/peer7/exa-send.py
bgp_multiview_topo1/peer8/exa-receive.py
bgp_multiview_topo1/peer8/exa-send.py
bgp_multiview_topo1/test_bgp_multiview_topo1.py
bgp_rfapi_basic_sanity/__init__.py
bgp_rfapi_basic_sanity/customize.py
bgp_rfapi_basic_sanity/scripts/add_routes.py
bgp_rfapi_basic_sanity/scripts/adjacencies.py
bgp_rfapi_basic_sanity/scripts/check_close.py
bgp_rfapi_basic_sanity/scripts/check_routes.py
bgp_rfapi_basic_sanity/scripts/check_timeout.py
bgp_rfapi_basic_sanity/scripts/cleanup_all.py
bgp_rfapi_basic_sanity/test_bgp_rfapi_basic_sanity.py
bgp_rfapi_basic_sanity_config2/__init__.py
bgp_vrf_netns/__init__.py
bgp_vrf_netns/peer1/exa-receive.py
bgp_vrf_netns/peer1/exa-send.py
bgp_vrf_netns/test_bgp_vrf_netns_topo.py
biswajit_ut_automation/bgp_topo_json_single_link/__init__.py
biswajit_ut_automation/bgp_topo_json_single_link/test_gr_ut_example_topojson.py
conftest.py
eigrp-topo1/test_eigrp_topo1.py
example-test/__init__.py
example-test/test_example.py
example-test/test_template.py
example-topojson-test/__init__.py
example-topojson-test/test_topo_json_multiple_links/__init__.py
example-topojson-test/test_topo_json_multiple_links/test_example_topojson_multiple_links.py
example-topojson-test/test_topo_json_single_link/__init__.py
example-topojson-test/test_topo_json_single_link/test_example_topojson.py
isis-topo1/__init__.py
isis-topo1/test_isis_topo1.py
ldp-topo1/test_ldp_topo1.py
ldp-vpls-topo1/__init__.py
ldp-vpls-topo1/test_ldp_vpls_topo1.py
lib/__init__.py
lib/bgp.py
lib/bgprib.py
lib/common_config.py
lib/ltemplate.py
lib/lutil.py
lib/test/__init__.py
lib/test/test_json.py
lib/test/test_version.py
lib/topogen.py
lib/topojson.py
lib/topolog.py
lib/topotest.py
lm-proxy-topo1/test_lm-proxy-topo1.py
ospf-sr-topo1/__init__.py
ospf-sr-topo1/test_ospf_sr_topo1.py
ospf-topo1-vrf/__init__.py
ospf-topo1-vrf/test_ospf_topo1_vrf.py
ospf-topo1/__init__.py
ospf-topo1/test_ospf_topo1.py
ospf6-topo1/test_ospf6_topo1.py
rip-topo1/test_rip_topo1.py
ripng-topo1/test_ripng_topo1.py
